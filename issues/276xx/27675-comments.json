[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [sdaftuar](https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1553249207), [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592610995), [sipa](https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1638845486) |\n| Stale ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/27675#pullrequestreview-1517398008), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/27675#pullrequestreview-1562445761), [glozow](https://github.com/bitcoin/bitcoin/pull/27675#pullrequestreview-1563072550) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28107](https://github.com/bitcoin/bitcoin/pull/28107) (util: Type-safe transaction identifiers by dergoegge)\n* [#27630](https://github.com/bitcoin/bitcoin/pull/27630) (p2p: Increase tx relay rate by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-05-16T13:45:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1549705895",
      "id" : 1549705895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585cXqKn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549705895/reactions"
      },
      "updated_at" : "2023-08-07T09:52:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549705895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "As justification for ignoring the privacy benefits of rate limiting INV messages, consider the following approach: an attacker makes multiple inbound connections to our peer, and upon receiving an INV of txs a,b,c,d,... via one connection immediately announces the same txs on each of its other connections. In that case the next INV we send on some other connection to the attacker will skip those transactions, providing a new unique set. With this approach, the attacker should be able to receive tx announcements from us at many times the 7tx/s limit we originally set.",
      "created_at" : "2023-05-16T13:48:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1549711784",
      "id" : 1549711784,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585cXrmo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549711784/reactions"
      },
      "updated_at" : "2023-05-16T13:48:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549711784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195220741"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195220741"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Looks like this will make inbound peers be treated identical to outbound ones for the purposes of getdata, as long as mapRelay is still around. For in-mempool txs it may be possible to fix by moving the time check outside of `info_for_relay` into this function and returning a nullptr early if the tx is known to not be announced. For non-mempool txs, I don't know.",
      "commit_id" : "bbf5dcf47b604ebbf980e7f9236f558724046365",
      "created_at" : "2023-05-16T14:04:22Z",
      "diff_hunk" : "@@ -2261,26 +2253,17 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_send_time);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);\n     }\n \n-    // Otherwise, the transaction must have been announced recently.\n-    if (tx_relay.m_recently_announced_invs.contains(gtxid.GetHash())) {\n-        // If it was, it can be relayed from either the mempool...\n-        if (txinfo.tx) return std::move(txinfo.tx);\n-        // ... or the relay pool.\n-        auto mi = mapRelay.find(gtxid.GetHash());\n-        if (mi != mapRelay.end()) return mi->second;\n-    }\n+    // Otherwise, the transaction must have been announced recently or removed from the mempool.\n+    // If the latter, maybe it's in mapRelay!",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195220741",
      "id" : 1195220741,
      "line" : 2264,
      "node_id" : "PRRC_kwDOABII585HPZ8F",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 2264,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 91,
      "pull_request_review_id" : 1428669748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195220741/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T15:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195220741",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195225774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195225774"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: My recommendation would be to not rename the method, or if you want, to pick `GetEntryTime()` over `GetNodeTime()`, because the function doesn't return the current node time but the time of transaction entry.",
      "commit_id" : "bbf5dcf47b604ebbf980e7f9236f558724046365",
      "created_at" : "2023-05-16T14:07:57Z",
      "diff_hunk" : "@@ -126,7 +126,7 @@ class CTxMemPoolEntry\n         return GetVirtualTransactionSize(nTxWeight, sigOpCost, ::nBytesPerSigOp);\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n-    std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    NodeClock::time_point GetNodeTime() const { return nTime; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195225774",
      "id" : 1195225774,
      "line" : 129,
      "node_id" : "PRRC_kwDOABII585HPbKu",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 129,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 23,
      "pull_request_review_id" : 1428669748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195225774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T15:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195225774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195879972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195879972"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I mostly renamed it to make sure there'd be compiler errors anywhere that it didn't get updated, just in case some type conversion happened automatically.",
      "commit_id" : "bbf5dcf47b604ebbf980e7f9236f558724046365",
      "created_at" : "2023-05-17T03:09:33Z",
      "diff_hunk" : "@@ -126,7 +126,7 @@ class CTxMemPoolEntry\n         return GetVirtualTransactionSize(nTxWeight, sigOpCost, ::nBytesPerSigOp);\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n-    std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    NodeClock::time_point GetNodeTime() const { return nTime; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195879972",
      "id" : 1195879972,
      "in_reply_to_id" : 1195225774,
      "line" : 129,
      "node_id" : "PRRC_kwDOABII585HR64k",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 129,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 23,
      "pull_request_review_id" : 1429722989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195879972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T03:09:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195879972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195881028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195881028"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, this is broken as-is. My original idea was to add a timestamp to the `mapRelay` entries too, then it was to drop `mapRelay` and add `vExtraTxnForCompact`-relay, then I compromised by just doing it wrong...",
      "commit_id" : "bbf5dcf47b604ebbf980e7f9236f558724046365",
      "created_at" : "2023-05-17T03:11:57Z",
      "diff_hunk" : "@@ -2261,26 +2253,17 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_send_time);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);\n     }\n \n-    // Otherwise, the transaction must have been announced recently.\n-    if (tx_relay.m_recently_announced_invs.contains(gtxid.GetHash())) {\n-        // If it was, it can be relayed from either the mempool...\n-        if (txinfo.tx) return std::move(txinfo.tx);\n-        // ... or the relay pool.\n-        auto mi = mapRelay.find(gtxid.GetHash());\n-        if (mi != mapRelay.end()) return mi->second;\n-    }\n+    // Otherwise, the transaction must have been announced recently or removed from the mempool.\n+    // If the latter, maybe it's in mapRelay!",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1195881028",
      "id" : 1195881028,
      "in_reply_to_id" : 1195220741,
      "line" : 2264,
      "node_id" : "PRRC_kwDOABII585HR7JE",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 2264,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 91,
      "pull_request_review_id" : 1429724356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195881028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-17T03:11:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195881028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1197968591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197968591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The `NodeClock::now()` time can go backwards, right?  If so I think that could pose some issues if we're primarily relying on system time in order to determine whether transactions should be available for relay. Can we use a steady clock instead?",
      "commit_id" : "3d9d11fa480b9d07466173d39d2426faf9d6890d",
      "created_at" : "2023-05-18T15:31:02Z",
      "diff_hunk" : "@@ -2299,7 +2299,7 @@ void PeerManagerImpl::ProcessGetData(CNode& pfrom, Peer& peer, const std::atomic\n     std::vector<CInv> vNotFound;\n     const CNetMsgMaker msgMaker(pfrom.GetCommonVersion());\n \n-    const auto now{GetTime<std::chrono::seconds>()};\n+    const NodeClock::time_point now = NodeClock::now();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1197968591",
      "id" : 1197968591,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585HZ4zP",
      "original_commit_id" : "023d0503ffdd91d408f10b34905b58f68edcc056",
      "original_line" : 2302,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1432933993,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197968591/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-18T15:31:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197968591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK on getting rid of the recently announced filter.  I think we'd need to use a steady clock to avoid random failures for no good reason, is that easy to do?",
      "created_at" : "2023-05-18T15:41:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1553249207",
      "id" : 1553249207,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585clLO3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553249207/reactions"
      },
      "updated_at" : "2023-05-18T15:41:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553249207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7463573?v=4",
         "events_url" : "https://api.github.com/users/sdaftuar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sdaftuar/followers",
         "following_url" : "https://api.github.com/users/sdaftuar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sdaftuar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sdaftuar",
         "id" : 7463573,
         "login" : "sdaftuar",
         "node_id" : "MDQ6VXNlcjc0NjM1NzM=",
         "organizations_url" : "https://api.github.com/users/sdaftuar/orgs",
         "received_events_url" : "https://api.github.com/users/sdaftuar/received_events",
         "repos_url" : "https://api.github.com/users/sdaftuar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sdaftuar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sdaftuar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1202129704"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202129704"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We could; it'd mean adding an extra field to the mempool, and using both mockable time and steady time for dealing with next invs (mockable time so we can skip over delays in sending invs; steady time for this purpose).",
      "commit_id" : "55b77aa435af626ed4c7dd413aecab57199ae371",
      "created_at" : "2023-05-23T11:29:51Z",
      "diff_hunk" : "@@ -2299,7 +2299,7 @@ void PeerManagerImpl::ProcessGetData(CNode& pfrom, Peer& peer, const std::atomic\n     std::vector<CInv> vNotFound;\n     const CNetMsgMaker msgMaker(pfrom.GetCommonVersion());\n \n-    const auto now{GetTime<std::chrono::seconds>()};\n+    const NodeClock::time_point now = NodeClock::now();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1202129704",
      "id" : 1202129704,
      "in_reply_to_id" : 1197968591,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Hpwso",
      "original_commit_id" : "023d0503ffdd91d408f10b34905b58f68edcc056",
      "original_line" : 2302,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1439442345,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202129704/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-23T11:29:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202129704",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1202222611"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202222611"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might have to use `LossyChronoFormatter` to avoid the fuzz crash?",
      "commit_id" : "55b77aa435af626ed4c7dd413aecab57199ae371",
      "created_at" : "2023-05-23T12:20:03Z",
      "diff_hunk" : "@@ -78,7 +78,7 @@ bool LoadMempool(CTxMemPool& pool, const fs::path& load_path, Chainstate& active\n             }\n             if (nTime > TicksSinceEpoch<std::chrono::seconds>(now - pool.m_expiry)) {\n                 LOCK(cs_main);\n-                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, nTime, /*bypass_limits=*/false, /*test_accept=*/false);\n+                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, NodeClock::time_point{std::chrono::seconds{nTime}}, /*bypass_limits=*/false, /*test_accept=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1202222611",
      "id" : 1202222611,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585HqHYT",
      "original_commit_id" : "71078b35eff1e43dc88203bb4d558b1706210a7d",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_persist.cpp",
      "position" : 5,
      "pull_request_review_id" : 1439563203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202222611/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-23T12:20:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1202222611",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "What's the rationale regarding optimizing for memory instead of privacy here? I can see how this simplifies the design, however, I fail to see this being an obvious pick given we'd be potentially even more exposed to fingerprinting than before (as is now it is trivial for every connection to probe data on the node's mempool).",
      "created_at" : "2023-05-23T18:22:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1559935656",
      "id" : 1559935656,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585c-rqo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559935656/reactions"
      },
      "updated_at" : "2023-05-23T18:22:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559935656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "So just to be clear, my concern here relates to the fact that the current codebase only allows a peer to request a transaction as long as we have announced that to them (with the exception of data requested after a `MEMPOOL` message if we happen run signaling bip37).\r\n\r\nAfter this patch, the logic above won't hold true anymore. If for whatever reason we have more than `INV_BROADCAST_MAX` transactions to send to a given peer at a given time, and we send an INV message to it, it will immediately be able to request any of those new transactions (even if they were never offered). Whether this is in itself a meaningful privacy leak is unclear to me. Under regular loads (<`INV_BROADCAST_MAX` pending transactions to be announced), this behaves exactly like the current codebase.\r\n\r\nI guess it all boils down to whether potentially allowing a peer to know when a transaction enters our mempool is something we should guard about or not.\r\n\r\n",
      "created_at" : "2023-05-31T17:52:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1570662645",
      "id" : 1570662645,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585dnmj1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570662645/reactions"
      },
      "updated_at" : "2023-05-31T17:52:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570662645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What's the rationale regarding optimizing for memory instead of privacy here? I can see how this simplifies the design, however, I fail to see this being an obvious pick given we'd be potentially even more exposed to fingerprinting than before (as is now it is trivial for every connection to probe data on the node's mempool).\r\n\r\nThis isn't trading off privacy -- that's the point of [this comment](https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1549711784). It does mean that someone trying to find out whether a recent transaction entered your mempool in the last window doesn't need multiple inbound connections, but that's a good thing: having many inbound connections is easy for an attacker, so avoiding the need to make many inbound connections just means those inbound slots become available for honest peers.\r\n\r\n> So just to be clear, my concern here relates to the fact that the current codebase only allows a peer to request a transaction as long as we have announced that to them (with the exception of data requested after a `MEMPOOL` message if we happen run signaling bip37).\r\n\r\nThat's already the case for any txs that have been in the mempool for greater than two minutes, and any transactions that have been announced to a peer. Generally that's plenty for fingerprinting -- if you announce pairs of conflicting txs randomly to different nodes, then if you do that 20 times at the same low-ish feerate (so that neither will rbf the other), then wait two minutes, you'll likely already get a nearly unique set of txs that will serve as a fingerprint for any given node.\r\n\r\n> After this patch, the logic above won't hold true anymore. If for whatever reason we have more than `INV_BROADCAST_MAX` transactions to send to a given peer at a given time, and we send an INV message to it, it will immediately be able to request any of those new transactions (even if they were never offered). Whether this is in itself a meaningful privacy leak is unclear to me. Under regular loads (<`INV_BROADCAST_MAX` pending transactions to be announced), this behaves exactly like the current codebase.\r\n> \r\n> I guess it all boils down to whether potentially allowing a peer to know when a transaction enters our mempool is something we should guard about or not.\r\n\r\nThe point of the random INV intervals is that we limit the knowledge of when a transaction entered our mempool to a specific window -- if we send an INV at t=0s, t=1.1s, t=6.1s, t=6.4s, eg, then our peer can tell the difference between a tx that entered at t=0.5s and t=3s, but can't tell the difference between t=3s and t=4s or t=5s, because they're all in the same window. We then use the same window boundaries for all inbound peers so that adding extra inbound peers doesn't give you more precise knowledge.\r\n\r\nIf the attacker only has a single inbound connection, then when the number of txs in a window exceeds `INV_BROADCAST_MAX` they'll get less information; however as the comment above attempted to explain, adding additional inbound connections and manually announcing some txs on some of the connections will allow an attacker to get the full set of txs included in each window. So I don't think it makes sense to consider the `INV_BROADCAST_MAX` limit to have a privacy benefit. (And if we eventually add erlay support, I think that limit goes away entirely for connections doing announcements over erlay rather than INV anyway)",
      "created_at" : "2023-06-02T05:04:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1573150818",
      "id" : 1573150818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585dxGBi",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573150818/reactions"
      },
      "updated_at" : "2023-06-02T05:04:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573150818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > What's the rationale regarding optimizing for memory instead of privacy here? I can see how this simplifies the design, however, I fail to see this being an obvious pick given we'd be potentially even more exposed to fingerprinting than before (as is now it is trivial for every connection to probe data on the node's mempool).\r\n> \r\n> This isn't trading off privacy -- that's the point of [this comment](https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1549711784). It does mean that someone trying to find out whether a recent transaction entered your mempool in the last window doesn't need multiple inbound connections, but that's a good thing: having many inbound connections is easy for an attacker, so avoiding the need to make many inbound connections just means those inbound slots become available for honest peers.\r\n\r\nRight, I don't think I originally fully understood what you meant by that. So the case is:\r\n\r\n- An attacker has `n` inbound connections to node `B` (namely `A0, ..., An-1`)\r\n- `B` sends an `INV` message containing `a, b, c, d` through link `Ai`\r\n    - *During the same message processing loop* for `B`, `A` sends `a, b, c, d` through link `Aj`\r\n    - Now `Aj` will receive an `INV` with a disjoint set for `a, b, c, d` when `B` picks it in this round\r\n\r\nProvided `A` has enough links with `B`, it should be able to get all pending connections in `B`'s mempool in a single round. Is that it? If so, I think this renders all my other comments irrelevant.\r\n\r\n> That's already the case for any txs that have been in the mempool for greater than two minutes, and any transactions that have been announced to a peer. Generally that's plenty for fingerprinting -- if you announce pairs of conflicting txs randomly to different nodes, then if you do that 20 times at the same low-ish feerate (so that neither will rbf the other), then wait two minutes, you'll likely already get a nearly unique set of txs that will serve as a fingerprint for any given node.\r\n\r\nI don't think I follow here though. Would you mind elaborating?",
      "created_at" : "2023-06-02T18:46:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1574166059",
      "id" : 1574166059,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585d094r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1574166059/reactions"
      },
      "updated_at" : "2023-06-02T18:46:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1574166059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1215190508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1215190508"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the answer is just to add a new tx entry field for the steady clock time and use that at natural precision.",
      "commit_id" : "55b77aa435af626ed4c7dd413aecab57199ae371",
      "created_at" : "2023-06-03T04:14:08Z",
      "diff_hunk" : "@@ -78,7 +78,7 @@ bool LoadMempool(CTxMemPool& pool, const fs::path& load_path, Chainstate& active\n             }\n             if (nTime > TicksSinceEpoch<std::chrono::seconds>(now - pool.m_expiry)) {\n                 LOCK(cs_main);\n-                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, nTime, /*bypass_limits=*/false, /*test_accept=*/false);\n+                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, NodeClock::time_point{std::chrono::seconds{nTime}}, /*bypass_limits=*/false, /*test_accept=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1215190508",
      "id" : 1215190508,
      "in_reply_to_id" : 1202222611,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585IblXs",
      "original_commit_id" : "71078b35eff1e43dc88203bb4d558b1706210a7d",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_persist.cpp",
      "position" : 5,
      "pull_request_review_id" : 1458871012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1215190508/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-03T04:14:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1215190508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218613588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218613588"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This includes commits to drop `mapRelay` now (cf #27625) so shouldn't be broken anymore.",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-05T21:26:43Z",
      "diff_hunk" : "@@ -2261,26 +2253,17 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_send_time);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);\n     }\n \n-    // Otherwise, the transaction must have been announced recently.\n-    if (tx_relay.m_recently_announced_invs.contains(gtxid.GetHash())) {\n-        // If it was, it can be relayed from either the mempool...\n-        if (txinfo.tx) return std::move(txinfo.tx);\n-        // ... or the relay pool.\n-        auto mi = mapRelay.find(gtxid.GetHash());\n-        if (mi != mapRelay.end()) return mi->second;\n-    }\n+    // Otherwise, the transaction must have been announced recently or removed from the mempool.\n+    // If the latter, maybe it's in mapRelay!",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218613588",
      "id" : 1218613588,
      "in_reply_to_id" : 1195220741,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IopFU",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 2264,
      "original_position" : 91,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1463499764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218613588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:26:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218613588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218614297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This isn't renamed anymore, instead `GetEntryTime()` is added for the steady clock time tracking mempool entry. (Happy to rename it to something better if someone has a suggestion)",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-05T21:27:40Z",
      "diff_hunk" : "@@ -126,7 +126,7 @@ class CTxMemPoolEntry\n         return GetVirtualTransactionSize(nTxWeight, sigOpCost, ::nBytesPerSigOp);\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n-    std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    NodeClock::time_point GetNodeTime() const { return nTime; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218614297",
      "id" : 1218614297,
      "in_reply_to_id" : 1195225774,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IopQZ",
      "original_commit_id" : "9607a5078dbb6a65913055cf36a14c6e07229309",
      "original_line" : 129,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1463501749,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:27:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218614612"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614612"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Switched to steady clock.",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-05T21:28:03Z",
      "diff_hunk" : "@@ -2299,7 +2299,7 @@ void PeerManagerImpl::ProcessGetData(CNode& pfrom, Peer& peer, const std::atomic\n     std::vector<CInv> vNotFound;\n     const CNetMsgMaker msgMaker(pfrom.GetCommonVersion());\n \n-    const auto now{GetTime<std::chrono::seconds>()};\n+    const NodeClock::time_point now = NodeClock::now();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218614612",
      "id" : 1218614612,
      "in_reply_to_id" : 1197968591,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IopVU",
      "original_commit_id" : "023d0503ffdd91d408f10b34905b58f68edcc056",
      "original_line" : 2302,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1463502605,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614612/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218614612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218615193"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218615193"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Entry time is no longer saved or loaded, so this is no longer relevant.",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-05T21:28:44Z",
      "diff_hunk" : "@@ -78,7 +78,7 @@ bool LoadMempool(CTxMemPool& pool, const fs::path& load_path, Chainstate& active\n             }\n             if (nTime > TicksSinceEpoch<std::chrono::seconds>(now - pool.m_expiry)) {\n                 LOCK(cs_main);\n-                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, nTime, /*bypass_limits=*/false, /*test_accept=*/false);\n+                const auto& accepted = AcceptToMemoryPool(active_chainstate, tx, NodeClock::time_point{std::chrono::seconds{nTime}}, /*bypass_limits=*/false, /*test_accept=*/false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1218615193",
      "id" : 1218615193,
      "in_reply_to_id" : 1202222611,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IopeZ",
      "original_commit_id" : "71078b35eff1e43dc88203bb4d558b1706210a7d",
      "original_line" : 81,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_persist.cpp",
      "position" : null,
      "pull_request_review_id" : 1463504124,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218615193/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T21:28:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218615193",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-12T10:42:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1587069681",
      "id" : 1587069681,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585emMLx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587069681/reactions"
      },
      "updated_at" : "2023-06-12T10:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587069681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\r\n> > [it is trivial for every connection to probe data on the node's mempool] already the case for any txs that have been in the mempool for greater than two minutes, and any transactions that have been announced to a peer. Generally that's plenty for fingerprinting -- if you announce pairs of conflicting txs randomly to different nodes, then if you do that 20 times at the same low-ish feerate (so that neither will rbf the other), then wait two minutes, you'll likely already get a nearly unique set of txs that will serve as a fingerprint for any given node.\r\n> \r\n> I don't think I follow here though. Would you mind elaborating?\r\n\r\nThe easy way to probe for the presence of transaction X in the mempool is to propose a fake transaction Z that spends an unspent output of X, and a fake transaction Y, with fake signatures for both, and see how its orphan handling behaves. If you receive a request for X and Y, then the victim didn't have X in its mempool; if you receive a request for just Y, then it did have X in the mempool; if you don't receive a request for either, then X was not in the mempool and was in its reject filter.\r\n\r\nIf you want to fingerprint a node, for example to see that an ipv4 address and a tor address are both pointing to the same node, then you need to set things up so that each node in the network has a different set of txs in their mempools, then query them to see if the node behind the ipv4 address and the node behind the tor address have the same set of txs. One way to do that is to propose a bunch of double-spends at the same feerate: a1/a2, b1/b2, c1/c2, etc and fire them off at various nodes on the network, then use the previous technique to see which txs actually ended up in the interesting nodes' mempools.\r\n\r\nNone of that requires careful timing -- you just need to set the feerates so they won't either be mined immediately, nor be evicted from the mempool too quickly.",
      "created_at" : "2023-06-12T11:56:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1587182546",
      "id" : 1587182546,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585emnvS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587182546/reactions"
      },
      "updated_at" : "2023-06-12T11:56:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1587182546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't think the multiple inbound connections argument is convincing, unless I am missing something. In practise, the inbound connections are scheduled randomly, so the attacker wouldn't know which inbound is the next one to announce the known invs on. And once they were scheduled by the victim (or the first inv message was sent by the attacker), it is too late to send another inv message, because only one inv message is processed per scheduling round. I haven't done any math, but the cost-vs-payoff should only be linear up to two inbound attacking connections, and quickly fade after?\r\n\r\nThough, the other arguments seem more convincing, so Concept ACK.",
      "created_at" : "2023-06-15T08:36:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592610995",
      "id" : 1592610995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e7VCz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592610995/reactions"
      },
      "updated_at" : "2023-06-15T08:36:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592610995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230650892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230650892"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: may be better to put this right after the `nTime` field to group related stuff?",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-15T08:37:15Z",
      "diff_hunk" : "@@ -83,6 +84,7 @@ class CTxMemPoolEntry\n     const int64_t sigOpCost;        //!< Total sigop cost\n     CAmount m_modified_fee;         //!< Used for determining the priority of the transaction for mining in a block\n     LockPoints lockPoints;          //!< Track the height and time at which tx was final\n+    const SteadyClock::time_point m_entry_time; //!< High-precision time when entering the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230650892",
      "id" : 1230650892,
      "line" : 87,
      "node_id" : "PRRC_kwDOABII585JWj4M",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 87,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 12,
      "pull_request_review_id" : 1481014085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230650892/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-15T08:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230650892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230651860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230651860"
         }
      },
      "author_association" : "MEMBER",
      "body" : "May be good to explain and document what time point to use when or why there are two different ones?",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-15T08:37:45Z",
      "diff_hunk" : "@@ -127,6 +130,7 @@ class CTxMemPoolEntry\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    SteadyClock::time_point GetEntryTime() const { return m_entry_time; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230651860",
      "id" : 1230651860,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII585JWkHU",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 28,
      "pull_request_review_id" : 1481014085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230651860/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-15T08:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230651860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230653996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230653996"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like this one is only to be used internally for relay and the other one is to be used for everything else?",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-15T08:39:21Z",
      "diff_hunk" : "@@ -127,6 +130,7 @@ class CTxMemPoolEntry\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    SteadyClock::time_point GetEntryTime() const { return m_entry_time; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230653996",
      "id" : 1230653996,
      "in_reply_to_id" : 1230651860,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII585JWkos",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 28,
      "pull_request_review_id" : 1481014085,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230653996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-15T08:39:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230653996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I don't think the multiple inbound connections argument is convincing, unless I am missing something. In practise, the inbound connections are scheduled randomly, so the attacker wouldn't know which inbound is the next one to announce the known invs on. And once they were scheduled by the victim (or the first inv message was sent by the attacker), it is too late to send another inv message, because only one inv message is processed per scheduling round.\r\n\r\nI think that's incorrect: if you have three inbound peers, A, B and C, the timing may look something like:\r\n\r\n * t=0, `next_inv_to_inbounds = 4.8s`\r\n * t=1, `SendMessages`, `peerB->m_next_inv_send_time = next_inv_to_inbounds`\r\n * t=1.001, `SendMessages`, `peerA->m_next_inv_send_time = next_inv_to_inbounds`\r\n * t=1.002, `SendMessages`, `peerC->m_next_inv_send_time = next_inv_to_inbounds`\r\n * t=2, `RelayTransaction(tx1)`\r\n * t=3, `RelayTransaction(tx2)`\r\n * t=4, `RelayTransaction(tx3)`\r\n * t=5, `SendMessages`, `peerC->m_next_inv_send_time = next_inv_to_inbounds = 10s`, INV tx1, tx2, tx3 to C\r\n * t=5.001, `SendMessages`, `peerB->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx1, tx2, tx3 to B\r\n * t=5.002, `SendMessages`, `peerA->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx1, tx2, tx3 to A\r\n\r\nNote that `NextInvToInbounds` only gets a new time if `next_inv_to_inbounds < now`, which leaves plenty of time for all the inbound peers to be cycled through before a new time is picked.",
      "created_at" : "2023-06-15T09:13:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592675495",
      "id" : 1592675495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e7kyn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592675495/reactions"
      },
      "updated_at" : "2023-06-15T09:13:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592675495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230714110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230714110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Looks like this one is only to be used internally for relay and the other one is to be used for everything else?\r\n\r\nYeah - `SteadyClock` times aren't comparable between runs (particularly if there was a reboot inbetween), so these timestamps are only useful \"internally\" in general.\r\n\r\nCould alternatively store the value of `mempool->GetSequence()` instead of the `SteadyClock` time for a similar result.",
      "commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "created_at" : "2023-06-15T09:21:09Z",
      "diff_hunk" : "@@ -127,6 +130,7 @@ class CTxMemPoolEntry\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    SteadyClock::time_point GetEntryTime() const { return m_entry_time; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230714110",
      "id" : 1230714110,
      "in_reply_to_id" : 1230651860,
      "line" : 133,
      "node_id" : "PRRC_kwDOABII585JWzT-",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 28,
      "pull_request_review_id" : 1481109700,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230714110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-15T09:21:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230714110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> the timing may look something like:\r\n> \r\n> \r\n>     * t=5, `SendMessages`, `peerC->m_next_inv_send_time = next_inv_to_inbounds = 10s`, INV tx1, tx2, tx3 to C\r\n> \r\n>     * t=5.001, `SendMessages`, `peerB->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx1, tx2, tx3 to B\r\n> \r\n>     * t=5.002, `SendMessages`, `peerA->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx1, tx2, tx3 to A\r\n\r\nIt looks like all inbound peers receive the same INVs, which doesn't look like an attack, but normal operation? Let's assume `INVENTORY_BROADCAST_MAX` is `1`, so as an attacker you'd get:\r\n\r\n* t=5, `SendMessages`, `peerC->m_next_inv_send_time = next_inv_to_inbounds = 10s`, INV tx1 to C\r\n* Attacker fans out `INV tx1` on all connections, because it doesn't know which connection is scheduled/shuffled next\r\n* t=5.0001 `ProcessMessages`, `peerB`, INV tx1 from B\r\n* t=5.001, `SendMessages`, `peerB->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx2 to B\r\n* t=5.0011 `ProcessMessages`, `peerC`, INV tx1 from A\r\n* t=5.002, `SendMessages`, `peerA->m_next_inv_send_Time = next_inv_to_inbounds`, INV tx2 to A\r\n\r\nThus, an attacker can only trivially double the information it can get (tx1+tx2) vs just (tx1). But getting tx3 with three inbound connections only seems possible with probability less than 1 in a single try.",
      "created_at" : "2023-06-15T09:59:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592741852",
      "id" : 1592741852,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e70_c",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592741852/reactions"
      },
      "updated_at" : "2023-06-15T09:59:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592741852",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> It looks like all inbound peers receive the same INVs, which doesn't look like an attack, but normal operation? \r\n\r\nYes, that's ordinary operation, where everyone finds out all the txids you received in an interval automatically. If you'd instead received more than 35 txids in the interval (tx1 .. tx100, say, with tx1 being highest feerate (`compareInvMempoolOrder`)) then everyone would receive `INV tx1..tx35`. For an attacker who wants to know the timing information for all 100 txs, they could make 3 inbound connections, `peerA1` through `peerA3`, as follows:\r\n\r\n * t=4.5, `peerA1` sends INV tx1..tx66 to us\r\n * t=4.51, `peerA2` sends INV tx34..tx100 to us\r\n * t=4.52, `peer A3` sends INV tx1..tx33, tx67..tx100 to us\r\n\r\nand our response would then be to remove the INVed txs from each peer's queue, so when we hit `next_inv_to_inbounds` we'd do:\r\n\r\n * t=5, `SendMessages`, `peerC->m_next_inv_send_time = next_inv_to_inbounds = 10s`, INV tx1..tx35 to C \r\n * t=5.001, `SendMessages`, `peerA1->m_next_inv_send_time = next_inv_to_inbounds`, INV tx67..tx100 to A1\r\n * t=5.002, `SendMessages`, `peerA3->m_next_inv_send_time = next_inv_to_inbounds`, INV tx34..tx66 to A3\r\n * t=5.003, `SendMessages`, `peerA2->m_next_inv_send_time = next_inv_to_inbounds`, INV tx1..tx33 to A2\r\n * t=5.004, `SendMessages`, `peerB->m_next_inv_send_time = next_inv_to_inbounds`, INV tx1..tx35 to B\r\n\r\nand between A1..A3 you receive announcements for all of tx1..tx100 that were accepted into the victim's mempool between the `next_inv_to_inbounds` timestamps of t=0 and t=4.8.\r\n\r\nie, basically if the network's processing up to 7X tx/second, you make X connections to the victim peer, divide the txs you receive into X groups, and announce all txids except for the K'th group to the victim via connection K. (If they request the tx from you, then just quickly reply notfound to avoid biasing the data). Few things to be careful of if you want to actually make that work, but should be find in principle.",
      "created_at" : "2023-06-15T11:37:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592878515",
      "id" : 1592878515,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e8WWz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592878515/reactions"
      },
      "updated_at" : "2023-06-15T11:37:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592878515",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> announce all txids except for the K'th group to the victim\r\n\r\nOk, looks like you are assuming that the attacker already knows all transactions (or txids), and I assumed this is what the attacker wants to find out.",
      "created_at" : "2023-06-15T11:48:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592892773",
      "id" : 1592892773,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e8Z1l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592892773/reactions"
      },
      "updated_at" : "2023-06-15T11:48:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592892773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ok, looks like you are assuming that the attacker already knows all transactions (or txids), and I assumed this is what the attacker wants to find out.\r\n\r\nYou find out txids more quickly just by running a public listening node; the extra information that active probing gets you is information about when a tx was first received by different nodes in the network, from which you can then infer some idea about how the network is connected (\"which nodes should I disrupt in order to partition the network?\") or which node was the source of a given transaction (to remove pseudonymity). This PR means that instead of actively probing via the above method, you could also actively probe by sending \"GETDATA\" messages for txids you haven't yet received an \"INV\" for.",
      "created_at" : "2023-06-15T11:57:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592903782",
      "id" : 1592903782,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e8chm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592903782/reactions"
      },
      "updated_at" : "2023-06-15T11:57:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592903782",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230935886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230935886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Looks like the mempool sequence was added in e76fc2b84d065c9d06010d0a10b316f1f9d36fb9 and is exposed publicly. So I guess it won't be going away any time soon and using it over `SteadyClock` allows to drop the static_assert about the precision (or just having to think about precision at all), as well as avoiding confusion about having two time points?",
      "commit_id" : "001924638b9990c8fa132d8b8adcf3541e2f9682",
      "created_at" : "2023-06-15T12:29:21Z",
      "diff_hunk" : "@@ -127,6 +130,7 @@ class CTxMemPoolEntry\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    SteadyClock::time_point GetEntryTime() const { return m_entry_time; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1230935886",
      "id" : 1230935886,
      "in_reply_to_id" : 1230651860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JXpdO",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1481452497,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230935886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-15T12:29:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230935886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> This PR means that instead of actively probing via the above method, you could also actively probe by sending \"GETDATA\" messages for txids you haven't yet received an \"INV\" for.\r\n\r\nThanks. My comments are unrelated and can be discarded, because this pull's goal isn't to change the externally visible inv sending logic, only the getdata receiving logic.",
      "created_at" : "2023-06-15T12:45:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1592976212",
      "id" : 1592976212,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e8uNU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592976212/reactions"
      },
      "updated_at" : "2023-06-15T12:45:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1592976212",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> The easy way to probe for the presence of transaction X in the mempool is to propose a fake transaction Z that spends an unspent output of X, and a fake transaction Y, with fake signatures for both, and see how its orphan handling behaves. If you receive a request for X and Y, then the victim didn't have X in its mempool; if you receive a request for just Y, then it did have X in the mempool; if you don't receive a request for either, then X was not in the mempool and was in its reject filter.\r\n\r\nThis feels pretty similar to what [TxProbe](https://arxiv.org/abs/1812.00942) used to do to infer links between nodes, and ultimately relates to how orphans are treated differently from mempool transactions both when handed and requested. \r\n\r\nThis is pretty tangential to this PR, but I'm wondering whether it may make sense to change that behavior to always request all the unannounced parents on a given link when an orphan is received through it. In the same way, orphans could be requested, even if known, when offered through a link they haven't been received from. Validation for this type of transaction may even be simplified, given they are already known, so as long as the same data is received nothing else needs to be checked. At a glance, this looks cheap while it will prevent leaking information related to orphans.\r\n\r\n",
      "created_at" : "2023-06-15T20:09:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1593665054",
      "id" : 1593665054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585e_WYe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593665054/reactions"
      },
      "updated_at" : "2023-06-15T20:11:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593665054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could rebase for CI?",
      "created_at" : "2023-06-28T10:54:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1611189572",
      "id" : 1611189572,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585gCM1E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611189572/reactions"
      },
      "updated_at" : "2023-06-28T10:54:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611189572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1245801404"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245801404"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In e16fb7d212bf1dbb5086ed8f452e8e80acbe8325 consider adding the `info_for_relay()` getter declaration next to `info()` and `infoAll()`\r\n\r\n<details><summary>diff</summary><p>\r\n\r\n```diff\r\n--- a/src/txmempool.h\r\n+++ b/src/txmempool.h\r\n@@ -411,8 +411,6 @@ public:\r\n     using txiter = indexed_transaction_set::nth_index<0>::type::const_iterator;\r\n     std::vector<std::pair<uint256, txiter>> vTxHashes GUARDED_BY(cs); //!< All tx witness hashes/entries in mapTx, in random order\r\n \r\n-    TxMempoolInfo info_for_relay(const GenTxid& gtxid, SteadyClock::time_point last_inv) const;\r\n-\r\n     typedef std::set<txiter, CompareIteratorByHash> setEntries;\r\n \r\n     using Limits = kernel::MemPoolLimits;\r\n@@ -710,6 +708,7 @@ public:\r\n         return mapTx.project<0>(mapTx.get<index_by_wtxid>().find(wtxid));\r\n     }\r\n     TxMempoolInfo info(const GenTxid& gtxid) const;\r\n+    TxMempoolInfo info_for_relay(const GenTxid& gtxid, SteadyClock::time_point last_inv) const;\r\n     std::vector<TxMempoolInfo> infoAll() const;\r\n```\r\n</p></details>\r\n",
      "commit_id" : "001924638b9990c8fa132d8b8adcf3541e2f9682",
      "created_at" : "2023-06-28T21:44:44Z",
      "diff_hunk" : "@@ -408,6 +408,8 @@ class CTxMemPool\n     using txiter = indexed_transaction_set::nth_index<0>::type::const_iterator;\n     std::vector<std::pair<uint256, txiter>> vTxHashes GUARDED_BY(cs); //!< All tx witness hashes/entries in mapTx, in random order\n \n+    TxMempoolInfo info_for_relay(const GenTxid& gtxid, SteadyClock::time_point last_inv) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1245801404",
      "id" : 1245801404,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KQWu8",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 411,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : null,
      "pull_request_review_id" : 1504151388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245801404/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-28T21:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245801404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1245804422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245804422"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 930b1c7323be84ad7fb8371ee744f201325f18bb agree with @MarcoFalke to put this next to `nTime`, and it may be nice to document how each is used and why the need for both",
      "commit_id" : "001924638b9990c8fa132d8b8adcf3541e2f9682",
      "created_at" : "2023-06-28T21:49:07Z",
      "diff_hunk" : "@@ -83,6 +84,7 @@ class CTxMemPoolEntry\n     const int64_t sigOpCost;        //!< Total sigop cost\n     CAmount m_modified_fee;         //!< Used for determining the priority of the transaction for mining in a block\n     LockPoints lockPoints;          //!< Track the height and time at which tx was final\n+    const SteadyClock::time_point m_entry_time; //!< High-precision time when entering the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1245804422",
      "id" : 1245804422,
      "in_reply_to_id" : 1230650892,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KQXeG",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 87,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1504151388,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245804422/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-28T21:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1245804422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1248242406"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242406"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No longer relevant",
      "commit_id" : "001924638b9990c8fa132d8b8adcf3541e2f9682",
      "created_at" : "2023-06-30T20:00:27Z",
      "diff_hunk" : "@@ -83,6 +84,7 @@ class CTxMemPoolEntry\n     const int64_t sigOpCost;        //!< Total sigop cost\n     CAmount m_modified_fee;         //!< Used for determining the priority of the transaction for mining in a block\n     LockPoints lockPoints;          //!< Track the height and time at which tx was final\n+    const SteadyClock::time_point m_entry_time; //!< High-precision time when entering the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1248242406",
      "id" : 1248242406,
      "in_reply_to_id" : 1230650892,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KZqrm",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 87,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1507821901,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242406/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T20:00:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242406",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1248242732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242732"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated to use the mempool sequence number rather than `SteadyClock`",
      "commit_id" : "001924638b9990c8fa132d8b8adcf3541e2f9682",
      "created_at" : "2023-06-30T20:00:58Z",
      "diff_hunk" : "@@ -127,6 +130,7 @@ class CTxMemPoolEntry\n     }\n     size_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n+    SteadyClock::time_point GetEntryTime() const { return m_entry_time; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1248242732",
      "id" : 1248242732,
      "in_reply_to_id" : 1230651860,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KZqws",
      "original_commit_id" : "500e31e87b33418a0747a0f3118db9ceb23896be",
      "original_line" : 133,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1507822403,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242732/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T20:00:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248242732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased and switched to using the mempool sequence instead of `SteadyClock`",
      "created_at" : "2023-06-30T20:01:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1615138376",
      "id" : 1615138376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585gRQ5I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615138376/reactions"
      },
      "updated_at" : "2023-06-30T20:01:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615138376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Seeing this thread safety warning locally with the fuzz build only (ARM64 clang 16).\r\n\r\n```\r\nnet_processing.cpp:5769:63: warning: calling function 'GetSequence' requires holding mutex 'm_mempool.cs' exclusively [-Wthread-safety-analysis]\r\n                    tx_relay->m_last_inv_sequence = m_mempool.GetSequence();\r\n                                                              ^\r\n1 warning generated.\r\n```\r\n",
      "created_at" : "2023-06-30T21:11:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1615199522",
      "id" : 1615199522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585gRf0i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615199522/reactions"
      },
      "updated_at" : "2023-06-30T21:11:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615199522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253438163"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253438163"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "eb4dc54 Are these special member functions [needed](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-zero), and if yes, [declare them all?](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#c21-if-you-define-or-delete-any-copy-move-or-destructor-function-define-or-delete-them-all) A comment in the commit explaining why they are added would be helpful.\r\n```diff\r\n+    CTxMemPoolEntry() = delete;\r\n+    ~CTxMemPoolEntry() = default;\r\n     CTxMemPoolEntry(const CTxMemPoolEntry&) = default;\r\n-    CTxMemPoolEntry& operator=(const CTxMemPoolEntry&) = delete;\r\n-\r\n-    // can't be moved\r\n+    CTxMemPoolEntry& operator=(const CTxMemPoolEntry&) = delete; // disallow copy assignment\r\n     CTxMemPoolEntry(CTxMemPoolEntry&&) = default;\r\n-    CTxMemPoolEntry& operator=(CTxMemPoolEntry&&) = delete;\r\n+    CTxMemPoolEntry& operator=(CTxMemPoolEntry&&) = delete;  // disallow move assignment\r\n```\r\n",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T17:44:27Z",
      "diff_hunk" : "@@ -120,6 +123,13 @@ class CTxMemPoolEntry\n           nModFeesWithAncestors{nFee},\n           nSigOpCostWithAncestors{sigOpCost} {}\n \n+    CTxMemPoolEntry(const CTxMemPoolEntry&) = default;\n+    CTxMemPoolEntry& operator=(const CTxMemPoolEntry&) = delete;\n+\n+    // can't be moved\n+    CTxMemPoolEntry(CTxMemPoolEntry&&) = default;\n+    CTxMemPoolEntry& operator=(CTxMemPoolEntry&&) = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253438163",
      "id" : 1253438163,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KtfLT",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 131,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253438163/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253438163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253457842"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253457842"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "eb4dc54 These changes seem needed due to the special member functions added to `CTxMemPoolEntry` in the same commit? If they are changed, a comment in the commit explaining why would be helpful.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T18:06:00Z",
      "diff_hunk" : "@@ -54,12 +54,12 @@ class LOCKABLE Epoch\n \n         // only allow modification via Epoch member functions\n         friend class Epoch;\n-        Marker& operator=(const Marker&) = delete;\n \n     public:\n         Marker() = default;\n         Marker(const Marker&) = default;\n-        Marker(Marker&&) = delete;\n+        Marker(Marker&&) = default;\n+        Marker& operator=(const Marker&) = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253457842",
      "id" : 1253457842,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Ktj-y",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 62,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/util/epochguard.h",
      "position" : null,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253457842/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253457842",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253479064"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253479064"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unrelated to this pull, but seems odd that `entry_height` is set to 0 here when 1 is the usual initial value.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T18:26:48Z",
      "diff_hunk" : "@@ -676,7 +676,7 @@ class ChainImpl : public Chain\n     {\n         if (!m_node.mempool) return true;\n         LockPoints lp;\n-        CTxMemPoolEntry entry(tx, 0, 0, 0, false, 0, lp);\n+        CTxMemPoolEntry entry(tx, 0, 0, 0, 0, false, 0, lp);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253479064",
      "id" : 1253479064,
      "line" : 679,
      "node_id" : "PRRC_kwDOABII585KtpKY",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 679,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 5,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253479064/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253479064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253501078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253501078"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ca6379eb While touching this, with guaranteed copy elision it's now almost always a pessimization to return `std::move(local)` (and the other remaining return values in this function are `return it->second;` and `{}`).\r\n\r\n```suggestion\r\n        return txinfo.tx;\r\n```\r\n",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T18:49:55Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253501078",
      "id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585KtuiW",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253501078/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253501078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253541014"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253541014"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/ca6379eba56ca8f669fea6c91877e9ecbb31451b why is `peer->m_wtxid_relay` added in this conditional? (in which case the comment just below would need updating)",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T19:31:02Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253541014",
      "id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585Kt4SW",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253541014/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253541014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253548429"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253548429"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/ca6379eba56ca8f669fea6c91877e9ecbb31451b It looks like the documentation above needs updating, i.e. `s/current_time/current sequence/`, now that `tx_relay->m_last_inv_send_time = SteadyClock::now();` in this commit was changed to `tx_relay->m_last_inv_sequence = m_mempool.GetSequence();`",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T19:35:17Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {\n                             // Insert txid into m_tx_inventory_known_filter, even for\n                             // wtxidrelay peers. This prevents re-adding of\n                             // unconfirmed parents to the recently_announced\n                             // filter, when a child tx is requested. See\n                             // ProcessGetData().\n-                            tx_relay->m_tx_inventory_known_filter.insert(txid);\n+                            tx_relay->m_tx_inventory_known_filter.insert(txinfo.tx->GetHash());\n                         }\n                     }\n+\n+                    // We don't hold cs_main or mempool.cs prior to setting current_time,\n+                    // so it's possible a tx could have been added to the mempool and included\n+                    // in m_tx_inventory_to_send and INVed above with a mempool nTime after\n+                    // current_time. As such, only get the current time after sending all the invs.\n+                    LOCK(m_mempool.cs);\n+                    tx_relay->m_last_inv_sequence = m_mempool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253548429",
      "id" : 1253548429,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Kt6GN",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5770,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253548429/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253548429",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253614165"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253614165"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/eb4dc54b3c9b9edad9b469b07cbac0573bbf1a37 A Doxygen doc explaining the `for_relay` aspect and `last_sequence` logic would be handy.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T20:30:29Z",
      "diff_hunk" : "@@ -708,6 +708,7 @@ class CTxMemPool\n         return mapTx.project<0>(mapTx.get<index_by_wtxid>().find(wtxid));\n     }\n     TxMempoolInfo info(const GenTxid& gtxid) const;\n+    TxMempoolInfo info_for_relay(const GenTxid& gtxid, uint64_t last_sequence) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253614165",
      "id" : 1253614165,
      "line" : 718,
      "node_id" : "PRRC_kwDOABII585KuKJV",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 718,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 19,
      "pull_request_review_id" : 1515038131,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253614165/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T20:38:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253614165",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253703097"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253703097"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, yuck; that's a bad rebase. :(",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T22:07:24Z",
      "diff_hunk" : "@@ -120,6 +123,13 @@ class CTxMemPoolEntry\n           nModFeesWithAncestors{nFee},\n           nSigOpCostWithAncestors{sigOpCost} {}\n \n+    CTxMemPoolEntry(const CTxMemPoolEntry&) = default;\n+    CTxMemPoolEntry& operator=(const CTxMemPoolEntry&) = delete;\n+\n+    // can't be moved\n+    CTxMemPoolEntry(CTxMemPoolEntry&&) = default;\n+    CTxMemPoolEntry& operator=(CTxMemPoolEntry&&) = delete;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253703097",
      "id" : 1253703097,
      "in_reply_to_id" : 1253438163,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Kuf25",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 131,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : null,
      "pull_request_review_id" : 1515444023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253703097/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T22:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253703097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253707986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253707986"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "That's moving a member of a local struct/object, not a simple local, so it can't have been constructed in place and copy/move elision isn't possible, though?",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T22:14:34Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253707986",
      "id" : 1253707986,
      "in_reply_to_id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585KuhDS",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515450372,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253707986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T22:14:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253707986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253709698"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253709698"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, you may be right.\r\n\r\nhttps://shaharmike.com/cpp/rvo/#returning-member\r\n",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T22:17:38Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253709698",
      "id" : 1253709698,
      "in_reply_to_id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585KuheC",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515452719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253709698/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:06:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253709698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253739563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253739563"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "<details><summary>If this test is valid (arm64 clang 16), returning the struct member without std::move may be better</summary><p>\r\n\r\n```cpp\r\n// rvo.cpp\r\n\r\n#include <iostream>\r\n\r\nstruct Snitch {   // Note: All methods have side effects\r\n    Snitch() { std::cout << \"ctor\" << std::endl; }\r\n    ~Snitch() { std::cout << \"dtor\" << std::endl; }\r\n\r\n    Snitch(const Snitch&) { std::cout << \"copy ctor\" << std::endl; }\r\n    Snitch(Snitch&&) { std::cout << \"move ctor\" << std::endl; }\r\n\r\n    Snitch& operator=(const Snitch&) {\r\n        std::cout << \"copy assignment\" << std::endl;\r\n        return *this;\r\n    }\r\n\r\n    Snitch& operator=(Snitch&&) {\r\n        std::cout << \"move assignment\" << std::endl;\r\n        return *this;\r\n    }\r\n};\r\n\r\nstruct Wrapper {\r\n    Snitch snitch;\r\n    int i;\r\n};\r\n\r\nSnitch foo() {\r\n    auto s = Wrapper().snitch;\r\n    return s;\r\n}\r\n\r\nSnitch foo_move() {\r\n    auto s = Wrapper().snitch;\r\n    return std::move(s);\r\n}\r\n\r\n\r\nint main() {\r\n    std::cout << \"\\nfoo_move...\" << std::endl;\r\n    Snitch t = foo_move();\r\n\r\n    std::cout << \"\\nfoo...\" << std::endl;\r\n    Snitch s = foo();\r\n\r\n    std::cout << \"\\ndone...\" << std::endl;\r\n    return 0;\r\n}\r\n\r\n// $ clang++ -std=c++17 -stdlib=libc++ rvo.cpp && ./a.out\r\n//\r\n// foo_move...\r\n// ctor\r\n// move ctor\r\n// dtor\r\n// move ctor\r\n// dtor\r\n//\r\n// foo...\r\n// ctor\r\n// move ctor\r\n// dtor\r\n//\r\n// done...\r\n// dtor\r\n// dtor\r\n```\r\n\r\n</p></details>\r\n\r\nNot necessarily for this pull, but was curious to find out.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T23:05:59Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253739563",
      "id" : 1253739563,
      "in_reply_to_id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585Kuowr",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515493315,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253739563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:08:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253739563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253743213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253743213"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For wtxid relay peers the prior `.insert(hash)` line adds the wtxid to the filter; for non-wtxid relay peers, it adds the txid to the filter. We only need to do a second insert to add the txid for wtxid relay peers, and then only when the wtxid is actually different to the txid. The extra check is just because testing a bool is easier than comparing two uint256s.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T23:11:30Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253743213",
      "id" : 1253743213,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585Kuppt",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1515498106,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253743213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:11:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253743213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253748543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253748543"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T23:23:05Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {\n                             // Insert txid into m_tx_inventory_known_filter, even for\n                             // wtxidrelay peers. This prevents re-adding of\n                             // unconfirmed parents to the recently_announced\n                             // filter, when a child tx is requested. See\n                             // ProcessGetData().\n-                            tx_relay->m_tx_inventory_known_filter.insert(txid);\n+                            tx_relay->m_tx_inventory_known_filter.insert(txinfo.tx->GetHash());\n                         }\n                     }\n+\n+                    // We don't hold cs_main or mempool.cs prior to setting current_time,\n+                    // so it's possible a tx could have been added to the mempool and included\n+                    // in m_tx_inventory_to_send and INVed above with a mempool nTime after\n+                    // current_time. As such, only get the current time after sending all the invs.\n+                    LOCK(m_mempool.cs);\n+                    tx_relay->m_last_inv_sequence = m_mempool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253748543",
      "id" : 1253748543,
      "in_reply_to_id" : 1253548429,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Kuq8_",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5770,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1515505296,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253748543/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:23:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253748543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253751283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253751283"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the test you want is `auto s = Wrapper(); return std::move(s.snitch);`",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T23:27:16Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253751283",
      "id" : 1253751283,
      "in_reply_to_id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585Kurnz",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515508793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253751283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:27:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253751283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253753580"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253753580"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "You're right, thanks.\r\n\r\n```\r\nfoo_move...\r\nctor\r\nmove ctor\r\ndtor\r\n\r\nfoo...\r\nctor\r\ncopy ctor\r\ndtor\r\n```\r\n",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-05T23:29:53Z",
      "diff_hunk" : "@@ -2290,22 +2282,14 @@ void PeerManagerImpl::ProcessGetBlockData(CNode& pfrom, Peer& peer, const CInv&\n     }\n }\n \n-CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid, const std::chrono::seconds mempool_req, const std::chrono::seconds now)\n+CTransactionRef PeerManagerImpl::FindTxForGetData(const Peer::TxRelay& tx_relay, const GenTxid& gtxid)\n {\n-    auto txinfo = m_mempool.info(gtxid);\n+    // If a tx was in the mempool prior to the last INV for this peer, permit the request.\n+    auto txinfo = m_mempool.info_for_relay(gtxid, tx_relay.m_last_inv_sequence);\n     if (txinfo.tx) {\n-        // If a TX could have been INVed in reply to a MEMPOOL request,\n-        // or is older than UNCONDITIONAL_RELAY_DELAY, permit the request\n-        // unconditionally.\n-        if ((mempool_req.count() && txinfo.m_time <= mempool_req) || txinfo.m_time <= now - UNCONDITIONAL_RELAY_DELAY) {\n-            return std::move(txinfo.tx);\n-        }\n+        return std::move(txinfo.tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253753580",
      "id" : 1253753580,
      "in_reply_to_id" : 1253501078,
      "line" : 2290,
      "node_id" : "PRRC_kwDOABII585KusLs",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 2290,
      "original_position" : 80,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 80,
      "pull_request_review_id" : 1515511850,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253753580/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-05T23:29:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253753580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated for jonatack's review -- removes unneeded code changes, updates comments.",
      "created_at" : "2023-07-05T23:30:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1622681555",
      "id" : 1622681555,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585guCfT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622681555/reactions"
      },
      "updated_at" : "2023-07-05T23:30:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622681555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254974082"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254974082"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, makes sense, and I see that your change makes the conditional here the same as in `ProcessMessage::TX` followed by the same comment; that `m_wtxid_relay` check and both comments were added in ac88e2eb6198.\r\n\r\n```cpp\r\n        if (peer->m_wtxid_relay && txid != wtxid) {\r\n            // Insert txid into m_tx_inventory_known_filter, even for\r\n            // wtxidrelay peers. This prevents re-adding of\r\n            // unconfirmed parents to the recently_announced\r\n            // filter, when a child tx is requested. See\r\n            // ProcessGetData().\r\n            AddKnownTx(*peer, txid);\r\n        }\r\n```",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-06T22:09:22Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254974082",
      "id" : 1254974082,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585KzWKC",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1517393245,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254974082/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T01:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254974082",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254977700"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254977700"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "caf32d2 mentioning `m_sequence_number`'s new responsibility for p2p tx relay might be helpful (or alternatively, drop \"external\")\r\n\r\n```suggestion\r\n    // In-memory counter for internal (p2p tx relay) and external (zmq) mempool tracking purposes.\r\n```",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-06T22:15:24Z",
      "diff_hunk" : "@@ -334,6 +334,9 @@ class CTxMemPool\n     // In-memory counter for external mempool tracking purposes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254977700",
      "id" : 1254977700,
      "line" : 334,
      "node_id" : "PRRC_kwDOABII585KzXCk",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 334,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 1,
      "pull_request_review_id" : 1517398008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254977700/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T23:07:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254977700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254980474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254980474"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "caf32d2 nit if you retouch, could be `[[nodiscard]]`",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-06T22:20:18Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1254980474",
      "id" : 1254980474,
      "line" : 135,
      "node_id" : "PRRC_kwDOABII585KzXt6",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 135,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 29,
      "pull_request_review_id" : 1517398008,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254980474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T23:17:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254980474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255524853"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255524853"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think this just refers to external to the *mempool*.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-07T09:19:38Z",
      "diff_hunk" : "@@ -334,6 +334,9 @@ class CTxMemPool\n     // In-memory counter for external mempool tracking purposes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255524853",
      "id" : 1255524853,
      "in_reply_to_id" : 1254977700,
      "line" : 334,
      "node_id" : "PRRC_kwDOABII585K1cn1",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 334,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 1,
      "pull_request_review_id" : 1518419562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255524853/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T10:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255524853",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255585328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255585328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is adding the txid still necessary though?\r\n\r\nIIUC, the purpose of adding this transaction's txid to `inventory_known_filter` is to save a step if this transaction has an unconfirmed child (if it already existed in this filter, then we wouldn't add it to the `recently_announced` filter). The PR is deleting those lines from `ProcessGetData`, and that's fine since an unconfirmed parent's sequence number should before that of its child.\r\nBut I'm not able to see another reason why we should add the txid to the `inventory_known_filter`, so why not delete this whole block?\r\n\r\nIf it's still needed, it probably makes sense to update the 2 comments since they mention recently_announced filter.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-07T10:04:45Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255585328",
      "id" : 1255585328,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585K1rYw",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1518419562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255585328/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T10:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255585328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255631372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255631372"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n/** Target number of transaction inventory items to send per transmission. */\r\n```",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-07T10:43:48Z",
      "diff_hunk" : "@@ -147,8 +147,12 @@ static constexpr auto OUTBOUND_INVENTORY_BROADCAST_INTERVAL{2s};\n /** Maximum rate of inventory items to send per second.\n  *  Limits the impact of low-fee transaction floods. */\n static constexpr unsigned int INVENTORY_BROADCAST_PER_SECOND = 7;\n+/** Target number of inventory items to send per transmission. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255631372",
      "id" : 1255631372,
      "line" : 150,
      "node_id" : "PRRC_kwDOABII585K12oM",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 150,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1518419562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255631372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T10:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255631372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255997178"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255997178"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There's also the RPC, so maybe (or something equivalent)\r\n\r\n`// In-memory counter used for P2P tx relay, RPC, and ZMQ mempool tracking purposes.`",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-07T15:20:45Z",
      "diff_hunk" : "@@ -334,6 +334,9 @@ class CTxMemPool\n     // In-memory counter for external mempool tracking purposes.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1255997178",
      "id" : 1255997178,
      "in_reply_to_id" : 1254977700,
      "line" : 334,
      "node_id" : "PRRC_kwDOABII585K3P76",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 334,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 1,
      "pull_request_review_id" : 1519154270,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255997178/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-07T15:20:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255997178",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1257388744"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257388744"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> since an unconfirmed parent's sequence number should before that of its child.\r\n\r\nWhat if a reorg happens, which adds a formerly-confirmed parent of an unconfirmed transaction back to the mempool?\r\n\r\nI don't think this example is particularly relevant in this situation (in such circumstances suboptimal relay is to be expected anyway), but perhaps it's enough to make a blanket assumption that parent.entry_sequence < child.entry_sequence.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-09T00:06:16Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1257388744",
      "id" : 1257388744,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585K8jrI",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1520826091,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257388744/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-09T00:06:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257388744",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\n----------------\r\n\r\nI was curious whether bumping a sequence number (RBF, then RBF back the target tx) is anything interesting. I think it's ok:\r\n- it doesn't provide any advantage for relay-delay over the regular RBF\r\n- it doesn't look different either (NOTFOUND as opposed to ignoring the GETDATA or whatnot) âÂ might be worth mentioning somewhere that they should look equal?",
      "created_at" : "2023-07-12T12:43:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1632462419",
      "id" : 1632462419,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585hTWZT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1632462419/reactions"
      },
      "updated_at" : "2023-07-12T12:43:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1632462419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1261909269"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261909269"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe we could recover that as an invariant by having txs added in `MaybeUpdateMempoolForReorg` set the sequence number as 0? The idea being that if they've made it into a block then we've probably announced the headers already so it's no secret that we knew about the tx anyway...",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-13T02:34:26Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1261909269",
      "id" : 1261909269,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585LNzUV",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1527477257,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261909269/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-13T02:34:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1261909269",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264388335"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264388335"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> But I'm not able to see another reason why we should add the txid to the `inventory_known_filter`, so why not delete this whole block?\r\n\r\nThat seems correct to me.",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-15T11:26:43Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264388335",
      "id" : 1264388335,
      "in_reply_to_id" : 1253541014,
      "line" : 5754,
      "node_id" : "PRRC_kwDOABII585LXQjv",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 191,
      "pull_request_review_id" : 1531344114,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264388335/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-15T11:26:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264388335",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264391225"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264391225"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's okay to discard it though -- you just might as well not have called the function in the first place if you don't care about the return value? (And given it's inline, presumably the compiler will treat it as if it wasn't called anyway).",
      "commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "created_at" : "2023-07-15T11:48:52Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264391225",
      "id" : 1264391225,
      "in_reply_to_id" : 1254980474,
      "line" : 135,
      "node_id" : "PRRC_kwDOABII585LXRQ5",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 135,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 29,
      "pull_request_review_id" : 1531347103,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264391225/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-15T11:48:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264391225",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264440771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264440771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, nodiscard is \"use it or lose it\" (remove it) -- applicable to getter/pure functions and any interfaces where the return value must be checked.  Unlike the latter, if the result of a getter is not used it would not be incorrect, but in that case the call is useless and should be removed; nodiscard just enforces it.\r\n",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-15T14:27:32Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264440771",
      "id" : 1264440771,
      "in_reply_to_id" : 1254980474,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585LXdXD",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 143,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 49,
      "pull_request_review_id" : 1531436313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264440771/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-15T14:27:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264440771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264577309"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577309"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I can see the point of adding `nodiscard` in that case for confusing APIs (eg, where someone not familiar with the API might write `foo.empty()` when they meant `foo.clear()`) but for a `foo.GetBar()` function, it just seems like busy work, that I don't think makes sense to do.",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-15T22:13:06Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264577309",
      "id" : 1264577309,
      "in_reply_to_id" : 1254980474,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585LX-sd",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 143,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 49,
      "pull_request_review_id" : 1531633907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577309/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-15T22:13:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264577392"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577392"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated to not add txids to the known filter for wtxid peers, and to set the entry sequence to 0 when adding txs that were in a block that was reorged out.",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-15T22:14:16Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1264577392",
      "id" : 1264577392,
      "in_reply_to_id" : 1253541014,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LX-tw",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1531634026,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577392/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-15T22:14:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264577392",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265149164"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265149164"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fec00d787b5530bbe892bef575fbb3cdc9d586ca\r\n\r\nnit: you may drop the `args.` part and it will work because `bypass_limits` var is initialized above.",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-17T10:18:09Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(), m_pool.GetSequence(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = args.m_bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265149164",
      "id" : 1265149164,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585LaKTs",
      "original_commit_id" : "fec00d787b5530bbe892bef575fbb3cdc9d586ca",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1532439769,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265149164/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-17T10:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265149164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265162383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265162383"
         }
      },
      "author_association" : "MEMBER",
      "body" : "34eab37b08bb9f23459aad179685a505a46759d7\r\nSeems to be still talking about `current_time`?",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-17T10:32:10Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {\n                             // Insert txid into m_tx_inventory_known_filter, even for\n                             // wtxidrelay peers. This prevents re-adding of\n                             // unconfirmed parents to the recently_announced\n                             // filter, when a child tx is requested. See\n                             // ProcessGetData().\n-                            tx_relay->m_tx_inventory_known_filter.insert(txid);\n+                            tx_relay->m_tx_inventory_known_filter.insert(txinfo.tx->GetHash());\n                         }\n                     }\n+\n+                    // We don't hold cs_main or mempool.cs prior to setting current_time,\n+                    // so it's possible a tx could have been added to the mempool and included\n+                    // in m_tx_inventory_to_send and INVed above with a mempool nTime after\n+                    // current_time. As such, only get the current time after sending all the invs.\n+                    LOCK(m_mempool.cs);\n+                    tx_relay->m_last_inv_sequence = m_mempool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265162383",
      "id" : 1265162383,
      "in_reply_to_id" : 1253548429,
      "line" : 5753,
      "node_id" : "PRRC_kwDOABII585LaNiP",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5753,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 226,
      "pull_request_review_id" : 1532459976,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265162383/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-17T10:32:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265162383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265171521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265171521"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is done in the following commit [c88deec](https://github.com/bitcoin/bitcoin/pull/27675/commits/c88deec99d53f55ff76fedaa30c318be6b72d085)",
      "commit_id" : "0753120b6cb270914753d30a2626272f896a8545",
      "created_at" : "2023-07-17T10:42:12Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265171521",
      "id" : 1265171521,
      "in_reply_to_id" : 1253541014,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LaPxB",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5754,
      "original_position" : 199,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1532474060,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265171521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-17T10:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265171521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 0753120b6cb270914753d30a2626272f896a8545 modulo [this (probably lost?) comment](https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1265162383)\r\n\r\nMy favorite achievement of this PR is dropping the complication of associated logic :)\r\n",
      "created_at" : "2023-07-17T11:01:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1637899668",
      "id" : 1637899668,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585hoF2U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1637899668/reactions"
      },
      "updated_at" : "2023-07-17T11:01:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1637899668",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept/approach ACK.",
      "created_at" : "2023-07-17T20:42:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1638845486",
      "id" : 1638845486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585hrswu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1638845486/reactions"
      },
      "updated_at" : "2023-07-17T20:42:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1638845486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1267822413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I messed this up in the [bad rebase](https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1253703097) :( Should be fixed now.",
      "commit_id" : "f5d17e1a3f2856483ad3a6abcf3ea415f2d05fde",
      "created_at" : "2023-07-19T09:33:05Z",
      "diff_hunk" : "@@ -5781,30 +5739,35 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n                         if (!txinfo.tx) {\n                             continue;\n                         }\n-                        auto txid = txinfo.tx->GetHash();\n                         // Peer told you to not send transactions at that feerate? Don't bother sending it.\n                         if (txinfo.fee < filterrate.GetFee(txinfo.vsize)) {\n                             continue;\n                         }\n                         if (tx_relay->m_bloom_filter && !tx_relay->m_bloom_filter->IsRelevantAndUpdate(*txinfo.tx)) continue;\n                         // Send\n-                        tx_relay->m_recently_announced_invs.insert(hash);\n                         vInv.push_back(inv);\n                         nRelayedTransactions++;\n                         if (vInv.size() == MAX_INV_SZ) {\n                             m_connman.PushMessage(pto, msgMaker.Make(NetMsgType::INV, vInv));\n                             vInv.clear();\n                         }\n                         tx_relay->m_tx_inventory_known_filter.insert(hash);\n-                        if (hash != txid) {\n+                        if (peer->m_wtxid_relay && hash != txinfo.tx->GetHash()) {\n                             // Insert txid into m_tx_inventory_known_filter, even for\n                             // wtxidrelay peers. This prevents re-adding of\n                             // unconfirmed parents to the recently_announced\n                             // filter, when a child tx is requested. See\n                             // ProcessGetData().\n-                            tx_relay->m_tx_inventory_known_filter.insert(txid);\n+                            tx_relay->m_tx_inventory_known_filter.insert(txinfo.tx->GetHash());\n                         }\n                     }\n+\n+                    // We don't hold cs_main or mempool.cs prior to setting current_time,\n+                    // so it's possible a tx could have been added to the mempool and included\n+                    // in m_tx_inventory_to_send and INVed above with a mempool nTime after\n+                    // current_time. As such, only get the current time after sending all the invs.\n+                    LOCK(m_mempool.cs);\n+                    tx_relay->m_last_inv_sequence = m_mempool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1267822413",
      "id" : 1267822413,
      "in_reply_to_id" : 1253548429,
      "line" : 5750,
      "node_id" : "PRRC_kwDOABII585LkW9N",
      "original_commit_id" : "284516f8e4303150628286636a629ff5a6f4a84a",
      "original_line" : 5750,
      "original_position" : 215,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 223,
      "pull_request_review_id" : 1536697145,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822413/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T09:33:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1267822689"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822689"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Dropped",
      "commit_id" : "f5d17e1a3f2856483ad3a6abcf3ea415f2d05fde",
      "created_at" : "2023-07-19T09:33:19Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(), m_pool.GetSequence(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = args.m_bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1267822689",
      "id" : 1267822689,
      "in_reply_to_id" : 1265149164,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LkXBh",
      "original_commit_id" : "fec00d787b5530bbe892bef575fbb3cdc9d586ca",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1536697570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822689/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-19T09:33:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267822689",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f5d17e1a3f2856483ad3a6abcf3ea415f2d05fde",
      "created_at" : "2023-07-25T09:41:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1649481055",
      "id" : 1649481055,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585iURVf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649481055/reactions"
      },
      "updated_at" : "2023-07-25T09:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1649481055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1274946418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274946418"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Agree as well.\r\n\r\nI think it is fine to only add `[[nodiscard]]` to functions where it is *harmful* to drop the result. Otherwise one ends up adding the attribute to *every* function that isn't `void`, which seems bloaty and unreadable?\r\n\r\nIf that was the goal, it could be easier achieved with a clang-tidy plugin, without touching or bloating any code at all.",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-07-26T13:18:52Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1274946418",
      "id" : 1274946418,
      "in_reply_to_id" : 1254980474,
      "line" : 135,
      "node_id" : "PRRC_kwDOABII585L_iNy",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 135,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 29,
      "pull_request_review_id" : 1547716506,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274946418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-26T13:18:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274946418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1275250233"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275250233"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Right, nodiscard is \"use it or lose it\" (remove it) -- applicable to getter/pure functions and any interfaces where the return value must be checked. Unlike the latter, if the result of a getter is not used it would not be incorrect, but in that case the call is useless and should be removed; nodiscard just enforces it.\r\n\r\nI use nodiscard for these two cases I describe, where it can simplify review and find issues for me. For instance, when adding it to a declaration I was touching in a pull, it revealed that a relevant unit test was not using the results and thereby highlighted that assertions were missing, which I added. When reviewing a pull having a pure function with many callers or one that is incorrect if not checked, I might add nodiscard and rebuild, and it saves me time if it is already present when initially building the commit.",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-07-26T16:57:46Z",
      "diff_hunk" : "@@ -130,6 +132,7 @@ class CTxMemPoolEntry\n     int32_t GetTxWeight() const { return nTxWeight; }\n     std::chrono::seconds GetTime() const { return std::chrono::seconds{nTime}; }\n     unsigned int GetHeight() const { return entryHeight; }\n+    uint64_t GetSequence() const { return entry_sequence; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1275250233",
      "id" : 1275250233,
      "in_reply_to_id" : 1254980474,
      "line" : 135,
      "node_id" : "PRRC_kwDOABII585MAsY5",
      "original_commit_id" : "172fa815e08b54c61b24d552f065df15046aef3c",
      "original_line" : 135,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 29,
      "pull_request_review_id" : 1548205982,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275250233/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-26T17:01:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275250233",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated to remove some unnecessary constructor changes and misleading comments associated with them.",
      "created_at" : "2023-07-27T02:53:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1652836631",
      "id" : 1652836631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585ihEkX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652836631/reactions"
      },
      "updated_at" : "2023-07-27T02:53:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652836631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 7efb30b",
      "created_at" : "2023-07-27T09:34:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1653253819",
      "id" : 1653253819,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585iiqa7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653253819/reactions"
      },
      "updated_at" : "2023-07-27T09:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653253819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280281473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280281473"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this comment could be misleading after ffa081b007300f28fd9cffe6f4795c1125e2f373\r\n```suggestion\r\n    const uint64_t entry_sequence;  //!< Sequence number used to determine whether this transaction is too recent for relay.\r\n```",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T08:28:51Z",
      "diff_hunk" : "@@ -79,6 +79,7 @@ class CTxMemPoolEntry\n     const size_t nUsageSize;        //!< ... and total memory usage\n     const int64_t nTime;            //!< Local time when entering the mempool\n     const unsigned int entryHeight; //!< Chain height when entering the mempool\n+    const uint64_t entry_sequence;  //!< Sequence number when entering the mempool",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280281473",
      "id" : 1280281473,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII585MT4uB",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 82,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 4,
      "pull_request_review_id" : 1556437447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280281473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280281473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280487599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280487599"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A comment might be helpful\r\n```suggestion\r\n    /** Returns info for a transaction if its entry_sequence <= last_sequence. */\r\n    TxMempoolInfo info_for_relay(const GenTxid& gtxid, uint64_t last_sequence) const;\r\n```",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T11:25:14Z",
      "diff_hunk" : "@@ -708,6 +708,7 @@ class CTxMemPool\n         return mapTx.project<0>(mapTx.get<index_by_wtxid>().find(wtxid));\n     }\n     TxMempoolInfo info(const GenTxid& gtxid) const;\n+    TxMempoolInfo info_for_relay(const GenTxid& gtxid, uint64_t last_sequence) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280487599",
      "id" : 1280487599,
      "line" : 711,
      "node_id" : "PRRC_kwDOABII585MUrCv",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 711,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.h",
      "position" : 4,
      "pull_request_review_id" : 1556437447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280487599/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280487599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280498101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498101"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think there may be an off-by-one here? The sequence number isn't incremented until `TransactionAddedToMempool()` fires later. Which means we could have:\r\nt=0: mempool sequence is 1\r\nt=1: tx A is submitted, `CTxMemPoolEntry` is constructed with `entry_sequence = m_pool.GetSequence() = 1`\r\nt=2: main signals fires `TransactionAddedToMempool(A, m_pool.GetAndIncrementSequence())` with sequence 2\r\nt=3: p2p announces A, `m_last_inv_sequence = m_mempool.GetSequence() = 2`\r\nt=4: new tx B is submitted, `CTxMemPoolEntry` is constructed with `entry_sequence = m_pool.GetSequence() = 2`\r\nt=5: main signals fires `TransactionAddedToMempool(B, m_pool.GetAndIncrementSequence())` with sequence 3\r\nt=6: spy node requests A and B. `FindTxForGetData()` calls `info_for_relay(last_sequence=2)`. A's sequence is 1 and B's sequence is 2. They are both requestable.\r\n\r\nI don't think it's problematic that the `TransactionAddedToMempool` sequence and `entry_sequence` are not the same, but we shouldn't relay B in this situation.\r\n\r\nPerhaps it makes sense to use `m_pool.GetSequence() + 1` here?\r\n\r\nTested in https://github.com/glozow/bitcoin/commit/258b1c8ced55b528d1afc585c23a3d98fa30394b#diff-ad4f4d79f7e644c4ec85670cece6e14ded4302c45016b085bb9bdea5a1075d9cR105-R111",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T11:35:32Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280498101",
      "id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MUtm1",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1556437447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498101/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:53:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280500977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280500977"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the commit message for ffa081b007300f28fd9cffe6f4795c1125e2f373 is \"validation: when adding txs due to a block reorg, allow immediate relay\" but the immediate relay behavior isn't until the subsequent commit when the bloom filter is removed",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T11:38:41Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280500977",
      "id" : 1280500977,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MUuTx",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1556437447,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280500977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T12:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280500977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280656421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280656421"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> The sequence number isn't incremented until TransactionAddedToMempool() fires later.\r\n\r\nDoesn't that mean there are races? (There is no guarantee that `TransactionAddedToMempool()` will always run in the near future)?\r\n\r\nBasically, I am wondering what happens if you reorder `t=2` and `t=3` in your example.",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T13:34:29Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280656421",
      "id" : 1280656421,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MVUQl",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1557023185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280656421/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T13:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280656421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280715228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280715228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Doesn't that mean there are races? (There is no guarantee that `TransactionAddedToMempool()` will always run in the near future)?\r\n\r\nThe mempool value is incremented when TrAddedTMP is queued, not when it's eventually run -- the increment happens first, then the result of the increment is passed through and queued up. So I don't think there's any racy here.\r\n\r\n> Perhaps it makes sense to use `m_pool.GetSequence() + 1` here?\r\n\r\nI think it would make more sense to change `info_for_relay`?\r\n\r\n```c++\r\nTxMempoolInfo CTxMemPool::info_for_relay(const GenTxid& gtxid, uint64_t last_sequence) const\r\n{\r\n    LOCK(cs);\r\n    indexed_transaction_set::const_iterator i = (gtxid.IsWtxid() ? get_iter_from_wtxid(gtxid.GetHash()) : mapTx.find(gtxid.GetHash()));\r\n//  if (i == mapTx.end() || last_sequence < i->GetSequence()) {\r\n    if (i == mapTx.end() || last_sequence <= i->GetSequence()) {\r\n        return TxMempoolInfo();\r\n    } else {\r\n        return GetInfo(i);\r\n    }\r\n}\r\n```",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T14:16:46Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280715228",
      "id" : 1280715228,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MVinc",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1557122291,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280715228/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T14:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280715228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280759603"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280759603"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Doesn't that mean there are races? (There is no guarantee that TransactionAddedToMempool() will always run in the near future)?\r\n\r\nI meant `TransactionAddedToMempool` event happening, not the validation interface clients' callbacks. IIUC the event firing on main signals (which calls `GetAndIncrementSequence()`) happens in validation before `ProcessTransaction` returns:\r\nhttps://github.com/bitcoin/bitcoin/blob/e5a9f2fb62dc4db6cad21b2997d96a881ea64125/src/validation.cpp#L1234\r\n\r\nThe queued callbacks are scheduled and may not have necessarily happened yet, but PeerManager doesn't implement `TransactionAddedToMempool`. It is only interested in the current `GetSequence()` and what is recorded in `mempool_sequence`.\r\n\r\n> Basically, I am wondering what happens if you reorder t=2 and t=3 in your example.\r\n\r\nMy understanding is that `GetSequence()` returns 2 when `ProcessTransaction` is done, even if t=2 and t=3 are swapped.",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T14:48:28Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280759603",
      "id" : 1280759603,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MVtcz",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1557193640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280759603/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T14:48:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280759603",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280780213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280780213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah I didn't see the last message.\r\n\r\n> I think it would make more sense to change info_for_relay?\r\n\r\nsounds good to me",
      "commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "created_at" : "2023-08-01T15:03:12Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1280780213",
      "id" : 1280780213,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MVye1",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1557225764,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280780213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T15:03:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280780213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1283068149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283068149"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated. This also changes the initial value for `m_last_inv_sequence` to `1` instead of `0`. (Note that I reversed the order of the `if .. else` in `info_for_relay` so `GetSeq() < last` becomes `! (GetSeq() <= last)` which is `last < GetSeq()`)",
      "commit_id" : "1a118062fbc4ec8f645f4ec4298d869a869c3344",
      "created_at" : "2023-08-03T11:32:37Z",
      "diff_hunk" : "@@ -834,7 +834,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         }\n     }\n \n-    entry.reset(new CTxMemPoolEntry(ptx, ws.m_base_fees, nAcceptTime, m_active_chainstate.m_chain.Height(),\n+    // Set entry_sequence to 0 when bypass_limits is used; this allows txs from a block\n+    // reorg to be marked earlier than any child txs that were already in the mempool.\n+    const uint64_t entry_sequence = bypass_limits ? 0 : m_pool.GetSequence();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1283068149",
      "id" : 1283068149,
      "in_reply_to_id" : 1280498101,
      "line" : 839,
      "node_id" : "PRRC_kwDOABII585MehD1",
      "original_commit_id" : "7efb30b87d7083bec32ca7208ad63103682be35f",
      "original_line" : 839,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 7,
      "pull_request_review_id" : 1560889968,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283068149/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T11:32:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283068149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Update for glozow's review; fixes off-by-one error and adds some glozow's test coverage of reorg behaviour",
      "created_at" : "2023-08-03T11:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1663824558",
      "id" : 1663824558,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585jK_Ku",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1663824558/reactions"
      },
      "updated_at" : "2023-08-03T11:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1663824558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1284155363"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284155363"
         }
      },
      "author_association" : "MEMBER",
      "body" : "1e9684f39fba909b3501e9402d5b61f4bf744ff2\r\n\"w hether\"",
      "commit_id" : "1a118062fbc4ec8f645f4ec4298d869a869c3344",
      "created_at" : "2023-08-04T08:43:39Z",
      "diff_hunk" : "@@ -79,6 +79,7 @@ class CTxMemPoolEntry\n     const size_t nUsageSize;        //!< ... and total memory usage\n     const int64_t nTime;            //!< Local time when entering the mempool\n     const unsigned int entryHeight; //!< Chain height when entering the mempool\n+    const uint64_t entry_sequence;  //!< Sequence number used to determine w hether this transaction is too recent for relay",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#discussion_r1284155363",
      "id" : 1284155363,
      "line" : 82,
      "node_id" : "PRRC_kwDOABII585Miqfj",
      "original_commit_id" : "1e9684f39fba909b3501e9402d5b61f4bf744ff2",
      "original_line" : 82,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/kernel/mempool_entry.h",
      "position" : 4,
      "pull_request_review_id" : 1562445761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27675",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284155363/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T08:51:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284155363",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> (for me, `sizeof(CTxMemPoolEntry)` even grows from 264 to 280 bytes - packing effects?)\r\n\r\nAdded a commit to fix this.\r\n\r\n> My understanding is that there is a bit of a trade-off with respect to memory (correct me if the byte counting is off!): While it saves 33kB per peer (so ~4MB with 125 peers; ~250kB for non-listening nodes with 8 peers), it also adds at least 8 bytes per mempool entry for `uint64_t entry_sequence`. [..] This seems a bit unsatisfactory because the `entry_sequence` data won't be needed after a few seconds (i.e. after we've sent an inv to each peer).\r\n>\r\n> Assuming a full mempool with `~150k` mempool entries, that is between 1.2 and 2.4MB. Because this is included in the maxmempool limit, it's effectively a decrease in mempool capacity instead of additional memory when the mempool is full.\r\n\r\nEffectively, that's a 0.4% increase in memory usage per tx (2000B per tx for 150k txs in 300MB becomes 2008B per tx for 149.4k txs in 300MB).\r\n\r\nThe main point here though is that with this change is for the case where we need to increase the number of (tx relay) peers or the tx acceptance rate -- the former meaning we'd need to allocate more bloom filters, and the latter meaning we'd need each bloom filter to be significantly bigger (cf #27630).\r\n\r\n> I wonder if there would be a more memory-efficient way to achieve the same behavior - did you consider something like a global list of all recent transactions with timestamp, from which entries could get removed regularly (i.e., after we have sent an inv to each tx-relay peer).\r\n\r\nI did think about that, but it seemed significantly more complicated -- you'd need to either have a map of txid-to-sequence, or a map of txiter-to-sequence; the former would be wasting 24B per entry duplicating the txid, but the latter would need a lot of care to make sure there aren't dangling references to txiters that have been removed from the mempool (and may be reallocated). You'd also need to regularly remove things from this map based on something like `min(peer.last_inv)` over each peer, which seems slightly awkward -- the information in the mempool starts depending on p2p state, rather than just the txs that are in the mempool. \r\n\r\nI do think those approaches would both result in measurable memory savings (1.2MB down to perhaps 100kB at 22tx/sec over 60 seconds?), but to me it just doesn't seem worth the complexity overall.",
      "created_at" : "2023-08-07T10:23:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27675#issuecomment-1667596577",
      "id" : 1667596577,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27675",
      "node_id" : "IC_kwDOABII585jZYEh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667596577/reactions"
      },
      "updated_at" : "2023-08-07T10:23:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667596577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
