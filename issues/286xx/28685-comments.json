[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28685).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28659](https://github.com/bitcoin/bitcoin/pull/28659) (assumeutxo, rpc: Add 'start' parameter to loadtxoutset by hernanmarino)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-19T10:02:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28685#issuecomment-1770482404",
      "id" : 1770482404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28685",
      "node_id" : "IC_kwDOABII585ph2rk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1770482404/reactions"
      },
      "updated_at" : "2023-10-19T11:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1770482404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've written a fuzz test that catches the original bug mention in https://github.com/bitcoin/bitcoin/issues/28675#issuecomment-1770389468: https://github.com/dergoegge/bitcoin/blob/2023-10-fuzz-coinstats-hash/src/test/fuzz/coinstats_hash.cpp.\r\n\r\nI think it also caught a second issue regarding the values of UTXOs, certain negative values seem to result in the same hash as their positive counter part. I have not investigated further but I assume it is realted to `VarIntMode::NONNEGATIVE_SIGNED`.\r\n\r\n```bash\r\n$ echo \"CMoC9Q==\" | base64 --decode > coinstats_hash.crash\r\n$ FUZZ_PRINTF=1 FUZZ=coinstats_hash ./src/test/fuzz/fuzz coinstats_hash.crash\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 3663010564\r\nINFO: Loaded 1 modules   (379542 inline 8-bit counters): 379542 [0x560080cb5d88, 0x560080d1281e),\r\nINFO: Loaded 1 PC tables (379542 PCs): 379542 [0x560080d12820,0x5600812dd180),\r\n./src/test/fuzz/fuzz: Running 1 inputs 1 time(s) each.\r\nRunning: coinstats_hash_crashes/crash-d59c557ae7f9e837716b272a05d1397a94f589d7\r\n2023-10-19T11:34:50Z Opened LevelDB successfully\r\n2023-10-19T11:34:50Z Using obfuscation key for : 0000000000000000\r\n2023-10-19T11:34:50Z mutating a coin\r\n2023-10-19T11:34:50Z coinbase=1 height=1386179375 value=-5934962493229608344 scriptPubKey=[97951910994b0a6104092fbc9b385639]\r\n2023-10-19T11:34:50Z coinbase=1 height=1386179375 value=6856422276773357632 scriptPubKey=[97951910994b0a6104092fbc9b385639]\r\nfuzz: test/fuzz/coinstats_hash.cpp:135: void coinstats_muhash_fuzz_target(FuzzBufferType): Assertion `mutated_result->hashSerialized != result->hashSerialized' failed.\r\n```\r\n\r\nUsing the varints in the serialization for the hashes seems like unnecessary complexity in the first place. Since we are changing the hash format already, maybe we just get rid of the varints entirely?\r\n\r\n(I've not polished the fuzz test, sorry if you run into bugs in the test itself)",
      "created_at" : "2023-10-19T11:41:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28685#issuecomment-1770720541",
      "id" : 1770720541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28685",
      "node_id" : "IC_kwDOABII585piw0d",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1770720541/reactions"
      },
      "updated_at" : "2023-10-19T11:41:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1770720541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   }
]
