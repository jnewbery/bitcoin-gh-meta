[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28616).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-09T09:47:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#issuecomment-1752685932",
      "id" : 1752685932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28616",
      "node_id" : "IC_kwDOABII585od91s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752685932/reactions"
      },
      "updated_at" : "2023-10-09T11:44:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752685932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "There's a glitch in this implementation though, probably not a big deal in practice. Because it relies on `blockConnected` to update the icon, if you restart the node during background sync, then the transaction will show as fully confirmed briefly - until the next block is connected.\r\n\r\nSimilarly, once background sync finishes, it will show as partially confirmed until a new block comes in. Since we don't show background validation progress yet in the GUI, this glitch would only be noticed by someone looking at the log.\r\n\r\nNot sure how involved fixing that is.",
      "created_at" : "2023-10-09T09:50:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#issuecomment-1752693617",
      "id" : 1752693617,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28616",
      "node_id" : "IC_kwDOABII585od_tx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752693617/reactions"
      },
      "updated_at" : "2023-10-09T09:52:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752693617",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `* =` in the current implementation this involves giving someone a malicious binary or getting them to recompile\r\n\r\nNot sure if this pull request is needed then.\r\n\r\nIf someone is running a malicious binary or malicious code, the malicious actor will have this code removed from the binary or code.\r\n\r\nI think this is only needed when the the utxo hash is added as a config option, so my suggestion would be to close this pull and include it in the pull that makes this an option.",
      "created_at" : "2023-10-09T10:19:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#issuecomment-1752736130",
      "id" : 1752736130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28616",
      "node_id" : "IC_kwDOABII585oeKGC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752736130/reactions"
      },
      "updated_at" : "2023-10-09T10:19:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752736130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> If someone is running a malicious binary or malicious code\r\n\r\nThey'd just add code to sweep the wallet.\r\n\r\nThere's also the (remote) possibility of Bitcoin Core shipping an otherwise valid binary with just a bad hash (accidentally or otherwise).\r\n\r\nI think it's reasonable to have _some_ UI differentiator between before and after the background check is finished. There's a difference between your node having validated every block and other people having vouched for the blocks.\r\n\r\nThat could also be a warning message (which would be followed by a crash if background sync completes and finds a different UTXO set). But this seems a bit less alarmist. Until you receive coins, there's no risk anyway.",
      "created_at" : "2023-10-09T12:02:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#issuecomment-1752879978",
      "id" : 1752879978,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28616",
      "node_id" : "IC_kwDOABII585oetNq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752879978/reactions"
      },
      "updated_at" : "2023-10-09T12:16:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1752879978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1350228491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350228491"
         }
      },
      "author_association" : "MEMBER",
      "body" : "be2be21d1740966325213258151d7f3477b19e1e: if #28608 lands first, this would check `role.validated` and `role.most_work` instead (cc @ryanofsky)",
      "commit_id" : "fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4",
      "created_at" : "2023-10-09T12:15:36Z",
      "diff_hunk" : "@@ -1468,12 +1468,30 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n \n void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& block)\n {\n-    if (role == ChainstateRole::BACKGROUND) {\n-        return;\n-    }\n     assert(block.data);\n     LOCK(cs_wallet);\n \n+    switch (role) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1350228491",
      "id" : 1350228491,
      "line" : 1474,
      "node_id" : "PRRC_kwDOABII585QetoL",
      "original_commit_id" : "be2be21d1740966325213258151d7f3477b19e1e",
      "original_line" : 1474,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 10,
      "pull_request_review_id" : 1664320238,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350228491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-09T12:15:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1350228491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1359690548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359690548"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Conditions were covered by the `switch` above.\r\n```suggestion\r\n```",
      "commit_id" : "fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4",
      "created_at" : "2023-10-15T00:08:10Z",
      "diff_hunk" : "@@ -1468,12 +1468,30 @@ void CWallet::transactionRemovedFromMempool(const CTransactionRef& tx, MemPoolRe\n \n void CWallet::blockConnected(ChainstateRole role, const interfaces::BlockInfo& block)\n {\n-    if (role == ChainstateRole::BACKGROUND) {\n-        return;\n-    }\n     assert(block.data);\n     LOCK(cs_wallet);\n \n+    switch (role) {\n+        case ChainstateRole::BACKGROUND:\n+            m_background_validation_height = block.height;\n+            return;\n+        case ChainstateRole::ASSUMEDVALID:\n+            if (m_background_validation_height == -1) {\n+                m_background_validation_height = 0;\n+            }\n+            break;\n+        case ChainstateRole::NORMAL:\n+            m_background_validation_height = -1;\n+            break;\n+    } // no default case, so the compiler can warn about missing cases\n+\n+    if (role == ChainstateRole::BACKGROUND) {\n+        m_background_validation_height = block.height;\n+        return;\n+    } else if (role == ChainstateRole::NORMAL) {\n+        m_background_validation_height = -1;\n+    } else {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1359690548",
      "id" : 1359690548,
      "line" : 1493,
      "node_id" : "PRRC_kwDOABII585RCzs0",
      "original_commit_id" : "fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4",
      "original_line" : 1493,
      "original_position" : 29,
      "original_start_line" : 1488,
      "path" : "src/wallet/wallet.cpp",
      "position" : 29,
      "pull_request_review_id" : 1678529596,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359690548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1488,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-15T00:19:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359690548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1359691870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359691870"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "On the`gui:` comit fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4, was this unintentional?",
      "commit_id" : "fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4",
      "created_at" : "2023-10-15T00:25:12Z",
      "diff_hunk" : "@@ -3376,7 +3376,6 @@ bool CWallet::IsTxAssumed(const CWalletTx& wtx) const EXCLUSIVE_LOCKS_REQUIRED(c\n     return false;\n }\n \n-",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28616#discussion_r1359691870",
      "id" : 1359691870,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RC0Be",
      "original_commit_id" : "fff5cb42dfe91ce1ba1a1aa2269253f262c6e2b4",
      "original_line" : 3379,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 4,
      "pull_request_review_id" : 1678530676,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28616",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359691870/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-15T00:28:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1359691870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   }
]
