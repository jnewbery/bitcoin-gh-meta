[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28652).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28647](https://github.com/bitcoin/bitcoin/pull/28647) (test: Add assumeutxo test for wrong hash by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-15T15:22:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#issuecomment-1763422701",
      "id" : 1763422701,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28652",
      "node_id" : "IC_kwDOABII585pG7Ht",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1763422701/reactions"
      },
      "updated_at" : "2023-10-15T19:07:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1763422701",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Wasn't the goal to make the RPC async, in which case the wait loop can be replaced with an immediate error? This would also avoid having to duplicate error checks in the RPC, as well as the Activate function?",
      "created_at" : "2023-10-16T09:28:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#issuecomment-1764079831",
      "id" : 1764079831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28652",
      "node_id" : "IC_kwDOABII585pJbjX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764079831/reactions"
      },
      "updated_at" : "2023-10-16T09:28:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764079831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Wasn't the goal to make the RPC async, in which case the wait loop can be replaced with an immediate error? This would also avoid having to duplicate error checks in the RPC, as well as the Activate function?\r\n\r\nYes, I think that's one of the long-term plans: https://github.com/bitcoin/bitcoin/issues/28620. It seems that currently no-one is working on that though and even if, it's likely too late to include it into the upcoming release v26 anyway. This PR is based on the assumption that the `loadtxoutset` RPC is released in its current form (if that's the case, we should add an \"EXPERIMENTAL\" warning) and given that, we shouldn't waste users time and leave them up to 10 minutes in the dark (creating the illusion that something useful happens in the background) until they get an error for an RPC that currently can only fail on mainnet. Or is the plan to deactivate `loadtxoutset` until #28620 is implemented?",
      "created_at" : "2023-10-16T10:28:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#issuecomment-1764176774",
      "id" : 1764176774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28652",
      "node_id" : "IC_kwDOABII585pJzOG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764176774/reactions"
      },
      "updated_at" : "2023-10-16T10:30:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1764176774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1360762466"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360762466"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: Use `chainman` to get the params, instead of using the global?",
      "commit_id" : "9620cb449374f234f72c1a9e1bae3d4b8c0ff171",
      "created_at" : "2023-10-16T14:35:49Z",
      "diff_hunk" : "@@ -2751,6 +2751,10 @@ static RPCHelpMan loadtxoutset()\n     afile >> metadata;\n \n     uint256 base_blockhash = metadata.m_base_blockhash;\n+    if (!Params().AssumeutxoForBlockhash(base_blockhash).has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1360762466",
      "id" : 1360762466,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RG5Zi",
      "original_commit_id" : "164273c1e17f2d01becab7e02ad27bf732f10f8d",
      "original_line" : 2754,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1680144671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360762466/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T14:41:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360762466",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1360854657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360854657"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, done. Intentionally moved the `chainman` definition up more than needed (right after `node`) to fail early in the (hypothetical?) case that there's no chainman.",
      "commit_id" : "9620cb449374f234f72c1a9e1bae3d4b8c0ff171",
      "created_at" : "2023-10-16T15:24:11Z",
      "diff_hunk" : "@@ -2751,6 +2751,10 @@ static RPCHelpMan loadtxoutset()\n     afile >> metadata;\n \n     uint256 base_blockhash = metadata.m_base_blockhash;\n+    if (!Params().AssumeutxoForBlockhash(base_blockhash).has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1360854657",
      "id" : 1360854657,
      "in_reply_to_id" : 1360762466,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585RHP6B",
      "original_commit_id" : "164273c1e17f2d01becab7e02ad27bf732f10f8d",
      "original_line" : 2754,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1680306939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360854657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T15:24:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1360854657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1361196621"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361196621"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since we are touching this file I think we could improved the `iostream error` that's thrown when the file size is less than 40 bytes.\r\n\r\n```suggestion\r\n    // Check if the file size is at least as large as the expected size of SnapshotMetadata\r\n    if (afile.size() < sizeof(SnapshotMetadata)) {\r\n        throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(\"Unable to load UTXO snapshot, \"\r\n                \"file size is invalid\");\r\n    }\r\n    afile >> metadata;\r\n\r\n```",
      "commit_id" : "9620cb449374f234f72c1a9e1bae3d4b8c0ff171",
      "created_at" : "2023-10-16T19:49:04Z",
      "diff_hunk" : "@@ -2751,14 +2752,16 @@ static RPCHelpMan loadtxoutset()\n     afile >> metadata;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28652#discussion_r1361196621",
      "id" : 1361196621,
      "line" : 2752,
      "node_id" : "PRRC_kwDOABII585RIjZN",
      "original_commit_id" : "9620cb449374f234f72c1a9e1bae3d4b8c0ff171",
      "original_line" : 2752,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 9,
      "pull_request_review_id" : 1680847579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28652",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361196621/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-16T19:49:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361196621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/110166421?v=4",
         "events_url" : "https://api.github.com/users/pablomartin4btc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pablomartin4btc/followers",
         "following_url" : "https://api.github.com/users/pablomartin4btc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pablomartin4btc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pablomartin4btc",
         "id" : 110166421,
         "login" : "pablomartin4btc",
         "node_id" : "U_kgDOBpEBlQ",
         "organizations_url" : "https://api.github.com/users/pablomartin4btc/orgs",
         "received_events_url" : "https://api.github.com/users/pablomartin4btc/received_events",
         "repos_url" : "https://api.github.com/users/pablomartin4btc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pablomartin4btc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pablomartin4btc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pablomartin4btc"
      }
   }
]
