[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29858).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [tdb3](https://github.com/bitcoin/bitcoin/pull/29858#pullrequestreview-2004787892), [rkrux](https://github.com/bitcoin/bitcoin/pull/29858#pullrequestreview-2045275412) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2024-04-11T18:17:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#issuecomment-2050256004",
      "id" : 2050256004,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29858",
      "node_id" : "IC_kwDOABII5856NGyE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2050256004/reactions"
      },
      "updated_at" : "2024-05-08T11:20:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2050256004",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568068748"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568068748"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: See https://github.com/bitcoin/bitcoin/blob/master/test/functional/README.md#style-guidelines\r\n\r\n>If more than one name from a module is needed, use lexicographically sorted multi-line imports in order to reduce the possibility of potential merge conflicts.",
      "commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "created_at" : "2024-04-17T00:28:40Z",
      "diff_hunk" : "@@ -5,20 +5,28 @@\n \"\"\"\n A test for RPC users with restricted permissions\n \"\"\"\n+\n+import os\n+import http.client\n+import urllib.parse\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n     str_to_b64str,\n+    get_datadir_path,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568068748",
      "id" : 1568068748,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII585ddtSM",
      "original_commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "original_line" : 16,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 12,
      "pull_request_review_id" : 2004787892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568068748/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-17T01:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568068748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568071896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568071896"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: See https://github.com/bitcoin/bitcoin/blob/master/test/functional/README.md#style-guidelines\r\n\r\n>Use f'{x}' for string formatting in preference to '{}'.format(x) or '%s' % x.",
      "commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "created_at" : "2024-04-17T00:35:12Z",
      "diff_hunk" : "@@ -5,20 +5,28 @@\n \"\"\"\n A test for RPC users with restricted permissions\n \"\"\"\n+\n+import os\n+import http.client\n+import urllib.parse\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n     str_to_b64str,\n+    get_datadir_path,\n )\n-import http.client\n-import urllib.parse\n \n-def rpccall(node, user, method):\n+\n+def rpccall(node, user, method, password=None):\n     url = urllib.parse.urlparse(node.url)\n-    headers = {\"Authorization\": \"Basic \" + str_to_b64str('{}:{}'.format(user[0], user[3]))}\n+    if password is not None:\n+        auth_value = str_to_b64str('{}:{}'.format(user, password))\n+    else:\n+        auth_value = str_to_b64str('{}:{}'.format(user[0], user[3]))\n+    headers = {\"Authorization\": \"Basic \" + auth_value}\n     conn = http.client.HTTPConnection(url.hostname, url.port)\n     conn.connect()\n-    conn.request('POST', '/', '{\"method\": \"' + method + '\"}', headers)\n+    conn.request('POST', '/', '{{\"method\": \"{}\"}}'.format(method), headers)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568071896",
      "id" : 1568071896,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII585dduDY",
      "original_commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "original_line" : 29,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 30,
      "pull_request_review_id" : 2004787892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568071896/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-17T01:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568071896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568080142"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568080142"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems to be using the argument `user` as either a string or a list depending on whether or not `password` was provided, which seems less straightforward than using a consistent type.  Unless I'm missing something, the `password` argument might not be needed at all, since the `user` list contains the plaintext password.  See:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/94836b3d96f7fe9ed4225bf7ada961ca5dd554e8/test/functional/rpc_whitelist.py#L40-L45",
      "commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "created_at" : "2024-04-17T00:50:04Z",
      "diff_hunk" : "@@ -5,20 +5,28 @@\n \"\"\"\n A test for RPC users with restricted permissions\n \"\"\"\n+\n+import os\n+import http.client\n+import urllib.parse\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n     str_to_b64str,\n+    get_datadir_path,\n )\n-import http.client\n-import urllib.parse\n \n-def rpccall(node, user, method):\n+\n+def rpccall(node, user, method, password=None):\n     url = urllib.parse.urlparse(node.url)\n-    headers = {\"Authorization\": \"Basic \" + str_to_b64str('{}:{}'.format(user[0], user[3]))}\n+    if password is not None:\n+        auth_value = str_to_b64str('{}:{}'.format(user, password))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568080142",
      "id" : 1568080142,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585ddwEO",
      "original_commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 23,
      "pull_request_review_id" : 2004787892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568080142/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-17T01:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568080142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568092353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568092353"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Instead of hardcoding these new `rpcauth` lines, it might be better to expand the existing `users` list.  This would apply to adjacent methods as well.",
      "commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "created_at" : "2024-04-17T01:15:03Z",
      "diff_hunk" : "@@ -92,5 +100,79 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        \"\"\"\n+        Tests that with rpcwhitelistdefault=0 and no entries in rpcwhitelist,\n+        all authorized users (with rpcauth entries) are allowed to access all RPC methods\n+        \"\"\"\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=0\\n\")\n+            f.write(\"rpcauth=user3:50358aa884c841648e0700b073c32b2e$b73e95fff0748cc0b517859d2ca47d9bac1aa78231f3e48fa9222b612bd2083e\\n\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568092353",
      "id" : 1568092353,
      "line" : 117,
      "node_id" : "PRRC_kwDOABII585ddzDB",
      "original_commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "original_line" : 117,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 52,
      "pull_request_review_id" : 2004787892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568092353/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-17T01:18:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568092353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Thank you for picking this up. Enhancing testing for of the whitelist capability is important to notice regressions associated with this security-minded feature.\r\n> \r\n> Concept ACK. Looks like there could be opportunities to enhance the existing approach taken. Some inline comments were left.\r\n> \r\n> Built and ran all functional tests (all passed).\r\n> \r\n> Checked that the following comments were addressed from PR #17805.\r\n> \r\n> * The additional tests appear to be integrated into rpc_whitelist.py\r\n> * Tests were organized into different methods\r\n> * num_nodes used is 1\r\n> * Trailing comma included in `test_framework.util` imports\r\n> * nit: Looks like the original comment @jonatack to include explicit `self.setup_clean_chain = False` could be added in https://github.com/bitcoin/bitcoin/blob/94836b3d96f7fe9ed4225bf7ada961ca5dd554e8/test/functional/rpc_whitelist.py#L35-L36\r\n> * `specififed` typo fixed\r\n> * nit:  Seems like @jonatack's original comment to create constants for HTTP codes (e.g. `HTTP_FORBIDDEN` instead of 403) could increase readability, but I'm not particularly partial either way.  If it's decided to factor response codes into constants, there probably should be a follow up PR to refactor response codes used in lines in this file predating this PR.  Changing the previous instances of 200/403 in this PR would seem to be combining two separate goals (adding new tests, refactoring).\r\n\r\nThanks a lot for the review, \r\nI didn't implement the requested format for HTTP codes because I wanted to maintain consistency with the already existing tests. However, for readability, I agree with your suggestion. I think the right approach would be to address this in a follow-up PR and also refactor these codes for some of the other tests files as well.",
      "created_at" : "2024-04-17T13:40:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#issuecomment-2061289481",
      "id" : 2061289481,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29858",
      "node_id" : "IC_kwDOABII58563MgJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061289481/reactions"
      },
      "updated_at" : "2024-04-17T13:40:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061289481",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/40592031?v=4",
         "events_url" : "https://api.github.com/users/naiyoma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naiyoma/followers",
         "following_url" : "https://api.github.com/users/naiyoma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naiyoma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naiyoma",
         "id" : 40592031,
         "login" : "naiyoma",
         "node_id" : "MDQ6VXNlcjQwNTkyMDMx",
         "organizations_url" : "https://api.github.com/users/naiyoma/orgs",
         "received_events_url" : "https://api.github.com/users/naiyoma/received_events",
         "repos_url" : "https://api.github.com/users/naiyoma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naiyoma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naiyoma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naiyoma"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1589320996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589320996"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "@tdb3  I've pushed an [update](https://github.com/bitcoin/bitcoin/pull/29858/commits/e02af85abaec67d92e976383777a4b0f2caae4e1). Adding the users to the existing list is a better approach. However, some tests are now failing because users are whitelisted in the run_test function, while the new tests are designed to test instances when a user is not whitelisted.\r\n\r\nI thought clearing the bitcoin.conf file before writing the new test would solve this issue, but it doesn't. Below is a sample output for the `bitcoin.conf `file in the `test_rpcwhitelist_default_0_without_whitelist` function:\r\n\r\n```\r\nrpcwhitelistdefault=0\r\nrpcauth=user1:50358aa884c841............................................................\r\nrpcauth=user2:8650ba41296f6..........................................\r\nrpcauth=user3:50358aa8..................................................\r\n\r\n```\r\nDespite having new permissions, users are still whitelisted, and thus this assertion would fail:\r\n\r\n`assert_equal(200, rpccall(self.nodes[0], user[0], \"getbestblockhash\", user[3]).status)\r\n`\r\nWhy would this happen? The new tests are still reading permissions from the` run_test `function and not the new `bitcoin.conf`\r\n\r\n",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-03T14:54:35Z",
      "diff_hunk" : "@@ -92,5 +100,79 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        \"\"\"\n+        Tests that with rpcwhitelistdefault=0 and no entries in rpcwhitelist,\n+        all authorized users (with rpcauth entries) are allowed to access all RPC methods\n+        \"\"\"\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=0\\n\")\n+            f.write(\"rpcauth=user3:50358aa884c841648e0700b073c32b2e$b73e95fff0748cc0b517859d2ca47d9bac1aa78231f3e48fa9222b612bd2083e\\n\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1589320996",
      "id" : 1589320996,
      "in_reply_to_id" : 1568092353,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585eux0k",
      "original_commit_id" : "94836b3d96f7fe9ed4225bf7ada961ca5dd554e8",
      "original_line" : 117,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : null,
      "pull_request_review_id" : 2038339562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589320996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-03T14:54:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589320996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/40592031?v=4",
         "events_url" : "https://api.github.com/users/naiyoma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naiyoma/followers",
         "following_url" : "https://api.github.com/users/naiyoma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naiyoma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naiyoma",
         "id" : 40592031,
         "login" : "naiyoma",
         "node_id" : "MDQ6VXNlcjQwNTkyMDMx",
         "organizations_url" : "https://api.github.com/users/naiyoma/orgs",
         "received_events_url" : "https://api.github.com/users/naiyoma/received_events",
         "repos_url" : "https://api.github.com/users/naiyoma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naiyoma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naiyoma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naiyoma"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/24559741310</sub>",
      "created_at" : "2024-05-03T15:47:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#issuecomment-2093275967",
      "id" : 2093275967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29858",
      "node_id" : "IC_kwDOABII5858xNs_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2093275967/reactions"
      },
      "updated_at" : "2024-05-03T15:47:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2093275967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593806337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593806337"
         }
      },
      "author_association" : "NONE",
      "body" : "`with  specified`\r\nExtra space between",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:29:21Z",
      "diff_hunk" : "@@ -92,5 +102,93 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(self.nodes[0].cwd, \"bitcoin.conf\"), \"w\", encoding=\"utf8\") as f:\n+            f.write(\"\\nrpcwhitelistdefault=0\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                assert_equal(200, rpccall(self.nodes[0], user[0], permission, user[3]).status)\n+                assert_equal(200, rpccall(self.nodes[0], user[0], \"getbestblockhash\", user[3]).status)\n+\n+\n+    def test_rpcwhitelist_default_0_specific_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with whitelist for each user\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=0\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+                import pdb; pdb.set_trace()\n+                f.write(\"rpcwhitelist=\" + user[0] + \":\" + \"getblockchaininfo\" + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                self.log.info(\"[\" + user[0] + \"]: Testing a permitted permission (\" + permission + \")\")\n+                assert_equal(200, rpccall(self.nodes[0], user[0], permission, user[3]).status)\n+                assert_equal(403, rpccall(self.nodes[0], user[0], \"getblockchaininfo\", user[3]).status)\n+\n+\n+    def test_whitelistdefault_1_without_specified_permission(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=1 with no specified permissions\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=1\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                self.log.info(\"[\" + user[0] + \"]: Testing a permitted permission (\" + permission + \")\")\n+                assert_equal(403, rpccall(self.nodes[0], user[0], \"getblockchaininfo\", user[3]).status)\n+\n+\n+    def test_whitelistdefault_1_with_specified_permission(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=1 with  specified permissions\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593806337",
      "id" : 1593806337,
      "line" : 173,
      "node_id" : "PRRC_kwDOABII585e_44B",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 173,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 117,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593806337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593806337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593808338"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593808338"
         }
      },
      "author_association" : "NONE",
      "body" : "Same string formatting nit can be applied here as well.\r\n```\r\nUse f'{x}' for string formatting in preference to '{}'.format(x) or '%s' % x.",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:31:09Z",
      "diff_hunk" : "@@ -5,20 +5,28 @@\n \"\"\"\n A test for RPC users with restricted permissions\n \"\"\"\n+\n+import os\n+import http.client\n+import urllib.parse\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n+    get_datadir_path,\n     str_to_b64str,\n )\n-import http.client\n-import urllib.parse\n \n-def rpccall(node, user, method):\n+\n+def rpccall(node, user, method, password=None):\n     url = urllib.parse.urlparse(node.url)\n-    headers = {\"Authorization\": \"Basic \" + str_to_b64str('{}:{}'.format(user[0], user[3]))}\n+    if password is not None:\n+        auth_value = str_to_b64str('{}:{}'.format(user, password))\n+    else:\n+        auth_value = str_to_b64str('{}:{}'.format(user[0], user[3]))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593808338",
      "id" : 1593808338,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII585e_5XS",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 25,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 25,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593808338/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593808338",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593810250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593810250"
         }
      },
      "author_association" : "NONE",
      "body" : "Suggestion: The above test ending here can be put in a separate function so that there are mostly other test functions calls inside `run_test`.",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:32:41Z",
      "diff_hunk" : "@@ -92,5 +102,93 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593810250",
      "id" : 1593810250,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585e_51K",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 103,
      "original_position" : 47,
      "original_start_line" : 102,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 47,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593810250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 102,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593810250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593813826"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593813826"
         }
      },
      "author_association" : "NONE",
      "body" : "This piece of code is duplicated in every test, good candidate for extracting out in a `getPermissions(user)` function.",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:35:57Z",
      "diff_hunk" : "@@ -92,5 +102,93 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(self.nodes[0].cwd, \"bitcoin.conf\"), \"w\", encoding=\"utf8\") as f:\n+            f.write(\"\\nrpcwhitelistdefault=0\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                assert_equal(200, rpccall(self.nodes[0], user[0], permission, user[3]).status)\n+                assert_equal(200, rpccall(self.nodes[0], user[0], \"getbestblockhash\", user[3]).status)\n+\n+\n+    def test_rpcwhitelist_default_0_specific_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with whitelist for each user\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=0\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+                import pdb; pdb.set_trace()\n+                f.write(\"rpcwhitelist=\" + user[0] + \":\" + \"getblockchaininfo\" + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                self.log.info(\"[\" + user[0] + \"]: Testing a permitted permission (\" + permission + \")\")\n+                assert_equal(200, rpccall(self.nodes[0], user[0], permission, user[3]).status)\n+                assert_equal(403, rpccall(self.nodes[0], user[0], \"getblockchaininfo\", user[3]).status)\n+\n+\n+    def test_whitelistdefault_1_without_specified_permission(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=1 with no specified permissions\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=1\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                self.log.info(\"[\" + user[0] + \"]: Testing a permitted permission (\" + permission + \")\")\n+                assert_equal(403, rpccall(self.nodes[0], user[0], \"getblockchaininfo\", user[3]).status)\n+\n+\n+    def test_whitelistdefault_1_with_specified_permission(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=1 with  specified permissions\")\n+        with open(os.path.join(get_datadir_path(self.options.tmpdir, 0), \"bitcoin.conf\"), 'a', encoding='utf8') as f:\n+            f.write(\"rpcwhitelistdefault=1\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+                f.write(\"rpcwhitelist=\" + user[0] + \":\" + user[2] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593813826",
      "id" : 1593813826,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585e_6tC",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 186,
      "original_position" : 130,
      "original_start_line" : 181,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 130,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593813826/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 181,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593813826",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593816229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593816229"
         }
      },
      "author_association" : "NONE",
      "body" : "This test fails at this line, throwing 403 instead.\r\n```\r\n2024-05-08T10:36:33.356000Z TestFramework (INFO): Testing rpcwhitelistdefault=0 with no specified permissions\r\n2024-05-08T10:36:34.102000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/Users/aither/projects/bitcoin/test/functional/test_framework/test_framework.py\", line 132, in main\r\n    self.run_test()\r\n  File \"/Users/aither/projects/bitcoin/test/functional/rpc_whitelist.py\", line 106, in run_test\r\n    self.test_rpcwhitelist_default_0_without_whitelist()\r\n  File \"/Users/aither/projects/bitcoin/test/functional/rpc_whitelist.py\", line 128, in test_rpcwhitelist_default_0_without_whitelist\r\n    assert_equal(200, rpccall(self.nodes[0], user[0], \"getbestblockhash\", user[3]).status)\r\n  File \"/Users/aither/projects/bitcoin/test/functional/test_framework/util.py\", line 74, in assert_equal\r\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\nAssertionError: not(200 == 403)\r\n```",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:37:37Z",
      "diff_hunk" : "@@ -92,5 +102,93 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(self.nodes[0].cwd, \"bitcoin.conf\"), \"w\", encoding=\"utf8\") as f:\n+            f.write(\"\\nrpcwhitelistdefault=0\\n\")\n+            for user in self.users:\n+                f.write(\"rpcauth=\" + user[0] + \":\" + user[1] + \"\\n\")\n+        self.restart_node(0)\n+        for user in self.users:\n+            permissions = user[2].replace(\" \", \"\").split(\",\")\n+            i = 0\n+            while i < len(permissions):\n+                if permissions[i] == '':\n+                    permissions.pop(i)\n+                i += 1\n+            for permission in permissions:\n+                assert_equal(200, rpccall(self.nodes[0], user[0], permission, user[3]).status)\n+                assert_equal(200, rpccall(self.nodes[0], user[0], \"getbestblockhash\", user[3]).status)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593816229",
      "id" : 1593816229,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585e_7Sl",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 128,
      "original_position" : 72,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 72,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593816229/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593816229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593818855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593818855"
         }
      },
      "author_association" : "NONE",
      "body" : "Why is this path different than in other tests below?",
      "commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "created_at" : "2024-05-08T10:38:40Z",
      "diff_hunk" : "@@ -92,5 +102,93 @@ def run_test(self):\n         self.log.info(\"Strange test 5\")\n         assert_equal(200, rpccall(self.nodes[0], self.strange_users[4], \"getblockcount\").status)\n \n+        #rpcwhitelistdefaulttest\n+        self.test_rpcwhitelist_default_0_without_whitelist()\n+        self.test_rpcwhitelist_default_0_specific_whitelist()\n+        self.test_whitelistdefault_1_without_specified_permission()\n+        self.test_whitelistdefault_1_with_specified_permission()\n+\n+\n+    def test_rpcwhitelist_default_0_without_whitelist(self):\n+        self.log.info(\"Testing rpcwhitelistdefault=0 with no specified permissions\")\n+        with open(os.path.join(self.nodes[0].cwd, \"bitcoin.conf\"), \"w\", encoding=\"utf8\") as f:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1593818855",
      "id" : 1593818855,
      "line" : 114,
      "node_id" : "PRRC_kwDOABII585e_77n",
      "original_commit_id" : "e02af85abaec67d92e976383777a4b0f2caae4e1",
      "original_line" : 114,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "test/functional/rpc_whitelist.py",
      "position" : 58,
      "pull_request_review_id" : 2045275412,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29858",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593818855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-08T11:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593818855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Converted to draft for now. If this is no longer a WIP, you can move it out of draft.",
      "created_at" : "2024-05-13T07:40:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#issuecomment-2106866088",
      "id" : 2106866088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29858",
      "node_id" : "IC_kwDOABII5859lDmo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2106866088/reactions"
      },
      "updated_at" : "2024-05-13T07:40:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2106866088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Thanks for adding these tests, concept ACK.\r\n> \r\n> Seems like this is in progress because there is test failure and a debugger is added. Added few suggestions for now, will review again when the tests pass.\r\n\r\nThanks for the review! The initial tests passed successfully. But I pushed an update that implements the suggested alternative approach from this [discussion](https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1568092353)\r\n\r\nUnfortunately, the tests are currently failing with this new approach, as explained [here](https://github.com/bitcoin/bitcoin/pull/29858#discussion_r1589320996).\r\n\r\nWhile I'm still working on refining the suggested approach, I've decided to revert the PR to its original state (with passing tests) for now. To keep things  functional while I continue working on the alternative approach in a separate branch on my[ fork](https://github.com/naiyoma/bitcoin/blob/test/rpc-whitelistdefault-test-approach-2/test/functional/rpc_whitelist.py)",
      "created_at" : "2024-05-14T21:57:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29858#issuecomment-2111204089",
      "id" : 2111204089,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29858",
      "node_id" : "IC_kwDOABII58591mr5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2111204089/reactions"
      },
      "updated_at" : "2024-05-14T21:57:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2111204089",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/40592031?v=4",
         "events_url" : "https://api.github.com/users/naiyoma/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naiyoma/followers",
         "following_url" : "https://api.github.com/users/naiyoma/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naiyoma/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naiyoma",
         "id" : 40592031,
         "login" : "naiyoma",
         "node_id" : "MDQ6VXNlcjQwNTkyMDMx",
         "organizations_url" : "https://api.github.com/users/naiyoma/orgs",
         "received_events_url" : "https://api.github.com/users/naiyoma/received_events",
         "repos_url" : "https://api.github.com/users/naiyoma/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naiyoma/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naiyoma/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naiyoma"
      }
   }
]
