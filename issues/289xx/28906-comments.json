[
   {
      "author_association" : "MEMBER",
      "body" : "A regression caused by https://github.com/bitcoin/bitcoin/pull/25325.\r\n\r\ncc @martinus @sipa @achow101",
      "created_at" : "2023-11-17T19:30:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1816973103",
      "id" : 1816973103,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sTM8v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816973103/reactions"
      },
      "updated_at" : "2023-11-17T19:30:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816973103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Do we have a 32-bit CI task already?",
      "created_at" : "2023-11-17T19:48:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1816995291",
      "id" : 1816995291,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sTSXb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816995291/reactions"
      },
      "updated_at" : "2023-11-17T19:48:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816995291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Do we have a 32-bit CI task already?\r\n\r\n~x86, not ARM.~ we do",
      "created_at" : "2023-11-17T19:50:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1816997141",
      "id" : 1816997141,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sTS0V",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816997141/reactions"
      },
      "updated_at" : "2023-11-17T19:51:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1816997141",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This is a shot in the dark, but could this be due to memory fragmentation? The `PoolResource` allocates blocks of 262144 bytes, which seems quite large for such a system. Could you try this patch, or is there a way for me to try this? It reduces the allocated block size to 16K (and fixes a few tests that rely on the hardcoded size).\r\n\r\n```patch\r\ndiff --git a/src/support/allocators/pool.h b/src/support/allocators/pool.h\r\nindex c8e70ebacff..9f93511995e 100644\r\n--- a/src/support/allocators/pool.h\r\n+++ b/src/support/allocators/pool.h\r\n@@ -184,7 +184,7 @@ public:\r\n     /**\r\n      * Construct a new Pool Resource object, defaults to 2^18=262144 chunk size.\r\n      */\r\n-    PoolResource() : PoolResource(262144) {}\r\n+    PoolResource() : PoolResource(16384) {}\r\n \r\n     /**\r\n      * Disable copy & move semantics, these are not supported for the resource.\r\ndiff --git a/src/test/coins_tests.cpp b/src/test/coins_tests.cpp\r\nindex 12dc4d1ccc4..5f1a0120aca 100644\r\n--- a/src/test/coins_tests.cpp\r\n+++ b/src/test/coins_tests.cpp\r\n@@ -1088,18 +1088,18 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\r\n {\r\n     CCoinsMapMemoryResource resource;\r\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\r\n-\r\n+    size_t num_elements = 16384 / 200;\r\n     {\r\n         CCoinsMap map{0, CCoinsMap::hasher{}, CCoinsMap::key_equal{}, &resource};\r\n         BOOST_TEST(memusage::DynamicUsage(map) >= resource.ChunkSizeBytes());\r\n \r\n-        map.reserve(1000);\r\n+        map.reserve(num_elements);\r\n \r\n         // The resource has preallocated a chunk, so we should have space for at several nodes without the need to allocate anything else.\r\n         const auto usage_before = memusage::DynamicUsage(map);\r\n \r\n         COutPoint out_point{};\r\n-        for (size_t i = 0; i < 1000; ++i) {\r\n+        for (size_t i = 0; i < num_elements; ++i) {\r\n             out_point.n = i;\r\n             map[out_point];\r\n         }\r\ndiff --git a/src/test/validation_flush_tests.cpp b/src/test/validation_flush_tests.cpp\r\nindex 7398091215c..c8f2c9b32fa 100644\r\n--- a/src/test/validation_flush_tests.cpp\r\n+++ b/src/test/validation_flush_tests.cpp\r\n@@ -37,7 +37,7 @@ BOOST_AUTO_TEST_CASE(getcoinscachesizestate)\r\n     };\r\n \r\n     // PoolResource defaults to 256 KiB that will be allocated, so we'll take that and make it a bit larger.\r\n-    constexpr size_t MAX_COINS_CACHE_BYTES = 262144 + 512;\r\n+    constexpr size_t MAX_COINS_CACHE_BYTES = 16384 + 512;\r\n \r\n     // Without any coins in the cache, we shouldn't need to flush.\r\n     BOOST_TEST(\r\n```",
      "created_at" : "2023-11-17T20:14:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1817042102",
      "id" : 1817042102,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sTdy2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817042102/reactions"
      },
      "updated_at" : "2023-11-17T20:14:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817042102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@martinus \r\n\r\n> This is a shot in the dark, but could this be due to memory fragmentation? The `PoolResource` allocates blocks of 262144 bytes, which seems quite large for such a system. Could you try this patch, or is there a way for me to try this? It reduces the allocated block size to 16K (and fixes a few tests that rely on the hardcoded size).\r\n\r\nI've tested your [patch](https://github.com/hebasto/artefacts/blob/bisect-arm-OOM.1/bisect-arm-OOM/bitcoin-274a7b769afb-arm-linux-gnueabihf.tar.gz). No change in behavior, unfortunately. It still fails with OOM.",
      "created_at" : "2023-11-17T22:05:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1817172322",
      "id" : 1817172322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sT9li",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817172322/reactions"
      },
      "updated_at" : "2023-11-17T22:05:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817172322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It could be that the memory usage calculation has changed, and calculation for memory used in the CCoinsMap is now more correct than before. Previously it overestimated memory usage, and now it's more correct but for the same cache size this also leads to a bit higher memory usage",
      "created_at" : "2023-11-18T07:46:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1817427540",
      "id" : 1817427540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sU75U",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817427540/reactions"
      },
      "updated_at" : "2023-11-18T07:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817427540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It could be that the memory usage calculation has changed, and calculation for memory used in the CCoinsMap is now more correct than before. Previously it overestimated memory usage, and now it's more correct but for the same cache size this also leads to a bit higher memory usage\n\nIt depends on definition of \"a bit higher\" :) It was less than 0.9 GB of RAM. Now 2 GB of RAM plus 1 GB swap is not enough.",
      "created_at" : "2023-11-18T09:11:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1817452601",
      "id" : 1817452601,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sVCA5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817452601/reactions"
      },
      "updated_at" : "2023-11-18T09:11:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817452601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\"a bit higher\" should be about 2% or so... I don't think there is a memory leak anywhere.. Is this issue only on ARM or also on x86 32bit?",
      "created_at" : "2023-11-18T09:14:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28906#issuecomment-1817453279",
      "id" : 1817453279,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28906",
      "node_id" : "IC_kwDOABII585sVCLf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817453279/reactions"
      },
      "updated_at" : "2023-11-18T09:15:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1817453279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   }
]
