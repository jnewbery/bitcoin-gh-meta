[
   {
      "author_association" : "MEMBER",
      "body" : "Meanwhile NAT-PMP support is there, but it has no IPv6 pinhole support. ",
      "created_at" : "2022-09-06T13:00:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-1238118486",
      "id" : 1238118486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII585JzDBW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238118486/reactions"
      },
      "updated_at" : "2022-09-06T13:00:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238118486",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Indeed, UPnP has an explicit command `AddPinhole` (https://upnp.org/specs/gw/UPnP-gw-WANIPv6FirewallControl-v1-Service.pdf) that's seperate from `Add(Any)PortMapping`.\r\n\r\nThe PCP (succssor to NAT-PMP) RFC (https://datatracker.ietf.org/doc/html/rfc6887) doesn't say anything about pinholes (although they do mention \"Simple firewall control\" but it's unclear to me how that maps to opcodes). Though i would guess the MAP opcode allows that, and more, it just leaves it up to the router how the external to internal mapping should be. Ideally.\r\n\r\nIt's kind of annoying if the client has to aware of the network state, ideally it doesn't really care how the port gets there, as long as it gets there.",
      "created_at" : "2024-04-25T13:41:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2077224493",
      "id" : 2077224493,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII5857z-4t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077224493/reactions"
      },
      "updated_at" : "2024-04-25T13:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077224493",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FWIW the version of libUPnP in depends (2.2.2) does have the Pinhole commands:\r\n```\r\nupnpcommands.h:                         int * inboundPinholeAllowed);\r\nupnpcommands.h:UPNP_GetOutboundPinholeTimeout(const char * controlURL, const char * servicetype,\r\nupnpcommands.h:UPNP_AddPinhole(const char * controlURL, const char * servicetype,\r\nupnpcommands.h:UPNP_UpdatePinhole(const char * controlURL, const char * servicetype,\r\nupnpcommands.h:UPNP_DeletePinhole(const char * controlURL, const char * servicetype, const char * uniqueID);\r\nupnpcommands.h:UPNP_CheckPinholeWorking(const char * controlURL, const char * servicetype,\r\nupnpcommands.h:UPNP_GetPinholePackets(const char * controlURL, const char * servicetype,\r\n```",
      "created_at" : "2024-04-25T13:45:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2077233941",
      "id" : 2077233941,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII58570BMV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077233941/reactions"
      },
      "updated_at" : "2024-04-25T13:45:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077233941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Manually creating an IPv6 pinhole seems to work here:\r\n```sh\r\n$ export ROUTER_IPV6_ADDR=...\r\n$ export MY_IPV6_ADDR=...\r\n$ upnpc -6 -u 'http://[${ROUTER_IPV6_ADDR}]:5000/rootDesc.xml' -A  \"\" 0 $MY_IPV6_ADDR 1234 tcp 30\r\nupnpc : miniupnpc library test client, version 2.2.4.\r\n (c) 2005-2022 Thomas Bernard.\r\nGo to http://miniupnp.free.fr/ or https://miniupnp.tuxfamily.org/\r\nfor more information.\r\nFound valid IGD : http://[...]:5000/ctl/IPConn\r\nLocal LAN ip address : ...\r\nAddPinhole: ([]:0 -> [...]:1234) / Pinhole ID = 13\r\n$ nc -6l 1234\r\n```\r\n(but only when connecting to it using IPv6 with the correct globally routable address, when connecting to the IPv4 UPnP address, or a link-scoped IPv6 address, it gives `failed with code 606 (Action not authorized)`. Seems like this problem: https://github.com/miniupnp/miniupnp/issues/600#issuecomment-1133602620)\r\n\r\nThen connecting to it from another host, and sending some text, appears to work:\r\n```sh\r\n$ nc $MY_IPV6_ADDR 1234\r\n.......\r\n```\r\nI'll try to integrate it into bitcoin. If i can find the right incantation.\r\n",
      "created_at" : "2024-04-25T17:08:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2077766337",
      "id" : 2077766337,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII58572DLB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077766337/reactions"
      },
      "updated_at" : "2024-04-25T17:20:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2077766337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The UPnP side of this is progressing, though i've ran into a possible bug/limitaton in miniupnp: https://github.com/miniupnp/miniupnp/issues/731#issuecomment-2081257515\r\n\r\n> Meanwhile NAT-PMP support is there, but it has no IPv6 pinhole support.\r\n\r\ni looked into this too, we'll actually have to implement PCP support ourselves to do this. The good part is that it's just a matter of sending one fixed-size binary UDP packet to the default gateway and parsing the result. Not worth taking on a dependency for.\r\n(see https://github.com/moonlight-stream/GS-IPv6-Forwarder/blob/master/GSv6Fwd/pcp.cpp for an example implementation of IPv6 pinholing)\r\nCan't begin to describe how much simpler than UPnP this is. No XML, no discovery, no HTTP. However, router support is probably less, so we still might want to support both.",
      "created_at" : "2024-04-28T10:21:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2081424660",
      "id" : 2081424660,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII5858EAUU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2081424660/reactions"
      },
      "updated_at" : "2024-04-28T10:26:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2081424660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The good part is that it's just a matter of sending one fixed-size binary UDP packet to the default gateway and parsing the result. \r\n\r\nNice!",
      "created_at" : "2024-04-29T08:36:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2082162255",
      "id" : 2082162255,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII5858G0ZP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2082162255/reactions"
      },
      "updated_at" : "2024-04-29T08:36:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2082162255",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Nice!\r\n\r\nIf you'd like to test, i have a branch here: https://github.com/laanwj/bitcoin/tree/2024-04-pcp-pinhole\r\nIt is a PoC that replaces [bitcoind.cpp](https://github.com/laanwj/bitcoin/blob/2024-04-pcp-pinhole/src/bitcoind.cpp) with a program that (on Linux only for now):\r\n\r\n- Enumerates local publicly routable IPv6 addresses\r\n- Gets the default gateway to get the PCP endpoint\r\n- Requests pinholes for 100 seconds to port 1234 on all addreses, and prints the result\r\n\r\ni've tried it on two routers (Turris Omnia and Fritz!Box) and there it worked.",
      "created_at" : "2024-04-29T09:05:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/17012#issuecomment-2082215034",
      "id" : 2082215034,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/17012",
      "node_id" : "IC_kwDOABII5858HBR6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2082215034/reactions"
      },
      "updated_at" : "2024-04-29T09:06:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2082215034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   }
]
