[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30000).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-04-29T20:59:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#issuecomment-2083652023",
      "id" : 2083652023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30000",
      "node_id" : "IC_kwDOABII5858MgG3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2083652023/reactions"
      },
      "updated_at" : "2024-04-29T20:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2083652023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/24396449433</sub>",
      "created_at" : "2024-04-29T23:14:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#issuecomment-2083841166",
      "id" : 2083841166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30000",
      "node_id" : "IC_kwDOABII5858NOSO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2083841166/reactions"
      },
      "updated_at" : "2024-04-29T23:14:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2083841166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586372606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586372606"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    /** Check if we already have an orphan transaction */\r\n```",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T14:43:09Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ class TxOrphanage {\n     bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586372606",
      "id" : 1586372606,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII585ejh_-",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 26,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : 3,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586372606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586372606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586410875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586410875"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: looks like this is only used for logging (and thus can be declared right before the logging) - do we still want/need to log the txid? I'd think wtxid suffices? But nvm if that's contentious.",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T15:14:59Z",
      "diff_hunk" : "@@ -54,18 +52,19 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n     return true;\n }\n \n-int TxOrphanage::EraseTx(const Txid& txid)\n+int TxOrphanage::EraseTx(const Wtxid& wtxid)\n {\n     LOCK(m_mutex);\n-    return EraseTxNoLock(txid);\n+    return EraseTxNoLock(wtxid);\n }\n \n-int TxOrphanage::EraseTxNoLock(const Txid& txid)\n+int TxOrphanage::EraseTxNoLock(const Wtxid& wtxid)\n {\n     AssertLockHeld(m_mutex);\n-    std::map<Txid, OrphanTx>::iterator it = m_orphans.find(txid);\n+    std::map<Wtxid, OrphanTx>::iterator it = m_orphans.find(wtxid);\n     if (it == m_orphans.end())\n         return 0;\n+    const auto& txid = it->second.tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586410875",
      "id" : 1586410875,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585ejrV7",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 67,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 42,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586410875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586410875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586417487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586417487"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: can't we just use `first`?\r\n```suggestion\r\n            nErased += EraseTxNoLock(maybeErase->first);\r\n```",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T15:21:51Z",
      "diff_hunk" : "@@ -101,13 +98,13 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     m_peer_work_set.erase(peer);\n \n     int nErased = 0;\n-    std::map<Txid, OrphanTx>::iterator iter = m_orphans.begin();\n+    std::map<Wtxid, OrphanTx>::iterator iter = m_orphans.begin();\n     while (iter != m_orphans.end())\n     {\n-        std::map<Txid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n+        std::map<Wtxid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n         if (maybeErase->second.fromPeer == peer)\n         {\n-            nErased += EraseTxNoLock(maybeErase->second.tx->GetHash());\n+            nErased += EraseTxNoLock(maybeErase->second.tx->GetWitnessHash());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586417487",
      "id" : 1586417487,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585ejs9P",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 107,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 70,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586417487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586417487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586473749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586473749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```Suggestion\r\n    if (m_orphanage.HaveTx(Wtxid::FromUint256(hash))) return true;\r\n```",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T16:19:56Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586473749",
      "id" : 1586473749,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585ej6sV",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2033911780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586473749/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-01T16:33:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586473749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586533521"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586533521"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: can just one-line\r\n```suggestion\r\n                            Assert(orphanage.HaveTx(ref->GetWitnessHash()));\r\n```",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T17:20:10Z",
      "diff_hunk" : "@@ -112,21 +112,21 @@ FUZZ_TARGET(txorphan, .init = initialize_orphanage)\n                     {\n                         CTransactionRef ref = orphanage.GetTxToReconsider(peer_id);\n                         if (ref) {\n-                            bool have_tx = orphanage.HaveTx(GenTxid::Txid(ref->GetHash())) || orphanage.HaveTx(GenTxid::Wtxid(ref->GetWitnessHash()));\n+                            bool have_tx = orphanage.HaveTx(ref->GetWitnessHash());\n                             Assert(have_tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586533521",
      "id" : 1586533521,
      "line" : 116,
      "node_id" : "PRRC_kwDOABII585ekJSR",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 116,
      "original_position" : 6,
      "original_start_line" : 115,
      "path" : "src/test/fuzz/txorphan.cpp",
      "position" : 6,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586533521/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 115,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586533521",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586638555"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586638555"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Or alternatively:\r\n\r\n<details>\r\n<summary>git diff on 4b4dfaa8f3</summary>\r\n\r\n```diff\r\ndiff --git a/src/txorphanage.cpp b/src/txorphanage.cpp\r\nindex 504a1f7ec3..bed92e6b32 100644\r\n--- a/src/txorphanage.cpp\r\n+++ b/src/txorphanage.cpp\r\n@@ -98,13 +98,11 @@ void TxOrphanage::EraseForPeer(NodeId peer)\r\n     m_peer_work_set.erase(peer);\r\n \r\n     int nErased = 0;\r\n-    std::map<Wtxid, OrphanTx>::iterator iter = m_orphans.begin();\r\n-    while (iter != m_orphans.end())\r\n-    {\r\n-        std::map<Wtxid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\r\n-        if (maybeErase->second.fromPeer == peer)\r\n+    for (auto iter = m_orphans.begin(); iter != m_orphans.end(); ) {\r\n+        const auto& [wtxid, tx] = *iter++; // increment to avoid iterator becoming invalid\r\n+        if (tx.fromPeer == peer)\r\n         {\r\n-            nErased += EraseTxNoLock(maybeErase->second.tx->GetWitnessHash());\r\n+            nErased += EraseTxNoLock(wtxid);\r\n         }\r\n     }\r\n     if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx from peer=%d\\n\", nErased, peer);\r\n\r\n```\r\n</details>\r\n",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T18:45:17Z",
      "diff_hunk" : "@@ -101,13 +98,13 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     m_peer_work_set.erase(peer);\n \n     int nErased = 0;\n-    std::map<Txid, OrphanTx>::iterator iter = m_orphans.begin();\n+    std::map<Wtxid, OrphanTx>::iterator iter = m_orphans.begin();\n     while (iter != m_orphans.end())\n     {\n-        std::map<Txid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n+        std::map<Wtxid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n         if (maybeErase->second.fromPeer == peer)\n         {\n-            nErased += EraseTxNoLock(maybeErase->second.tx->GetHash());\n+            nErased += EraseTxNoLock(maybeErase->second.tx->GetWitnessHash());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586638555",
      "id" : 1586638555,
      "in_reply_to_id" : 1586417487,
      "line" : 107,
      "node_id" : "PRRC_kwDOABII585eki7b",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 107,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 70,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586638555/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586638555",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586713579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586713579"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's not immediately obvious to me why it is safe to just convert any `gtxid` into a `Wtxid` here, especially since there are callsites of `AlreadyHaveTx` where a ` GenTxId::Txid` is passed, such as e.g. [here](https://github.com/bitcoin/bitcoin/blob/d73245abc70346a0e8805d50a1f395706084294c/src/net_processing.cpp#L4632). If it is indeed safe, I think it could be a better approach to update `AlreadyHaveTx` to take a `Wtxid` and push the conversion further to the edge, so it can be reviewed on a case-by-case basis?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T19:24:21Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586713579",
      "id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585ek1Pr",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2033751635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586713579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-01T19:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586713579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586884665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586884665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "(Ignore me if I'm understanding) -- coinbase transactions are [required to have all `0` Wtxids](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#commitment-structure) (`0x0000....0000`) which means for an `INV` message for a witness coinbase you have to use the non-witness txid to reference the transaction? - so `AlreadyHaveTx` in that case is explicitly *not* using a Wtxid? (Or are coinbases never `INV`'d?)\r\n\r\nAlso perhaps not great/confusing to treat Wtxid and Txids as always interchangeable (though the types allow it) because of the coinbase Wtxid caveat?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-01T22:22:51Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1586884665",
      "id" : 1586884665,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585elfA5",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2034556058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586884665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T08:32:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586884665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587460520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587460520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> It's not immediately obvious to me why it is safe to just convert any gtxid into a Wtxid here\r\n\r\nThe argument I'm making in this PR is that in all the places we are checking by txid, we shouldn't be doing that, because we're missing same-txid-different-witness cases. But yeah totally fair to say it's difficult to review it together, so I'll split the first commit to make it more explicit where the change is happening and why that's ok.\r\n\r\n>  I think it could be a better approach to update AlreadyHaveTx to take a Wtxid\r\n\r\nfwiw I disagree, as we do want to check txids in the other data structures.\r\n\r\n> coinbase transactions are [required to have all 0 Wtxids](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#commitment-structure) (0x0000....0000) which means for an INV message for a witness coinbase you have to use the non-witness txid to reference the transaction? - so AlreadyHaveTx in that case is explicitly not using a Wtxid? (Or are coinbases never INV'd?)\r\n\r\nThat link is referring to the wtxid of the coinbase transaction when calculating the witness commitment; that's not the case in any other situation. Also, yes, if we get a coinbase transaction in tx relay we'd drop that pretty much immediately and wouldn't be putting it in orphanage:\r\nhttps://github.com/bitcoin/bitcoin/blob/9d1a286f20b8a602ffe72928bcd79be09fdbf9d0/src/validation.cpp#L735-L742",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T11:12:16Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587460520",
      "id" : 1587460520,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585enrmo",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035457852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587460520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T11:12:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587460520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587694422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587694422"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> The argument I'm making in this PR is that in all the places we are checking by txid, we shouldn't be doing that, because we're missing same-txid-different-witness cases.\r\n\r\nI agree, the rationale makes sense. My concern is about segwit txs (`txid != wtxid`) where we check by txid (for whatever reason: intentional because we don't have witness data, legacy and we never updated it, buggy, ...): just creating a wtxid from the txid hash as is done here seems like it has potential to start missing things we previously wouldn't - since `TxOrphanage` now _only_ indexes by `wtxid`?\r\n\r\nI've made a [branch](https://github.com/glozow/bitcoin/compare/2024-04-orphan-use-wtxid...stickies-v:bitcoin:pr/30000) where I've created 2 overloads of `AlreadyHaveTx`: one that takes `Wtxid` and one that takes `Txid`, to force all the conversions to the edges. I implemented the `Txid` to perform less checks, based on the documentation (didn't verify the code) that `m_recent_rejects_reconsiderable` and `m_recent_rejects` uses `wtxid`, whereas `m_recent_confirmed_transactions` uses both `txid` and `wtxid`.\r\n\r\nThere are 4 callsites of `AlreadyHaveTx`. For 2 of them, [1) here](https://github.com/glozow/bitcoin/compare/2024-04-orphan-use-wtxid...stickies-v:bitcoin:pr/30000#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R4255-R4256) and [2) here](https://github.com/glozow/bitcoin/compare/2024-04-orphan-use-wtxid...stickies-v:bitcoin:pr/30000#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R4561), the conversion seems trivial/sensible.\r\n\r\nA third is more confusing to me. [3) Here in `ProcessMessage`](https://github.com/glozow/bitcoin/compare/2024-04-orphan-use-wtxid...stickies-v:bitcoin:pr/30000#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R4663), I initially used the `Txid` overload, but that fails the `p2p_orphan_handling.py::test_orphan_of_orphan` test. Switching to `Wtxid` makes it pass, but I don't understand why. Since with this pull, `TxOrphanage` indexes on `Wtxid`, calling `HaveTx` on a blind conversion of `parent_txid` into a `Wtxid` seems like it shouldn't find anything in the orphanage, unless we're dealing with non-segwit transaction?\r\n\r\nFinally, for the [4) fourth here](https://github.com/glozow/bitcoin/compare/2024-04-orphan-use-wtxid...stickies-v:bitcoin:pr/30000#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R6319-R6341), I think my refactoring is a no-op, we just blindly call the different function signatures based on `GenTxid::IsWtxid()`, no real difference with the current implementation except perhaps for making things more explicit.",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T14:03:35Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587694422",
      "id" : 1587694422,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585eoktW",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035842164,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587694422/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T14:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587694422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587705035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705035"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To be clear: I'm not saying this PR needs to overhaul `AlreadyHaveTx` like I did, and I think having `TxOrphanage` index on `Wtxid` instead of `Txid` is better. I just think that if we're going to be calling `TxOrphanage` methods with (what are in fact) txids, we should probably have `TxOrphanage` _also_ keep a `Txid` index and not do blind conversion such as is happening here? I think that would address my concerns and make things easier to review?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T14:08:54Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587705035",
      "id" : 1587705035,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585eonTL",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035860350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705035/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T14:09:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587705703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fwiw, I think the in-orphanage txid==wtixd case seems pretty rare all things considered. I had 4 over a 24 hour period, vs about 400 times where we fetched a segwit parent via txid though that particular txid was in the orphanage already.\r\n\r\niow I'm not sure extra complexity is worth it, vs just dropping it altogether(and eating a tiny bit more of bandwidth?)",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T14:09:22Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587705703",
      "id" : 1587705703,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585eondn",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035861475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705703/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T14:11:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587705703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587730485"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587730485"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> iow I'm not sure extra complexity is worth it,\r\n\r\nOh, fair enough. I don't have a good enough view of the attack vectors here. In my review, I was operating on the assumption that we wouldn't want to miss anything we're currently doing. If it's okay to relax that, that could make sense - but it should probably be made explicit then?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T14:23:52Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587730485",
      "id" : 1587730485,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585eotg1",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035904439,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587730485/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T14:23:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587730485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587742487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587742487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "IIUC If the check is removed, you'll waste bandwidth when you get orphan chains that are non-segwit, but you won't keep or relay them, so it shouldn't churn the orphanage.\r\n\r\nWould it help if the comment was touched up to be explicit about what it's saving us from doing?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-02T14:31:36Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1587742487",
      "id" : 1587742487,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585eowcX",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2035924068,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587742487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-02T14:31:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587742487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589529436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589529436"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 646aa4da91c03a0e72d086cae281aa0688f2f41d\r\n\r\nThis is only used for logging now. Do we care about logging the `txid` now that the map is keyed by `wtxid`?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T17:40:57Z",
      "diff_hunk" : "@@ -23,7 +23,7 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n \n     const Txid& hash = tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589529436",
      "id" : 1589529436,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585evktc",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 24,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 2,
      "pull_request_review_id" : 2038712299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589529436/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-03T19:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589529436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589547282"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589547282"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 646aa4da91c03a0e72d086cae281aa0688f2f41d\r\n\r\nnit: `nErased` is a counter right? Shouldn't this read `txs` instead?",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T17:54:15Z",
      "diff_hunk" : "@@ -101,13 +98,13 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     m_peer_work_set.erase(peer);\n \n     int nErased = 0;\n-    std::map<Txid, OrphanTx>::iterator iter = m_orphans.begin();\n+    std::map<Wtxid, OrphanTx>::iterator iter = m_orphans.begin();\n     while (iter != m_orphans.end())\n     {\n-        std::map<Txid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n+        std::map<Wtxid, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n         if (maybeErase->second.fromPeer == peer)\n         {\n-            nErased += EraseTxNoLock(maybeErase->second.tx->GetHash());\n+            nErased += EraseTxNoLock(maybeErase->second.tx->GetWitnessHash());\n         }\n     }\n     if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx from peer=%d\\n\", nErased, peer);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589547282",
      "id" : 1589547282,
      "line" : 110,
      "node_id" : "PRRC_kwDOABII585evpES",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 110,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 73,
      "pull_request_review_id" : 2038712299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589547282/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-03T19:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589547282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589549760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589549760"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 646aa4da91c03a0e72d086cae281aa0688f2f41d\r\n\r\nSame here, do we still care about logging `txids`? I guess this applies to all the file, so not pointing it out again",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T17:56:16Z",
      "diff_hunk" : "@@ -159,7 +156,7 @@ void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx)\n             for (const auto& elem : it_by_prev->second) {\n                 // Get this source peer's work set, emplacing an empty set if it didn't exist\n                 // (note: if this peer wasn't still connected, we would have removed the orphan tx already)\n-                std::set<Txid>& orphan_work_set = m_peer_work_set.try_emplace(elem->second.fromPeer).first->second;\n+                std::set<Wtxid>& orphan_work_set = m_peer_work_set.try_emplace(elem->second.fromPeer).first->second;\n                 // Add this tx to the work set\n                 orphan_work_set.insert(elem->first);\n                 LogPrint(BCLog::TXPACKAGES, \"added %s (wtxid=%s) to peer %d workset\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589549760",
      "id" : 1589549760,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII585evprA",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 162,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 98,
      "pull_request_review_id" : 2038712299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589549760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-03T19:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589549760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589569008"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589569008"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 646aa4da91c03a0e72d086cae281aa0688f2f41d\r\n\r\nThis should not be called `orphanHash` anymore, but also, this could be inlined",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T18:10:27Z",
      "diff_hunk" : "@@ -226,7 +219,7 @@ void TxOrphanage::EraseForBlock(const CBlock& block)\n             if (itByPrev == m_outpoint_to_orphan_it.end()) continue;\n             for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n                 const CTransaction& orphanTx = *(*mi)->second.tx;\n-                const auto& orphanHash = orphanTx.GetHash();\n+                const auto& orphanHash = orphanTx.GetWitnessHash();\n                 vOrphanErase.push_back(orphanHash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589569008",
      "id" : 1589569008,
      "line" : 223,
      "node_id" : "PRRC_kwDOABII585evuXw",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 223,
      "original_position" : 144,
      "original_start_line" : 222,
      "path" : "src/txorphanage.cpp",
      "position" : 144,
      "pull_request_review_id" : 2038712299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589569008/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 222,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-03T19:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589569008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589571339"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589571339"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, in L231:\r\n\r\n`for (const auto& orphanHash : vOrphanErase)` -> `for (const auto& wtxid : vOrphanErase)`",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T18:12:19Z",
      "diff_hunk" : "@@ -226,7 +219,7 @@ void TxOrphanage::EraseForBlock(const CBlock& block)\n             if (itByPrev == m_outpoint_to_orphan_it.end()) continue;\n             for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n                 const CTransaction& orphanTx = *(*mi)->second.tx;\n-                const auto& orphanHash = orphanTx.GetHash();\n+                const auto& orphanHash = orphanTx.GetWitnessHash();\n                 vOrphanErase.push_back(orphanHash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589571339",
      "id" : 1589571339,
      "in_reply_to_id" : 1589569008,
      "line" : 223,
      "node_id" : "PRRC_kwDOABII585evu8L",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 223,
      "original_position" : 144,
      "original_start_line" : 222,
      "path" : "src/txorphanage.cpp",
      "position" : 144,
      "pull_request_review_id" : 2038712299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589571339/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 222,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-03T19:51:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589571339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589584199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589584199"
         }
      },
      "author_association" : "NONE",
      "body" : "imo `wtxid` and `txid` being double SHA256 outputs and `wtxid` being essentially a superset of `txid`, makes this blind conversion legitimate in this case.",
      "commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "created_at" : "2024-05-03T18:21:58Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1589584199",
      "id" : 1589584199,
      "in_reply_to_id" : 1586713579,
      "line" : 2300,
      "node_id" : "PRRC_kwDOABII585evyFH",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : 7,
      "pull_request_review_id" : 2038776284,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589584199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2298,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-03T18:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1589584199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11520757?v=4",
         "events_url" : "https://api.github.com/users/itornaza/events{/privacy}",
         "followers_url" : "https://api.github.com/users/itornaza/followers",
         "following_url" : "https://api.github.com/users/itornaza/following{/other_user}",
         "gists_url" : "https://api.github.com/users/itornaza/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/itornaza",
         "id" : 11520757,
         "login" : "itornaza",
         "node_id" : "MDQ6VXNlcjExNTIwNzU3",
         "organizations_url" : "https://api.github.com/users/itornaza/orgs",
         "received_events_url" : "https://api.github.com/users/itornaza/received_events",
         "repos_url" : "https://api.github.com/users/itornaza/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/itornaza/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/itornaza/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/itornaza"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596607638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, I would definitely say to log both txid and wtxid when we have it. A lot of things use txid only, e.g. if you want to trace a tx through logs or look it up in mempool. Would be a pain to not have txid imo.",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T10:53:13Z",
      "diff_hunk" : "@@ -23,7 +23,7 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n \n     const Txid& hash = tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596607638",
      "id" : 1596607638,
      "in_reply_to_id" : 1589529436,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585fKkyW",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 24,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 2,
      "pull_request_review_id" : 2049834162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607638/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-10T10:56:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596607978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607978"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same as above, imo definitely want to log txid if we have it.",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T10:53:38Z",
      "diff_hunk" : "@@ -54,18 +52,19 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n     return true;\n }\n \n-int TxOrphanage::EraseTx(const Txid& txid)\n+int TxOrphanage::EraseTx(const Wtxid& wtxid)\n {\n     LOCK(m_mutex);\n-    return EraseTxNoLock(txid);\n+    return EraseTxNoLock(wtxid);\n }\n \n-int TxOrphanage::EraseTxNoLock(const Txid& txid)\n+int TxOrphanage::EraseTxNoLock(const Wtxid& wtxid)\n {\n     AssertLockHeld(m_mutex);\n-    std::map<Txid, OrphanTx>::iterator it = m_orphans.find(txid);\n+    std::map<Wtxid, OrphanTx>::iterator it = m_orphans.find(wtxid);\n     if (it == m_orphans.end())\n         return 0;\n+    const auto& txid = it->second.tx->GetHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596607978",
      "id" : 1596607978,
      "in_reply_to_id" : 1586410875,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKk3q",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 67,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : null,
      "pull_request_review_id" : 2049834162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607978/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-10T10:56:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596607978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596610435"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596610435"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T10:56:23Z",
      "diff_hunk" : "@@ -159,7 +156,7 @@ void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx)\n             for (const auto& elem : it_by_prev->second) {\n                 // Get this source peer's work set, emplacing an empty set if it didn't exist\n                 // (note: if this peer wasn't still connected, we would have removed the orphan tx already)\n-                std::set<Txid>& orphan_work_set = m_peer_work_set.try_emplace(elem->second.fromPeer).first->second;\n+                std::set<Wtxid>& orphan_work_set = m_peer_work_set.try_emplace(elem->second.fromPeer).first->second;\n                 // Add this tx to the work set\n                 orphan_work_set.insert(elem->first);\n                 LogPrint(BCLog::TXPACKAGES, \"added %s (wtxid=%s) to peer %d workset\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596610435",
      "id" : 1596610435,
      "in_reply_to_id" : 1589549760,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII585fKleD",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 162,
      "original_position" : 98,
      "original_start_line" : null,
      "path" : "src/txorphanage.cpp",
      "position" : 107,
      "pull_request_review_id" : 2049834162,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596610435/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-10T10:56:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596610435",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596626751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T11:15:01Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596626751",
      "id" : 1596626751,
      "in_reply_to_id" : 1586473749,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKpc_",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 2049866191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-10T11:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596626910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T11:15:12Z",
      "diff_hunk" : "@@ -112,21 +112,21 @@ FUZZ_TARGET(txorphan, .init = initialize_orphanage)\n                     {\n                         CTransactionRef ref = orphanage.GetTxToReconsider(peer_id);\n                         if (ref) {\n-                            bool have_tx = orphanage.HaveTx(GenTxid::Txid(ref->GetHash())) || orphanage.HaveTx(GenTxid::Wtxid(ref->GetWitnessHash()));\n+                            bool have_tx = orphanage.HaveTx(ref->GetWitnessHash());\n                             Assert(have_tx);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596626910",
      "id" : 1596626910,
      "in_reply_to_id" : 1586533521,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKpfe",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 116,
      "original_position" : 6,
      "original_start_line" : 115,
      "path" : "src/test/fuzz/txorphan.cpp",
      "position" : null,
      "pull_request_review_id" : 2049866191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626910/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-10T11:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596626910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596628093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628093"
         }
      },
      "author_association" : "MEMBER",
      "body" : "inlined. didn't do the rename as I don't think it's incorrect and want to minimize diff",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T11:16:29Z",
      "diff_hunk" : "@@ -226,7 +219,7 @@ void TxOrphanage::EraseForBlock(const CBlock& block)\n             if (itByPrev == m_outpoint_to_orphan_it.end()) continue;\n             for (auto mi = itByPrev->second.begin(); mi != itByPrev->second.end(); ++mi) {\n                 const CTransaction& orphanTx = *(*mi)->second.tx;\n-                const auto& orphanHash = orphanTx.GetHash();\n+                const auto& orphanHash = orphanTx.GetWitnessHash();\n                 vOrphanErase.push_back(orphanHash);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596628093",
      "id" : 1596628093,
      "in_reply_to_id" : 1589569008,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKpx9",
      "original_commit_id" : "646aa4da91c03a0e72d086cae281aa0688f2f41d",
      "original_line" : 223,
      "original_position" : 144,
      "original_start_line" : 222,
      "path" : "src/txorphanage.cpp",
      "position" : null,
      "pull_request_review_id" : 2049866191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628093/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-10T11:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596628218"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628218"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed thanks",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T11:16:37Z",
      "diff_hunk" : "@@ -24,7 +24,7 @@ class TxOrphanage {\n     bool AddTx(const CTransactionRef& tx, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n     /** Check if we already have an orphan transaction (by txid or wtxid) */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596628218",
      "id" : 1596628218,
      "in_reply_to_id" : 1586372606,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKpz6",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 26,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/txorphanage.h",
      "position" : null,
      "pull_request_review_id" : 2049866191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628218/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-10T11:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596628218",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596649444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596649444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Split up the commit, hope it helps (https://github.com/bitcoin/bitcoin/pull/30000#pullrequestreview-2049866191)",
      "commit_id" : "65f69bf533f66ecfb2695b03204bd437f1fe692d",
      "created_at" : "2024-05-10T11:41:11Z",
      "diff_hunk" : "@@ -2295,7 +2295,9 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_reconside\n \n     const uint256& hash = gtxid.GetHash();\n \n-    if (m_orphanage.HaveTx(gtxid)) return true;\n+    // Orphanage is checked by wtxid. However, even if this is a txid, look up the same hash in\n+    // case this is a non-segwit transaction in the orphanage.\n+    if (m_orphanage.HaveTx(Wtxid::FromUint256(gtxid.GetHash()))) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30000#discussion_r1596649444",
      "id" : 1596649444,
      "in_reply_to_id" : 1586713579,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fKu_k",
      "original_commit_id" : "4b4dfaa8f3fb98696ab19962e07db51046137542",
      "original_line" : 2300,
      "original_position" : 7,
      "original_start_line" : 2298,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 2049904786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30000",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596649444/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-10T11:41:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596649444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
