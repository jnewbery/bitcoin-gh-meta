[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30093).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theuni](https://github.com/bitcoin/bitcoin/pull/30093#pullrequestreview-2053171781), [josibake](https://github.com/bitcoin/bitcoin/pull/30093#issuecomment-2157864160) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30050](https://github.com/bitcoin/bitcoin/pull/30050) (refactor, wallet: get serialized size of `CRecipient`s directly by josibake)\n* [#24128](https://github.com/bitcoin/bitcoin/pull/24128) (wallet: BIP 326 sequence based anti-fee-snipe for taproot inputs by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-05-13T09:54:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#issuecomment-2107140226",
      "id" : 2107140226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30093",
      "node_id" : "IC_kwDOABII5859mGiC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107140226/reactions"
      },
      "updated_at" : "2024-06-10T09:43:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107140226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1598744518"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598744518"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A few suggestions:\r\n- Looks to me like `txNew.vout` is always empty here, so I'm not sure why we'd bother to add `txNew.vout.size()` unless I'm missing something ?\r\n- There's an additional likely insert for change. Since the reserved size here is exact, that could trigger a reallocation up to the next power-of-two. Makes sense to make this `vecSend.size()+1` just in case.\r\n- I think the txouts could be `std::move`d (in both places) instead to save a copy similar to #30094?\r\n- Any reason not `.reserve()` for the `txNew.vin` as well?",
      "commit_id" : "aaed2db4f44afbf9ae3c730acbe618b998adc265",
      "created_at" : "2024-05-13T16:27:14Z",
      "diff_hunk" : "@@ -1088,6 +1088,7 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     coin_selection_params.tx_noinputs_size = 10 + GetSizeOfCompactSize(vecSend.size()); // bytes for output count\n \n     // vouts to the payees\n+    txNew.vout.reserve(txNew.vout.size() + vecSend.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1598744518",
      "id" : 1598744518,
      "line" : 1091,
      "node_id" : "PRRC_kwDOABII585fSufG",
      "original_commit_id" : "aaed2db4f44afbf9ae3c730acbe618b998adc265",
      "original_line" : 1091,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 4,
      "pull_request_review_id" : 2053171781,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598744518/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-13T16:27:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598744518",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1599029438"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599029438"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hey @theuni, excellent review, thanks!\r\n1) yes, it's always empty, leaving it out is indeed more readable - and if people modify it in the future, they should just pay attention to this\r\n2) nice, haven't noticed it, added the +1 (added you as co-author)\r\n3) To be consistent with `txNew.vin`, I've changed it to `emplace_back` instead, the performance should be comparable - do you agree?\r\n4) wanted to be focused only on the issue discovered during code review, but this is much better, thanks for the comment, pushed!",
      "commit_id" : "a1c3d587959634f029019ed4fb25f7303ffcda44",
      "created_at" : "2024-05-13T20:12:02Z",
      "diff_hunk" : "@@ -1088,6 +1088,7 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n     coin_selection_params.tx_noinputs_size = 10 + GetSizeOfCompactSize(vecSend.size()); // bytes for output count\n \n     // vouts to the payees\n+    txNew.vout.reserve(txNew.vout.size() + vecSend.size());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1599029438",
      "id" : 1599029438,
      "in_reply_to_id" : 1598744518,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585fT0C-",
      "original_commit_id" : "aaed2db4f44afbf9ae3c730acbe618b998adc265",
      "original_line" : 1091,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 2053705970,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599029438/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-13T20:12:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599029438",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1841944?v=4",
         "events_url" : "https://api.github.com/users/paplorinc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paplorinc/followers",
         "following_url" : "https://api.github.com/users/paplorinc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paplorinc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paplorinc",
         "id" : 1841944,
         "login" : "paplorinc",
         "node_id" : "MDQ6VXNlcjE4NDE5NDQ=",
         "organizations_url" : "https://api.github.com/users/paplorinc/orgs",
         "received_events_url" : "https://api.github.com/users/paplorinc/received_events",
         "repos_url" : "https://api.github.com/users/paplorinc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paplorinc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paplorinc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paplorinc"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1599061542"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599061542"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This will just be forwarded to the copy ctor. `push_back(std::move(txout))` would be more correct (and clear).",
      "commit_id" : "a1c3d587959634f029019ed4fb25f7303ffcda44",
      "created_at" : "2024-05-13T20:46:43Z",
      "diff_hunk" : "@@ -1098,7 +1099,7 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         if (IsDust(txout, wallet.chain().relayDustFee())) {\n             return util::Error{_(\"Transaction amount too small\")};\n         }\n-        txNew.vout.push_back(txout);\n+        txNew.vout.emplace_back(txout);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#discussion_r1599061542",
      "id" : 1599061542,
      "line" : 1102,
      "node_id" : "PRRC_kwDOABII585fT74m",
      "original_commit_id" : "a1c3d587959634f029019ed4fb25f7303ffcda44",
      "original_line" : 1102,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 13,
      "pull_request_review_id" : 2053797039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30093",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599061542/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-13T20:46:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1599061542",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nI noticed you have benchmarks, would be nice to have the comparison of old vs new in the PR description.",
      "created_at" : "2024-06-10T09:43:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#issuecomment-2157864160",
      "id" : 2157864160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30093",
      "node_id" : "IC_kwDOABII586AnmTg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2157864160/reactions"
      },
      "updated_at" : "2024-06-10T09:43:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2157864160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the review @josibake, I've added the conclusions of the benchmarks to the commit message (but copied it to the PR description as well now), can you please check if https://github.com/bitcoin/bitcoin/pull/30093/commits/ebf8667f634653a2eebe404469bfb62c5bb3add2 answers your questions?\r\n\r\n@theuni, appreciate your previous reviews and insights, please take a look at the changes I did since.",
      "created_at" : "2024-06-10T16:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30093#issuecomment-2158816952",
      "id" : 2158816952,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30093",
      "node_id" : "IC_kwDOABII586ArO64",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2158816952/reactions"
      },
      "updated_at" : "2024-06-10T16:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2158816952",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1841944?v=4",
         "events_url" : "https://api.github.com/users/paplorinc/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paplorinc/followers",
         "following_url" : "https://api.github.com/users/paplorinc/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paplorinc/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paplorinc",
         "id" : 1841944,
         "login" : "paplorinc",
         "node_id" : "MDQ6VXNlcjE4NDE5NDQ=",
         "organizations_url" : "https://api.github.com/users/paplorinc/orgs",
         "received_events_url" : "https://api.github.com/users/paplorinc/received_events",
         "repos_url" : "https://api.github.com/users/paplorinc/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paplorinc/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paplorinc/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paplorinc"
      }
   }
]
