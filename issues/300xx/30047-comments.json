[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30047).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [katesalazar](https://github.com/bitcoin/bitcoin/pull/30047#issuecomment-2096770530) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28201](https://github.com/bitcoin/bitcoin/pull/28201) (Silent Payments: sending by josibake)\n* [#28122](https://github.com/bitcoin/bitcoin/pull/28122) (Silent Payments: Implement BIP352 by josibake)\n* [#27260](https://github.com/bitcoin/bitcoin/pull/27260) (Enhanced error messages for invalid network prefix during address parsing. by russeree)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-05-06T09:27:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#issuecomment-2095548257",
      "id" : 2095548257,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30047",
      "node_id" : "IC_kwDOABII585854dh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2095548257/reactions"
      },
      "updated_at" : "2024-05-06T19:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2095548257",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30047#discussion_r1591418368"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30047"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1591418368"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Aren't these checks broken if limit is `NO_LIMIT` (0) ?",
      "commit_id" : "1cfe953c266475e379010900f278e55d21f10418",
      "created_at" : "2024-05-06T18:46:35Z",
      "diff_hunk" : "@@ -370,11 +370,11 @@ std::string Encode(Encoding encoding, const std::string& hrp, const data& values\n }\n \n /** Decode a Bech32 or Bech32m string. */\n-DecodeResult Decode(const std::string& str) {\n+DecodeResult Decode(const std::string& str, CharLimit limit) {\n     std::vector<int> errors;\n     if (!CheckCharacters(str, errors)) return {};\n     size_t pos = str.rfind('1');\n-    if (str.size() > 90 || pos == str.npos || pos == 0 || pos + 7 > str.size()) {\n+    if (str.size() > limit || pos == str.npos || pos == 0 || pos + 7 > str.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#discussion_r1591418368",
      "id" : 1591418368,
      "line" : 377,
      "node_id" : "PRRC_kwDOABII585e2x4A",
      "original_commit_id" : "1cfe953c266475e379010900f278e55d21f10418",
      "original_line" : 377,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bech32.cpp",
      "position" : 10,
      "pull_request_review_id" : 2041444686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30047",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1591418368/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-06T18:49:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1591418368",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-05-06T19:37:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#issuecomment-2096770530",
      "id" : 2096770530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30047",
      "node_id" : "IC_kwDOABII5858-i3i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096770530/reactions"
      },
      "updated_at" : "2024-05-06T19:37:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096770530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/52637275?v=4",
         "events_url" : "https://api.github.com/users/katesalazar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/katesalazar/followers",
         "following_url" : "https://api.github.com/users/katesalazar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/katesalazar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/katesalazar",
         "id" : 52637275,
         "login" : "katesalazar",
         "node_id" : "MDQ6VXNlcjUyNjM3Mjc1",
         "organizations_url" : "https://api.github.com/users/katesalazar/orgs",
         "received_events_url" : "https://api.github.com/users/katesalazar/received_events",
         "repos_url" : "https://api.github.com/users/katesalazar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/katesalazar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/katesalazar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/katesalazar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30047#discussion_r1592074394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30047"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1592074394"
         }
      },
      "author_association" : "MEMBER",
      "body" : ":doh: yes! fixed and added unit tests for the `NO_LIMIT` case.",
      "commit_id" : "7cb6dac0dc3d11b7dc3e338e5773ca5e64e0c58d",
      "created_at" : "2024-05-07T08:59:02Z",
      "diff_hunk" : "@@ -370,11 +370,11 @@ std::string Encode(Encoding encoding, const std::string& hrp, const data& values\n }\n \n /** Decode a Bech32 or Bech32m string. */\n-DecodeResult Decode(const std::string& str) {\n+DecodeResult Decode(const std::string& str, CharLimit limit) {\n     std::vector<int> errors;\n     if (!CheckCharacters(str, errors)) return {};\n     size_t pos = str.rfind('1');\n-    if (str.size() > 90 || pos == str.npos || pos == 0 || pos + 7 > str.size()) {\n+    if (str.size() > limit || pos == str.npos || pos == 0 || pos + 7 > str.size()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#discussion_r1592074394",
      "id" : 1592074394,
      "in_reply_to_id" : 1591418368,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585e5SCa",
      "original_commit_id" : "1cfe953c266475e379010900f278e55d21f10418",
      "original_line" : 377,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/bech32.cpp",
      "position" : null,
      "pull_request_review_id" : 2042518236,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30047",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1592074394/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-07T08:59:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1592074394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think the original bug here illustrates that the enum is not well suited for this. Definitely not with a value of 0 for NO_LIMIT anyway. Got any other ideas? :)",
      "created_at" : "2024-05-07T14:23:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#issuecomment-2098532940",
      "id" : 2098532940,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30047",
      "node_id" : "IC_kwDOABII5859FRJM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2098532940/reactions"
      },
      "updated_at" : "2024-05-07T14:23:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2098532940",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I think the original bug here illustrates that the enum is not well suited for this. Definitely not with a value of 0 for NO_LIMIT anyway. Got any other ideas? :)\r\n\r\nYeah, I was getting an icky feeling while updating the PR for 2 reasons: `NO_LIMIT` of 0 is crappy and also the caller needs to make sure to use the same `CharLimit` for `Decode` and again with `LocateErrors`, which seems foot-gunny.\r\n\r\nMy ideal solution is `Decode`/`LocateErrors` shouldn't have a character limit at all (or use 1024, considering BIP173 mentions that bech32 error detection works reasonably well up to 1024 characters). Then, character limits for specific address types (e.g. bc1, sp1) should be enforced in the Destination Encoder/Decoder in [src/key_io.cpp](https://github.com/bitcoin/bitcoin/blob/master/src/key_io.cpp).\r\n\r\nIIRC, when I first wrote this code a year ago, there wasn't much appetite for moving the charlimit out of `Decode`. If thats still the case, my next best solution would be keep the Enum and remove the `NO_LIMIT` case.",
      "created_at" : "2024-05-07T14:55:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30047#issuecomment-2098604388",
      "id" : 2098604388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30047",
      "node_id" : "IC_kwDOABII5859Filk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2098604388/reactions"
      },
      "updated_at" : "2024-05-07T14:55:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2098604388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   }
]
