{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Another attempt at #25380 with an alternate approach\r\n\r\nThis PR updates `CBlockPolicyEstimator` to ignore all transactions with an in-block child when a new block is received.\r\nThis fixes the assumption that all transactions are confirmed solely because of their fee rate. \r\nAs some transactions are confirmed due to a CFPP by some child.\r\n\r\n\r\nThe downside of this approach is that transactions that are not CPFPâd will aslo be ignored.\r\n\r\n The correct approach is to linearize all transactions removed from the mempool because of the new  block, and only ignore transactions whose mining score is not the same with their the fee rate.\r\n\r\nI have a branch that implements this using a mini miner:\r\n\r\n- [mini miner: Linearize should also return package fees and sizes](https://github.com/bitcoin/bitcoin/commit/d8c1cbca34e47306921ed410b8f5e8573528af54)\r\n\r\n- [fees: Add function computing ancestors and descendants of transactions](https://github.com/bitcoin/bitcoin/commit/cd610d1eeebbcabeb426d8e667591607fd5d8d5c)\r\n- [fees: Ignore transactions that are CPFP'd](https://github.com/bitcoin/bitcoin/commit/09e989830f3b24482ec95a58892a33958df96f70)\r\n\r\nThe implication of the approach in this branch is that the constructor used and the linearization code will be removed post-cluster mempool implementation:\r\n\r\n[Rework mini_miner to utilize cluster mempool features](https://github.com/sdaftuar/bitcoin/commit/d24f02699ec4af215a4ffae3a2ae2457f71bf93f)\r\n\r\nAnother approach I contemplated was to replicate the linearization code into `policy/fees.cpp` and use it but this means having duplicate code in `policy/fees.cpp` and `node/mini_miner.cpp`. Considering that post-cluster mempool, we will transition to tracking chunks rather than individual transactions and the specification for this is already under discussion [here](https://delvingbitcoin.org/t/package-aware-fee-estimator-post-cluster-mempool/312).\r\n\r\nThis PR is an interim solution, focusing on ignoring transactions with in-block children this is safe to use considering that the majority of transactions are individual transactions. Upon implementing the cluster mempool, we will just track chunks and make the fee estimator package aware.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079/comments",
   "created_at" : "2024-05-10T09:04:16Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/30079",
   "id" : 2289321876,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585vE6t1",
   "number" : 30079,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/30079.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30079",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/30079.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30079"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079/timeline",
   "title" : "Fee Estimation: Ignore all transactions with an in-block child",
   "updated_at" : "2024-05-10T09:04:20Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30079",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
      "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
      "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ismaelsadeeq",
      "id" : 48946461,
      "login" : "ismaelsadeeq",
      "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
      "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
      "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
      "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ismaelsadeeq"
   }
}
