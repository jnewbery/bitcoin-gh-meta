[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Great find!\r\n\r\nIt seems reasonable and safer to increase the min prune target, since blocks can be larger post-segwit (and we've seen it, e.g. 774628).  Some rough napkin math for a new value (correct me if something looks off):\r\n- 4MB per block, 288 blocks = 1152MB\r\n- Add 15% for Undo data = 1325MB\r\n- Add 20% for Orphan block rate = 1590MB\r\n- Add one block file + added 15% undo data = 147MB\r\n- Target >= 1737MB, so something like 1750MB seems at first glance that it could work\r\n\r\nI would recommend we minimize impact to existing nodes and provide time for warning/deprecation.\r\n>increase the limit in a hard way - this would be an inconvenience to lots of existing users who would need to update their bitcoin.conf to be able to start bitcoind\r\n\r\nThis seems like a no-go to me as it can impact node runtime.  An alternate option is presented below\r\n\r\n>increase it in a soft way, something like disrepecting it on purpose by setting it to a higher value, but without an init error.\r\n\r\nThis seems at minimum unintuitive and at most dangerous for node operators, since nodes with limited space would believe bitcoind was being limited/constrained to a particular allocated amount of space but would be exceeding the allocated amount.\r\n\r\n>add a comment to the -prune doc that values around 550MiB are pointless.\r\n\r\nYes, this seems prudent.\r\n\r\n>do nothing\r\n\r\nWe should do something, as this seems like a bug given current allowed block sizes.\r\n\r\nHow about something like:\r\n- Temporarily allow and respect values >= 550MB but < 1750MB (e.g. for one release)\r\n- bitcoind provides a warning message for values >= 550MB but < 1750MB\r\n- Add a clear deprecation warning in the release notes\r\n- Add note/comment for `prune` in the default bitcoin.conf and `-prune` help/doc about values >= 550MB but < 1750MB being supported temporarily but unsupported in future release\r\n- In a future release, the min prune target can be changed to and enforced to 1750MB",
      "created_at" : "2024-05-04T14:34:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/30037#issuecomment-2094223248",
      "id" : 2094223248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30037",
      "node_id" : "IC_kwDOABII585800-Q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2094223248/reactions"
      },
      "updated_at" : "2024-05-04T14:40:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2094223248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> since nodes with limited space would believe bitcoind was being limited/constrained to a particular allocated amount of space but would be exceeding the allocated amount\r\n\r\nThis is already the case today, because the 288 blocks rule takes precedence over the user-provided number. With average block sizes of 1.6MiB currently, my synced `prune=550` node usually takes up between 700MiB and 900MiB of space for `*.blk` and `*.rev` files.. The target is only respected when possible (during the earlier parts of IBD where blocks are still small). So the point would be that if we are going to disrepect the target anyway in later stages of IBD we might as well start earlier (and gain some performance benefits).\r\n\r\n> Temporarily allow and respect values >= 550MB **but < 1750MB** (e.g. for one release)\r\n\r\nYou probably didn't mean it that way , but there is no maximum target, everything >=550MB is respected today, and we won't want to change that.\r\n\r\n> How about something like:\r\n\r\nSounds reasonable to me in general.",
      "created_at" : "2024-05-06T14:42:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/30037#issuecomment-2096202995",
      "id" : 2096202995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30037",
      "node_id" : "IC_kwDOABII58588YTz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096202995/reactions"
      },
      "updated_at" : "2024-05-06T14:43:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2096202995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
