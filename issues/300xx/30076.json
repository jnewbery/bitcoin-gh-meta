{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "This PR fixes a dormant bug in MiniWallet that exists since support for P2TR was initially added in #23371 (see commit 041abfebe49ae5e3e882c00cc5caea1365a27a49).\r\n    \r\nIn the course of spending the output, the leaf version byte of the control block in the witness stack doesn't set the parity bit, i.e. we were so far just lucky that the used combinations of relevant data (internal pubkey, leaf script / version) didn't result in a tweaked pubkey with odd y-parity. If that was the case, we'd get the following validation error:\r\n\r\n`mandatory-script-verify-flag-failed (Witness program hash mismatch) (-26)`\r\n    \r\nSince MiniWallets can now optionally be tagged (#29939), resulting in different internal pubkeys, the issue is more prevalent now. Fix it by passing the parity bit, as specified in BIP341.\r\n\r\nCan be tested with the following patch (fails on master, succeeds on PR):\r\n```diff\r\ndiff --git a/test/functional/test_framework/mempool_util.py b/test/functional/test_framework/mempool_util.py\r\nindex 148cc935ed..7ebe858681 100644\r\n--- a/test/functional/test_framework/mempool_util.py\r\n+++ b/test/functional/test_framework/mempool_util.py\r\n@@ -42,7 +42,7 @@ def fill_mempool(test_framework, node):\r\n     # Generate UTXOs to flood the mempool\r\n     # 1 to create a tx initially that will be evicted from the mempool later\r\n     # 75 transactions each with a fee rate higher than the previous one\r\n-    ephemeral_miniwallet = MiniWallet(node, tag_name=\"fill_mempool_ephemeral_wallet\")\r\n+    ephemeral_miniwallet = MiniWallet(node, tag_name=\"fill_mempool_ephemeral_wallet3\")\r\n     test_framework.generate(ephemeral_miniwallet, 1 + num_of_batches * tx_batch_size)\r\n \r\n     # Mine enough blocks so that the UTXOs are allowed to be spent\r\n```",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076/comments",
   "created_at" : "2024-05-09T22:52:38Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/30076",
   "id" : 2288582058,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585vCbgF",
   "number" : 30076,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/30076.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30076",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/30076.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30076"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076/timeline",
   "title" : "test: fix MiniWallet script-path spend (missing parity bit in leaf version)",
   "updated_at" : "2024-05-09T22:52:43Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30076",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
      "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
      "followers_url" : "https://api.github.com/users/theStack/followers",
      "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/theStack",
      "id" : 91535,
      "login" : "theStack",
      "node_id" : "MDQ6VXNlcjkxNTM1",
      "organizations_url" : "https://api.github.com/users/theStack/orgs",
      "received_events_url" : "https://api.github.com/users/theStack/received_events",
      "repos_url" : "https://api.github.com/users/theStack/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/theStack"
   }
}
