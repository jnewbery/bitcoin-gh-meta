[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't know much about the flatpak, but I'm guessing the \"flatpak run\" command is invoking `bitcoin-qt` with a hardcoded `-datadir=` argument that preempts the `-choosedatadir` argument:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/66e2d21ef203e422eea8f0a3c7029ac59b210668/src/qt/intro.cpp#L210-L213\r\n\r\nProbably easiest way to fix this is for flatpack to stop passing a hardcoded datadir to bitcoin-qt and instead create an initial `$HOME/.config/Bitcoin/Bitcoin-Qt.conf` file with something like:\r\n\r\n```ini\r\n[General]\r\nstrDataDir=/path/to/datadir\r\n```\r\n\r\nOr, to help with this and make it easier, `bitcoin-qt` could provide a new softer way of setting a datadir directory that has lower precedence than existing command line and config options like a `-defaultdatdir` argument or a `BITCOIN_DATADIR` environment variable.\r\n\r\nAssuming flatpak is passing a `-datadir` argument, it might not be possible to fix this solely in bitcoin-qt without changing the flatpak, because the `-datadir` argument does take precedence over everything else by design.",
      "created_at" : "2022-03-18T15:12:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072506837",
      "id" : 1072506837,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_7SfV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072506837/reactions"
      },
      "updated_at" : "2022-03-18T15:12:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072506837",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/flathub/org.bitcoincore.bitcoin-qt/blob/2d5b49c3ee87bc86f93e75b87512163afd54e284/install_wrappers.sh#L6",
      "created_at" : "2022-03-18T15:21:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072514344",
      "id" : 1072514344,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_7UUo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072514344/reactions"
      },
      "updated_at" : "2022-03-18T15:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072514344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> https://github.com/flathub/org.bitcoincore.bitcoin-qt/blob/2d5b49c3ee87bc86f93e75b87512163afd54e284/install_wrappers.sh#L6\r\n\r\nThanks. Since that wraps both bitcoind and bitcoin-qt, it looks like a similar problem would also happen with `bitcoind` and the `-conf` option. For example if user tried to use the flatpak with `-conf` argument and a configuration file containing `datadir=/some/path`, the configured datadir would be ignored because of the flatpak command line argument.\r\n\r\nMaybe a decent way to fix these issues across all the binaries could be to make [`GetDefaultDataDir`](https://github.com/bitcoin/bitcoin/blob/66e2d21ef203e422eea8f0a3c7029ac59b210668/src/util/system.cpp#L789) check for a `BITCOIN_DATADIR` environment variable, and change the flatpak to set `BITCOIN_DATADIR` instead of passing `-datadir=`\r\n\r\nHaving the wrapper create an initial `Bitcoin-Qt.conf` as suggested previously could also work to fix the GUI problem, but seems more awkward.",
      "created_at" : "2022-03-18T15:39:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072531097",
      "id" : 1072531097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_7YaZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072531097/reactions"
      },
      "updated_at" : "2022-03-18T15:39:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072531097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@MarcoFalke - Interesting. the change /setup was in the `flathub/org.bitcoincore.bitcoin-qt` repo, while the issues page led me here.\r\n\r\nThat said, yes. I found it impossible to configure anything or provide datadir during startup while running from flatpak. \r\n",
      "created_at" : "2022-03-18T18:48:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072703584",
      "id" : 1072703584,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_8Chg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072703584/reactions"
      },
      "updated_at" : "2022-03-18T18:48:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072703584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/332330?v=4",
         "events_url" : "https://api.github.com/users/orsenthil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/orsenthil/followers",
         "following_url" : "https://api.github.com/users/orsenthil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/orsenthil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/orsenthil",
         "id" : 332330,
         "login" : "orsenthil",
         "node_id" : "MDQ6VXNlcjMzMjMzMA==",
         "organizations_url" : "https://api.github.com/users/orsenthil/orgs",
         "received_events_url" : "https://api.github.com/users/orsenthil/received_events",
         "repos_url" : "https://api.github.com/users/orsenthil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/orsenthil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/orsenthil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/orsenthil"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> That said, yes. I found it impossible to configure anything or provide datadir during startup while running from flatpak.\r\n\r\nYou should still be able to override the datadir from the command line by appending your own -datadir argument.",
      "created_at" : "2022-03-18T19:26:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072736282",
      "id" : 1072736282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_8Kga",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072736282/reactions"
      },
      "updated_at" : "2022-03-18T19:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072736282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I had tried that. I gave an option a different datadir, which I had moved, and run didn't recognize. I will try again and share the output. \r\n\r\nI ended up using a non flatpak version - compiled from the master of this repo.",
      "created_at" : "2022-03-18T19:30:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072738692",
      "id" : 1072738692,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_8LGE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072738692/reactions"
      },
      "updated_at" : "2022-03-18T19:30:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072738692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/332330?v=4",
         "events_url" : "https://api.github.com/users/orsenthil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/orsenthil/followers",
         "following_url" : "https://api.github.com/users/orsenthil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/orsenthil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/orsenthil",
         "id" : 332330,
         "login" : "orsenthil",
         "node_id" : "MDQ6VXNlcjMzMjMzMA==",
         "organizations_url" : "https://api.github.com/users/orsenthil/orgs",
         "received_events_url" : "https://api.github.com/users/orsenthil/received_events",
         "repos_url" : "https://api.github.com/users/orsenthil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/orsenthil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/orsenthil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/orsenthil"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Sounds good. I think we have enough information to fix this in any case.\r\n\r\nAnother possible option if flatpak supports this could be to put a symlink in the flatpak datadir location that points to the desired location\r\n",
      "created_at" : "2022-03-18T19:37:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072743223",
      "id" : 1072743223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_8MM3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072743223/reactions"
      },
      "updated_at" : "2022-03-18T19:37:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072743223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I tried the symlink option too. I moved the datadir from `~/.var/app/org.bitcoincore.bitcoin-qt` and `ln -s` that data dir; but the flatpak run complained (something like datadir doesn't exist).",
      "created_at" : "2022-03-18T19:47:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-1072749014",
      "id" : 1072749014,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII584_8NnW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072749014/reactions"
      },
      "updated_at" : "2022-03-18T19:47:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1072749014",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/332330?v=4",
         "events_url" : "https://api.github.com/users/orsenthil/events{/privacy}",
         "followers_url" : "https://api.github.com/users/orsenthil/followers",
         "following_url" : "https://api.github.com/users/orsenthil/following{/other_user}",
         "gists_url" : "https://api.github.com/users/orsenthil/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/orsenthil",
         "id" : 332330,
         "login" : "orsenthil",
         "node_id" : "MDQ6VXNlcjMzMjMzMA==",
         "organizations_url" : "https://api.github.com/users/orsenthil/orgs",
         "received_events_url" : "https://api.github.com/users/orsenthil/received_events",
         "repos_url" : "https://api.github.com/users/orsenthil/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/orsenthil/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/orsenthil/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/orsenthil"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "This worked for me - Pop!_OS (Ubuntu 22.04 LTS) running bitcoincore installed via flatpak:\r\n\r\nGet the flatpak ID:\r\n```\r\n> flatpak list | grep -i bitcoin\r\n> Bitcoin Core\torg.bitcoincore.bitcoin-qt\t26.1\tstable\tuser\r\n```\r\nAllow flatpak to use the new data folder:\r\n```\r\n> flatpak override --user --filesystem=/my/new/folder/for-btc-data org.bitcoincore.bitcoin-qt\r\n```\r\nLaunch from the command line:\r\n```\r\n> flatpak run org.bitcoincore.bitcoin-qt --datadir=/my/new/folder/for-btc-data &\r\n```\r\nI have to launch from the command line. Editing the flatpak .desktop file does not work.\r\n\r\n",
      "created_at" : "2024-05-11T16:22:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24612#issuecomment-2105945843",
      "id" : 2105945843,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24612",
      "node_id" : "IC_kwDOABII5859hi7z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2105945843/reactions"
      },
      "updated_at" : "2024-05-11T16:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2105945843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/54378069?v=4",
         "events_url" : "https://api.github.com/users/nolajohn/events{/privacy}",
         "followers_url" : "https://api.github.com/users/nolajohn/followers",
         "following_url" : "https://api.github.com/users/nolajohn/following{/other_user}",
         "gists_url" : "https://api.github.com/users/nolajohn/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/nolajohn",
         "id" : 54378069,
         "login" : "nolajohn",
         "node_id" : "MDQ6VXNlcjU0Mzc4MDY5",
         "organizations_url" : "https://api.github.com/users/nolajohn/orgs",
         "received_events_url" : "https://api.github.com/users/nolajohn/received_events",
         "repos_url" : "https://api.github.com/users/nolajohn/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/nolajohn/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/nolajohn/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/nolajohn"
      }
   }
]
