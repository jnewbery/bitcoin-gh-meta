[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-07-25T20:47:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#issuecomment-1650538288",
      "id" : 1650538288,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28155",
      "node_id" : "IC_kwDOABII585iYTcw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650538288/reactions"
      },
      "updated_at" : "2023-07-25T20:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650538288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I've purposely split this into three commits according to each of the fixes so they can be discussed, and considered independently. That way it'll be easier to remove any if the change does not reach enough consensus.",
      "created_at" : "2023-07-25T20:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#issuecomment-1650541120",
      "id" : 1650541120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28155",
      "node_id" : "IC_kwDOABII585iYUJA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650541120/reactions"
      },
      "updated_at" : "2023-07-25T20:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1650541120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "would it make sense to add a functional test like the below under\r\n```\r\nip_port = \"localhost:[]\".format(p2p_port='add')\r\nself.nodes[0].addnode(node=ip_port, command='add')\r\n```\r\nin `test/functional/rpc_net.py` on line 212\r\nbecause we shortly after assert that there is only 1 added node added",
      "created_at" : "2023-07-26T21:29:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#issuecomment-1652522093",
      "id" : 1652522093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28155",
      "node_id" : "IC_kwDOABII585if3xt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652522093/reactions"
      },
      "updated_at" : "2023-07-26T21:29:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1652522093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> would it make sense to add a functional test like the below under\r\n> \r\n> ```\r\n> ip_port = \"localhost:[]\".format(p2p_port='add')\r\n> self.nodes[0].addnode(node=ip_port, command='add')\r\n> ```\r\n> \r\n> in `test/functional/rpc_net.py` on line 212 because we shortly after assert that there is only 1 added node added\r\n\r\nI don't think that'd work. You'll still be able to add two nodes that resolve to the same IP using `addnode` as long as they belong to different namespaces. Lookups are not performed. The difference though is that both connections won't be established. However, the connection is not being checked by the test. \r\n\r\nWhat could be added, however, is a check for `127.0.0.1` and `127.1`.\r\n\r\nPS: This actually made me realize that the check for whether to add something to `m_added_nodes` was not good enough.",
      "created_at" : "2023-07-28T16:45:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#issuecomment-1655993325",
      "id" : 1655993325,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28155",
      "node_id" : "IC_kwDOABII585itHPt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1655993325/reactions"
      },
      "updated_at" : "2023-07-28T16:45:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1655993325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Added a test to `test/functional/rpc_net.py` and fixed the check on `CConnman::AddNode`",
      "created_at" : "2023-07-28T17:32:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#issuecomment-1656076583",
      "id" : 1656076583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28155",
      "node_id" : "IC_kwDOABII585itbkn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1656076583/reactions"
      },
      "updated_at" : "2023-07-28T17:32:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1656076583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1277945499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277945499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "might want to uncomment these other tests",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-07-28T18:25:28Z",
      "diff_hunk" : "@@ -57,14 +57,14 @@ def run_test(self):\n         self.connect_nodes(0, 1)\n         self.sync_all()\n \n-        self.test_connection_count()\n-        self.test_getpeerinfo()\n-        self.test_getnettotals()\n-        self.test_getnetworkinfo()\n+        # self.test_connection_count()\n+        # self.test_getpeerinfo()\n+        # self.test_getnettotals()\n+        # self.test_getnetworkinfo()\n         self.test_getaddednodeinfo()\n-        self.test_service_flags()\n-        self.test_getnodeaddresses()\n-        self.test_addpeeraddress()\n+        # self.test_service_flags()\n+        # self.test_getnodeaddresses()\n+        # self.test_addpeeraddress()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1277945499",
      "id" : 1277945499,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MK-ab",
      "original_commit_id" : "b5763bc83ee87fd9f2e9e370cead7558f95718b0",
      "original_line" : 67,
      "original_position" : 18,
      "original_start_line" : 60,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 1552702292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277945499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-28T18:25:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277945499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15950706?v=4",
         "events_url" : "https://api.github.com/users/kevkevinpal/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kevkevinpal/followers",
         "following_url" : "https://api.github.com/users/kevkevinpal/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kevkevinpal/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kevkevinpal",
         "id" : 15950706,
         "login" : "kevkevinpal",
         "node_id" : "MDQ6VXNlcjE1OTUwNzA2",
         "organizations_url" : "https://api.github.com/users/kevkevinpal/orgs",
         "received_events_url" : "https://api.github.com/users/kevkevinpal/received_events",
         "repos_url" : "https://api.github.com/users/kevkevinpal/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kevkevinpal/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kevkevinpal/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kevkevinpal"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1277960418"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277960418"
         }
      },
      "author_association" : "NONE",
      "body" : "Ups, my bad",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-07-28T18:41:20Z",
      "diff_hunk" : "@@ -57,14 +57,14 @@ def run_test(self):\n         self.connect_nodes(0, 1)\n         self.sync_all()\n \n-        self.test_connection_count()\n-        self.test_getpeerinfo()\n-        self.test_getnettotals()\n-        self.test_getnetworkinfo()\n+        # self.test_connection_count()\n+        # self.test_getpeerinfo()\n+        # self.test_getnettotals()\n+        # self.test_getnetworkinfo()\n         self.test_getaddednodeinfo()\n-        self.test_service_flags()\n-        self.test_getnodeaddresses()\n-        self.test_addpeeraddress()\n+        # self.test_service_flags()\n+        # self.test_getnodeaddresses()\n+        # self.test_addpeeraddress()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1277960418",
      "id" : 1277960418,
      "in_reply_to_id" : 1277945499,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MLCDi",
      "original_commit_id" : "b5763bc83ee87fd9f2e9e370cead7558f95718b0",
      "original_line" : 67,
      "original_position" : 18,
      "original_start_line" : 60,
      "path" : "test/functional/rpc_net.py",
      "position" : null,
      "pull_request_review_id" : 1552730733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277960418/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-28T18:41:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1277960418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296821862"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296821862"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, style (`const` and attach the `&` to `auto`):\r\n```suggestion\r\n            for (const auto& r : resolved) {\r\n```",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T07:53:56Z",
      "diff_hunk" : "@@ -462,19 +462,22 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n     if (pszDest) {\n         const std::vector<CService> resolved{Lookup(pszDest, default_port, fNameLookup && !HaveNameProxy(), 256)};\n         if (!resolved.empty()) {\n-            const CService& rnd{resolved[GetRand(resolved.size())]};\n-            addrConnect = CAddress{MaybeFlipIPv6toCJDNS(rnd), NODE_NONE};\n-            if (!addrConnect.IsValid()) {\n-                LogPrint(BCLog::NET, \"Resolver returned invalid address %s for %s\\n\", addrConnect.ToStringAddrPort(), pszDest);\n-                return nullptr;\n-            }\n-            // It is possible that we already have a connection to the IP/port pszDest resolved to.\n-            // In that case, drop the connection that was just created.\n-            LOCK(m_nodes_mutex);\n-            CNode* pnode = FindNode(static_cast<CService>(addrConnect));\n-            if (pnode) {\n-                LogPrintf(\"Failed to open new connection, already connected\\n\");\n-                return nullptr;\n+            // If the connection is made by name, it can be the case that the name resolves to more than one address.\n+            // We don't want to connect any more of them if we are already connected to one\n+            for (auto &r : resolved) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296821862",
      "id" : 1296821862,
      "line" : 467,
      "node_id" : "PRRC_kwDOABII585NS-5m",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 467,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 19,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296821862/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296821862",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296827360"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296827360"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This log can be improved to something like this:\r\n\r\n```\r\nNot opening a new connection to pool.bitcoinnodes.org, already connected to 1.2.3.4",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T07:58:37Z",
      "diff_hunk" : "@@ -462,19 +462,22 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n     if (pszDest) {\n         const std::vector<CService> resolved{Lookup(pszDest, default_port, fNameLookup && !HaveNameProxy(), 256)};\n         if (!resolved.empty()) {\n-            const CService& rnd{resolved[GetRand(resolved.size())]};\n-            addrConnect = CAddress{MaybeFlipIPv6toCJDNS(rnd), NODE_NONE};\n-            if (!addrConnect.IsValid()) {\n-                LogPrint(BCLog::NET, \"Resolver returned invalid address %s for %s\\n\", addrConnect.ToStringAddrPort(), pszDest);\n-                return nullptr;\n-            }\n-            // It is possible that we already have a connection to the IP/port pszDest resolved to.\n-            // In that case, drop the connection that was just created.\n-            LOCK(m_nodes_mutex);\n-            CNode* pnode = FindNode(static_cast<CService>(addrConnect));\n-            if (pnode) {\n-                LogPrintf(\"Failed to open new connection, already connected\\n\");\n-                return nullptr;\n+            // If the connection is made by name, it can be the case that the name resolves to more than one address.\n+            // We don't want to connect any more of them if we are already connected to one\n+            for (auto &r : resolved) {\n+                addrConnect = CAddress{MaybeFlipIPv6toCJDNS(r), NODE_NONE};\n+                if (!addrConnect.IsValid()) {\n+                    LogPrint(BCLog::NET, \"Resolver returned invalid address %s for %s\\n\", addrConnect.ToStringAddrPort(), pszDest);\n+                    return nullptr;\n+                }\n+                // It is possible that we already have a connection to the IP/port pszDest resolved to.\n+                // In that case, drop the connection that was just created.\n+                LOCK(m_nodes_mutex);\n+                CNode* pnode = FindNode(static_cast<CService>(addrConnect));\n+                if (pnode) {\n+                    LogPrintf(\"Failed to open new connection, already connected\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296827360",
      "id" : 1296827360,
      "line" : 478,
      "node_id" : "PRRC_kwDOABII585NTAPg",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 478,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 30,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296827360/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296827360",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296832854"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296832854"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The old code would pick a random address from the list of resolved addresses. The new code would pick the last one. I think it is good to preserve the randomness. One way to achieve that would be to shuffle the result before iterating and picking the last one.\r\n\r\n```cpp\r\nif (!resolved.empty()) {\r\n    Shuffle(resolved.begin(), resolved.end(), FastRandomContext{});\r\n    for (const auto& r : resolved) {\r\n```\r\n\r\nor if the shuffle is perceived expensive for big lists, before the loop `auto to_pick = GetRand(resolved.size())` and inside the loop only assign `addrConnect` for the `to_pick`th element.",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T08:03:34Z",
      "diff_hunk" : "@@ -462,19 +462,22 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n     if (pszDest) {\n         const std::vector<CService> resolved{Lookup(pszDest, default_port, fNameLookup && !HaveNameProxy(), 256)};\n         if (!resolved.empty()) {\n-            const CService& rnd{resolved[GetRand(resolved.size())]};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296832854",
      "id" : 1296832854,
      "line" : 465,
      "node_id" : "PRRC_kwDOABII585NTBlW",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 465,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 4,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296832854/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296832854",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296841654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296841654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In the commit message of 12e601c33e `rpc: Prevents adding the same ip more than once when formatted differently`:\r\n\r\n> ... formatting IPs in aborts\r\n    different,\r\n\r\n",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T08:11:30Z",
      "diff_hunk" : "@@ -2570,9 +2577,10 @@ std::vector<CAddress> CConnman::GetAddresses(CNode& requestor, size_t max_addres\n \n bool CConnman::AddNode(const std::string& strNode)\n {\n+    CService resolved(LookupNumeric(strNode, Params().GetDefaultPort(strNode)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296841654",
      "id" : 1296841654,
      "line" : 2580,
      "node_id" : "PRRC_kwDOABII585NTDu2",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 2580,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 101,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296841654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296841654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296882332"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296882332"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: use `resolved.IsValid()` instead of `resolved != CService{}`.",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T08:44:59Z",
      "diff_hunk" : "@@ -2570,9 +2577,10 @@ std::vector<CAddress> CConnman::GetAddresses(CNode& requestor, size_t max_addres\n \n bool CConnman::AddNode(const std::string& strNode)\n {\n+    CService resolved(LookupNumeric(strNode, Params().GetDefaultPort(strNode)));\n     LOCK(m_added_nodes_mutex);\n     for (const std::string& it : m_added_nodes) {\n-        if (strNode == it) return false;\n+        if (strNode == it || (resolved != CService{} && resolved == LookupNumeric(it, Params().GetDefaultPort(it)))) return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296882332",
      "id" : 1296882332,
      "line" : 2583,
      "node_id" : "PRRC_kwDOABII585NTNqc",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 2583,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 105,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296882332/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296882332",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296885786"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296885786"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style (same in the declaration):\r\n```suggestion\r\nstd::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo(bool include_connected) const\r\n```",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T08:47:53Z",
      "diff_hunk" : "@@ -1919,7 +1922,7 @@ std::vector<CAddress> CConnman::GetCurrentBlockRelayOnlyConns() const\n     return ret;\n }\n \n-std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n+std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo(bool includeConnected) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296885786",
      "id" : 1296885786,
      "line" : 1925,
      "node_id" : "PRRC_kwDOABII585NTOga",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 1925,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 41,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296885786/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296885786",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296888861"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296888861"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        std::vector<AddedNodeInfo> vInfo = GetAddedNodeInfo(/*include_connected=*/false);\r\n```\r\nand in other call sites too",
      "commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "created_at" : "2023-08-17T08:50:30Z",
      "diff_hunk" : "@@ -1979,21 +1988,19 @@ void CConnman::ThreadOpenAddedConnections()\n     while (true)\n     {\n         CSemaphoreGrant grant(*semAddnode);\n-        std::vector<AddedNodeInfo> vInfo = GetAddedNodeInfo();\n+        std::vector<AddedNodeInfo> vInfo = GetAddedNodeInfo(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28155#discussion_r1296888861",
      "id" : 1296888861,
      "line" : 1991,
      "node_id" : "PRRC_kwDOABII585NTPQd",
      "original_commit_id" : "a6fcf17f9dde56637bcfe824bb3def83e764b38c",
      "original_line" : 1991,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 70,
      "pull_request_review_id" : 1582006631,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28155",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296888861/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-17T08:54:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296888861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
