[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657264383), [dergoegge](https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657827011) |\n| Stale ACK | [MarcoFalke](https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1660604025), [Sjors](https://github.com/bitcoin/bitcoin/pull/28186#pullrequestreview-1557474340), [stickies-v](https://github.com/bitcoin/bitcoin/pull/28186#pullrequestreview-1562868143) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/149](https://github.com/bitcoin-core/gui/pull/149) (Intro: Have user choose assumevalid by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-07-30T15:10:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657197143",
      "id" : 1657197143,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585ixtJX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657197143/reactions"
      },
      "updated_at" : "2023-08-05T10:02:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657197143",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.",
      "created_at" : "2023-07-30T20:52:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657264383",
      "id" : 1657264383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585ix9j_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657264383/reactions"
      },
      "updated_at" : "2023-07-30T20:52:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657264383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-07-31T07:33:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657827011",
      "id" : 1657827011,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i0G7D",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657827011/reactions"
      },
      "updated_at" : "2023-07-31T07:33:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657827011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> The dbwrapper is a key component of the libbitcoinkernel library. Future users of this library would not want to contend with having the leveldb headers exposed and potentially polluting their project's namespace.\r\n\r\nNot sure about the motivation. I don't think any user should include the dbwrapper either? No user should be directly writing or reading from the db. The only reason why they'd have to include the header is to get access to `DBOptions`, which would alternatively and trivially be achieved by moving `DBOptions` into a separate header, no?\r\n\r\nAnd if you are worried about the `txdb.h` include, maybe do a pimpl there? IIRC https://github.com/bitcoin/bitcoin/pull/22242 did that, or something like that.",
      "created_at" : "2023-07-31T08:11:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657883999",
      "id" : 1657883999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i0U1f",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657883999/reactions"
      },
      "updated_at" : "2023-07-31T08:11:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657883999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Re https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657883999\r\n\r\n>  I don't think any user should include the dbwrapper either? No user should be directly writing or reading from the db. \r\n\r\nIt's hard to speculate on how this will be used in the future. Something calling the db directly for e.g. data science use cases would not be unheard of.\r\n\r\n> And if you are worried about the txdb.h include, maybe do a pimpl there? IIRC https://github.com/bitcoin/bitcoin/pull/22242 did that, or something like that.\r\n\r\nI am also thinking about the `base.h` include. Though not in the kernel, it pollutes a very significant portion of source files. Implementing a pimpl in `base.h` could work, but I don't think that would really be preferable to this PR here. Getting rid of a big, unused besides a single source file include with a bunch of mostly move-only changes seems like a win to me. If this is not sufficient motivation for you though, I'd be happy to work with a reopened #22242, and separate PR for splitting the `DBOptions` and `DBParams`.\r\n\r\n",
      "created_at" : "2023-07-31T09:23:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1657995803",
      "id" : 1657995803,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i0wIb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657995803/reactions"
      },
      "updated_at" : "2023-07-31T09:23:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657995803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280179325"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280179325"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unrelated nit in 4735590b9f3bdfc248086e0e20c9d56fa6156e1c: Add missing `}; // namespace dbwrapper_private` (via clang-format) to clarify the new function is not in the namespace?",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T06:50:47Z",
      "diff_hunk" : "@@ -84,6 +81,8 @@ const std::vector<unsigned char>& GetObfuscateKey(const CDBWrapper &w);\n \n };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280179325",
      "id" : 1280179325,
      "line" : 68,
      "node_id" : "PRRC_kwDOABII585MTfx9",
      "original_commit_id" : "4735590b9f3bdfc248086e0e20c9d56fa6156e1c",
      "original_line" : 82,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 51,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280179325/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T08:07:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280179325",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280188384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280188384"
         }
      },
      "author_association" : "MEMBER",
      "body" : "74b5c3dac581b7597668a6a0cc55678d2af296da: Any reason to remove the docs from the header?",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T07:01:09Z",
      "diff_hunk" : "@@ -101,16 +103,9 @@ class CDBBatch\n     void EraseImpl(DataStream& ssKey);\n \n public:\n-    /**\n-     * @param[in] _parent   CDBWrapper that this batch is to be submitted to\n-     */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280188384",
      "id" : 1280188384,
      "line" : 104,
      "node_id" : "PRRC_kwDOABII585MTh_g",
      "original_commit_id" : "74b5c3dac581b7597668a6a0cc55678d2af296da",
      "original_line" : 106,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 75,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280188384/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T08:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280188384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280201239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280201239"
         }
      },
      "author_association" : "MEMBER",
      "body" : "029ac57bf6a987f50c31bb8c80e77989fc53d85a: nit: missing clang-format?",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T07:15:09Z",
      "diff_hunk" : "@@ -312,10 +313,7 @@ class CDBWrapper\n     // Get an estimate of LevelDB memory usage (in bytes).\n     size_t DynamicMemoryUsage() const;\n \n-    CDBIterator *NewIterator()\n-    {\n-        return new CDBIterator(*this, pdb->NewIterator(iteroptions));\n-    }\n+    CDBIterator *NewIterator();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280201239",
      "id" : 1280201239,
      "line" : 289,
      "node_id" : "PRRC_kwDOABII585MTlIX",
      "original_commit_id" : "029ac57bf6a987f50c31bb8c80e77989fc53d85a",
      "original_line" : 316,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 321,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280201239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T08:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280201239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280202266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280202266"
         }
      },
      "author_association" : "MEMBER",
      "body" : "029ac57bf6a987f50c31bb8c80e77989fc53d85a: nit: I don't think you need to specify `CDBIterator::` to `make_unique` when you are already in the `CDBIterator::` scope? \r\n\r\nAlso could use `{}` for the constructor, instead of `()`?",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T07:16:17Z",
      "diff_hunk" : "@@ -307,26 +308,39 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+struct CDBIterator::IteratorImpl {\n+    const std::unique_ptr<leveldb::Iterator> iter;\n+\n+    explicit IteratorImpl(leveldb::Iterator* _iter) : iter{_iter} {}\n+};\n+\n+CDBIterator::CDBIterator(const CDBWrapper& _parent, std::unique_ptr<IteratorImpl> _piter) : parent(_parent), m_pimpl_iter(std::move(_piter)) {}\n+\n+CDBIterator* CDBWrapper::NewIterator()\n+{\n+    return new CDBIterator(*this, std::make_unique<CDBIterator::IteratorImpl>(pdb->NewIterator(iteroptions)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280202266",
      "id" : 1280202266,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MTlYa",
      "original_commit_id" : "029ac57bf6a987f50c31bb8c80e77989fc53d85a",
      "original_line" : 321,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280202266/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T08:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280202266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280242366"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280242366"
         }
      },
      "author_association" : "MEMBER",
      "body" : "6005165242cf090589934133f01f9dbd496612f1: I think you can  remove all of those classes/inheritance/constructors by  using two lambdas?\r\n\r\n\r\n```diff\r\ndiff --git a/src/dbwrapper.cpp b/src/dbwrapper.cpp\r\nindex 94883ec669..71ec3b5f91 100644\r\n--- a/src/dbwrapper.cpp\r\n+++ b/src/dbwrapper.cpp\r\n@@ -300,11 +300,11 @@ std::vector<unsigned char> CDBWrapper::CreateObfuscateKey() const\r\n     return ret;\r\n }\r\n \r\n-bool CDBWrapper::ReadImpl(CDBWrapper::ReaderBase& reader) const\r\n+bool CDBWrapper::ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const\r\n {\r\n     DataStream ssKey{};\r\n     ssKey.reserve(DBWRAPPER_PREALLOC_KEY_SIZE);\r\n-    reader.WriteKeyToStream(ssKey);\r\n+    write_key_to_stream(ssKey);\r\n     leveldb::Slice slKey(CharCast(ssKey.data()), ssKey.size());\r\n \r\n     std::string strValue;\r\n@@ -318,7 +318,7 @@ bool CDBWrapper::ReadImpl(CDBWrapper::ReaderBase& reader) const\r\n     try {\r\n         CDataStream ssValue{MakeByteSpan(strValue), SER_DISK, CLIENT_VERSION};\r\n         ssValue.Xor(obfuscate_key);\r\n-        reader.ReadValueFromStream(ssValue);\r\n+        read_value_from_stream(ssValue);\r\n     } catch (const std::exception&) {\r\n         return false;\r\n     }\r\ndiff --git a/src/dbwrapper.h b/src/dbwrapper.h\r\nindex 2a2a23c72d..6d3524f063 100644\r\n--- a/src/dbwrapper.h\r\n+++ b/src/dbwrapper.h\r\n@@ -15,6 +15,7 @@\r\n #include <cstddef>\r\n #include <cstdint>\r\n #include <exception>\r\n+#include <functional>\r\n #include <leveldb/db.h>\r\n #include <leveldb/options.h>\r\n #include <leveldb/slice.h>\r\n@@ -232,35 +233,7 @@ private:\r\n     //! whether or not the database resides in memory\r\n     bool m_is_memory;\r\n \r\n-    class ReaderBase\r\n-    {\r\n-    public:\r\n-        virtual void ReadValueFromStream(CDataStream& ssValue) = 0;\r\n-        virtual void WriteKeyToStream(DataStream& ssKey) = 0;\r\n-    };\r\n-\r\n-    template <typename K, typename V>\r\n-    class Reader : public ReaderBase\r\n-    {\r\n-    private:\r\n-        const K& key;\r\n-        V& value;\r\n-\r\n-    public:\r\n-        Reader(const K& key, V& value) : key{key}, value{value} {}\r\n-\r\n-        void ReadValueFromStream(CDataStream& ssValue) override\r\n-        {\r\n-            ssValue >> value;\r\n-        }\r\n-\r\n-        void WriteKeyToStream(DataStream& ssKey) override\r\n-        {\r\n-            ssKey << key;\r\n-        }\r\n-    };\r\n-\r\n-    bool ReadImpl(ReaderBase& reader) const;\r\n+    bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\r\n \r\n public:\r\n     CDBWrapper(const DBParams& params);\r\n@@ -272,8 +245,9 @@ public:\r\n     template <typename K, typename V>\r\n     bool Read(const K& key, V& value) const\r\n     {\r\n-        Reader reader{key, value};\r\n-        return ReadImpl(reader);\r\n+        auto write_key_to_stream{[&key](DataStream& ssKey) { ssKey << key; }};\r\n+        auto read_value_from_stream{[&value](CDataStream& ssValue) { ssValue >> value; }};\r\n+        return ReadImpl(write_key_to_stream, read_value_from_stream);\r\n     }\r\n \r\n     template <typename K, typename V>\r\n",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T07:54:30Z",
      "diff_hunk" : "@@ -232,6 +232,36 @@ class CDBWrapper\n     //! whether or not the database resides in memory\n     bool m_is_memory;\n \n+    class ReaderBase\n+    {\n+    public:\n+        virtual void ReadValueFromStream(CDataStream& ssValue) = 0;\n+        virtual void WriteKeyToStream(DataStream& ssKey) = 0;\n+    };\n+\n+    template <typename K, typename V>\n+    class Reader : public ReaderBase\n+    {\n+    private:\n+        const K& key;\n+        V& value;\n+\n+    public:\n+        Reader(const K& key, V& value) : key{key}, value{value} {}\n+\n+        void ReadValueFromStream(CDataStream& ssValue) override\n+        {\n+            ssValue >> value;\n+        }\n+\n+        void WriteKeyToStream(DataStream& ssKey) override\n+        {\n+            ssKey << key;\n+        }\n+    };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280242366",
      "id" : 1280242366,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MTvK-",
      "original_commit_id" : "6005165242cf090589934133f01f9dbd496612f1",
      "original_line" : 261,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280242366/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T10:01:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280242366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280255522"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280255522"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 9fd6debc9f50955507d1540310ae4928b561bea0: This is assumed to never be null and heavily used. What do you think about an inline private helper:\r\n\r\n\r\n```cpp\r\nauto& DBContext() { return *Assert(m_db_context); }",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T08:06:19Z",
      "diff_hunk" : "@@ -179,30 +174,13 @@ class CDBIterator\n     }\n };\n \n+struct LevelDBContext;\n+\n class CDBWrapper\n {\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n-    //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n-\n-    //! database options used\n-    leveldb::Options options;\n-\n-    //! options used when reading from the database\n-    leveldb::ReadOptions readoptions;\n-\n-    //! options used when iterating over values of the database\n-    leveldb::ReadOptions iteroptions;\n-\n-    //! options used when writing to the database\n-    leveldb::WriteOptions writeoptions;\n-\n-    //! options used when sync writing to the database\n-    leveldb::WriteOptions syncoptions;\n-\n-    //! the database itself\n-    leveldb::DB* pdb;\n+    std::unique_ptr<LevelDBContext> m_db_context;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280255522",
      "id" : 1280255522,
      "line" : 183,
      "node_id" : "PRRC_kwDOABII585MTyYi",
      "original_commit_id" : "9fd6debc9f50955507d1540310ae4928b561bea0",
      "original_line" : 183,
      "original_position" : 47,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 221,
      "pull_request_review_id" : 1556273554,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280255522/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T08:07:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280255522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks, makes sense. I initially wondered about the 15 commits and +100 LOC, but having more commits for this template-heavy code makes it easier to review, and I found a way to reduce the number of LOC. Just a style nit though, feel free to ignore.",
      "created_at" : "2023-08-01T08:07:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1659784274",
      "id" : 1659784274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i7kxS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659784274/reactions"
      },
      "updated_at" : "2023-08-01T08:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659784274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280311080"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280311080"
         }
      },
      "author_association" : "MEMBER",
      "body" : "74b5c3dac581b7597668a6a0cc55678d2af296da: `m_impl_batch` (since we don't use `p` for pointers) or `m_impl` (the pattern used in e.g. `AddrManImpl`)?",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T08:54:08Z",
      "diff_hunk" : "@@ -90,7 +90,9 @@ class CDBBatch\n \n private:\n     const CDBWrapper &parent;\n-    leveldb::WriteBatch batch;\n+\n+    struct WriteBatchImpl;\n+    const std::unique_ptr<WriteBatchImpl> m_pimpl_batch;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280311080",
      "id" : 1280311080,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585MT_8o",
      "original_commit_id" : "74b5c3dac581b7597668a6a0cc55678d2af296da",
      "original_line" : 95,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 65,
      "pull_request_review_id" : 1556486530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280311080/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T09:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280311080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280383910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280383910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ca6f83d88cb241786676bfb341fc27f6467d39ee: this description, although not amazing, went missing",
      "commit_id" : "0280dc44d227ae34e8fcbb708833bfe9d66c7b5f",
      "created_at" : "2023-08-01T09:50:34Z",
      "diff_hunk" : "@@ -67,10 +66,6 @@ class CDBWrapper;\n  */\n namespace dbwrapper_private {\n \n-/** Handle database error by throwing dbwrapper_error exception.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280383910",
      "id" : 1280383910,
      "line" : 75,
      "node_id" : "PRRC_kwDOABII585MURum",
      "original_commit_id" : "ca6f83d88cb241786676bfb341fc27f6467d39ee",
      "original_line" : 70,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 42,
      "pull_request_review_id" : 1556486530,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280383910/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T09:57:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280383910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I'd be happy to work with a reopened #22242\r\n\r\nI guess that pull is mostly orthogonal (shouldn't (silently) conflict with this one). Rebased and reopened in https://github.com/bitcoin/bitcoin/pull/28195",
      "created_at" : "2023-08-01T10:31:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1660036495",
      "id" : 1660036495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i8iWP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660036495/reactions"
      },
      "updated_at" : "2023-08-01T10:31:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660036495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280498519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498519"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `const std::string&`?",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T11:35:59Z",
      "diff_hunk" : "@@ -27,6 +27,11 @@\n #include <memory>\n #include <optional>\n \n+bool DestroyDB(std::string& path_str)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280498519",
      "id" : 1280498519,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585MUttX",
      "original_commit_id" : "4735590b9f3bdfc248086e0e20c9d56fa6156e1c",
      "original_line" : 36,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 25,
      "pull_request_review_id" : 1556786030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498519/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T17:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280498519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280723077"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280723077"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`WriteImpl`, `ssKey` and `ssValue` are all `CDBBatch` class members, I'm not sure passing these as parameters makes sense? And if so, I think `ssKey` should be `const`.\r\n\r\nAt first sight, I'm not entirely sure why `ssKey` and `ssValue` are `CDBBatch` members when they get resized and cleared in every operation, so perhaps cleaning that up is the better way to go, but I don't like the ambiguity the current implementation introduces.\r\n\r\nAnd this comment applies pretty much identically to 5c9e87fcde410e6dc1a60f0f138ff842fdbcf328",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T14:22:10Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280723077",
      "id" : 1280723077,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII585MVkiF",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 75,
      "pull_request_review_id" : 1556786030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280723077/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T17:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280723077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the reviews @Sjors and @MarcoFalke,\r\n\r\nUpdated 0280dc44d227ae34e8fcbb708833bfe9d66c7b5f -> e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518 ([cleaveLeveldbHeaders_0](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_0) -> [cleaveLeveldbHeaders_1](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_1),  [compare](https://github.com/TheCharlatan/bitcoin/compare/cleaveLeveldbHeaders_0..cleaveLeveldbHeaders_1))\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280179325), added namespace close comment.\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280188384), returned comment to its proper place.\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280201239), applied `clang-format-diff` suggestion.\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280202266), call constructor with curly braces.\r\n* Addressed @Sjors's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280311080), dropped `p` in pimpl naming for both instances.\r\n* Addressed @Sjors's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280383910), re-added comment for handle error function.\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280255522), added `DBContext()` helper function. Also polished up the initialization of `m_db_context`.\r\n* Applied @MarcoFalke's [patch](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280242366), removed the reader class and replaced it with some simple lambdas.\r\n",
      "created_at" : "2023-08-01T15:41:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1660581208",
      "id" : 1660581208,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i-nVY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660581208/reactions"
      },
      "updated_at" : "2023-08-01T15:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660581208",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280829946"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280829946"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you, this is much simpler indeed.",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T15:41:17Z",
      "diff_hunk" : "@@ -232,6 +232,36 @@ class CDBWrapper\n     //! whether or not the database resides in memory\n     bool m_is_memory;\n \n+    class ReaderBase\n+    {\n+    public:\n+        virtual void ReadValueFromStream(CDataStream& ssValue) = 0;\n+        virtual void WriteKeyToStream(DataStream& ssKey) = 0;\n+    };\n+\n+    template <typename K, typename V>\n+    class Reader : public ReaderBase\n+    {\n+    private:\n+        const K& key;\n+        V& value;\n+\n+    public:\n+        Reader(const K& key, V& value) : key{key}, value{value} {}\n+\n+        void ReadValueFromStream(CDataStream& ssValue) override\n+        {\n+            ssValue >> value;\n+        }\n+\n+        void WriteKeyToStream(DataStream& ssKey) override\n+        {\n+            ssKey << key;\n+        }\n+    };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280829946",
      "id" : 1280829946,
      "in_reply_to_id" : 1280242366,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MV-n6",
      "original_commit_id" : "6005165242cf090589934133f01f9dbd496612f1",
      "original_line" : 261,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1557308076,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280829946/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T15:41:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280829946",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280830109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280830109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we are in the `CDBWrapper::` scope here.",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T15:41:24Z",
      "diff_hunk" : "@@ -307,26 +308,39 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+struct CDBIterator::IteratorImpl {\n+    const std::unique_ptr<leveldb::Iterator> iter;\n+\n+    explicit IteratorImpl(leveldb::Iterator* _iter) : iter{_iter} {}\n+};\n+\n+CDBIterator::CDBIterator(const CDBWrapper& _parent, std::unique_ptr<IteratorImpl> _piter) : parent(_parent), m_pimpl_iter(std::move(_piter)) {}\n+\n+CDBIterator* CDBWrapper::NewIterator()\n+{\n+    return new CDBIterator(*this, std::make_unique<CDBIterator::IteratorImpl>(pdb->NewIterator(iteroptions)));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280830109",
      "id" : 1280830109,
      "in_reply_to_id" : 1280202266,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MV-qd",
      "original_commit_id" : "029ac57bf6a987f50c31bb8c80e77989fc53d85a",
      "original_line" : 321,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 1557308316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280830109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T15:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280830109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "re-ACK e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518  ð\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518  ð\r\nH6bBOIgZy20U7oO/DsSwT8YNb6GfT92ONblBYOrZTkfGEfWVP/VaQ7KBD5xXg9+vmO9WNcCQBEkDecHYcykwDg==\r\n```\r\n\r\n</details>\r\n",
      "created_at" : "2023-08-01T15:52:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1660604025",
      "id" : 1660604025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585i-s55",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660604025/reactions"
      },
      "updated_at" : "2023-08-01T15:52:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660604025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280862595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280862595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `const DataStream& ssKey`?",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T16:08:38Z",
      "diff_hunk" : "@@ -140,6 +140,8 @@ class CDBIterator\n     const CDBWrapper &parent;\n     leveldb::Iterator *piter;\n \n+    void SeekImpl(DataStream& ssKey);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280862595",
      "id" : 1280862595,
      "line" : 134,
      "node_id" : "PRRC_kwDOABII585MWGmD",
      "original_commit_id" : "b669a40741dba987a21d72fb331d72b5f47db72e",
      "original_line" : 143,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 148,
      "pull_request_review_id" : 1556786030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280862595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T17:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280862595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280943436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280943436"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `const DataStream& ssKey`?",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T17:27:33Z",
      "diff_hunk" : "@@ -237,6 +236,7 @@ class CDBWrapper\n     bool m_is_memory;\n \n     bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\n+    bool ExistsImpl(DataStream& ssKey) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280943436",
      "id" : 1280943436,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585MWaVM",
      "original_commit_id" : "f29222d8e1a46a1d28b7eae5b4a2c15924105cec",
      "original_line" : 239,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 233,
      "pull_request_review_id" : 1556786030,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280943436/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T17:28:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280943436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280972174"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280972174"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> At first sight, I'm not entirely sure why ssKey and ssValue are CDBBatch members when they get resized and cleared in every operation\r\n\r\nHaven't checked it, but if there is more than one operation, they may save a dealloc+alloc?",
      "commit_id" : "e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518",
      "created_at" : "2023-08-01T17:57:38Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280972174",
      "id" : 1280972174,
      "in_reply_to_id" : 1280723077,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII585MWhWO",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 75,
      "pull_request_review_id" : 1557537938,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280972174/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T17:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280972174",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281161914"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281161914"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> WriteImpl, ssKey and ssValue are all CDBBatch class members, I'm not sure passing these as parameters makes sense? And if so, I think ssKey should be const.\r\n\r\nThis gave me pause too, but it felt clearer to me this way. Let me know if you think passing them arguments here is more confusing.\r\n\r\n> At first sight, I'm not entirely sure why ssKey and ssValue are CDBBatch members when they get resized and cleared in every operation, so perhaps cleaning that up is the better way to go, but I don't like the ambiguity the current implementation introduces.\r\n\r\nAFAIU they don't get resized in every operation. Clear should not be de-allocating its memory and if it is already at the correct capacity, calling `reserve` should not be doing anything.",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-01T21:14:23Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281161914",
      "id" : 1281161914,
      "in_reply_to_id" : 1280723077,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MXPq6",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1557848663,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281161914/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T21:14:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281161914",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the review @stickies-v,\r\n\r\nUpdated e8a3a0a0d761c8544e20ffc3ee3d4c1029c44518 -> 8c4481ed3713931247e4cedcb5733d3598050eb7 ([cleaveLeveldbHeaders_1](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_1) -> [cleaveLeveldbHeaders_2](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_2),  [compare](https://github.com/TheCharlatan/bitcoin/compare/cleaveLeveldbHeaders_1..cleaveLeveldbHeaders_2))\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280498519), added `const` qualifier in DestroyDB's `path_str` arg.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280862595), and [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1280943436), added `const` qualifiers to the `DataStream` arguments where applicable.\r\n",
      "created_at" : "2023-08-01T21:24:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1661120330",
      "id" : 1661120330,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585jAq9K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661120330/reactions"
      },
      "updated_at" : "2023-08-01T21:24:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1661120330",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421341"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421341"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit: `const DataStream&` seems fine here, but if you want to pass an immutable view of raw bytes, `Span<const std::byte>` may be better. (`Span{ssKey}` should do the conversion, but it will likely happen implicitly by the compiler already).\r\n\r\n",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-02T05:44:06Z",
      "diff_hunk" : "@@ -237,6 +236,7 @@ class CDBWrapper\n     bool m_is_memory;\n \n     bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\n+    bool ExistsImpl(DataStream& ssKey) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421341",
      "id" : 1281421341,
      "in_reply_to_id" : 1280943436,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MYPAd",
      "original_commit_id" : "f29222d8e1a46a1d28b7eae5b4a2c15924105cec",
      "original_line" : 239,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1558238398,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421341/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T05:44:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, `CharCast` can be moved to the cpp file in the last commit, if you want",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-02T05:44:39Z",
      "diff_hunk" : "@@ -237,6 +236,7 @@ class CDBWrapper\n     bool m_is_memory;\n \n     bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\n+    bool ExistsImpl(DataStream& ssKey) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421788",
      "id" : 1281421788,
      "in_reply_to_id" : 1280943436,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MYPHc",
      "original_commit_id" : "f29222d8e1a46a1d28b7eae5b4a2c15924105cec",
      "original_line" : 239,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1558240046,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T05:44:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281421788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1282316651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282316651"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Alright yeah I was a bit too quick with my initial suggestion, the current implementation makes sense from a (de)alloc perspective, thanks for pointing that out both.\r\n\r\n> Let me know if you think passing them arguments here is more confusing.\r\n\r\nI still don't really like it, but I agree that taking these 2 arguments is the most natural interface for `WriteImpl`. The only reason we have this weirdness is just because `Write` wants to do some allocation optimization. So I'm okay keeping it like this.\r\n\r\nAnother approach that could work is to make `ssKey` and `ssValue` static vars? It means we would allocate one additional `DataStream` in `Erase`, but I think on the `CDBWrapper` level that's no big deal?",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-02T19:13:02Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1282316651",
      "id" : 1282316651,
      "in_reply_to_id" : 1280723077,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mbplr",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1559672607,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282316651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T19:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282316651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283023840"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283023840"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, unless any objections this would have my preference, less side effects and easier to understand imo:\r\n\r\n<details>\r\n<summary>git diff on 26fe348e6e05d9b50614fdcba9cfb7a711ae86dc</summary>\r\n\r\n```diff\r\ndiff --git a/src/dbwrapper.h b/src/dbwrapper.h\r\nindex 54c4685c48..48a6c9af00 100644\r\n--- a/src/dbwrapper.h\r\n+++ b/src/dbwrapper.h\r\n@@ -92,9 +92,6 @@ private:\r\n     const CDBWrapper &parent;\r\n     leveldb::WriteBatch batch;\r\n \r\n-    DataStream ssKey{};\r\n-    CDataStream ssValue;\r\n-\r\n     size_t size_estimate{0};\r\n \r\n     void WriteImpl(const DataStream& ssKey, CDataStream& ssValue);\r\n@@ -103,7 +100,7 @@ public:\r\n     /**\r\n      * @param[in] _parent   CDBWrapper that this batch is to be submitted to\r\n      */\r\n-    explicit CDBBatch(const CDBWrapper& _parent) : parent(_parent), ssValue(SER_DISK, CLIENT_VERSION){};\r\n+    explicit CDBBatch(const CDBWrapper& _parent) : parent(_parent){};\r\n \r\n     void Clear()\r\n     {\r\n@@ -114,6 +111,9 @@ public:\r\n     template <typename K, typename V>\r\n     void Write(const K& key, const V& value)\r\n     {\r\n+        static DataStream ssKey{};\r\n+        static CDataStream ssValue{SER_DISK, CLIENT_VERSION};\r\n+\r\n         ssKey.reserve(DBWRAPPER_PREALLOC_KEY_SIZE);\r\n         ssValue.reserve(DBWRAPPER_PREALLOC_VALUE_SIZE);\r\n         ssKey << key;\r\n@@ -126,6 +126,8 @@ public:\r\n     template <typename K>\r\n     void Erase(const K& key)\r\n     {\r\n+        static DataStream ssKey{};\r\n+\r\n         ssKey.reserve(DBWRAPPER_PREALLOC_KEY_SIZE);\r\n         ssKey << key;\r\n         leveldb::Slice slKey(CharCast(ssKey.data()), ssKey.size());\r\n\r\n```\r\n</details>",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-03T10:49:58Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283023840",
      "id" : 1283023840,
      "in_reply_to_id" : 1280723077,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MeWPg",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1560822742,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283023840/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T10:49:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283023840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283055797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283055797"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not sure about making this a static var. Now the allocations survive beyond the lifetime of the `CDBBatch` objects and I am not sure if this is entirely safe.",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-03T11:20:51Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283055797",
      "id" : 1283055797,
      "in_reply_to_id" : 1280723077,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MeeC1",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1560871235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283055797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T11:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283055797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283080816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283080816"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point. Okay, let's mark as resolved.",
      "commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "created_at" : "2023-08-03T11:45:26Z",
      "diff_hunk" : "@@ -97,6 +97,8 @@ class CDBBatch\n \n     size_t size_estimate{0};\n \n+    void WriteImpl(DataStream& ssKey, CDataStream& ssValue);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283080816",
      "id" : 1283080816,
      "in_reply_to_id" : 1280723077,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MekJw",
      "original_commit_id" : "93099c4ae6067e6d3e9a8857e72f34efdffd0039",
      "original_line" : 90,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : null,
      "pull_request_review_id" : 1560909041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283080816/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T11:45:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283080816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283098892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283098892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: that's a pretty long line",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T11:57:31Z",
      "diff_hunk" : "@@ -127,24 +150,90 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n+struct CDBBatch::WriteBatchImpl {\n+    leveldb::WriteBatch batch;\n+};\n+\n+CDBBatch::CDBBatch(const CDBWrapper& _parent) : parent(_parent), m_impl_batch{std::make_unique<CDBBatch::WriteBatchImpl>()}, ssValue(SER_DISK, CLIENT_VERSION){};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283098892",
      "id" : 1283098892,
      "line" : 159,
      "node_id" : "PRRC_kwDOABII585MeokM",
      "original_commit_id" : "8c4481ed3713931247e4cedcb5733d3598050eb7",
      "original_line" : 159,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 54,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283098892/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283098892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the re-review @MarcoFalke,\r\n\r\nUpdated 8c4481ed3713931247e4cedcb5733d3598050eb7 -> f26396732b940095380d76ed77685e0fb11294b8 ([cleaveLeveldbHeaders_2](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_2) -> [cleaveLeveldbHeaders_3](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_3),  [compare](https://github.com/TheCharlatan/bitcoin/compare/cleaveLeveldbHeaders_2..cleaveLeveldbHeaders_3))\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421788), moved `CharCast` to implementation file\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1281421341), using `Span` now instead of `DataStream` types for passing immutable raw bytes.\r\n",
      "created_at" : "2023-08-03T12:59:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1663941035",
      "id" : 1663941035,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585jLbmr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1663941035/reactions"
      },
      "updated_at" : "2023-08-03T13:07:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1663941035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283223804"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283223804"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\nvoid CDBBatch::WriteImpl(Span<const std::byte> ssKey, CDataStream& ssValue)\r\n```\r\n\r\nSpan is cheap to copy, so there is no need to add `const&`. Also, it would be better to do the renames in a separate commit. (Maybe at the end for all touched lines in this pull, or not at all). Otherwise, this breaks review options such as `--color-moved=dimmed-zebra   --color-moved-ws=ignore-all-space`",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T13:40:54Z",
      "diff_hunk" : "@@ -127,24 +152,90 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n+struct CDBBatch::WriteBatchImpl {\n+    leveldb::WriteBatch batch;\n+};\n+\n+CDBBatch::CDBBatch(const CDBWrapper& _parent) : parent(_parent), m_impl_batch{std::make_unique<CDBBatch::WriteBatchImpl>()}, ssValue(SER_DISK, CLIENT_VERSION){};\n+\n+CDBBatch::~CDBBatch() = default;\n+\n+void CDBBatch::Clear()\n+{\n+    m_impl_batch->batch.Clear();\n+    size_estimate = 0;\n+}\n+\n+void CDBBatch::WriteImpl(const Span<const std::byte>& key, CDataStream& ssValue)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283223804",
      "id" : 1283223804,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MfHD8",
      "original_commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "original_line" : 169,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : null,
      "pull_request_review_id" : 1561130522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283223804/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T13:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283223804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283260447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283260447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's not immediately obvious to me why we can't stick to our usual pattern of using a `const DataStream& ssKey, CDataStream& ssValue` function signature, and instead resort to lambdas as is done here. I think the below code is much more straightforward, but perhaps I'm missing some nuance or drawbacks?\r\n\r\n<details>\r\n<summary>git diff on f26396732b940095380d76ed77685e0fb11294b8</summary>\r\n\r\n```diff\r\ndiff --git a/src/dbwrapper.cpp b/src/dbwrapper.cpp\r\nindex 1b2548f262..cb27b739fe 100644\r\n--- a/src/dbwrapper.cpp\r\n+++ b/src/dbwrapper.cpp\r\n@@ -335,11 +335,8 @@ std::vector<unsigned char> CDBWrapper::CreateObfuscateKey() const\r\n     return ret;\r\n }\r\n \r\n-bool CDBWrapper::ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const\r\n+bool CDBWrapper::ReadImpl(const DataStream& ssKey, CDataStream& ssValue) const\r\n {\r\n-    DataStream ssKey{};\r\n-    ssKey.reserve(DBWRAPPER_PREALLOC_KEY_SIZE);\r\n-    write_key_to_stream(ssKey);\r\n     leveldb::Slice slKey(CharCast(ssKey.data()), ssKey.size());\r\n \r\n     std::string strValue;\r\n@@ -351,9 +348,8 @@ bool CDBWrapper::ReadImpl(std::function<void(DataStream&)> write_key_to_stream,\r\n         HandleError(status);\r\n     }\r\n     try {\r\n-        CDataStream ssValue{MakeByteSpan(strValue), SER_DISK, CLIENT_VERSION};\r\n+        ssValue << MakeByteSpan(strValue);\r\n         ssValue.Xor(obfuscate_key);\r\n-        read_value_from_stream(ssValue);\r\n     } catch (const std::exception&) {\r\n         return false;\r\n     }\r\ndiff --git a/src/dbwrapper.h b/src/dbwrapper.h\r\nindex e48d077a80..e9536b8e7a 100644\r\n--- a/src/dbwrapper.h\r\n+++ b/src/dbwrapper.h\r\n@@ -205,7 +205,7 @@ private:\r\n     //! whether or not the database resides in memory\r\n     bool m_is_memory;\r\n \r\n-    bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\r\n+    bool ReadImpl(const DataStream& ssKey, CDataStream& ssValue) const;\r\n     bool ExistsImpl(const Span<const std::byte>& key) const;\r\n     size_t EstimateSizeImpl(const Span<const std::byte>& key1, const Span<const std::byte>& key2) const;\r\n     auto& DBContext() const { return *Assert(m_db_context); }\r\n@@ -220,9 +220,16 @@ public:\r\n     template <typename K, typename V>\r\n     bool Read(const K& key, V& value) const\r\n     {\r\n-        auto write_key_to_stream{[&key](DataStream& ssKey) { ssKey << key; }};\r\n-        auto read_value_from_stream{[&value](CDataStream& ssValue) { ssValue >> value; }};\r\n-        return ReadImpl(write_key_to_stream, read_value_from_stream);\r\n+        DataStream ssKey{};\r\n+        ssKey.reserve(DBWRAPPER_PREALLOC_KEY_SIZE);\r\n+        ssKey << key;\r\n+\r\n+        CDataStream ssValue{SER_DISK, CLIENT_VERSION};\r\n+        if(ReadImpl(ssKey, ssValue)) {\r\n+            ssValue >> value;\r\n+            return true;\r\n+        }\r\n+        return false;\r\n     }\r\n \r\n     template <typename K, typename V>\r\n\r\n```\r\n</details>",
      "commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "created_at" : "2023-08-03T14:07:04Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283260447",
      "id" : 1283260447,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585MfQAf",
      "original_commit_id" : "39c5b07ab530fdc123a41598e11eafd9060f49fe",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 1,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283260447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-08-03T14:48:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283260447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283280722"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283280722"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: pretty long line",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T14:21:50Z",
      "diff_hunk" : "@@ -127,24 +152,90 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n+struct CDBBatch::WriteBatchImpl {\n+    leveldb::WriteBatch batch;\n+};\n+\n+CDBBatch::CDBBatch(const CDBWrapper& _parent) : parent(_parent), m_impl_batch{std::make_unique<CDBBatch::WriteBatchImpl>()}, ssValue(SER_DISK, CLIENT_VERSION){};\n+\n+CDBBatch::~CDBBatch() = default;\n+\n+void CDBBatch::Clear()\n+{\n+    m_impl_batch->batch.Clear();\n+    size_estimate = 0;\n+}\n+\n+void CDBBatch::WriteImpl(const Span<const std::byte>& key, CDataStream& ssValue)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    ssValue.Xor(dbwrapper_private::GetObfuscateKey(parent));\n+    leveldb::Slice slValue(CharCast(ssValue.data()), ssValue.size());\n+    m_impl_batch->batch.Put(slKey, slValue);\n+    // LevelDB serializes writes as:\n+    // - byte: header\n+    // - varint: key length (1 byte up to 127B, 2 bytes up to 16383B, ...)\n+    // - byte[]: key\n+    // - varint: value length\n+    // - byte[]: value\n+    // The formula below assumes the key and value are both less than 16k.\n+    size_estimate += 3 + (slKey.size() > 127) + slKey.size() + (slValue.size() > 127) + slValue.size();\n+}\n+\n+void CDBBatch::EraseImpl(const Span<const std::byte>& key)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    m_impl_batch->batch.Delete(slKey);\n+    // LevelDB serializes erases as:\n+    // - byte: header\n+    // - varint: key length\n+    // - byte[]: key\n+    // The formula below assumes the key is less than 16kB.\n+    size_estimate += 2 + (slKey.size() > 127) + slKey.size();\n+}\n+\n+struct LevelDBContext {\n+    //! custom environment this database is using (may be nullptr in case of default environment)\n+    leveldb::Env* penv;\n+\n+    //! database options used\n+    leveldb::Options options;\n+\n+    //! options used when reading from the database\n+    leveldb::ReadOptions readoptions;\n+\n+    //! options used when iterating over values of the database\n+    leveldb::ReadOptions iteroptions;\n+\n+    //! options used when writing to the database\n+    leveldb::WriteOptions writeoptions;\n+\n+    //! options used when sync writing to the database\n+    leveldb::WriteOptions syncoptions;\n+\n+    //! the database itself\n+    leveldb::DB* pdb;\n+};\n+\n CDBWrapper::CDBWrapper(const DBParams& params)\n-    : m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}\n+    : m_db_context{std::make_unique<LevelDBContext>()}, m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283280722",
      "id" : 1283280722,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII585MfU9S",
      "original_commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "original_line" : 221,
      "original_position" : 117,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 117,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283280722/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283280722",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283281451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283281451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this needs to be removed?",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T14:22:21Z",
      "diff_hunk" : "@@ -127,24 +152,90 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n+struct CDBBatch::WriteBatchImpl {\n+    leveldb::WriteBatch batch;\n+};\n+\n+CDBBatch::CDBBatch(const CDBWrapper& _parent) : parent(_parent), m_impl_batch{std::make_unique<CDBBatch::WriteBatchImpl>()}, ssValue(SER_DISK, CLIENT_VERSION){};\n+\n+CDBBatch::~CDBBatch() = default;\n+\n+void CDBBatch::Clear()\n+{\n+    m_impl_batch->batch.Clear();\n+    size_estimate = 0;\n+}\n+\n+void CDBBatch::WriteImpl(const Span<const std::byte>& key, CDataStream& ssValue)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    ssValue.Xor(dbwrapper_private::GetObfuscateKey(parent));\n+    leveldb::Slice slValue(CharCast(ssValue.data()), ssValue.size());\n+    m_impl_batch->batch.Put(slKey, slValue);\n+    // LevelDB serializes writes as:\n+    // - byte: header\n+    // - varint: key length (1 byte up to 127B, 2 bytes up to 16383B, ...)\n+    // - byte[]: key\n+    // - varint: value length\n+    // - byte[]: value\n+    // The formula below assumes the key and value are both less than 16k.\n+    size_estimate += 3 + (slKey.size() > 127) + slKey.size() + (slValue.size() > 127) + slValue.size();\n+}\n+\n+void CDBBatch::EraseImpl(const Span<const std::byte>& key)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    m_impl_batch->batch.Delete(slKey);\n+    // LevelDB serializes erases as:\n+    // - byte: header\n+    // - varint: key length\n+    // - byte[]: key\n+    // The formula below assumes the key is less than 16kB.\n+    size_estimate += 2 + (slKey.size() > 127) + slKey.size();\n+}\n+\n+struct LevelDBContext {\n+    //! custom environment this database is using (may be nullptr in case of default environment)\n+    leveldb::Env* penv;\n+\n+    //! database options used\n+    leveldb::Options options;\n+\n+    //! options used when reading from the database\n+    leveldb::ReadOptions readoptions;\n+\n+    //! options used when iterating over values of the database\n+    leveldb::ReadOptions iteroptions;\n+\n+    //! options used when writing to the database\n+    leveldb::WriteOptions writeoptions;\n+\n+    //! options used when sync writing to the database\n+    leveldb::WriteOptions syncoptions;\n+\n+    //! the database itself\n+    leveldb::DB* pdb;\n+};\n+\n CDBWrapper::CDBWrapper(const DBParams& params)\n-    : m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}\n+    : m_db_context{std::make_unique<LevelDBContext>()}, m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}\n {\n-    penv = nullptr;\n-    readoptions.verify_checksums = true;\n-    iteroptions.verify_checksums = true;\n-    iteroptions.fill_cache = false;\n-    syncoptions.sync = true;\n-    options = GetOptions(params.cache_bytes);\n-    options.create_if_missing = true;\n+    m_db_context = std::make_unique<LevelDBContext>();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283281451",
      "id" : 1283281451,
      "line" : 223,
      "node_id" : "PRRC_kwDOABII585MfVIr",
      "original_commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "original_line" : 223,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 126,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283281451/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283281451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283286314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283286314"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think this needs a `LIFETIMEBOUND`.\r\n\r\nAlso: suggested alternative name `DBContextRef()` to highlight that the return value can mutate our `CDBWrapper` state? No strong view on it though, happy with the current one too, just a suggestion.",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T14:25:42Z",
      "diff_hunk" : "@@ -254,6 +205,11 @@ class CDBWrapper\n     //! whether or not the database resides in memory\n     bool m_is_memory;\n \n+    bool ReadImpl(std::function<void(DataStream&)> write_key_to_stream, std::function<void(CDataStream&)> read_value_from_stream) const;\n+    bool ExistsImpl(const Span<const std::byte>& key) const;\n+    size_t EstimateSizeImpl(const Span<const std::byte>& key1, const Span<const std::byte>& key2) const;\n+    auto& DBContext() const { return *Assert(m_db_context); }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283286314",
      "id" : 1283286314,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585MfWUq",
      "original_commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "original_line" : 211,
      "original_position" : 244,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 244,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283286314/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283286314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283298874"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283298874"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: Would this be an improvement, to highlight the reference nature of `db_context`, as well as I think generally it's slightly cleaner to not call `DBContext()` every time (I know it's a very cheap call)? Not sure though, would be a lot of change, happy to keep as is.\r\n\r\n```suggestion\r\n    auto& db_context{DBContext()};\r\n    db_context.penv = nullptr;\r\n```",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T14:33:53Z",
      "diff_hunk" : "@@ -127,24 +152,90 @@ static leveldb::Options GetOptions(size_t nCacheSize)\n     return options;\n }\n \n+struct CDBBatch::WriteBatchImpl {\n+    leveldb::WriteBatch batch;\n+};\n+\n+CDBBatch::CDBBatch(const CDBWrapper& _parent) : parent(_parent), m_impl_batch{std::make_unique<CDBBatch::WriteBatchImpl>()}, ssValue(SER_DISK, CLIENT_VERSION){};\n+\n+CDBBatch::~CDBBatch() = default;\n+\n+void CDBBatch::Clear()\n+{\n+    m_impl_batch->batch.Clear();\n+    size_estimate = 0;\n+}\n+\n+void CDBBatch::WriteImpl(const Span<const std::byte>& key, CDataStream& ssValue)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    ssValue.Xor(dbwrapper_private::GetObfuscateKey(parent));\n+    leveldb::Slice slValue(CharCast(ssValue.data()), ssValue.size());\n+    m_impl_batch->batch.Put(slKey, slValue);\n+    // LevelDB serializes writes as:\n+    // - byte: header\n+    // - varint: key length (1 byte up to 127B, 2 bytes up to 16383B, ...)\n+    // - byte[]: key\n+    // - varint: value length\n+    // - byte[]: value\n+    // The formula below assumes the key and value are both less than 16k.\n+    size_estimate += 3 + (slKey.size() > 127) + slKey.size() + (slValue.size() > 127) + slValue.size();\n+}\n+\n+void CDBBatch::EraseImpl(const Span<const std::byte>& key)\n+{\n+    leveldb::Slice slKey(CharCast(key.data()), key.size());\n+    m_impl_batch->batch.Delete(slKey);\n+    // LevelDB serializes erases as:\n+    // - byte: header\n+    // - varint: key length\n+    // - byte[]: key\n+    // The formula below assumes the key is less than 16kB.\n+    size_estimate += 2 + (slKey.size() > 127) + slKey.size();\n+}\n+\n+struct LevelDBContext {\n+    //! custom environment this database is using (may be nullptr in case of default environment)\n+    leveldb::Env* penv;\n+\n+    //! database options used\n+    leveldb::Options options;\n+\n+    //! options used when reading from the database\n+    leveldb::ReadOptions readoptions;\n+\n+    //! options used when iterating over values of the database\n+    leveldb::ReadOptions iteroptions;\n+\n+    //! options used when writing to the database\n+    leveldb::WriteOptions writeoptions;\n+\n+    //! options used when sync writing to the database\n+    leveldb::WriteOptions syncoptions;\n+\n+    //! the database itself\n+    leveldb::DB* pdb;\n+};\n+\n CDBWrapper::CDBWrapper(const DBParams& params)\n-    : m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}\n+    : m_db_context{std::make_unique<LevelDBContext>()}, m_name{fs::PathToString(params.path.stem())}, m_path{params.path}, m_is_memory{params.memory_only}\n {\n-    penv = nullptr;\n-    readoptions.verify_checksums = true;\n-    iteroptions.verify_checksums = true;\n-    iteroptions.fill_cache = false;\n-    syncoptions.sync = true;\n-    options = GetOptions(params.cache_bytes);\n-    options.create_if_missing = true;\n+    m_db_context = std::make_unique<LevelDBContext>();\n+    DBContext().penv = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283298874",
      "id" : 1283298874,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585MfZY6",
      "original_commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "original_line" : 224,
      "original_position" : 127,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 127,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283298874/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:50:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283298874",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated f26396732b940095380d76ed77685e0fb11294b8 -> 3fb2dac2ce78092c1006ee082c536bea1b69a152 ([cleaveLeveldbHeaders_3](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_3) -> [cleaveLeveldbHeaders_4](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_4),  [compare](https://github.com/TheCharlatan/bitcoin/compare/cleaveLeveldbHeaders_3..cleaveLeveldbHeaders_4))\r\n* Addressed @MarcoFalke's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283223804), changed `const Span<const std::byte>&` to `Span<const std::byte>`.\r\n* Split out renaming of some of the key variables into a separate commit at the end.",
      "created_at" : "2023-08-03T14:42:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1664121698",
      "id" : 1664121698,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585jMHti",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1664121698/reactions"
      },
      "updated_at" : "2023-08-03T14:42:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1664121698",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283315877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283315877"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would it make sense to move this to the `LevelDBContext` destructor?",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-03T14:46:00Z",
      "diff_hunk" : "@@ -185,16 +276,16 @@ CDBWrapper::CDBWrapper(const DBParams& params)\n \n CDBWrapper::~CDBWrapper()\n {\n-    delete pdb;\n-    pdb = nullptr;\n-    delete options.filter_policy;\n-    options.filter_policy = nullptr;\n-    delete options.info_log;\n-    options.info_log = nullptr;\n-    delete options.block_cache;\n-    options.block_cache = nullptr;\n-    delete penv;\n-    options.env = nullptr;\n+    delete DBContext().pdb;\n+    DBContext().pdb = nullptr;\n+    delete DBContext().options.filter_policy;\n+    DBContext().options.filter_policy = nullptr;\n+    delete DBContext().options.info_log;\n+    DBContext().options.info_log = nullptr;\n+    delete DBContext().options.block_cache;\n+    DBContext().options.block_cache = nullptr;\n+    delete DBContext().penv;\n+    DBContext().options.env = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283315877",
      "id" : 1283315877,
      "line" : 288,
      "node_id" : "PRRC_kwDOABII585Mfdil",
      "original_commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "original_line" : 288,
      "original_position" : 189,
      "original_start_line" : 279,
      "path" : "src/dbwrapper.cpp",
      "position" : 189,
      "pull_request_review_id" : 1560934462,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283315877/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 279,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-03T14:48:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283315877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283434519"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283434519"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I originally did this to keep the stream reading within the try catch block, while changing as few lines in the implementation as possible. We could just return the string value though in the `ReadImpl` and then complete the data reading in the `Read` function.",
      "commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "created_at" : "2023-08-03T16:18:06Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283434519",
      "id" : 1283434519,
      "in_reply_to_id" : 1283260447,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585Mf6gX",
      "original_commit_id" : "39c5b07ab530fdc123a41598e11eafd9060f49fe",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 1,
      "pull_request_review_id" : 1561449777,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283434519/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-08-03T16:18:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283434519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283455714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283455714"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I generally like your approach of keeping it as clean a move as possible, and in the other commits am okay with foregoing some slight improvements because of that. Here, though, I feel like we're making both the interface and implementation way too complex because of it, so personally I'd much rather make some more changes.",
      "commit_id" : "f26396732b940095380d76ed77685e0fb11294b8",
      "created_at" : "2023-08-03T16:36:54Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283455714",
      "id" : 1283455714,
      "in_reply_to_id" : 1283260447,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585Mf_ri",
      "original_commit_id" : "39c5b07ab530fdc123a41598e11eafd9060f49fe",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/dbwrapper.cpp",
      "position" : 1,
      "pull_request_review_id" : 1561479929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283455714/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-08-03T16:36:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283455714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1284419848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284419848"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: missing docstring",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-04T13:23:40Z",
      "diff_hunk" : "@@ -209,30 +177,13 @@ class CDBIterator\n     }\n };\n \n+struct LevelDBContext;\n+\n class CDBWrapper\n {\n     friend const std::vector<unsigned char>& dbwrapper_private::GetObfuscateKey(const CDBWrapper &w);\n private:\n-    //! custom environment this database is using (may be nullptr in case of default environment)\n-    leveldb::Env* penv;\n-\n-    //! database options used\n-    leveldb::Options options;\n-\n-    //! options used when reading from the database\n-    leveldb::ReadOptions readoptions;\n-\n-    //! options used when iterating over values of the database\n-    leveldb::ReadOptions iteroptions;\n-\n-    //! options used when writing to the database\n-    leveldb::WriteOptions writeoptions;\n-\n-    //! options used when sync writing to the database\n-    leveldb::WriteOptions syncoptions;\n-\n-    //! the database itself\n-    leveldb::DB* pdb;\n+    std::unique_ptr<LevelDBContext> m_db_context;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1284419848",
      "id" : 1284419848,
      "line" : 186,
      "node_id" : "PRRC_kwDOABII585MjrEI",
      "original_commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "original_line" : 186,
      "original_position" : 233,
      "original_start_line" : null,
      "path" : "src/dbwrapper.h",
      "position" : 233,
      "pull_request_review_id" : 1562868143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284419848/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T13:54:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284419848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1284999471"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284999471"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It would, but then we'd also have to forward-declare a destructor class for it and I don't think it's really worth doing that.",
      "commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "created_at" : "2023-08-05T08:19:48Z",
      "diff_hunk" : "@@ -185,16 +276,16 @@ CDBWrapper::CDBWrapper(const DBParams& params)\n \n CDBWrapper::~CDBWrapper()\n {\n-    delete pdb;\n-    pdb = nullptr;\n-    delete options.filter_policy;\n-    options.filter_policy = nullptr;\n-    delete options.info_log;\n-    options.info_log = nullptr;\n-    delete options.block_cache;\n-    options.block_cache = nullptr;\n-    delete penv;\n-    options.env = nullptr;\n+    delete DBContext().pdb;\n+    DBContext().pdb = nullptr;\n+    delete DBContext().options.filter_policy;\n+    DBContext().options.filter_policy = nullptr;\n+    delete DBContext().options.info_log;\n+    DBContext().options.info_log = nullptr;\n+    delete DBContext().options.block_cache;\n+    DBContext().options.block_cache = nullptr;\n+    delete DBContext().penv;\n+    DBContext().options.env = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1284999471",
      "id" : 1284999471,
      "in_reply_to_id" : 1283315877,
      "line" : 288,
      "node_id" : "PRRC_kwDOABII585Ml4kv",
      "original_commit_id" : "3fb2dac2ce78092c1006ee082c536bea1b69a152",
      "original_line" : 288,
      "original_position" : 189,
      "original_start_line" : 279,
      "path" : "src/dbwrapper.cpp",
      "position" : 189,
      "pull_request_review_id" : 1563822941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28186",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284999471/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 279,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-05T08:19:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284999471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the review @stickies-v,\r\n\r\nUpdated 3fb2dac2ce78092c1006ee082c536bea1b69a152 -> 1be04724a3ac061859118c09b90e2e15ea8d04b0 ([cleaveLeveldbHeaders_4](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_4) -> [cleaveLeveldbHeaders_5](https://github.com/TheCharlatan/bitcoin/tree/cleaveLeveldbHeaders_5),  [compare](https://github.com/TheCharlatan/bitcoin/compare/cleaveLeveldbHeaders_4..cleaveLeveldbHeaders_5))\r\n\r\n* Addressed @stickies-v's [comment_1](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283098892) and [comment_2](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283280722), added some line breaks in constructor lists.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283260447), further split up the `CDBWrapper::Read` implementation. The `ReadImpl` now returns an option of the read database value string.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283281451), removed left over `m_db_context` initializer.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1283286314), added `LIFETIMEBOUND` to `DBContext` reference getter.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/28186#discussion_r1284419848), added docstring to `m_db_contex` `CDBWrapper` member variable.",
      "created_at" : "2023-08-05T10:02:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28186#issuecomment-1666459887",
      "id" : 1666459887,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28186",
      "node_id" : "IC_kwDOABII585jVCjv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1666459887/reactions"
      },
      "updated_at" : "2023-08-05T10:02:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1666459887",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   }
]
