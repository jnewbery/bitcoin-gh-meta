[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27991](https://github.com/bitcoin/bitcoin/pull/27991) (build: pass sanitize flags to instrument libsecp256k1 code by fanquake)\n* [#27351](https://github.com/bitcoin/bitcoin/pull/27351) (wallet: add `seeds` argument to `importdescriptors` by apoelstra)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-07-21T18:36:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1646097920",
      "id" : 1646097920,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28122",
      "node_id" : "IC_kwDOABII585iHXYA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1646097920/reactions"
      },
      "updated_at" : "2023-07-22T05:41:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1646097920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1271314036"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271314036"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Didn't verify my theory in practice yet, but according to my calculations having a HRP of size 4 would exceed the current 117 character limit (see https://github.com/bitcoin/bips/pull/1458/files#r1271312933). I assume the regtest-HRP should just also be set to \"tsp\" here (as it's currently stated in the BIP)? Otherweise the limit has to be raised by one.\r\n\r\nFun fact: in #27827 the \"sprt\" HRP works, but this is because the pubkeys are encoded as x-only (see commit https://github.com/bitcoin/bitcoin/pull/27827/commits/3a0d081ee07f3c65220a45855c96bf35ac2643fd), i.e. the payload of the address is only 64 bytes instead of 66 bytes and hence the limit is not exceeded.",
      "commit_id" : "13529c968e3fd84d6702eb5ffb9a6cc9b7264376",
      "created_at" : "2023-07-22T16:10:19Z",
      "diff_hunk" : "@@ -508,6 +511,7 @@ class CRegTestParams : public CChainParams\n         base58Prefixes[EXT_SECRET_KEY] = {0x04, 0x35, 0x83, 0x94};\n \n         bech32_hrp = \"bcrt\";\n+        silent_payment_hrp = \"sprt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1271314036",
      "id" : 1271314036,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585LxrZ0",
      "original_commit_id" : "6d11e3c435397dab960bc2b5e6cb5a2a1166b39b",
      "original_line" : 514,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/chainparams.cpp",
      "position" : 28,
      "pull_request_review_id" : 1542113471,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271314036/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-22T16:10:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271314036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1271484187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271484187"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "c75d9de0683a91151eb4a508cb64a8937ca92 `s/PAYMENT_H/PAYMENTS_H/` in `ifndef/define/endif` or rename the files to `silentpayment.{h,cpp}`\r\n\r\n```bash\r\n$ test/lint/lint-include-guards.py \r\nsrc/wallet/silentpayments.h seems to be missing the expected include guard:\r\n  #ifndef BITCOIN_WALLET_SILENTPAYMENTS_H\r\n  #define BITCOIN_WALLET_SILENTPAYMENTS_H\r\n  ...\r\n  #endif // BITCOIN_WALLET_SILENTPAYMENTS_H\r\n```\r\n",
      "commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "created_at" : "2023-07-23T17:27:50Z",
      "diff_hunk" : "@@ -0,0 +1,56 @@\n+#ifndef BITCOIN_WALLET_SILENTPAYMENT_H\n+#define BITCOIN_WALLET_SILENTPAYMENT_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1271484187",
      "id" : 1271484187,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LyU8b",
      "original_commit_id" : "1d75df2aaeb34bb3058294dd02559bd35e27ae37",
      "original_line" : 2,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.h",
      "position" : null,
      "pull_request_review_id" : 1542293714,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271484187/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-23T17:27:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1271484187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1274629530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274629530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed, thanks!",
      "commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "created_at" : "2023-07-26T09:11:40Z",
      "diff_hunk" : "@@ -0,0 +1,56 @@\n+#ifndef BITCOIN_WALLET_SILENTPAYMENT_H\n+#define BITCOIN_WALLET_SILENTPAYMENT_H",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1274629530",
      "id" : 1274629530,
      "in_reply_to_id" : 1271484187,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585L-U2a",
      "original_commit_id" : "1d75df2aaeb34bb3058294dd02559bd35e27ae37",
      "original_line" : 2,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.h",
      "position" : null,
      "pull_request_review_id" : 1547207752,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274629530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-26T09:11:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274629530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1275442463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442463"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 56882622faf469b6f948f79a69c3c8ddbde92ff8 \"crypto: update CKey, CPubkey for silent payments\"\r\n\r\nWe shouldn't be copying secret data out of a secure structure into an insecure one. When `tweaked_seckey` is destroyed, the underlying data may still linger in memory and end up being read by something else.\r\n\r\nIf this function must return a new `CKey`, then it should instantiate it here and perform the operation on it's `data()` rather than doing this copy.\r\n\r\nHowever, I would prefer if this function mirrored the libsecp one where the tweaking occurs on and modified this `CKey` itself.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-26T20:16:57Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1275442463",
      "id" : 1275442463,
      "line" : 182,
      "node_id" : "PRRC_kwDOABII585MBbUf",
      "original_commit_id" : "56882622faf469b6f948f79a69c3c8ddbde92ff8",
      "original_line" : 182,
      "original_position" : 25,
      "original_start_line" : 181,
      "path" : "src/key.cpp",
      "position" : 25,
      "pull_request_review_id" : 1548528898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 181,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-26T20:21:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1275442608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 56882622faf469b6f948f79a69c3c8ddbde92ff8 \"crypto: update CKey, CPubkey for silent payments\"\r\n\r\nSame data copying concerns as `AddTweak`.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-26T20:17:10Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_add(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+CKey CKey::MultiplyTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1275442608",
      "id" : 1275442608,
      "line" : 198,
      "node_id" : "PRRC_kwDOABII585MBbWw",
      "original_commit_id" : "56882622faf469b6f948f79a69c3c8ddbde92ff8",
      "original_line" : 198,
      "original_position" : 41,
      "original_start_line" : 197,
      "path" : "src/key.cpp",
      "position" : 41,
      "pull_request_review_id" : 1548528898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442608/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 197,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-26T20:21:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275442608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276883646"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276883646"
         }
      },
      "author_association" : "MEMBER",
      "body" : "56882622faf469b6f948f79a69c3c8ddbde92ff8\r\n```suggestion\r\n    static CPubKey Combine(const std::vector<CPubKey> &pubkeys);\r\n```",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:33:46Z",
      "diff_hunk" : "@@ -211,6 +211,12 @@ class CPubKey\n      */\n     static bool CheckLowS(const std::vector<unsigned char>& vchSig);\n \n+    //! Add a number of public keys together.\n+    static CPubKey Combine(std::vector<CPubKey> pubkeys);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276883646",
      "id" : 1276883646,
      "line" : 215,
      "node_id" : "PRRC_kwDOABII585MG7K-",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 215,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/pubkey.h",
      "position" : 5,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276883646/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276883646",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276885882"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276885882"
         }
      },
      "author_association" : "MEMBER",
      "body" : "65b2dec1e39ea4efb327457563d2b18d49b4bc4c: Use an initializer list for data members",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:36:35Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276885882",
      "id" : 1276885882,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585MG7t6",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 18,
      "original_position" : 18,
      "original_start_line" : 12,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 18,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276885882/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 12,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276885882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276888369"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888369"
         }
      },
      "author_association" : "MEMBER",
      "body" : "65b2dec1e39ea4efb327457563d2b18d49b4bc4c: Could use structured binding",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:39:30Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)\n+{\n+    // Because a sender can create multiple outputs for us, we first check the outputs vector for an output with\n+    // output index 0. If we find it, we remove it from the vector and then iterate over the vector again looking for\n+    // an output with index 1, and so on until one of the following happens:\n+    //\n+    //     1. We have determined all outputs belong to us (the vector is empty)\n+    //     2. We have passed over the vector and found no outputs belonging to us\n+    //\n+\n+    // The ECDH shared secret must be set before we start scanning\n+    assert(m_ecdh_pubkey.IsValid());\n+\n+    bool removed;\n+    uint32_t output_index{0};\n+    std::vector<CKey> raw_tr_keys;\n+    do {\n+        // We haven't removed anything yet on this pass and if we don't remove anything, we didn't find\n+        // any silent payment outputs and should stop checking\n+        removed = false;\n+        std::pair<CKey, CPubKey> tweakResult = CreateOutput(output_index);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276888369",
      "id" : 1276888369,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII585MG8Ux",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 70,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 70,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888369/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888369",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276888579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888579"
         }
      },
      "author_association" : "MEMBER",
      "body" : "65b2dec1e39ea4efb327457563d2b18d49b4bc4c: Could use an initializer list",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:39:49Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)\n+{\n+    // Because a sender can create multiple outputs for us, we first check the outputs vector for an output with\n+    // output index 0. If we find it, we remove it from the vector and then iterate over the vector again looking for\n+    // an output with index 1, and so on until one of the following happens:\n+    //\n+    //     1. We have determined all outputs belong to us (the vector is empty)\n+    //     2. We have passed over the vector and found no outputs belonging to us\n+    //\n+\n+    // The ECDH shared secret must be set before we start scanning\n+    assert(m_ecdh_pubkey.IsValid());\n+\n+    bool removed;\n+    uint32_t output_index{0};\n+    std::vector<CKey> raw_tr_keys;\n+    do {\n+        // We haven't removed anything yet on this pass and if we don't remove anything, we didn't find\n+        // any silent payment outputs and should stop checking\n+        removed = false;\n+        std::pair<CKey, CPubKey> tweakResult = CreateOutput(output_index);\n+        const CKey& silent_payment_priv_key = tweakResult.first;\n+        const XOnlyPubKey& silent_payment_pub_key = XOnlyPubKey{tweakResult.second};\n+        output_pub_keys.erase(std::remove_if(output_pub_keys.begin(), output_pub_keys.end(), [&](auto outputPubKey) {\n+            if (silent_payment_pub_key == outputPubKey) {\n+                // Since we found an output, we need to increment the output index and check the vector again\n+                raw_tr_keys.emplace_back(silent_payment_priv_key);\n+                removed = true;\n+                output_index++;\n+                // Return true so that this output pubkey is removed the from vector and not checked again\n+                return true;\n+            }\n+            return false;\n+        }), output_pub_keys.end());\n+    } while (!output_pub_keys.empty() && removed);\n+    return raw_tr_keys;\n+}\n+\n+Sender::Sender(const CKey& scalar_ecdh_input, const SilentPaymentRecipient& recipient)\n+{\n+    m_ecdh_pubkey = scalar_ecdh_input.SilentPaymentECDH(recipient.m_scan_pubkey);\n+    m_recipient = recipient;\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276888579",
      "id" : 1276888579,
      "line" : 92,
      "node_id" : "PRRC_kwDOABII585MG8YD",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 92,
      "original_position" : 92,
      "original_start_line" : 88,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 92,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 88,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276888579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276890488"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276890488"
         }
      },
      "author_association" : "MEMBER",
      "body" : "65b2dec1e39ea4efb327457563d2b18d49b4bc4c: Could use structured binding\r\n```suggestion\r\n    for (const auto& [pubkey, amount]: m_recipient.m_outputs) {\r\n```",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:42:12Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)\n+{\n+    // Because a sender can create multiple outputs for us, we first check the outputs vector for an output with\n+    // output index 0. If we find it, we remove it from the vector and then iterate over the vector again looking for\n+    // an output with index 1, and so on until one of the following happens:\n+    //\n+    //     1. We have determined all outputs belong to us (the vector is empty)\n+    //     2. We have passed over the vector and found no outputs belonging to us\n+    //\n+\n+    // The ECDH shared secret must be set before we start scanning\n+    assert(m_ecdh_pubkey.IsValid());\n+\n+    bool removed;\n+    uint32_t output_index{0};\n+    std::vector<CKey> raw_tr_keys;\n+    do {\n+        // We haven't removed anything yet on this pass and if we don't remove anything, we didn't find\n+        // any silent payment outputs and should stop checking\n+        removed = false;\n+        std::pair<CKey, CPubKey> tweakResult = CreateOutput(output_index);\n+        const CKey& silent_payment_priv_key = tweakResult.first;\n+        const XOnlyPubKey& silent_payment_pub_key = XOnlyPubKey{tweakResult.second};\n+        output_pub_keys.erase(std::remove_if(output_pub_keys.begin(), output_pub_keys.end(), [&](auto outputPubKey) {\n+            if (silent_payment_pub_key == outputPubKey) {\n+                // Since we found an output, we need to increment the output index and check the vector again\n+                raw_tr_keys.emplace_back(silent_payment_priv_key);\n+                removed = true;\n+                output_index++;\n+                // Return true so that this output pubkey is removed the from vector and not checked again\n+                return true;\n+            }\n+            return false;\n+        }), output_pub_keys.end());\n+    } while (!output_pub_keys.empty() && removed);\n+    return raw_tr_keys;\n+}\n+\n+Sender::Sender(const CKey& scalar_ecdh_input, const SilentPaymentRecipient& recipient)\n+{\n+    m_ecdh_pubkey = scalar_ecdh_input.SilentPaymentECDH(recipient.m_scan_pubkey);\n+    m_recipient = recipient;\n+}\n+\n+CPubKey Sender::CreateOutput(const CPubKey& spend_pubkey, const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+    return spend_pubkey.AddTweak(shared_secret.begin());\n+}\n+\n+std::vector<wallet::CRecipient> Sender::GenerateRecipientScriptPubKeys() const\n+{\n+    int n = 0;\n+    std::vector<wallet::CRecipient> spks;\n+    for (const auto& pair : m_recipient.m_outputs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276890488",
      "id" : 1276890488,
      "line" : 109,
      "node_id" : "PRRC_kwDOABII585MG814",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 109,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 109,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276890488/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276890488",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276891288"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276891288"
         }
      },
      "author_association" : "MEMBER",
      "body" : "65b2dec1e39ea4efb327457563d2b18d49b4bc4c: Could use structured binding",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-07-27T22:43:13Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)\n+{\n+    // Because a sender can create multiple outputs for us, we first check the outputs vector for an output with\n+    // output index 0. If we find it, we remove it from the vector and then iterate over the vector again looking for\n+    // an output with index 1, and so on until one of the following happens:\n+    //\n+    //     1. We have determined all outputs belong to us (the vector is empty)\n+    //     2. We have passed over the vector and found no outputs belonging to us\n+    //\n+\n+    // The ECDH shared secret must be set before we start scanning\n+    assert(m_ecdh_pubkey.IsValid());\n+\n+    bool removed;\n+    uint32_t output_index{0};\n+    std::vector<CKey> raw_tr_keys;\n+    do {\n+        // We haven't removed anything yet on this pass and if we don't remove anything, we didn't find\n+        // any silent payment outputs and should stop checking\n+        removed = false;\n+        std::pair<CKey, CPubKey> tweakResult = CreateOutput(output_index);\n+        const CKey& silent_payment_priv_key = tweakResult.first;\n+        const XOnlyPubKey& silent_payment_pub_key = XOnlyPubKey{tweakResult.second};\n+        output_pub_keys.erase(std::remove_if(output_pub_keys.begin(), output_pub_keys.end(), [&](auto outputPubKey) {\n+            if (silent_payment_pub_key == outputPubKey) {\n+                // Since we found an output, we need to increment the output index and check the vector again\n+                raw_tr_keys.emplace_back(silent_payment_priv_key);\n+                removed = true;\n+                output_index++;\n+                // Return true so that this output pubkey is removed the from vector and not checked again\n+                return true;\n+            }\n+            return false;\n+        }), output_pub_keys.end());\n+    } while (!output_pub_keys.empty() && removed);\n+    return raw_tr_keys;\n+}\n+\n+Sender::Sender(const CKey& scalar_ecdh_input, const SilentPaymentRecipient& recipient)\n+{\n+    m_ecdh_pubkey = scalar_ecdh_input.SilentPaymentECDH(recipient.m_scan_pubkey);\n+    m_recipient = recipient;\n+}\n+\n+CPubKey Sender::CreateOutput(const CPubKey& spend_pubkey, const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+    return spend_pubkey.AddTweak(shared_secret.begin());\n+}\n+\n+std::vector<wallet::CRecipient> Sender::GenerateRecipientScriptPubKeys() const\n+{\n+    int n = 0;\n+    std::vector<wallet::CRecipient> spks;\n+    for (const auto& pair : m_recipient.m_outputs) {\n+        XOnlyPubKey output_pubkey = XOnlyPubKey{CreateOutput(pair.first, n)};\n+        auto tap = WitnessV1Taproot(output_pubkey);\n+        CScript spk = GetScriptForDestination(tap);\n+        spks.push_back(wallet::CRecipient{spk, pair.second, false});\n+        n++;\n+    }\n+    return spks;\n+}\n+\n+CKey SumInputPrivKeys(const std::vector<std::pair<CKey, bool>>& sender_secret_keys)\n+{\n+    const auto& [seckey, is_taproot] = sender_secret_keys.at(0);\n+    CKey sum_seckey{seckey};\n+    if (is_taproot && sum_seckey.GetPubKey()[0] == 3) {\n+        sum_seckey.Negate();\n+    }\n+    if (sender_secret_keys.size() > 1) {\n+        for (size_t i = 1; i < sender_secret_keys.size(); i++) {\n+            const auto& [sender_seckey, sender_is_taproot] = sender_secret_keys.at(i);\n+            auto temp_key{sender_seckey};\n+            if (sender_is_taproot && sender_seckey.GetPubKey()[0] == 3) {\n+                temp_key.Negate();\n+            }\n+            sum_seckey = sum_seckey.AddTweak(temp_key.begin());\n+        }\n+    }\n+    return sum_seckey;\n+}\n+\n+CKey PrepareScalarECDHInput(const std::vector<std::pair<CKey, bool>>& sender_secret_keys, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    CKey sum_input_secret_keys = SumInputPrivKeys(sender_secret_keys);\n+    uint256 outpoints_hash = HashOutpoints(tx_outpoints);\n+    return sum_input_secret_keys.MultiplyTweak(outpoints_hash.begin());\n+}\n+\n+std::vector<SilentPaymentRecipient> GroupSilentPaymentAddresses(const std::vector<wallet::V0SilentPaymentDestination>& silent_payment_destinations)\n+{\n+    std::map<CPubKey, std::vector<std::pair<CPubKey, CAmount>>> recipient_groups;\n+    std::vector<SilentPaymentRecipient> recipients;\n+    for (const auto& destination : silent_payment_destinations) {\n+        recipient_groups[destination.m_scan_pubkey].emplace_back(destination.m_spend_pubkey, destination.m_amount);\n+    }\n+    for (const auto& pair : recipient_groups) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1276891288",
      "id" : 1276891288,
      "line" : 153,
      "node_id" : "PRRC_kwDOABII585MG9CY",
      "original_commit_id" : "dc18efa78d014be0a09e4c986813086e56c251a3",
      "original_line" : 153,
      "original_position" : 153,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 153,
      "pull_request_review_id" : 1550940798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276891288/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-28T08:55:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276891288",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase, if still relevant",
      "created_at" : "2023-08-01T14:54:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1660492118",
      "id" : 1660492118,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28122",
      "node_id" : "IC_kwDOABII585i-RlW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660492118/reactions"
      },
      "updated_at" : "2023-08-01T14:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660492118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Needs rebase, if still relevant\r\n\r\nthanks, fixed!",
      "created_at" : "2023-08-01T15:48:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1660598041",
      "id" : 1660598041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28122",
      "node_id" : "IC_kwDOABII585i-rcZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660598041/reactions"
      },
      "updated_at" : "2023-08-01T15:48:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660598041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282093736"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282093736"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can someone remind me wtf regtest has a different hrp than testnet and signet?\r\n\r\nIf each of the four had a different one, Iâd get it, but why does regtest have a different one than the other two testing networks?\r\n\r\nUnless Iâm forgetting about some good reason for that to be there, I might recommend that you just use `tsp` for all three",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-02T15:43:51Z",
      "diff_hunk" : "@@ -508,6 +511,7 @@ class CRegTestParams : public CChainParams\n         base58Prefixes[EXT_SECRET_KEY] = {0x04, 0x35, 0x83, 0x94};\n \n         bech32_hrp = \"bcrt\";\n+        silent_payment_hrp = \"sprt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282093736",
      "id" : 1282093736,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585MazKo",
      "original_commit_id" : "13e6c7b5444af103bb612cd503c50915d8d41015",
      "original_line" : 514,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/chainparams.cpp",
      "position" : 28,
      "pull_request_review_id" : 1559306552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282093736/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T16:46:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282093736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4060799?v=4",
         "events_url" : "https://api.github.com/users/murchandamus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/murchandamus/followers",
         "following_url" : "https://api.github.com/users/murchandamus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/murchandamus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/murchandamus",
         "id" : 4060799,
         "login" : "murchandamus",
         "node_id" : "MDQ6VXNlcjQwNjA3OTk=",
         "organizations_url" : "https://api.github.com/users/murchandamus/orgs",
         "received_events_url" : "https://api.github.com/users/murchandamus/received_events",
         "repos_url" : "https://api.github.com/users/murchandamus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/murchandamus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/murchandamus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/murchandamus"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282854035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282854035"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This issue has some helpful context: https://github.com/bitcoin/bitcoin/issues/12314#issuecomment-582600899\r\n\r\nTLDR; at the time regtest was created, it was assumed that using a separate HRP wouldn't cost anything.\r\n\r\n> If each of the four had a different one, Iâd get it, but why does regtest have a different one than the other two testing networks?\r\n\r\nThis actually makes sense to me. Testnet and Signet are \"global\" networks, so everyone has to agree on the address format. Regtest is always used in a private context, and is specific to Bitcoin Core. Having a separate HRP helps differentiate the local vs networked usage IMO.\r\n\r\n> Unless Iâm forgetting about some good reason for that to be there, I might recommend that you just use tsp for all three\r\n\r\nIf we decided to make the HRP for regtest throughout Bitcoin Core to be the same as signet and testnet, then I'm fine with this. What I don't want is for silent payment addresses to be a special case in the functional test framework.\r\n\r\n",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-03T08:41:30Z",
      "diff_hunk" : "@@ -508,6 +511,7 @@ class CRegTestParams : public CChainParams\n         base58Prefixes[EXT_SECRET_KEY] = {0x04, 0x35, 0x83, 0x94};\n \n         bech32_hrp = \"bcrt\";\n+        silent_payment_hrp = \"sprt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282854035",
      "id" : 1282854035,
      "in_reply_to_id" : 1282093736,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585MdsyT",
      "original_commit_id" : "13e6c7b5444af103bb612cd503c50915d8d41015",
      "original_line" : 514,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/chainparams.cpp",
      "position" : 28,
      "pull_request_review_id" : 1560541351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282854035/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T08:41:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282854035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282961735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282961735"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I've updated the BIP to recommend upping the character limit to 1023, as having a limit of 117 would cause issues with forward compatibility with future silent payment addresses. I've also removed regtest from the BIP, as I don't think it's correct to define Bitcoin Core specific conventions in BIPs. Regarding \"tsp\" vs \"sprt\", I don't really have a strong opinion here, but would prefer to follow the convention in Bitcoin Core. If we end up moving Bitcoin Core to use the same HRP for all networks, then we should update the silent payments HRP to do the same.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-03T09:56:06Z",
      "diff_hunk" : "@@ -508,6 +511,7 @@ class CRegTestParams : public CChainParams\n         base58Prefixes[EXT_SECRET_KEY] = {0x04, 0x35, 0x83, 0x94};\n \n         bech32_hrp = \"bcrt\";\n+        silent_payment_hrp = \"sprt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1282961735",
      "id" : 1282961735,
      "in_reply_to_id" : 1271314036,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585MeHFH",
      "original_commit_id" : "6d11e3c435397dab960bc2b5e6cb5a2a1166b39b",
      "original_line" : 514,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/chainparams.cpp",
      "position" : 28,
      "pull_request_review_id" : 1560714797,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282961735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T09:56:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282961735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1283012394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283012394"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Note to self, this should be 1023",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-03T10:38:54Z",
      "diff_hunk" : "@@ -370,11 +370,13 @@ std::string Encode(Encoding encoding, const std::string& hrp, const data& values\n }\n \n /** Decode a Bech32 or Bech32m string. */\n-DecodeResult Decode(const std::string& str) {\n+DecodeResult Decode(const std::string& str, bool silent) {\n+    std::size_t max_size = silent ? 1024 : 90;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1283012394",
      "id" : 1283012394,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585MeTcq",
      "original_commit_id" : "a469cb1e551ba16f1d83e4b0ae68194e38f1b9ec",
      "original_line" : 374,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bech32.cpp",
      "position" : 6,
      "pull_request_review_id" : 1560805532,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283012394/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T10:38:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283012394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1284001548"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001548"
         }
      },
      "author_association" : "NONE",
      "body" : "To improve maintainability and support forward compatibility, consider abstracting the handling of different versions into a separate helper function like â[evalCheckSig](https://github.com/bitcoin/bitcoin/blob/a4ca4975880c4f870c6047065c70610af2529e74/src/script/interpreter.cpp#L391)â does. This approach will allow for easier modification and extension for new versions of Silent addresses, and would also be more clear how version handling is done\r\n",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-04T05:41:02Z",
      "diff_hunk" : "@@ -309,3 +311,51 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());\n+    CPubKey spend_pubkey{spend_pubkey_data};\n+\n+    return {scan_pubkey, spend_pubkey};\n+}\n+\n+std::vector<unsigned char> DecodeSilentAddress(const std::string& str)\n+{\n+    const auto& params{Params()};\n+    const auto& silent_payment_hrp = params.SilentPaymentHRP();\n+    const auto dec = bech32::Decode(str, /*silent=*/true);\n+    if (dec.encoding != bech32::Encoding::BECH32M || dec.hrp != silent_payment_hrp) {\n+        return {};\n+    }\n+    auto version = dec.data.front();  // retrieve the version\n+    std::vector<unsigned char> silent_payment_data;\n+    silent_payment_data.reserve(((dec.data.size() - 1) * 5) / 8);\n+    if (!ConvertBits<5, 8, false>([&](unsigned char c) { silent_payment_data.push_back(c); }, dec.data.begin() + 1, dec.data.end())) {\n+        return {};\n+    }\n+    if ((version == 0 && silent_payment_data.size() != SILENT_PAYMENT_V0_DATA_SIZE) || silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1284001548",
      "id" : 1284001548,
      "line" : 341,
      "node_id" : "PRRC_kwDOABII585MiE8M",
      "original_commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "original_line" : 341,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 40,
      "pull_request_review_id" : 1562204323,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001548/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T05:47:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001548",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/15610188?v=4",
         "events_url" : "https://api.github.com/users/BrandonOdiwuor/events{/privacy}",
         "followers_url" : "https://api.github.com/users/BrandonOdiwuor/followers",
         "following_url" : "https://api.github.com/users/BrandonOdiwuor/following{/other_user}",
         "gists_url" : "https://api.github.com/users/BrandonOdiwuor/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/BrandonOdiwuor",
         "id" : 15610188,
         "login" : "BrandonOdiwuor",
         "node_id" : "MDQ6VXNlcjE1NjEwMTg4",
         "organizations_url" : "https://api.github.com/users/BrandonOdiwuor/orgs",
         "received_events_url" : "https://api.github.com/users/BrandonOdiwuor/received_events",
         "repos_url" : "https://api.github.com/users/BrandonOdiwuor/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/BrandonOdiwuor/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/BrandonOdiwuor/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/BrandonOdiwuor"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1285232819"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285232819"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the suggestion, I'll take a look at `EvalCheckSig`! ",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-06T15:26:21Z",
      "diff_hunk" : "@@ -309,3 +311,51 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());\n+    CPubKey spend_pubkey{spend_pubkey_data};\n+\n+    return {scan_pubkey, spend_pubkey};\n+}\n+\n+std::vector<unsigned char> DecodeSilentAddress(const std::string& str)\n+{\n+    const auto& params{Params()};\n+    const auto& silent_payment_hrp = params.SilentPaymentHRP();\n+    const auto dec = bech32::Decode(str, /*silent=*/true);\n+    if (dec.encoding != bech32::Encoding::BECH32M || dec.hrp != silent_payment_hrp) {\n+        return {};\n+    }\n+    auto version = dec.data.front();  // retrieve the version\n+    std::vector<unsigned char> silent_payment_data;\n+    silent_payment_data.reserve(((dec.data.size() - 1) * 5) / 8);\n+    if (!ConvertBits<5, 8, false>([&](unsigned char c) { silent_payment_data.push_back(c); }, dec.data.begin() + 1, dec.data.end())) {\n+        return {};\n+    }\n+    if ((version == 0 && silent_payment_data.size() != SILENT_PAYMENT_V0_DATA_SIZE) || silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1285232819",
      "id" : 1285232819,
      "in_reply_to_id" : 1284001548,
      "line" : 341,
      "node_id" : "PRRC_kwDOABII585Mmxiz",
      "original_commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "original_line" : 341,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 40,
      "pull_request_review_id" : 1564168708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285232819/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-06T15:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285232819",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286843620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286843620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "rename to TweakAdd to more closely mirror the secp function",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T09:15:33Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286843620",
      "id" : 1286843620,
      "line" : 177,
      "node_id" : "PRRC_kwDOABII585Ms6zk",
      "original_commit_id" : "376a9b9ad48bb0dc308edc44574584bed9bf01ae",
      "original_line" : 177,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 20,
      "pull_request_review_id" : 1566866196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286843620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T09:15:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286843620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286844417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286844417"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this should also be rename since we aren't hashing",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T09:16:13Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_add(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+CKey CKey::MultiplyTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_mul(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+// we dont want to hash the output of ECDH yet, so we provide a custom hash function to secp256k1_ecdh which\n+// returns the serialized public key without hashing it\n+int custom_ecdh_hash_function(unsigned char *output, const unsigned char *x32, const unsigned char *y32, void *data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286844417",
      "id" : 1286844417,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585Ms7AB",
      "original_commit_id" : "376a9b9ad48bb0dc308edc44574584bed9bf01ae",
      "original_line" : 211,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 54,
      "pull_request_review_id" : 1566867434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286844417/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T09:16:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286844417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286847829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286847829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Should probably rename this to just \"UnhashedECDH\"",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T09:19:09Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_add(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+CKey CKey::MultiplyTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_mul(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+// we dont want to hash the output of ECDH yet, so we provide a custom hash function to secp256k1_ecdh which\n+// returns the serialized public key without hashing it\n+int custom_ecdh_hash_function(unsigned char *output, const unsigned char *x32, const unsigned char *y32, void *data) {\n+\n+    secp256k1_pubkey pubkey;\n+    unsigned char uncompressed_pubkey[65];\n+    uncompressed_pubkey[0] = 0x04;\n+    memcpy(uncompressed_pubkey + 1, x32, 32);\n+    memcpy(uncompressed_pubkey + 33, y32, 32);\n+\n+    if (!secp256k1_ec_pubkey_parse(secp256k1_context_sign, &pubkey, uncompressed_pubkey, 65)) {\n+        return 0;\n+    }\n+\n+    size_t outputlen = 33;\n+    if (!secp256k1_ec_pubkey_serialize(secp256k1_context_sign, output, &outputlen, &pubkey, SECP256K1_EC_COMPRESSED)) {\n+        return 0;\n+    }\n+    return 1;\n+}\n+\n+// WARNING: DO NOT USE THIS FUNCTION OUTSIDE OF SILENT PAYMENTS\n+// This function returns the un-hashed ECDH result and is specific to silent payments.\n+// If ECDH is required for a different use-case, a separate function should be used which does not use\n+// the `custom_ecdh_hash_function` and instead returns the hashed ECDH result (as is standard practice)\n+CPubKey CKey::SilentPaymentECDH(const CPubKey& pubkey) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286847829",
      "id" : 1286847829,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII585Ms71V",
      "original_commit_id" : "376a9b9ad48bb0dc308edc44574584bed9bf01ae",
      "original_line" : 234,
      "original_position" : 77,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 77,
      "pull_request_review_id" : 1566872721,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286847829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T09:19:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286847829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286857436"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286857436"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "move this to the UnhashedECDH function",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T09:27:13Z",
      "diff_hunk" : "@@ -172,6 +174,79 @@ bool CKey::Negate()\n     return secp256k1_ec_seckey_negate(secp256k1_context_sign, keydata.data());\n }\n \n+CKey CKey::AddTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_add(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+CKey CKey::MultiplyTweak(const unsigned char *tweak32) const\n+{\n+    assert(fValid);\n+\n+    unsigned char tweaked_seckey[32];\n+    memcpy(tweaked_seckey, data(), 32);\n+\n+    int ret = secp256k1_ec_seckey_tweak_mul(secp256k1_context_sign, tweaked_seckey, tweak32);\n+    assert(ret);\n+\n+    CKey new_seckey;\n+    new_seckey.Set(std::begin(tweaked_seckey), std::end(tweaked_seckey), true);\n+\n+    return new_seckey;\n+}\n+\n+// we dont want to hash the output of ECDH yet, so we provide a custom hash function to secp256k1_ecdh which\n+// returns the serialized public key without hashing it\n+int custom_ecdh_hash_function(unsigned char *output, const unsigned char *x32, const unsigned char *y32, void *data) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286857436",
      "id" : 1286857436,
      "in_reply_to_id" : 1286844417,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585Ms-Lc",
      "original_commit_id" : "376a9b9ad48bb0dc308edc44574584bed9bf01ae",
      "original_line" : 211,
      "original_position" : 54,
      "original_start_line" : null,
      "path" : "src/key.cpp",
      "position" : 54,
      "pull_request_review_id" : 1566887443,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286857436/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T09:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286857436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286873697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286873697"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Wrap this function in a more generic \"Decode\" function that doesn't have size restrictions, possibly use an ENUM for indicating what sort of error guarantees you want.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T09:41:33Z",
      "diff_hunk" : "@@ -370,11 +370,13 @@ std::string Encode(Encoding encoding, const std::string& hrp, const data& values\n }\n \n /** Decode a Bech32 or Bech32m string. */\n-DecodeResult Decode(const std::string& str) {\n+DecodeResult Decode(const std::string& str, bool silent) {\n+    std::size_t max_size = silent ? 1024 : 90;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286873697",
      "id" : 1286873697,
      "in_reply_to_id" : 1283012394,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585MtCJh",
      "original_commit_id" : "a469cb1e551ba16f1d83e4b0ae68194e38f1b9ec",
      "original_line" : 374,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/bech32.cpp",
      "position" : 6,
      "pull_request_review_id" : 1566913038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286873697/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T09:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286873697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286904504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286904504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Similar to \"Decode\", there should be a higher-level function that first decodes the string and then passes it to the relevant decoding function",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:08:17Z",
      "diff_hunk" : "@@ -309,3 +311,33 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());\n+    CPubKey spend_pubkey{spend_pubkey_data};\n+\n+    return {scan_pubkey, spend_pubkey};\n+}\n+\n+std::vector<unsigned char> DecodeSilentAddress(const std::string& str)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286904504",
      "id" : 1286904504,
      "line" : 327,
      "node_id" : "PRRC_kwDOABII585MtJq4",
      "original_commit_id" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec",
      "original_line" : 327,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 26,
      "pull_request_review_id" : 1566961113,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286904504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:08:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286904504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286912005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286912005"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Even better, should probably first add a new destination type to CTxDestination",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:15:28Z",
      "diff_hunk" : "@@ -309,3 +311,33 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());\n+    CPubKey spend_pubkey{spend_pubkey_data};\n+\n+    return {scan_pubkey, spend_pubkey};\n+}\n+\n+std::vector<unsigned char> DecodeSilentAddress(const std::string& str)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286912005",
      "id" : 1286912005,
      "in_reply_to_id" : 1286904504,
      "line" : 327,
      "node_id" : "PRRC_kwDOABII585MtLgF",
      "original_commit_id" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec",
      "original_line" : 327,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 26,
      "pull_request_review_id" : 1566972666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286912005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:15:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286912005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286930916"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286930916"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This doesn't need to be a struct, could just be functions which the DescScriptPubKeyMan calls as needed",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:34:17Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286930916",
      "id" : 1286930916,
      "line" : 12,
      "node_id" : "PRRC_kwDOABII585MtQHk",
      "original_commit_id" : "8be91169396a560bfc4a4e8b34a242111704f8e9",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 12,
      "pull_request_review_id" : 1567002299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286930916/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:34:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286930916",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286935217"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286935217"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this function should be \"label aware,\" meaning if the wallet implements labels later on, this function does not need to change.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:38:43Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286935217",
      "id" : 1286935217,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII585MtRKx",
      "original_commit_id" : "8be91169396a560bfc4a4e8b34a242111704f8e9",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 50,
      "pull_request_review_id" : 1567009051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286935217/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:38:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286935217",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941048"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This shouldn't return private keys, it should only return the tweak portion of the private key. This also means `Recipient` doesn't need to have the spend private key.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:44:44Z",
      "diff_hunk" : "@@ -0,0 +1,179 @@\n+#include <wallet/silentpayments.h>\n+#include <arith_uint256.h>\n+#include <coins.h>\n+#include <crypto/common.h>\n+#include <crypto/hmac_sha512.h>\n+#include <key_io.h>\n+#include <undo.h>\n+#include <logging.h>\n+\n+namespace wallet {\n+\n+Recipient::Recipient(const CKey& scan_seckey, const CKey& spend_seckey)\n+{\n+    m_scan_seckey = scan_seckey;\n+    m_scan_pubkey = CPubKey{m_scan_seckey.GetPubKey()};\n+    m_spend_seckey = spend_seckey;\n+    m_spend_pubkey = CPubKey{m_spend_seckey.GetPubKey()};\n+}\n+\n+void Recipient::ComputeECDHSharedSecret(const CPubKey& sender_public_key, const std::vector<COutPoint>& tx_outpoints)\n+{\n+    const auto& outpoint_hash = HashOutpoints(tx_outpoints);\n+    auto tweaked_scan_seckey = m_scan_seckey.MultiplyTweak(outpoint_hash.begin());\n+    CPubKey result = tweaked_scan_seckey.SilentPaymentECDH(sender_public_key);\n+\n+    m_ecdh_pubkey = result;\n+    assert(m_ecdh_pubkey.IsValid());\n+}\n+\n+std::pair<CKey,CPubKey> Recipient::CreateOutput(const uint32_t output_index) const\n+{\n+    HashWriter h;\n+    h.write(Span{m_ecdh_pubkey});\n+    unsigned char num[4];\n+    WriteBE32(num, output_index);\n+    h << num;\n+    uint256 shared_secret = h.GetSHA256();\n+\n+    const auto& result_pubkey{m_spend_pubkey.AddTweak(shared_secret.begin())};\n+    const auto& result_seckey{m_spend_seckey.AddTweak(shared_secret.begin())};\n+\n+    return {result_seckey, result_pubkey};\n+}\n+\n+std::pair<CPubKey,CPubKey> Recipient::GetAddress() const\n+{\n+    return {m_scan_pubkey, m_spend_pubkey};\n+}\n+\n+std::vector<CKey> Recipient::ScanTxOutputs(std::vector<XOnlyPubKey> output_pub_keys)\n+{\n+    // Because a sender can create multiple outputs for us, we first check the outputs vector for an output with\n+    // output index 0. If we find it, we remove it from the vector and then iterate over the vector again looking for\n+    // an output with index 1, and so on until one of the following happens:\n+    //\n+    //     1. We have determined all outputs belong to us (the vector is empty)\n+    //     2. We have passed over the vector and found no outputs belonging to us\n+    //\n+\n+    // The ECDH shared secret must be set before we start scanning\n+    assert(m_ecdh_pubkey.IsValid());\n+\n+    bool removed;\n+    uint32_t output_index{0};\n+    std::vector<CKey> raw_tr_keys;\n+    do {\n+        // We haven't removed anything yet on this pass and if we don't remove anything, we didn't find\n+        // any silent payment outputs and should stop checking\n+        removed = false;\n+        std::pair<CKey, CPubKey> tweakResult = CreateOutput(output_index);\n+        const CKey& silent_payment_priv_key = tweakResult.first;\n+        const XOnlyPubKey& silent_payment_pub_key = XOnlyPubKey{tweakResult.second};\n+        output_pub_keys.erase(std::remove_if(output_pub_keys.begin(), output_pub_keys.end(), [&](auto outputPubKey) {\n+            if (silent_payment_pub_key == outputPubKey) {\n+                // Since we found an output, we need to increment the output index and check the vector again\n+                raw_tr_keys.emplace_back(silent_payment_priv_key);\n+                removed = true;\n+                output_index++;\n+                // Return true so that this output pubkey is removed the from vector and not checked again\n+                return true;\n+            }\n+            return false;\n+        }), output_pub_keys.end());\n+    } while (!output_pub_keys.empty() && removed);\n+    return raw_tr_keys;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941048",
      "id" : 1286941048,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII585MtSl4",
      "original_commit_id" : "8be91169396a560bfc4a4e8b34a242111704f8e9",
      "original_line" : 85,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/wallet/silentpayments.cpp",
      "position" : 85,
      "pull_request_review_id" : 1567018287,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941460"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941460"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this should be its own commit",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:45:11Z",
      "diff_hunk" : "@@ -62,6 +63,20 @@ enum class AddressPurpose {\n     SEND,\n     REFUND, //!< Never set in current code may be present in older wallet databases\n };\n+\n+struct CRecipient\n+{\n+    CScript scriptPubKey;\n+    CAmount nAmount;\n+    bool fSubtractFeeFromAmount;\n+};\n+\n+struct V0SilentPaymentDestination",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941460",
      "id" : 1286941460,
      "line" : 79,
      "node_id" : "PRRC_kwDOABII585MtSsU",
      "original_commit_id" : "8be91169396a560bfc4a4e8b34a242111704f8e9",
      "original_line" : 74,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/types.h",
      "position" : 25,
      "pull_request_review_id" : 1567018921,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941460/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:45:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941460",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941957"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941957"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "this should be its own commit, might not be needed if we instead V0SilentPaymentDestination as a CTxDestination type",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T10:45:41Z",
      "diff_hunk" : "@@ -262,13 +262,6 @@ inline std::optional<AddressPurpose> PurposeFromString(std::string_view s)\n     return {};\n }\n \n-struct CRecipient",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1286941957",
      "id" : 1286941957,
      "line" : 265,
      "node_id" : "PRRC_kwDOABII585MtS0F",
      "original_commit_id" : "8be91169396a560bfc4a4e8b34a242111704f8e9",
      "original_line" : 265,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : 4,
      "pull_request_review_id" : 1567019657,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941957/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T10:45:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286941957",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe point out in the description how the first commit 8283ca76e4feb37d3514fbd8dc491b8c4965dff1 relates to BIP 324, which doesn't use the ecdh module, but ElligatorSwift instead.\r\n\r\n8be91169396a560bfc4a4e8b34a242111704f8e9: maybe split this up a bit more: e.g. one commit to introduce a dummy SilentPaymentRecipient / Sender class, one that adds ComputeECDHSharedSecret,  CreateOutput, etc. And then build up the tests across these commits.",
      "created_at" : "2023-08-08T15:06:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1669800569",
      "id" : 1669800569,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28122",
      "node_id" : "IC_kwDOABII585jhyJ5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669800569/reactions"
      },
      "updated_at" : "2023-08-08T16:55:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669800569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287394228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287394228"
         }
      },
      "author_association" : "MEMBER",
      "body" : "As long as testnet and signet are the same, and different from mainnet, I'm happy. When testing with e.g. hardware wallets it lets you use the testnet app / firmware instead of signet-specific stuff.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:40:13Z",
      "diff_hunk" : "@@ -508,6 +511,7 @@ class CRegTestParams : public CChainParams\n         base58Prefixes[EXT_SECRET_KEY] = {0x04, 0x35, 0x83, 0x94};\n \n         bech32_hrp = \"bcrt\";\n+        silent_payment_hrp = \"sprt\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287394228",
      "id" : 1287394228,
      "in_reply_to_id" : 1282093736,
      "line" : 514,
      "node_id" : "PRRC_kwDOABII585MvBO0",
      "original_commit_id" : "13e6c7b5444af103bb612cd503c50915d8d41015",
      "original_line" : 514,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/kernel/chainparams.cpp",
      "position" : 28,
      "pull_request_review_id" : 1567728841,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287394228/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:40:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287394228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287398956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287398956"
         }
      },
      "author_association" : "MEMBER",
      "body" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec: alternatively you could scan for the exact pubkey length. That would tolerate future versions to add extra stuff to the address that's safe to ignore for older versions.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:44:45Z",
      "diff_hunk" : "@@ -309,3 +311,33 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287398956",
      "id" : 1287398956,
      "line" : 321,
      "node_id" : "PRRC_kwDOABII585MvCYs",
      "original_commit_id" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec",
      "original_line" : 321,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 20,
      "pull_request_review_id" : 1567736115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287398956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287398956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287401010"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287401010"
         }
      },
      "author_association" : "MEMBER",
      "body" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec: could use `version == 0 && silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE` (see comment above)",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:46:46Z",
      "diff_hunk" : "@@ -309,3 +311,33 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)\n+{\n+\n+    std::vector<unsigned char> scan_pubkey_data(data.begin(), data.begin() + 33);\n+    CPubKey scan_pubkey{scan_pubkey_data};\n+\n+    std::vector<unsigned char> spend_pubkey_data(data.begin() + 33, data.end());\n+    CPubKey spend_pubkey{spend_pubkey_data};\n+\n+    return {scan_pubkey, spend_pubkey};\n+}\n+\n+std::vector<unsigned char> DecodeSilentAddress(const std::string& str)\n+{\n+    const auto& params{Params()};\n+    const auto& silent_payment_hrp = params.SilentPaymentHRP();\n+    const auto dec = bech32::Decode(str, /*silent=*/true);\n+    if (dec.encoding != bech32::Encoding::BECH32M || dec.hrp != silent_payment_hrp) {\n+        return {};\n+    }\n+    auto version = dec.data.front();  // retrieve the version\n+    std::vector<unsigned char> silent_payment_data;\n+    silent_payment_data.reserve(((dec.data.size() - 1) * 5) / 8);\n+    if (!ConvertBits<5, 8, false>([&](unsigned char c) { silent_payment_data.push_back(c); }, dec.data.begin() + 1, dec.data.end())) {\n+        return {};\n+    }\n+    if ((version == 0 && silent_payment_data.size() != SILENT_PAYMENT_V0_DATA_SIZE) || silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287401010",
      "id" : 1287401010,
      "line" : 341,
      "node_id" : "PRRC_kwDOABII585MvC4y",
      "original_commit_id" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec",
      "original_line" : 341,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 40,
      "pull_request_review_id" : 1567736115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287401010/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287401010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287402078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287402078"
         }
      },
      "author_association" : "MEMBER",
      "body" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec `assert data.size() >= SILENT_PAYMENT_V0_DATA_SIZE` (or early return if you don't expect the caller to have already checked this)",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:47:47Z",
      "diff_hunk" : "@@ -309,3 +311,33 @@ bool IsValidDestinationString(const std::string& str)\n {\n     return IsValidDestinationString(str, Params());\n }\n+\n+std::pair<CPubKey, CPubKey> DecodeSilentData(const std::vector<unsigned char>& data)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287402078",
      "id" : 1287402078,
      "line" : 315,
      "node_id" : "PRRC_kwDOABII585MvDJe",
      "original_commit_id" : "37b0ca1c3d753cc61e0debf8ea59160bdf4127ec",
      "original_line" : 315,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 14,
      "pull_request_review_id" : 1567736115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287402078/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287402078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287404315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404315"
         }
      },
      "author_association" : "MEMBER",
      "body" : "328951d056e939b6db573043fc71d8bd6ae68dff: if cheap, could assert/assume both ` CPubKey` are valid. ",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:49:52Z",
      "diff_hunk" : "@@ -341,3 +341,21 @@ std::vector<unsigned char> DecodeSilentAddress(const std::string& str)\n     if ((version == 0 && silent_payment_data.size() != SILENT_PAYMENT_V0_DATA_SIZE) || silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE) return {};\n     return silent_payment_data;\n }\n+\n+std::string EncodeSilentDestination(const CPubKey& scan_pubkey, const CPubKey& spend_pubkey)\n+{",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287404315",
      "id" : 1287404315,
      "line" : 346,
      "node_id" : "PRRC_kwDOABII585MvDsb",
      "original_commit_id" : "328951d056e939b6db573043fc71d8bd6ae68dff",
      "original_line" : 346,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 45,
      "pull_request_review_id" : 1567736115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404315/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287404996"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404996"
         }
      },
      "author_association" : "MEMBER",
      "body" : "328951d056e939b6db573043fc71d8bd6ae68dff: this should be in some bech32 helper function.",
      "commit_id" : "8ee791e7b34a354ce6835b968fe12924b8908d7c",
      "created_at" : "2023-08-08T16:50:33Z",
      "diff_hunk" : "@@ -341,3 +341,21 @@ std::vector<unsigned char> DecodeSilentAddress(const std::string& str)\n     if ((version == 0 && silent_payment_data.size() != SILENT_PAYMENT_V0_DATA_SIZE) || silent_payment_data.size() < SILENT_PAYMENT_V0_DATA_SIZE) return {};\n     return silent_payment_data;\n }\n+\n+std::string EncodeSilentDestination(const CPubKey& scan_pubkey, const CPubKey& spend_pubkey)\n+{\n+    // The data_in is scan_pubkey + spend_pubkey\n+    std::vector<unsigned char> data_in = {};\n+    // Set 0 as the silent payments version\n+    std::vector<unsigned char> data_out = {0};\n+\n+    data_in.insert(data_in.end(), scan_pubkey.begin(), scan_pubkey.end());\n+    data_in.insert(data_in.end(), spend_pubkey.begin(), spend_pubkey.end());\n+\n+    ConvertBits<8, 5, true>([&](unsigned char c) { data_out.push_back(c); }, data_in.begin(), data_in.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#discussion_r1287404996",
      "id" : 1287404996,
      "line" : 355,
      "node_id" : "PRRC_kwDOABII585MvD3E",
      "original_commit_id" : "328951d056e939b6db573043fc71d8bd6ae68dff",
      "original_line" : 355,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/key_io.cpp",
      "position" : 54,
      "pull_request_review_id" : 1567736115,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28122",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404996/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-08T16:56:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1287404996",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think this PR should also contain `IsInputForSharedSecretDerivation` that's currently in the send PR, as well as `SumInputPubKeys` (not sure where that's introduced). More generally: anything that's critical in deriving the correct key from a transaction, given its inputs. (this would also make it easier to build an index based on just this PR, see #28241)",
      "created_at" : "2023-08-09T09:01:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1670943979",
      "id" : 1670943979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28122",
      "node_id" : "IC_kwDOABII585jmJTr",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670943979/reactions"
      },
      "updated_at" : "2023-08-09T09:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670943979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
