[
   {
      "author_association" : "MEMBER",
      "body" : "> Should we disable the adding of new inputs when reduce_output is set? If someone really intends to do that, they should probably use outputs.\r\n\r\nI don't think so. This is more an implementation issue rather than a missing doc or a missing restriction.\r\nThis could also happen without someone intending to do it. For instance, could be a higher bump fee that make the tx require another input.\r\n\r\nThe issue arises because the code (as is now) mixes two different concepts; it treats the change output and the reduce output (output from where the fees will be taken) as they would be the same, when they are not. It can easily be seen [here](https://github.com/bitcoin/bitcoin/blob/f4f1d6d230dd390f0524b8852b8cfc912d006958/src/wallet/feebumper.cpp#L250C12-L250C12).\r\nInstead of instructing the wallet to deduce the fee from certain output (by using SFFO), we discard the output from the recipients list and make the output script the custom change destination, so the wallet **automatically** adds the change output, at the end of the transaction creation process, going to the discarded output script, with an amount equal to the remainder: `inputs - outputs - new_bump_fee`.\r\n\r\nTo untangle the two concepts, we need to fix #27601 first. It is the reason why we drop the change output from the recipients list instead of simply mark it as SFFO (which would be the easiest implementation for a \"reduce output\" mechanism).",
      "created_at" : "2023-07-31T21:15:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28180#issuecomment-1659172967",
      "id" : 1659172967,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28180",
      "node_id" : "IC_kwDOABII585i5Phn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659172967/reactions"
      },
      "updated_at" : "2023-07-31T21:17:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659172967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "What is the status here? This is the only issue tagged 26.0 that doesn't have a pull request associated ",
      "created_at" : "2023-09-05T11:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28180#issuecomment-1706447648",
      "id" : 1706447648,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28180",
      "node_id" : "IC_kwDOABII585ltlMg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706447648/reactions"
      },
      "updated_at" : "2023-09-05T11:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706447648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What is the status here? This is the only issue tagged 26.0 that doesn't have a pull request associated\r\n\r\nStatus is \"waiting for others\" in #27601 since July 27th. Happy to receive feedback on my last message there (https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1550813509).\r\n\r\nThe reason why this happens is explained above https://github.com/bitcoin/bitcoin/issues/28180#issuecomment-1659172967.  if we manage to merge #27601 (in any form), we can fix this issue cleanly.\r\n\r\nBasically, the only remaining point to discuss there is whether to have the transaction creation process automatically detecting change outputs when they match the custom change address or not.\r\nI could also code a different version of the PR moving the automatic change output detection outside of the tx creation process too. Placing it on the upper layer (similar to what we do with the duplicate recipients check). But, in any case, concluding the discussion there prior to any changes would be preferable.",
      "created_at" : "2023-09-05T13:06:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/28180#issuecomment-1706585802",
      "id" : 1706585802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28180",
      "node_id" : "IC_kwDOABII585luG7K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706585802/reactions"
      },
      "updated_at" : "2023-09-05T13:18:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706585802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   }
]
