[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28868).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-13T21:32:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28868#issuecomment-1809161000",
      "id" : 1809161000,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28868",
      "node_id" : "IC_kwDOABII585r1Zso",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809161000/reactions"
      },
      "updated_at" : "2023-11-14T05:00:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809161000",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It seems like there's a random failure happening where something in BDB is `free()`ing an invalid pointer which causes bitcoind to abort. This appears to only be happening with the change the reloads the wallet for the early exits. I don't really understand why that is even happening, and it doesn't happen consistently enough to reliably debug.",
      "created_at" : "2023-11-14T00:29:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28868#issuecomment-1809348998",
      "id" : 1809348998,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28868",
      "node_id" : "IC_kwDOABII585r2HmG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809348998/reactions"
      },
      "updated_at" : "2023-11-14T00:29:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809348998",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I also get a test failure at 65b2da99fe18768d1bd4cd67522f7031f16a3420 about half the time. With the first commit a47f220933f202dd1f972d30f6cb31b09ca0a225 this test doesn't fail (at least not the first ten times I tried).\r\n\r\n```\r\n228/283 - wallet_migration.py failed, Duration: 2 s\r\n\r\nstdout:\r\n2023-11-14T06:24:21.154000Z TestFramework (INFO): PRNG seed is: 2952483070848634871\r\n...\r\n2023-11-14T06:24:22.297000Z TestFramework (INFO): Test migration of an encrypted wallet\r\n2023-11-14T06:24:22.892000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n...\r\n  File \"/home/sjors/dev/bitcoin/test/functional/wallet_migration.py\", line 452, in test_encrypted\r\n    assert_raises_rpc_error(-4, \"The passphrase contains a null character\", wallet.migratewallet, None, \"pass\\0with\\0null\")\r\n  File \"/home/sjors/dev/bitcoin/test/functional/test_framework/util.py\", line 130, in assert_raises_rpc_error\r\n    assert try_rpc(code, message, fun, *args, **kwds), \"No exception raised\"\r\n  File \"/home/sjors/dev/bitcoin/test/functional/test_framework/util.py\", line 150, in try_rpc\r\n    raise AssertionError(\"Unexpected exception raised: \" + type(e).__name__)\r\nAssertionError: Unexpected exception raised: RemoteDisconnected\r\n2023-11-14T06:24:22.944000Z TestFramework (INFO): Stopping nodes\r\n[node 0] Cleaning up leftover process\r\n```",
      "created_at" : "2023-11-14T06:29:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28868#issuecomment-1809618420",
      "id" : 1809618420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28868",
      "node_id" : "IC_kwDOABII585r3JX0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809618420/reactions"
      },
      "updated_at" : "2023-11-14T06:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809618420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "While trying to test the first commit, I ran into something odd. It seems that an _empty_ watch-only wallet legacy is treated as a descriptor wallet by `migratewallet`.\r\n\r\n1. Checkout master at 5800c558eb5efb4839ed00d6967e43306d68e1c3, compile with BDB\r\n2. `src/bitcoind -deprecatedrpc=create_bdb`\r\n3. `src/bitcoin-cli createwallet TestMigrate true true \"\" false false` (this warns that legacy wallets are deprecated)\r\n4. Restart the node (not sure if necessary) and load the wallet again, double check with `getwalletinfo` that it's a legacy wallet\r\n5. `src/bitcoin-cli -rpcwallet=TestMigrate migratewallet`\r\n\r\nThat results in:\r\n\r\n```\r\nerror code: -4\r\nerror message:\r\nError: This wallet is already a descriptor wallet\r\n```\r\n\r\nOnce I import an address it does migrate.",
      "created_at" : "2023-11-14T06:57:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28868#issuecomment-1809641110",
      "id" : 1809641110,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28868",
      "node_id" : "IC_kwDOABII585r3O6W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809641110/reactions"
      },
      "updated_at" : "2023-11-14T06:57:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1809641110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
