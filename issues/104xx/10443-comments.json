[
   {
      "body" : "This is interesting but still no comment.\r\n\r\nConcept ACK\r\n\r\nI'll play around with this a bit.\r\n\r\n```\r\nWshadow statistics: \r\n   1 policy/fees_input.cpp:127:23: warning: declaration shadows a local variable [-Wshadow]\r\n   1 policy/fees_input.cpp:197:38: warning: declaration shadows a local variable [-Wshadow]\r\n   1 policy/fees_input.cpp:229:22: warning: declaration shadows a local variable [-Wshadow]\r\n   1 policy/fees_input.cpp:233:27: warning: declaration shadows a local variable [-Wshadow]\r\n   1 policy/fees_input.cpp:27:61: warning: declaration shadows a field of 'CBlockPolicyInput' [-Wshadow]\r\n   1 test/fee_est/fee_est.cpp:301:34: warning: declaration shadows a local variable [-Wshadow]\r\n   1 test/fee_est/fee_est.cpp:79:20: warning: declaration shadows a field of 'TxData' [-Wshadow]\r\n   1 test/fee_est/fee_est.cpp:79:29: warning: declaration shadows a field of 'TxData' [-Wshadow]\r\n   1 test/fee_est/fee_est.cpp:79:39: warning: declaration shadows a field of 'TxData' [-Wshadow]\r\n```",
      "created_at" : "2017-06-13T20:46:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-308243389",
      "id" : 308243389,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2017-06-13T20:46:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308243389",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "When estimate log doesn't have enough data, `fee_est` is generating empty data in the HTML file. Emit some warning in such cases?\r\n",
      "created_at" : "2017-06-14T07:21:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-308342619",
      "id" : 308342619,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2017-06-14T07:21:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308342619",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "For perfect output, there should be 3rd dimension - time or current block height when the tx was first seen :-)",
      "created_at" : "2017-06-14T07:24:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-308343380",
      "id" : 308343380,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2017-06-14T07:24:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/308343380",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/6848764?v=3",
         "events_url" : "https://api.github.com/users/paveljanik/events{/privacy}",
         "followers_url" : "https://api.github.com/users/paveljanik/followers",
         "following_url" : "https://api.github.com/users/paveljanik/following{/other_user}",
         "gists_url" : "https://api.github.com/users/paveljanik/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/paveljanik",
         "id" : 6848764,
         "login" : "paveljanik",
         "organizations_url" : "https://api.github.com/users/paveljanik/orgs",
         "received_events_url" : "https://api.github.com/users/paveljanik/received_events",
         "repos_url" : "https://api.github.com/users/paveljanik/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/paveljanik/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/paveljanik/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/paveljanik"
      }
   },
   {
      "body" : "Concept ACK. I think this could be a useful tool.\r\n\r\nCould this be split into two PRs to aid reviewers? The first PR would cover the `-estlog` option and writing the fee estimation data to disk. The second PR would be for a tool to read and graph the logs.\r\n\r\nParsing and graphing json files seems like a problem that has probably been solved many times before. If I was approaching this, I'd look at implementing this as a script in /contrib or a separate repository. Was there a particular reason you chose to implement this as a new C++ program?",
      "created_at" : "2017-06-28T12:05:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-311640095",
      "id" : 311640095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2017-06-28T12:05:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/311640095",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/1063656?v=3",
         "events_url" : "https://api.github.com/users/jnewbery/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jnewbery/followers",
         "following_url" : "https://api.github.com/users/jnewbery/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jnewbery/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jnewbery",
         "id" : 1063656,
         "login" : "jnewbery",
         "organizations_url" : "https://api.github.com/users/jnewbery/orgs",
         "received_events_url" : "https://api.github.com/users/jnewbery/received_events",
         "repos_url" : "https://api.github.com/users/jnewbery/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jnewbery/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jnewbery"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> Could this be split into two PRs to aid reviewers? The first PR would cover the -estlog option and writing the fee estimation data to disk. The second PR would be for a tool to read and graph the logs.\r\n\r\nI think this is useful.\r\n\r\nHowever I'm not sure the analysis tool belongs in this repository. As it's specific to developers debugging the fee estimation code it's not something we want to ship with the distribution, or install by default. One place it could be is e.g. https://github.com/bitcoin-core/bitcoin-maintainer-tools . You could still document or refer to it from here.",
      "created_at" : "2018-04-10T18:20:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-380199151",
      "id" : 380199151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2018-04-10T18:20:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380199151",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Agree that fee_est tool shouldn't be installed, since it's a tool specifically for made for modifying and debugging fee estimation code.\r\n\r\nBut it would be awkward to use and maintain from a separate repository because it links and calls into the fee estimation code. (The tool works by piping historical data into the fee estimator so it's possible to make experimental changes to fee estimation and see how those changes affect its output and internal state.)\r\n\r\nAs far as build / distribution is concerned I think it makes sense to think of it more like a unit test or benchmark than like a maintainer tool.",
      "created_at" : "2018-04-10T18:53:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-380209281",
      "id" : 380209281,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2018-04-10T18:54:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380209281",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "OWNER",
      "body" : "> But it would be awkward to use and maintain from a separate repository because it links and calls into the fee estimation code. \r\n\r\nYes, I agree, that's unfortunately true. That part needs to stay in the repository with the rest of the code.\r\n\r\n> Parsing and graphing json files seems like a problem that has probably been solved many times before. If I was approaching this, I'd look at implementing this as a script in /contrib or a separate repository.\r\n\r\nI agree - especially with the references to cloudflare CDN and such. It feels a bit ugly to have that in the C++ code. Better to spit out e.g. JSON or CSV or whatever is convenient, then use a separate script for pretty formatting. This would also keep open the option of using different (non-web) visualization tools.\r\n",
      "created_at" : "2018-05-14T14:18:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-388833486",
      "id" : 388833486,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "updated_at" : "2018-05-14T14:30:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/388833486",
      "user" : {
         "avatar_url" : "https://avatars0.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 54 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",
      "created_at" : "2018-07-29T15:18:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-408684675",
      "id" : 408684675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQwODY4NDY3NQ==",
      "updated_at" : "2018-07-29T15:18:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/408684675",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r216699784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216699784"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-11 16:31:38 mdl(pr=10443): src/test/fee_est/README.md:8: MD034 Bare URL used\r\n2018-09-11 16:31:38 mdl(pr=10443): src/test/fee_est/README.md:9: MD034 Bare URL used\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-11T14:52:49Z",
      "diff_hunk" : "@@ -0,0 +1,37 @@\n+src/test/fee_est -- Fee estimation offline testing tool\n+=======================================================\n+\n+The `fee_est` tool is intended to help debug and test changes in bitcoin fee\n+estimation code using transaction data gathered from live bitcoin nodes.\n+\n+Transaction data can be collected by running bitcoind with `-estlog` parameter\n+which will produce newline-delimited json file (http://ndjson.org/,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r216699784",
      "id" : 216699784,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNjY5OTc4NA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 8,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/test/fee_est/README.md",
      "position" : null,
      "pull_request_review_id" : 154242217,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216699784/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/216699784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r217878986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217878986"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Mod by zero here.",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-15T07:58:24Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r217878986",
      "id" : 217878986,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxNzg3ODk4Ng==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 181,
      "original_position" : 177,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 155707084,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217878986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/217878986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422492"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422492"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees.h:199:10: warning: function 'CBlockPolicyEstimator::processTx' has a definition with different parameter names [readability-inconsistent-declaration-parameter-name]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:37:49Z",
      "diff_hunk" : "@@ -190,11 +191,12 @@ class CBlockPolicyEstimator\n     ~CBlockPolicyEstimator();\n \n     /** Process all the transactions that have been included in a block */\n+    struct Block;\n     void processBlock(unsigned int nBlockHeight,\n-                      std::vector<const CTxMemPoolEntry*>& entries);\n+                      const std::function<void(Block&)> process_txs);\n \n     /** Process a transaction accepted to the mempool*/\n-    void processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate);\n+    void processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422492",
      "id" : 219422492,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMjQ5Mg==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 199,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/policy/fees.h",
      "position" : null,
      "pull_request_review_id" : 157594261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422492/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422492",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422569"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422569"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees.cpp:17:5: warning: single-argument constructors must be marked explicit to avoid unintentional implicit conversions [google-explicit-constructor]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:38:07Z",
      "diff_hunk" : "@@ -9,11 +9,17 @@\n #include <clientversion.h>\n #include <primitives/transaction.h>\n #include <streams.h>\n-#include <txmempool.h>\n #include <util.h>\n \n static constexpr double INF_FEERATE = 1e99;\n \n+struct CBlockPolicyEstimator::Block {\n+    Block(int height) : height(height) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422569",
      "id" : 219422569,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMjU2OQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 157594364,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422569/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422569",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422843"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:149:17: warning: parameter 'pool' is unused [misc-unused-parameters]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:39:10Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422843",
      "id" : 219422843,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMjg0Mw==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 153,
      "original_position" : 149,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157594739,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422843/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422905"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:163:28: warning: passing result of std::move() as a const reference argument; no move will actually happen [hicpp-move-const-arg]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:39:24Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219422905",
      "id" : 219422905,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMjkwNQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 167,
      "original_position" : 163,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157594814,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422905/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219422905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:177:21: warning: rand() has limited randomness; use C++11 random library instead [cert-msc30-c]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:40:03Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423092",
      "id" : 219423092,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzA5Mg==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 181,
      "original_position" : 177,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157595078,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423154"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423154"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:185:9: warning: the 'empty' method should be used to check for emptiness instead of 'size' [readability-container-size-empty]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:40:17Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (sample.size() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423154",
      "id" : 219423154,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzE1NA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 189,
      "original_position" : 185,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157595156,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423154/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423154",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423187"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423187"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:205:31: warning: passing result of std::move() as a const reference argument; no move will actually happen [hicpp-move-const-arg]\r\n```",
      "commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "created_at" : "2018-09-21T08:40:26Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (sample.size() > 0) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423187",
      "id" : 219423187,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzE4Nw==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_position" : 205,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 207,
      "pull_request_review_id" : 157595205,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "updated_at" : "2018-11-06T18:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423187",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423229"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:229:38: warning: parameter 'targets' is unused [misc-unused-parameters]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:40:35Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (sample.size() > 0) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423229",
      "id" : 219423229,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzIyOQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 233,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157595259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423229/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:230:28: warning: parameter 'estimator' is unused [misc-unused-parameters]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:40:44Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (sample.size() > 0) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423270",
      "id" : 219423270,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzI3MA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 234,
      "original_position" : 230,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157595312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423297"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/test/fee_est/fee_est.cpp:231:17: warning: parameter 'pool' is unused [misc-unused-parameters]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:40:52Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <txmempool.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(std::move(fee));\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = rand() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (sample.size() > 0) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator,\n+    CTxMemPool& pool)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423297",
      "id" : 219423297,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzI5Nw==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 235,
      "original_position" : 231,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 157595362,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.h:33:10: warning: function 'FeeEstInput::removeTx' has a definition with different parameter names [readability-inconsistent-declaration-parameter-name]\r\n```",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-09-21T08:41:26Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_POLICY_FEES_INPUT_H\n+#define BITCOIN_POLICY_FEES_INPUT_H\n+\n+#include <amount.h>\n+#include <fs.h>\n+\n+#include <map>\n+#include <memory>\n+#include <vector>\n+\n+class CAutoFile;\n+class CBlockPolicyEstimator;\n+class UniValue;\n+class uint256;\n+\n+class FeeEstInput\n+{\n+public:\n+    FeeEstInput(CBlockPolicyEstimator& estimator);\n+\n+    /** Process all the transactions that have been included in a block */\n+    struct Block;\n+    void processBlock(int height, const std::function<void(Block&)>& process_txs);\n+\n+    /** Process a transaction added the mempool or a block */\n+    void processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid);\n+\n+    /** Remove a transaction from the mempool tracking stats */\n+    void removeTx(const uint256& hash, bool in_block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423451",
      "id" : 219423451,
      "line" : 33,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzQ1MQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.h",
      "position" : 33,
      "pull_request_review_id" : 157595545,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423558"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.cpp:30:39: warning: passing result of std::move() as a const reference argument; no move will actually happen [hicpp-move-const-arg]\r\n```",
      "commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "created_at" : "2018-09-21T08:41:48Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423558",
      "id" : 219423558,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzU1OA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_position" : 30,
      "path" : "src/policy/fees_input.cpp",
      "position" : 39,
      "pull_request_review_id" : 157595685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "updated_at" : "2018-11-06T18:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423558",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423610"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.cpp:33:32: warning: passing result of std::move() as a const reference argument; no move will actually happen [hicpp-move-const-arg]\r\n```",
      "commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "created_at" : "2018-09-21T08:41:57Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423610",
      "id" : 219423610,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzYxMA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_position" : 33,
      "path" : "src/policy/fees_input.cpp",
      "position" : 42,
      "pull_request_review_id" : 157595736,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "updated_at" : "2018-11-06T18:26:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423610",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423710"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423710"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.cpp:126:13: warning: use std::make_unique instead [modernize-make-unique]\r\n```\r\n\r\n`MakeUnique` in our case :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:42:20Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool inBlock)\n+{\n+    estimator.removeTx(hash, inBlock);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(inBlock));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log.reset(new std::ofstream(filename, std::ofstream::out | std::ofstream::app));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423710",
      "id" : 219423710,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzcxMA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 130,
      "original_position" : 126,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 157595866,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423710/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423856"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.cpp:143:87: warning: the parameter 'filter' is copied for each invocation but only used as a const reference; consider making it a const reference [performance-unnecessary-value-param]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:42:53Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool inBlock)\n+{\n+    estimator.removeTx(hash, inBlock);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(inBlock));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log.reset(new std::ofstream(filename, std::ofstream::out | std::ofstream::app));\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, std::function<bool(UniValue&)> filter)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423856",
      "id" : 219423856,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzg1Ng==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 147,
      "original_position" : 143,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 157596039,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423856/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423905"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423905"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 04:48:56 clang-tidy(pr=10443): src/policy/fees_input.cpp:198:13: warning: consider replacing 'unsigned short' with 'uint16' [google-runtime-int]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:43:06Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool inBlock)\n+{\n+    estimator.removeTx(hash, inBlock);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(inBlock));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log.reset(new std::ofstream(filename, std::ofstream::out | std::ofstream::app));\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, std::function<bool(UniValue&)> filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& txs = value[\"txs\"].getValues();\n+                for (const UniValue& tx : txs) {\n+                    estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(),\n+                        tx[\"fee\"].get_int64(), tx[\"size\"].get_int(), &est_block, true /* valid */);\n+                }\n+                return txs.size();\n+            });\n+            continue;\n+        }\n+\n+        const UniValue& removeTx = value[\"removeTx\"];\n+        if (removeTx.isObject()) {\n+            estimator.removeTx(uint256S(removeTx[\"hash\"].get_str()), removeTx[\"inBlock\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& flush = value[\"flush\"];\n+        if (flush.isArray()) {\n+            estimator.FlushUnconfirmed();\n+            continue;\n+        }\n+\n+        const UniValue& read = value[\"read\"];\n+        if (read.isStr()) {\n+            std::vector<unsigned char> data = ParseHex(read.get_str());\n+            unsigned short randv = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219423905",
      "id" : 219423905,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyMzkwNQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 198,
      "original_position" : 198,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 157596111,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423905/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219423905",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219424018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424018"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 05:13:44 cppcheck(pr=10443): [src/policy/fees_input.h:23]: (style) Class 'FeeEstInput' has a constructor with 1 argument that is not explicit.\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:43:28Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_POLICY_FEES_INPUT_H\n+#define BITCOIN_POLICY_FEES_INPUT_H\n+\n+#include <amount.h>\n+#include <fs.h>\n+\n+#include <map>\n+#include <memory>\n+#include <vector>\n+\n+class CAutoFile;\n+class CBlockPolicyEstimator;\n+class UniValue;\n+class uint256;\n+\n+class FeeEstInput\n+{\n+public:\n+    FeeEstInput(CBlockPolicyEstimator& estimator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219424018",
      "id" : 219424018,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDAxOA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.h",
      "position" : null,
      "pull_request_review_id" : 157596252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219424086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424086"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-20 05:13:44 cppcheck(pr=10443): [src/policy/fees.cpp:17]: (style) Struct 'Block' has a constructor with 1 argument that is not explicit.\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-21T08:43:43Z",
      "diff_hunk" : "@@ -9,11 +9,17 @@\n #include <clientversion.h>\n #include <primitives/transaction.h>\n #include <streams.h>\n-#include <txmempool.h>\n #include <util.h>\n \n static constexpr double INF_FEERATE = 1e99;\n \n+struct CBlockPolicyEstimator::Block {\n+    Block(int height) : height(height) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219424086",
      "id" : 219424086,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTQyNDA4Ng==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 157596329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424086/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219424086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [paveljanik](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-308243389), [jnewbery](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-311640095), [sipa](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-494982393), [jonatack](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-737147179), [aureleoules](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1280546856) |\n| Approach NACK | [josibake](https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1529690116) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27861](https://github.com/bitcoin/bitcoin/pull/27861) (kernel: Add interrupt class by TheCharlatan)\n* [#27859](https://github.com/bitcoin/bitcoin/pull/27859) (Mempool: persist mempoolminfee accross restarts by ismaelsadeeq)\n* [#27622](https://github.com/bitcoin/bitcoin/pull/27622) (Fee estimation: avoid serving stale fee estimate by ismaelsadeeq)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2018-09-21T13:33:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-423532381",
      "id" : 423532381,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyMzUzMjM4MQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423532381/reactions"
      },
      "updated_at" : "2023-06-14T01:10:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/423532381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-22 22:51:38 cpplint(pr=10443): src/policy/fees.cpp:17:  Single-parameter constructors should be marked explicit.  [runtime/explicit] [5]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-23T08:25:35Z",
      "diff_hunk" : "@@ -9,11 +9,17 @@\n #include <clientversion.h>\n #include <primitives/transaction.h>\n #include <streams.h>\n-#include <txmempool.h>\n #include <util.h>\n \n static constexpr double INF_FEERATE = 1e99;\n \n+struct CBlockPolicyEstimator::Block {\n+    Block(int height) : height(height) {}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691822",
      "id" : 219691822,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTgyMg==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 17,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : null,
      "pull_request_review_id" : 157932420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691831"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691831"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-22 22:51:38 cpplint(pr=10443): src/policy/fees_input.cpp:0:  No copyright message found.\r\n```",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-09-23T08:25:54Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691831",
      "id" : 219691831,
      "line" : 5,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTgzMQ==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 5,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : 5,
      "pull_request_review_id" : 157932426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691848"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691848"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-22 22:51:38 cpplint(pr=10443): src/policy/fees_input.cpp:198:  Use int16/int64/etc, rather than the C type short  [runtime/int] [4]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-23T08:26:48Z",
      "diff_hunk" : "@@ -0,0 +1,218 @@\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool inBlock)\n+{\n+    estimator.removeTx(hash, inBlock);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(inBlock));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log.reset(new std::ofstream(filename, std::ofstream::out | std::ofstream::app));\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, std::function<bool(UniValue&)> filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& txs = value[\"txs\"].getValues();\n+                for (const UniValue& tx : txs) {\n+                    estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(),\n+                        tx[\"fee\"].get_int64(), tx[\"size\"].get_int(), &est_block, true /* valid */);\n+                }\n+                return txs.size();\n+            });\n+            continue;\n+        }\n+\n+        const UniValue& removeTx = value[\"removeTx\"];\n+        if (removeTx.isObject()) {\n+            estimator.removeTx(uint256S(removeTx[\"hash\"].get_str()), removeTx[\"inBlock\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& flush = value[\"flush\"];\n+        if (flush.isArray()) {\n+            estimator.FlushUnconfirmed();\n+            continue;\n+        }\n+\n+        const UniValue& read = value[\"read\"];\n+        if (read.isStr()) {\n+            std::vector<unsigned char> data = ParseHex(read.get_str());\n+            unsigned short randv = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691848",
      "id" : 219691848,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTg0OA==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 198,
      "original_position" : 198,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 157932444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691848/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691848",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691867"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-22 22:51:38 cpplint(pr=10443): src/policy/fees_input.h:23:  Single-parameter constructors should be marked explicit.  [runtime/explicit] [5]\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-09-23T08:27:39Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_POLICY_FEES_INPUT_H\n+#define BITCOIN_POLICY_FEES_INPUT_H\n+\n+#include <amount.h>\n+#include <fs.h>\n+\n+#include <map>\n+#include <memory>\n+#include <vector>\n+\n+class CAutoFile;\n+class CBlockPolicyEstimator;\n+class UniValue;\n+class uint256;\n+\n+class FeeEstInput\n+{\n+public:\n+    FeeEstInput(CBlockPolicyEstimator& estimator);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691867",
      "id" : 219691867,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTg2Nw==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 23,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.h",
      "position" : null,
      "pull_request_review_id" : 157932466,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691867/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\n2018-09-22 22:51:38 cpplint(pr=10443): src/test/fee_est/fee_est.cpp:0:  No copyright message found.\r\n```",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-09-23T08:28:05Z",
      "diff_hunk" : "@@ -0,0 +1,332 @@\n+#include <policy/fees.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r219691876",
      "id" : 219691876,
      "line" : 5,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxOTY5MTg3Ng==",
      "original_commit_id" : "8cd1bb684bfec22fc54e091dc96c782a26847393",
      "original_line" : 5,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 5,
      "pull_request_review_id" : 157932474,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/219691876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-09-24T22:24:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-424145518",
      "id" : 424145518,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQyNDE0NTUxOA==",
      "updated_at" : "2018-09-24T22:24:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/424145518",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224318978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224318978"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't `height` guaranteed to be non-negative? Should be `unsigned int`?",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:32:58Z",
      "diff_hunk" : "@@ -0,0 +1,55 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2016 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+#ifndef BITCOIN_POLICY_FEES_INPUT_H\n+#define BITCOIN_POLICY_FEES_INPUT_H\n+\n+#include <amount.h>\n+#include <fs.h>\n+\n+#include <map>\n+#include <memory>\n+#include <vector>\n+\n+class CAutoFile;\n+class CBlockPolicyEstimator;\n+class UniValue;\n+class uint256;\n+\n+class FeeEstInput\n+{\n+public:\n+    explicit FeeEstInput(CBlockPolicyEstimator& estimator);\n+\n+    /** Process all the transactions that have been included in a block */\n+    struct Block;\n+    void processBlock(int height, const std::function<void(Block&)>& process_txs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224318978",
      "id" : 224318978,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxODk3OA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 27,
      "original_position" : 27,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.h",
      "position" : null,
      "pull_request_review_id" : 163654386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224318978/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224318978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The variable `file` shadows an already existing local variable. Please choose another name :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:34:13Z",
      "diff_hunk" : "@@ -0,0 +1,222 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319126",
      "id" : 224319126,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTEyNg==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 109,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 163654570,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`tx` shadows a local variable. Please choose another name :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:35:42Z",
      "diff_hunk" : "@@ -0,0 +1,222 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log = MakeUnique<std::ofstream>(filename, std::ofstream::out | std::ofstream::app);\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, const std::function<bool(UniValue&)>& filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& txs = value[\"txs\"].getValues();\n+                for (const UniValue& tx : txs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319364",
      "id" : 224319364,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTM2NA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 178,
      "original_position" : 178,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 163654863,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`filename` shadows another variable. Please use another name :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:36:28Z",
      "diff_hunk" : "@@ -0,0 +1,222 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log = MakeUnique<std::ofstream>(filename, std::ofstream::out | std::ofstream::app);\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, const std::function<bool(UniValue&)>& filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& txs = value[\"txs\"].getValues();\n+                for (const UniValue& tx : txs) {\n+                    estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(),\n+                        tx[\"fee\"].get_int64(), tx[\"size\"].get_int(), &est_block, true /* valid */);\n+                }\n+                return txs.size();\n+            });\n+            continue;\n+        }\n+\n+        const UniValue& removeTx = value[\"removeTx\"];\n+        if (removeTx.isObject()) {\n+            estimator.removeTx(uint256S(removeTx[\"hash\"].get_str()), removeTx[\"inBlock\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& flush = value[\"flush\"];\n+        if (flush.isArray()) {\n+            estimator.FlushUnconfirmed();\n+            continue;\n+        }\n+\n+        const UniValue& read = value[\"read\"];\n+        if (read.isStr()) {\n+            std::vector<unsigned char> data = ParseHex(read.get_str());\n+            uint16_t randv = 0;\n+            GetRandBytes((unsigned char*)&randv, sizeof(randv));\n+            fs::path filename = strprintf(\"fee_estimates.tmp.%04x\", randv);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319465",
      "id" : 224319465,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTQ2NQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 204,
      "original_position" : 204,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 163654979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319465/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319504"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Same here: shadows another local variable :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:36:47Z",
      "diff_hunk" : "@@ -0,0 +1,222 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util.h>\n+#include <utilstrencodings.h>\n+#include <utiltime.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, Block* block, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", height);\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream file(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(file), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log = MakeUnique<std::ofstream>(filename, std::ofstream::out | std::ofstream::app);\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, const std::function<bool(UniValue&)>& filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& txs = value[\"txs\"].getValues();\n+                for (const UniValue& tx : txs) {\n+                    estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(),\n+                        tx[\"fee\"].get_int64(), tx[\"size\"].get_int(), &est_block, true /* valid */);\n+                }\n+                return txs.size();\n+            });\n+            continue;\n+        }\n+\n+        const UniValue& removeTx = value[\"removeTx\"];\n+        if (removeTx.isObject()) {\n+            estimator.removeTx(uint256S(removeTx[\"hash\"].get_str()), removeTx[\"inBlock\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& flush = value[\"flush\"];\n+        if (flush.isArray()) {\n+            estimator.FlushUnconfirmed();\n+            continue;\n+        }\n+\n+        const UniValue& read = value[\"read\"];\n+        if (read.isStr()) {\n+            std::vector<unsigned char> data = ParseHex(read.get_str());\n+            uint16_t randv = 0;\n+            GetRandBytes((unsigned char*)&randv, sizeof(randv));\n+            fs::path filename = strprintf(\"fee_estimates.tmp.%04x\", randv);\n+            CAutoFile(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION)\n+                .write((const char*)data.data(), data.size());\n+            {\n+                CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319504",
      "id" : 224319504,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTUwNA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 208,
      "original_position" : 208,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 163655029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:38:58Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319764",
      "id" : 224319764,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTc2NA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 164,
      "original_position" : 164,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655353,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:39:14Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319785",
      "id" : 224319785,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTc4NQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 181,
      "original_position" : 181,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655387,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319785/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-10-11T05:39:30Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319825",
      "id" : 224319825,
      "line" : 182,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTgyNQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 182,
      "original_position" : 183,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 182,
      "pull_request_review_id" : 163655431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319845"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-10-11T05:39:44Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319845",
      "id" : 224319845,
      "line" : 192,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTg0NQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 192,
      "original_position" : 193,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 192,
      "pull_request_review_id" : 163655461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319898"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:40:09Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319898",
      "id" : 224319898,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTg5OA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 201,
      "original_position" : 203,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655520,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319971"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:40:44Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319971",
      "id" : 224319971,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTk3MQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 222,
      "original_position" : 222,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655603,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319995"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319995"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-10-11T05:40:54Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224319995",
      "id" : 224319995,
      "line" : 222,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMxOTk5NQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 222,
      "original_position" : 223,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 222,
      "pull_request_review_id" : 163655636,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224319995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "An implicit signedness changing conversion takes place here. Avoid or make it explicit :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:41:26Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320065",
      "id" : 224320065,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMyMDA2NQ==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 226,
      "original_position" : 226,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320184"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320184"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The unused parameter `estimator` can be removed?",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:42:24Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap,\n+    CBlockPolicyEstimator& estimator)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320184",
      "id" : 224320184,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMyMDE4NA==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 233,
      "original_position" : 233,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320184/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`tx` here shadows an already existing local variable. Please choose another name :-)",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-10-11T05:42:56Z",
      "diff_hunk" : "@@ -0,0 +1,333 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options\n+{\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData\n+{\n+    TxData(CAmount fee, int size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    int size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const int SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            int64_t feeRate = estimator.estimateSmartFee(target, nullptr /* confTarget */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            int j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<int64_t> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            int64_t feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* feeCalc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : *it;\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    int nonTestTxs = 0;\n+    int unconfirmedTestTxs = 0;\n+    int outlierTestTxs = 0;\n+    int keptTestTxs = 0;\n+    int64_t errsq = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.expectedBlocks == -1) {\n+            ++nonTestTxs;\n+        } else if (entry.second.actualBlocks == -1) {\n+            ++unconfirmedTestTxs;\n+        } else if (entry.second.expectedBlocks == std::numeric_limits<int>::max()) {\n+            ++outlierTestTxs;\n+        } else {\n+            ++keptTestTxs;\n+            int err = entry.second.expectedBlocks - entry.second.actualBlocks;\n+            errsq += err * err;\n+        }\n+    }\n+    printf(\"Non-test txs: %i\\n\", nonTestTxs);\n+    printf(\"Test txs: %i total (%i kept, %i discarded unconfirmed, %i discarded outliers)\\n\",\n+        keptTestTxs + unconfirmedTestTxs + outlierTestTxs, keptTestTxs, unconfirmedTestTxs, outlierTestTxs);\n+    if (keptTestTxs > 0) {\n+        printf(\"Mean squared error: %g\\n\", double(errsq) / double(keptTestTxs));\n+    }\n+}\n+\n+int main(int argc, char** argv)\n+{\n+    Options options = ParseCommandLine(argc, argv);\n+\n+    if (options.help) {\n+        printf(\"%s\", Usage().c_str());\n+        return EXIT_SUCCESS;\n+    } else if (options.error) {\n+        fprintf(stderr, \"Try `fee_est -h` for more information.\\n\");\n+        return EXIT_FAILURE;\n+    } else if (options.dataFileOut.empty() && options.graphFileOut.empty() && !options.cross) {\n+        fprintf(stderr, \"Warning: No output options specified. Try -ograph, -odat, -cross options, or `fee_est -h` \"\n+                        \"for more information.\\n\");\n+    }\n+\n+    CBlockPolicyEstimator estimator;\n+    FeeEstInput input(estimator);\n+\n+    if (!options.dataFileIn.empty() && !input.readData(options.dataFileIn)) {\n+        fprintf(stderr, \"Error: failed to load fee estimate data file '%s'\\n\", options.dataFileOut.c_str());\n+        return 1;\n+    }\n+\n+    const std::vector<unsigned int> targets = estimator.getUniqueTargets();\n+    TxMap txMap;\n+\n+    auto filter = [&](UniValue& value) {\n+        bool keep = true;\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            auto inserted = txMap.emplace(uint256S(tx[\"hash\"].get_str()),\n+                TxData(tx[\"fee\"].get_int64(), tx[\"size\"].get_int(), tx[\"height\"].get_int()));\n+            if (options.cross && !UpdateCross(*inserted.first, targets, estimator)) {\n+                keep = false;\n+            }\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int blockHeight = block[\"height\"].get_int();\n+            const auto& txs = value[\"txs\"].getValues();\n+            for (const UniValue& tx : txs) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r224320246",
      "id" : 224320246,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIyNDMyMDI0Ng==",
      "original_commit_id" : "56446378f5d0c2bdeb7a45fa7382ccd58c9b994c",
      "original_line" : 302,
      "original_position" : 302,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : null,
      "pull_request_review_id" : 163655948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/224320246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-11-05T11:18:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-435839844",
      "id" : 435839844,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQzNTgzOTg0NA==",
      "updated_at" : "2018-11-05T11:18:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/435839844",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r232177743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232177743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could use `std::transform`? :-)",
      "commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "created_at" : "2018-11-09T08:50:00Z",
      "diff_hunk" : "@@ -0,0 +1,330 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            CAmount feeRate = estimator.estimateSmartFee(target, nullptr /* fee_calc */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            size_t j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<CAmount> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r232177743",
      "id" : 232177743,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMjE3Nzc0Mw==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_position" : 190,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 190,
      "pull_request_review_id" : 173317531,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "updated_at" : "2018-11-09T08:50:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/232177743",
      "user" : {
         "avatar_url" : "https://avatars3.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233021806"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233021806"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`printf(â¦)` is it is not used in the rest of the project:\r\n\r\n```\r\n$ git grep \"[^frns]printf\" -- \"*.cpp\" \"*.h\" \":(exclude)src/leveldb/\" \":(exclude)src/secp256k1/\" \":(exclude)src/tinyformat.h\" \":(exclude)src/univalue/\"\r\n$\r\n```",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-11-13T12:44:36Z",
      "diff_hunk" : "@@ -0,0 +1,330 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            CAmount feeRate = estimator.estimateSmartFee(target, nullptr /* fee_calc */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            size_t j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<CAmount> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            CAmount feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* fee_calc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : int(*it);\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap, CBlockPolicyEstimator&)\n+{\n+    int nonTestTxs = 0;\n+    int unconfirmedTestTxs = 0;\n+    int outlierTestTxs = 0;\n+    int keptTestTxs = 0;\n+    int64_t errsq = 0;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.expectedBlocks == -1) {\n+            ++nonTestTxs;\n+        } else if (entry.second.actualBlocks == -1) {\n+            ++unconfirmedTestTxs;\n+        } else if (entry.second.expectedBlocks == std::numeric_limits<int>::max()) {\n+            ++outlierTestTxs;\n+        } else {\n+            ++keptTestTxs;\n+            int err = entry.second.expectedBlocks - entry.second.actualBlocks;\n+            errsq += err * err;\n+        }\n+    }\n+    printf(\"Non-test txs: %i\\n\", nonTestTxs);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233021806",
      "id" : 233021806,
      "line" : 251,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzAyMTgwNg==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_line" : 251,
      "original_position" : 250,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 251,
      "pull_request_review_id" : 174342575,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233021806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022032"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022032"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This `move` is not needed?",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-11-13T12:45:26Z",
      "diff_hunk" : "@@ -0,0 +1,330 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            CAmount feeRate = estimator.estimateSmartFee(target, nullptr /* fee_calc */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            size_t j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<CAmount> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            CAmount feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022032",
      "id" : 233022032,
      "line" : 208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzAyMjAzMg==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_line" : 208,
      "original_position" : 207,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 208,
      "pull_request_review_id" : 174342873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022302"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`move` not needed?",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-11-13T12:46:12Z",
      "diff_hunk" : "@@ -0,0 +1,227 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util/strencodings.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash,\n+    unsigned int height,\n+    CAmount fee,\n+    size_t size,\n+    Block* block,\n+    bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022302",
      "id" : 233022302,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzAyMjMwMg==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_line" : 42,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 174343169,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022302/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022355"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022355"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`move` not needed?",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2018-11-13T12:46:25Z",
      "diff_hunk" : "@@ -0,0 +1,227 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util/strencodings.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash,\n+    unsigned int height,\n+    CAmount fee,\n+    size_t size,\n+    Block* block,\n+    bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r233022355",
      "id" : 233022355,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzMzAyMjM1NQ==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_line" : 39,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 174343244,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022355/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/233022355",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r235334662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235334662"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This `data` shadows the `data` on line 206 above :-)",
      "commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "created_at" : "2018-11-21T10:38:04Z",
      "diff_hunk" : "@@ -0,0 +1,227 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util/strencodings.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+#include <univalue.h>\n+\n+struct FeeEstInput::Block {\n+    UniValue json_txs{UniValue::VARR};\n+    CBlockPolicyEstimator::Block* est_block = nullptr;\n+};\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash,\n+    unsigned int height,\n+    CAmount fee,\n+    size_t size,\n+    Block* block,\n+    bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, block ? block->est_block : nullptr, valid);\n+    if (log) {\n+        UniValue tx(UniValue::VOBJ);\n+        tx.pushKV(\"hash\", hash.ToString());\n+        tx.pushKV(\"height\", int(height));\n+        tx.pushKV(\"fee\", fee);\n+        tx.pushKV(\"size\", uint64_t(size));\n+        if (block) {\n+            block->json_txs.push_back(std::move(tx));\n+        } else {\n+            UniValue value(UniValue::VOBJ);\n+            value.pushKV(\"tx\", std::move(tx));\n+            value.pushKV(\"valid\", UniValue(valid));\n+            value.pushKV(\"time\", GetTime());\n+            *log << value.write() << std::endl;\n+        }\n+    }\n+}\n+\n+void FeeEstInput::processBlock(unsigned int height, const std::function<void(Block&)>& process_txs)\n+{\n+    Block block;\n+    estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+        block.est_block = &est_block;\n+        process_txs(block);\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", int64_t(height));\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", block.json_txs);\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream data(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(data), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log = MakeUnique<std::ofstream>(filename, std::ofstream::out | std::ofstream::app);\n+        if (!*log) {\n+            log.reset();\n+            return false;\n+        }\n+    }\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"start\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    return true;\n+}\n+\n+bool FeeEstInput::readLog(const std::string& filename, const std::function<bool(UniValue&)>& filter)\n+{\n+    std::ifstream file(filename);\n+    if (!file) {\n+        LogPrintf(\"%s: Failed to open log file %s\\n\", __func__, filename);\n+        return false;\n+    }\n+\n+    std::string line;\n+    while (std::getline(file, line)) {\n+        UniValue value;\n+        if (!value.read(line)) {\n+            throw std::runtime_error(\"Failed to parse fee estimate log line.\");\n+        }\n+\n+        if (filter && !filter(value)) {\n+            continue;\n+        }\n+\n+        const UniValue& tx = value[\"tx\"];\n+        if (tx.isObject()) {\n+            estimator.processTx(uint256S(tx[\"hash\"].get_str()), tx[\"height\"].get_int(), tx[\"fee\"].get_int64(),\n+                tx[\"size\"].get_int(), nullptr /* block */, value[\"valid\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& block = value[\"block\"];\n+        if (block.isObject()) {\n+            int height = block[\"height\"].get_int();\n+            estimator.processBlock(height, [&](CBlockPolicyEstimator::Block& est_block) {\n+                const auto& block_txs = value[\"txs\"].getValues();\n+                for (const UniValue& block_tx : block_txs) {\n+                    estimator.processTx(uint256S(block_tx[\"hash\"].get_str()), block_tx[\"height\"].get_int(),\n+                        block_tx[\"fee\"].get_int64(), block_tx[\"size\"].get_int(), &est_block, true /* valid */);\n+                }\n+                return block_txs.size();\n+            });\n+            continue;\n+        }\n+\n+        const UniValue& removeTx = value[\"removeTx\"];\n+        if (removeTx.isObject()) {\n+            estimator.removeTx(uint256S(removeTx[\"hash\"].get_str()), removeTx[\"inBlock\"].get_bool());\n+            continue;\n+        }\n+\n+        const UniValue& flush = value[\"flush\"];\n+        if (flush.isArray()) {\n+            estimator.FlushUnconfirmed();\n+            continue;\n+        }\n+\n+        const UniValue& read = value[\"read\"];\n+        if (read.isStr()) {\n+            std::vector<unsigned char> data = ParseHex(read.get_str());\n+            uint16_t randv = 0;\n+            GetRandBytes((unsigned char*)&randv, sizeof(randv));\n+            fs::path data_filename = strprintf(\"fee_estimates.tmp.%04x\", randv);\n+            CAutoFile(fsbridge::fopen(data_filename, \"wb\"), SER_DISK, CLIENT_VERSION)\n+                .write((const char*)data.data(), data.size());\n+            {\n+                CAutoFile data(fsbridge::fopen(data_filename, \"rb\"), SER_DISK, CLIENT_VERSION);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r235334662",
      "id" : 235334662,
      "line" : 208,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIzNTMzNDY2Mg==",
      "original_commit_id" : "50cd9b1cb7d03a81140d8a59698eba8d06b89612",
      "original_line" : 208,
      "original_position" : 213,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : 208,
      "pull_request_review_id" : 177173780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2020-10-02T13:49:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/235334662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7826565?v=4",
         "events_url" : "https://api.github.com/users/practicalswift/events{/privacy}",
         "followers_url" : "https://api.github.com/users/practicalswift/followers",
         "following_url" : "https://api.github.com/users/practicalswift/following{/other_user}",
         "gists_url" : "https://api.github.com/users/practicalswift/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/practicalswift",
         "id" : 7826565,
         "login" : "practicalswift",
         "node_id" : "MDQ6VXNlcjc4MjY1NjU=",
         "organizations_url" : "https://api.github.com/users/practicalswift/orgs",
         "received_events_url" : "https://api.github.com/users/practicalswift/received_events",
         "repos_url" : "https://api.github.com/users/practicalswift/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/practicalswift/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/practicalswift"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2018-12-24T12:23:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-449727832",
      "id" : 449727832,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ0OTcyNzgzMg==",
      "updated_at" : "2018-12-24T12:23:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/449727832",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 51163cee78f32fb6311bf620266c42fd115ba98f -> 8b9c3da3cf077051d6b1112ba4adbadd60096d57 ([pr/fee.16](https://github.com/ryanofsky/bitcoin/commits/pr/fee.16) -> [pr/fee.17](https://github.com/ryanofsky/bitcoin/commits/pr/fee.17)) due to conflict with #13341\r\nRebased 8b9c3da3cf077051d6b1112ba4adbadd60096d57 -> 4bcecdb666d1dbc90201dccbfee27a234f88c960 ([pr/fee.17](https://github.com/ryanofsky/bitcoin/commits/pr/fee.17) -> [pr/fee.18](https://github.com/ryanofsky/bitcoin/commits/pr/fee.18)) due to conflict with #13786\r\nUpdated 4bcecdb666d1dbc90201dccbfee27a234f88c960 -> aaa4b687c5fdeb2c75246e23077c984a0f133e81 ([pr/fee.18](https://github.com/ryanofsky/bitcoin/commits/pr/fee.18) -> [pr/fee.19](https://github.com/ryanofsky/bitcoin/commits/pr/fee.19)) fixing travis size_t univalue errors\r\nRebased aaa4b687c5fdeb2c75246e23077c984a0f133e81 -> a5faeb1cedd52b2886a1d5c320802874436fe2f6 ([pr/fee.19](https://github.com/ryanofsky/bitcoin/commits/pr/fee.19) -> [pr/fee.20](https://github.com/ryanofsky/bitcoin/commits/pr/fee.20)) to fix broken lint error caused by #13705\r\nUpdated a5faeb1cedd52b2886a1d5c320802874436fe2f6 -> 61ab4c17eebf9b73267c992fb664d603620f9e81 ([pr/fee.20](https://github.com/ryanofsky/bitcoin/commits/pr/fee.20) -> [pr/fee.21](https://github.com/ryanofsky/bitcoin/commits/pr/fee.21)) adding missing lock annotation.\r\nRebased 61ab4c17eebf9b73267c992fb664d603620f9e81 -> a9eb5cc5ceace3e567a0f7ba44c6350b2746436f ([pr/fee.21](https://github.com/ryanofsky/bitcoin/commits/pr/fee.21) -> [pr/fee.22](https://github.com/ryanofsky/bitcoin/commits/pr/fee.22)) due to conflict with #14100\r\nUpdated a9eb5cc5ceace3e567a0f7ba44c6350b2746436f -> 8cd1bb684bfec22fc54e091dc96c782a26847393 ([pr/fee.22](https://github.com/ryanofsky/bitcoin/commits/pr/fee.22) -> [pr/fee.23](https://github.com/ryanofsky/bitcoin/commits/pr/fee.23)) to fix `G_TRANSLATION_FUN` link error after #13961\r\nRebased 8cd1bb684bfec22fc54e091dc96c782a26847393 -> a60d26ac2bceea2c67ef34c8641705b16f656d07 ([pr/fee.23](https://github.com/ryanofsky/bitcoin/commits/pr/fee.23) -> [pr/fee.24](https://github.com/ryanofsky/bitcoin/commits/pr/fee.24)) due to conflict with #13311\r\nUpdated a60d26ac2bceea2c67ef34c8641705b16f656d07 -> 1e7ec287c927437b5a183bc807c49eba4a16d18a ([pr/fee.24](https://github.com/ryanofsky/bitcoin/commits/pr/fee.24) -> [pr/fee.25](https://github.com/ryanofsky/bitcoin/commits/pr/fee.25)) with suggested lint fixes\r\nUpdated 1e7ec287c927437b5a183bc807c49eba4a16d18a -> 56446378f5d0c2bdeb7a45fa7382ccd58c9b994c ([pr/fee.25](https://github.com/ryanofsky/bitcoin/commits/pr/fee.25) -> [pr/fee.26](https://github.com/ryanofsky/bitcoin/commits/pr/fee.26)) with more lint fixes\r\nUpdated 56446378f5d0c2bdeb7a45fa7382ccd58c9b994c -> 8d99281859540689b55285bd0acdf8c1529c4b37 ([pr/fee.26](https://github.com/ryanofsky/bitcoin/commits/pr/fee.26) -> [pr/fee.27](https://github.com/ryanofsky/bitcoin/commits/pr/fee.27)) with more lint fixes\r\nUpdated 8d99281859540689b55285bd0acdf8c1529c4b37 -> 68944a5120c651772fd7f3c028c446e38f9a3f57 ([pr/fee.27](https://github.com/ryanofsky/bitcoin/commits/pr/fee.27) -> [pr/fee.28](https://github.com/ryanofsky/bitcoin/commits/pr/fee.28)) with more lint fixes\r\nRebased 68944a5120c651772fd7f3c028c446e38f9a3f57 -> 50cd9b1cb7d03a81140d8a59698eba8d06b89612 ([pr/fee.28](https://github.com/ryanofsky/bitcoin/commits/pr/fee.28) -> [pr/fee.29](https://github.com/ryanofsky/bitcoin/commits/pr/fee.29)) due to conflict with #14555\r\nRebased 50cd9b1cb7d03a81140d8a59698eba8d06b89612 -> a0148157c57e91b299e6b450c7ee758f606488e6 ([pr/fee.29](https://github.com/ryanofsky/bitcoin/commits/pr/fee.29) -> [pr/fee.30](https://github.com/ryanofsky/bitcoin/commits/pr/fee.30)) due to conflict with #13128\r\nUpdated a0148157c57e91b299e6b450c7ee758f606488e6 -> 6f9c07f0a72ff0d95bfee9f37e4ae3dc9ed9c0e4 ([pr/fee.30](https://github.com/ryanofsky/bitcoin/commits/pr/fee.30) -> [pr/fee.31](https://github.com/ryanofsky/bitcoin/commits/pr/fee.31)) restructuring to work around clang lock annotation errors from #13128\r\nRebased 6f9c07f0a72ff0d95bfee9f37e4ae3dc9ed9c0e4 -> ca993015e0e115540f0ef2710a8f2a81f5fbf0c1 ([pr/fee.31](https://github.com/ryanofsky/bitcoin/commits/pr/fee.31) -> [pr/fee.32](https://github.com/ryanofsky/bitcoin/commits/pr/fee.32)) due to conflict with #14963\r\nRebased ca993015e0e115540f0ef2710a8f2a81f5fbf0c1 -> b197b85a6a1c682070c445c0314d6a645936ba0f ([pr/fee.32](https://github.com/ryanofsky/bitcoin/commits/pr/fee.32) -> [pr/fee.33](https://github.com/ryanofsky/bitcoin/commits/pr/fee.33)) due to conflict with #15043\r\nRebased b197b85a6a1c682070c445c0314d6a645936ba0f -> b5df05ab46d25052c95344e91fc0631b29635f1d ([pr/fee.33](https://github.com/ryanofsky/bitcoin/commits/pr/fee.33) -> [pr/fee.34](https://github.com/ryanofsky/bitcoin/commits/pr/fee.34)) due to conflict with #15295\r\nUpdated b5df05ab46d25052c95344e91fc0631b29635f1d -> 9588e9e81d29227213babe45d37e9bfcd10ab05c ([pr/fee.34](https://github.com/ryanofsky/bitcoin/commits/pr/fee.34) -> [pr/fee.35](https://github.com/ryanofsky/bitcoin/commits/pr/fee.35), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.34..pr/fee.35)) to fix travis link error with #15295\r\nRebased 9588e9e81d29227213babe45d37e9bfcd10ab05c -> e2330472f0ed7466e951d99f1c707d1852289cd1 ([pr/fee.35](https://github.com/ryanofsky/bitcoin/commits/pr/fee.35) -> [pr/fee.36](https://github.com/ryanofsky/bitcoin/commits/pr/fee.36)) due to conflict with #15534\r\nRebased e2330472f0ed7466e951d99f1c707d1852289cd1 -> 28ab62aaaeac6d8f7ce5f3297504b549ca4cea5a ([pr/fee.36](https://github.com/ryanofsky/bitcoin/commits/pr/fee.36) -> [pr/fee.37](https://github.com/ryanofsky/bitcoin/commits/pr/fee.37)) due to conflict with #15638\r\nRebased 28ab62aaaeac6d8f7ce5f3297504b549ca4cea5a -> ccc44e115237b5337869ddb738ecb1af04c52f61 ([pr/fee.37](https://github.com/ryanofsky/bitcoin/commits/pr/fee.37) -> [pr/fee.38](https://github.com/ryanofsky/bitcoin/commits/pr/fee.38)) due to conflict with #15323\r\n",
      "created_at" : "2019-01-07T17:13:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-452008993",
      "id" : 452008993,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1MjAwODk5Mw==",
      "updated_at" : "2019-05-15T15:35:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/452008993",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-01-15T19:31:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-454520828",
      "id" : 454520828,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ1NDUyMDgyOA==",
      "updated_at" : "2019-01-15T19:31:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/454520828",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r264029972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264029972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: this renaming is succinct, yes, but also less communicative.",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2019-03-10T09:19:41Z",
      "diff_hunk" : "@@ -546,11 +545,13 @@ CBlockPolicyEstimator::~CBlockPolicyEstimator()\n {\n }\n \n-void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r264029972",
      "id" : 264029972,
      "line" : 557,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2NDAyOTk3Mg==",
      "original_commit_id" : "e2330472f0ed7466e951d99f1c707d1852289cd1",
      "original_line" : 557,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 33,
      "pull_request_review_id" : 212593904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264029972/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264029972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r264030102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264030102"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: maybe load this from a separate file?",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2019-03-10T09:23:45Z",
      "diff_hunk" : "@@ -0,0 +1,330 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r264030102",
      "id" : 264030102,
      "line" : 94,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2NDAzMDEwMg==",
      "original_commit_id" : "e2330472f0ed7466e951d99f1c707d1852289cd1",
      "original_line" : 94,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 94,
      "pull_request_review_id" : 212594047,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264030102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/264030102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5470?v=4",
         "events_url" : "https://api.github.com/users/Empact/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Empact/followers",
         "following_url" : "https://api.github.com/users/Empact/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Empact/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Empact",
         "id" : 5470,
         "login" : "Empact",
         "node_id" : "MDQ6VXNlcjU0NzA=",
         "organizations_url" : "https://api.github.com/users/Empact/orgs",
         "received_events_url" : "https://api.github.com/users/Empact/received_events",
         "repos_url" : "https://api.github.com/users/Empact/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Empact/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Empact/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Empact"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-04-10T14:22:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-481712088",
      "id" : 481712088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4MTcxMjA4OA==",
      "updated_at" : "2019-04-10T14:22:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/481712088",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-05-01T14:31:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-488298383",
      "id" : 488298383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ4ODI5ODM4Mw==",
      "updated_at" : "2019-05-01T14:31:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/488298383",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK, but it seems the HTML code (or even the conversion to HTML) could live outside the repo?",
      "created_at" : "2019-05-22T21:34:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-494982393",
      "id" : 494982393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDQ5NDk4MjM5Mw==",
      "updated_at" : "2019-05-22T21:34:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/494982393",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This PR has some overlap with @kallewoof's [mff](https://github.com/kallewoof/mff) utility. One difference is that this creates logs in [json-lines](http://jsonlines.org/) format and only logs mempool data needed to run fee estimation code reproducibly, while mff uses a custom format and logs additional information.\r\n\r\n---\r\n\r\nRebased ccc44e115237b5337869ddb738ecb1af04c52f61 -> 6251342fc77cb49e9913aeeb89bf6f3e3234f617 ([`pr/fee.38`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.38) -> [`pr/fee.39`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.39) due to various conflicts\r\nRebased 6251342fc77cb49e9913aeeb89bf6f3e3234f617 -> 23a1edcfaa469022c9e8296559fb0d00417225ec ([pr/fee.39](https://github.com/ryanofsky/bitcoin/commits/pr/fee.39) -> [pr/fee.40](https://github.com/ryanofsky/bitcoin/commits/pr/fee.40)) due to conflict with #16171\r\nRebased 6251342fc77cb49e9913aeeb89bf6f3e3234f617 -> 1b322b073e0ce93f55b9f5678bf50ee1af069c58 ([pr/fee.39](https://github.com/ryanofsky/bitcoin/commits/pr/fee.39) -> [pr/fee.40](https://github.com/ryanofsky/bitcoin/commits/pr/fee.40)) due to conflict with #16171\r\nRebased 1b322b073e0ce93f55b9f5678bf50ee1af069c58 -> 207cf9f8356ab4ceb72b1fd0bbbb66f6e726006b ([pr/fee.40](https://github.com/ryanofsky/bitcoin/commits/pr/fee.40) -> [pr/fee.41](https://github.com/ryanofsky/bitcoin/commits/pr/fee.41)) due to conflicts with #14193 and #16291\r\nRebased 207cf9f8356ab4ceb72b1fd0bbbb66f6e726006b -> a1c3573115b25a6b702a1b56e5813a80281f9d7d ([pr/fee.41](https://github.com/ryanofsky/bitcoin/commits/pr/fee.41) -> [pr/fee.42](https://github.com/ryanofsky/bitcoin/commits/pr/fee.42)) due to conflict with #16362\r\nRebased a1c3573115b25a6b702a1b56e5813a80281f9d7d -> 73b1eaca4edecae3dcde6fcf57b3832fb84a8d10 ([pr/fee.42](https://github.com/ryanofsky/bitcoin/commits/pr/fee.42) -> [pr/fee.43](https://github.com/ryanofsky/bitcoin/commits/pr/fee.43))\r\nRebased 73b1eaca4edecae3dcde6fcf57b3832fb84a8d10 -> aa41b10397895687dcdafad40fd9ac1934796425 ([`pr/fee.43`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.43) -> [`pr/fee.44`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.44)) due to conflict with #15921\r\nRebased aa41b10397895687dcdafad40fd9ac1934796425 -> f00110e8b6836ef384c0dbbd3ec693d5b97c21bb ([`pr/fee.44`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.44) -> [`pr/fee.45`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.45)) due to minor conflict with #17050\r\nRebased f00110e8b6836ef384c0dbbd3ec693d5b97c21bb -> 03bcb1190e4e6673414a3ae9dfca1112ab14b305 ([`pr/fee.45`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.45) -> [`pr/fee.46`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.46)) due to conflicts with #17851 and #16688\r\nRebased 03bcb1190e4e6673414a3ae9dfca1112ab14b305 -> 35af64c93097ca65e5d0e8ef76b0326fdc1561cf ([`pr/fee.46`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.46) -> [`pr/fee.47`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.47)) due to conflict with #17891\r\nRebased 35af64c93097ca65e5d0e8ef76b0326fdc1561cf -> 6597699b2215d5aef8633c973b0e4f4fddcf230b ([`pr/fee.47`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.47) -> [`pr/fee.48`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.48)) due to conflict with #17261\r\nRebased 6597699b2215d5aef8633c973b0e4f4fddcf230b -> 8392f77f047c1bc11e0475ef5fbf624f7f3f9488 ([`pr/fee.48`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.48) -> [`pr/fee.49`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.49)) due to conflict with #17925\r\nRebased 8392f77f047c1bc11e0475ef5fbf624f7f3f9488 -> b5adc1b2819d88f5e2ed67dd98c9f5c091e99101 ([`pr/fee.49`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.49) -> [`pr/fee.50`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.50), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.49-rebase..pr/fee.50)) due to conflict with #18126\r\nRebased b5adc1b2819d88f5e2ed67dd98c9f5c091e99101 -> b698b5dbaa87cba45f867141a97b010813d86160 ([`pr/fee.50`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.50) -> [`pr/fee.51`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.51), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.50-rebase..pr/fee.51)) due to conflict with #18134\r\nRebased b698b5dbaa87cba45f867141a97b010813d86160 -> 47164d0ef2d2625c3c47e49659e6f1833c472700 ([`pr/fee.51`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.51) -> [`pr/fee.52`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.52), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.51-rebase..pr/fee.52)) due to conflict with #18673\r\nRebased 47164d0ef2d2625c3c47e49659e6f1833c472700 -> 5123ff1f22b38162e42529b2f1484bb980c7834c ([`pr/fee.52`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.52) -> [`pr/fee.53`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.53), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.52-rebase..pr/fee.53)) to due conflicts with #18698 and #18922\r\nUpdated 5123ff1f22b38162e42529b2f1484bb980c7834c -> 854a21ddb8007cdea471befd25cb401f7f4f96e4 ([`pr/fee.53`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.53) -> [`pr/fee.54`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.54), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.53..pr/fee.54)) fixing travis fuzzer build\r\nUpdated 854a21ddb8007cdea471befd25cb401f7f4f96e4 -> e635c970bd0a6b8bfe7f923e96fd17186d623843 ([`pr/fee.54`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.54) -> [`pr/fee.55`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.55), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.54..pr/fee.55)) fixing travis fuzzer assert https://travis-ci.org/github/bitcoin/bitcoin/jobs/691844334#L3561\r\nUpdated e635c970bd0a6b8bfe7f923e96fd17186d623843 -> 009c76da19c271a552ec88ba17009a30e1a3141b ([`pr/fee.55`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.55) -> [`pr/fee.56`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.56), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.55..pr/fee.56)) fixing travis fuzzer assert https://travis-ci.org/github/bitcoin/bitcoin/jobs/694860650#L3536\r\nRebased 009c76da19c271a552ec88ba17009a30e1a3141b -> 3f92adfecc9dc3b11e620b421ea4084ff9fcd280 ([`pr/fee.56`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.56) -> [`pr/fee.57`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.57), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.56-rebase..pr/fee.57)) to work around travis arm timeouts \"sudo: unable to resolve host travis-job-bitcoin-bitcoin-694879056\" https://travis-ci.org/github/bitcoin/bitcoin/jobs/694879056\r\nRebased 3f92adfecc9dc3b11e620b421ea4084ff9fcd280 -> 110245a8dbd11d31d9e52c7c17dc8795743617f8 ([`pr/fee.57`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.57) -> [`pr/fee.58`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.58), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.57-rebase..pr/fee.58)) due to conflict with #19561\r\nRebased 110245a8dbd11d31d9e52c7c17dc8795743617f8 -> 00d514a60820d7c3be4fa0e5433aefabd594d237 ([`pr/fee.58`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.58) -> [`pr/fee.59`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.59), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.58-rebase..pr/fee.59)) due to conflict with #19556\r\nRebased 00d514a60820d7c3be4fa0e5433aefabd594d237 -> 2c512ff0729f89aa47019009534d3958ec18f42b ([`pr/fee.59`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.59) -> [`pr/fee.60`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.60), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.59-rebase..pr/fee.60)) due to conflict with #20003",
      "created_at" : "2019-06-08T12:48:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-500121675",
      "id" : 500121675,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUwMDEyMTY3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-10-02T13:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/500121675",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-07-24T18:17:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-514742892",
      "id" : 514742892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNDc0Mjg5Mg==",
      "updated_at" : "2019-07-24T18:17:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/514742892",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-08-02T16:27:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-517763980",
      "id" : 517763980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDUxNzc2Mzk4MA==",
      "updated_at" : "2019-08-02T16:27:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/517763980",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-10-30T16:21:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-547990247",
      "id" : 547990247,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU0Nzk5MDI0Nw==",
      "updated_at" : "2019-10-30T16:21:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/547990247",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2019-12-11T19:49:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-564704329",
      "id" : 564704329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU2NDcwNDMyOQ==",
      "updated_at" : "2019-12-11T19:49:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/564704329",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-03T22:10:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-570713463",
      "id" : 570713463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3MDcxMzQ2Mw==",
      "updated_at" : "2020-01-03T22:10:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570713463",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-15T06:05:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-574510521",
      "id" : 574510521,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU3NDUxMDUyMQ==",
      "updated_at" : "2020-01-15T06:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/574510521",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-01-30T06:09:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-580098700",
      "id" : 580098700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MDA5ODcwMA==",
      "updated_at" : "2020-01-30T06:09:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/580098700",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->Needs rebase",
      "created_at" : "2020-02-03T11:54:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-581379026",
      "id" : 581379026,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDU4MTM3OTAyNg==",
      "updated_at" : "2020-02-03T11:54:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581379026",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-03-25T19:48:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-604049598",
      "id" : 604049598,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYwNDA0OTU5OA==",
      "updated_at" : "2020-03-25T19:48:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604049598",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-04-17T15:19:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-615304009",
      "id" : 615304009,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYxNTMwNDAwOQ==",
      "updated_at" : "2020-04-17T15:19:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/615304009",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).",
      "created_at" : "2020-05-23T12:07:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-633039019",
      "id" : 633039019,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDYzMzAzOTAxOQ==",
      "updated_at" : "2020-05-23T12:07:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/633039019",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-07-30T16:28:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-666507294",
      "id" : 666507294,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY2NjUwNzI5NA==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-07-30T16:28:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/666507294",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-07T09:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-688190376",
      "id" : 688190376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDY4ODE5MDM3Ng==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-07T09:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688190376",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-09-29T14:16:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-700735313",
      "id" : 700735313,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDcwMDczNTMxMw==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-09-29T14:16:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700735313",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2020-12-01T09:45:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-736359841",
      "id" : 736359841,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNjM1OTg0MQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-01T09:45:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736359841",
      "user" : {
         "avatar_url" : "https://avatars2.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Discovered this PR thanks to DrahtBot's \"needs rebase\" notifications.\r\n\r\nConcept ACK, interesting idea for dev tooling in the tests or contrib.",
      "created_at" : "2020-12-02T10:41:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-737147179",
      "id" : 737147179,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDczNzE0NzE3OQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2020-12-02T10:41:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/737147179",
      "user" : {
         "avatar_url" : "https://avatars1.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r592827395"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592827395"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Please [use `std::make_unique` in new code](https://github.com/bitcoin/bitcoin/blob/master/src/util/memory.h#L13).",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2021-03-12T00:32:22Z",
      "diff_hunk" : "@@ -0,0 +1,222 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees_input.h>\n+\n+#include <chainparams.h>\n+#include <clientversion.h>\n+#include <policy/fees.h>\n+#include <streams.h>\n+#include <util/strencodings.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+\n+#include <univalue.h>\n+\n+namespace {\n+UniValue TxLog(const uint256& hash, unsigned int height, CAmount fee, size_t size)\n+{\n+    UniValue tx(UniValue::VOBJ);\n+    tx.pushKV(\"hash\", hash.ToString());\n+    tx.pushKV(\"height\", int(height));\n+    tx.pushKV(\"fee\", fee);\n+    tx.pushKV(\"size\", uint64_t(size));\n+    return tx;\n+}\n+} // namespace\n+\n+FeeEstInput::FeeEstInput(CBlockPolicyEstimator& estimator) : estimator(estimator) {}\n+\n+void FeeEstInput::processTx(const uint256& hash, unsigned int height, CAmount fee, size_t size, bool valid)\n+{\n+    estimator.processTx(hash, height, fee, size, valid);\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"tx\", TxLog(hash, height, fee, size));\n+        value.pushKV(\"valid\", UniValue(valid));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::processBlock(unsigned int block_height, const AddTxsFn& add_txs)\n+{\n+    UniValue json_txs{UniValue::VARR};\n+    estimator.processBlock(block_height, [&](const AddTxFn& add_tx) {\n+        add_txs([&](const uint256& hash, unsigned int height, CAmount fee, size_t size) {\n+            add_tx(hash, height, fee, size);\n+            if (log) json_txs.push_back(TxLog(hash, height, fee, size));\n+        });\n+    });\n+    if (log) {\n+        UniValue json(UniValue::VOBJ);\n+        UniValue json_block(UniValue::VOBJ);\n+        json_block.pushKV(\"height\", int64_t(block_height));\n+        json.pushKV(\"block\", json_block);\n+        json.pushKV(\"txs\", std::move(json_txs));\n+        json.pushKV(\"time\", GetTime());\n+        *log << json.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::removeTx(const uint256& hash, bool in_block)\n+{\n+    estimator.removeTx(hash, in_block);\n+\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue removeTx(UniValue::VOBJ);\n+        removeTx.pushKV(\"hash\", hash.ToString());\n+        removeTx.pushKV(\"inBlock\", UniValue(in_block));\n+        value.pushKV(\"removeTx\", removeTx);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+void FeeEstInput::flushUnconfirmed()\n+{\n+    estimator.FlushUnconfirmed();\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        UniValue flush(UniValue::VARR);\n+        value.pushKV(\"flush\", flush);\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+}\n+\n+bool FeeEstInput::writeData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"wb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"%s: Failed to write fee estimates to %s\\n\", __func__, filename.string());\n+        return false;\n+    }\n+    estimator.Write(file);\n+    return true;\n+}\n+\n+bool FeeEstInput::readData(const fs::path& filename)\n+{\n+    CAutoFile file(fsbridge::fopen(filename, \"rb\"), SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull() || !estimator.Read(file)) {\n+        return false;\n+    }\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        std::ifstream data(filename.string(), std::ifstream::binary);\n+        value.pushKV(\n+            \"read\", HexStr(std::string(std::istreambuf_iterator<char>(data), std::istreambuf_iterator<char>())));\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+    return true;\n+}\n+\n+bool FeeEstInput::writeLog(const std::string& filename)\n+{\n+    if (log) {\n+        UniValue value(UniValue::VOBJ);\n+        value.pushKV(\"stop\", Params().NetworkIDString());\n+        value.pushKV(\"time\", GetTime());\n+        *log << value.write() << std::endl;\n+    }\n+\n+    if (filename.empty()) {\n+        log.reset();\n+    } else {\n+        log = MakeUnique<std::ofstream>(filename, std::ofstream::out | std::ofstream::app);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r592827395",
      "id" : 592827395,
      "line" : null,
      "node_id" : "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjgyNzM5NQ==",
      "original_commit_id" : "2c512ff0729f89aa47019009534d3958ec18f42b",
      "original_line" : 130,
      "original_position" : 130,
      "original_start_line" : null,
      "path" : "src/policy/fees_input.cpp",
      "position" : null,
      "pull_request_review_id" : 610356728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592827395/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2021-04-13T16:29:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/592827395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 2c512ff0729f89aa47019009534d3958ec18f42b -> de8a2d80f74d33067a3b532368cca877fc65e7d2 ([`pr/fee.60`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.60) -> [`pr/fee.61`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.61), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.60-rebase..pr/fee.61)) due to conflicts with #18766\r\nUpdated de8a2d80f74d33067a3b532368cca877fc65e7d2 -> 4b1c4957a59f68f1c501e1fc5e0fea4a58b14525 ([`pr/fee.61`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.61) -> [`pr/fee.62`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.62), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.61..pr/fee.62)) due to std::filesystem compile error https://cirrus-ci.com/task/4871270773817344?command=ci#L8556 and https://ci.appveyor.com/project/DrahtBot/bitcoin/builds/38354674\r\nRebased 4b1c4957a59f68f1c501e1fc5e0fea4a58b14525 -> e793f63c336be2eb0c8c82e31c7ddc05600f9a3d ([`pr/fee.62`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.62) -> [`pr/fee.63`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.63), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.62-rebase..pr/fee.63)) due to conflict with #21575\r\nRebased e793f63c336be2eb0c8c82e31c7ddc05600f9a3d -> 941fabf8da5031d7405e5d69a607552ae3273fdf ([`pr/fee.63`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.63) -> [`pr/fee.64`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.64), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.63-rebase..pr/fee.64)) due to conflicts with #21732, #22003, #21850\r\nRebased 941fabf8da5031d7405e5d69a607552ae3273fdf -> de097a24fa9364aa2230dd3cb5ceac3677cb4d2a ([`pr/fee.64`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.64) -> [`pr/fee.65`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.65), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.64-rebase..pr/fee.65)) due to conflict #21966 with attempted fixes for fuzz UndefinedBehaviorSanitizer implicit-unsigned-integer-truncation error https://cirrus-ci.com/task/5690421675294720\r\nRebased de097a24fa9364aa2230dd3cb5ceac3677cb4d2a -> 50ce90cedb6480446e8d1970b2c138d95b2410af ([`pr/fee.65`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.65) -> [`pr/fee.66`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.66), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.65-rebase..pr/fee.66)) due to conflict with #20833\r\nRebased 50ce90cedb6480446e8d1970b2c138d95b2410af -> f51bb257abe46226a84a9a6dd01a362f06187f9e ([`pr/fee.66`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.66) -> [`pr/fee.67`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.67), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.66-rebase..pr/fee.67)) due to conflict with #22084\r\nRebased f51bb257abe46226a84a9a6dd01a362f06187f9e -> 233c1b2776e33d0c0657f06aca33b39880a20f4e ([`pr/fee.67`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.67) -> [`pr/fee.68`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.68), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.67-rebase..pr/fee.68)) due to conflict with #22796\r\nRebased 233c1b2776e33d0c0657f06aca33b39880a20f4e -> 3c5c30fcb1bac408f34604c81bf392ae7efcf787 ([`pr/fee.68`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.68) -> [`pr/fee.69`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.69), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.68-rebase..pr/fee.69)) due to conflicts with #23044, #22976, #22951\r\nRebased 3c5c30fcb1bac408f34604c81bf392ae7efcf787 -> 84f5df64005de6b6c0f651f2f6b0e470737fed4e ([`pr/fee.69`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.69) -> [`pr/fee.70`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.70), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.69-rebase..pr/fee.70)) due to conflicts with #22937 and #22766\r\nvarious others\r\nRebased 84f5df64005de6b6c0f651f2f6b0e470737fed4e -> 1e8d0d3852d6cb83ce60c50d94f565dc9093eae7 ([`pr/fee.70`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.70) -> [`pr/fee.71`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.71), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.70-rebase..pr/fee.71)) due to conflicts with #25290 and various others\r\nRebased 1e8d0d3852d6cb83ce60c50d94f565dc9093eae7 -> 950f76289a1344c12fd3d3460a0688d0ead44607 ([`pr/fee.71`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.71) -> [`pr/fee.72`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.72), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.71-rebase..pr/fee.72)) due to conflict with #25667\r\nUpdated 950f76289a1344c12fd3d3460a0688d0ead44607 -> 538c780d078ecf400eb7b509f9fbcd176cdd290c ([`pr/fee.72`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.72) -> [`pr/fee.73`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.73), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.72..pr/fee.73)) to fix lint error https://cirrus-ci.com/task/6497917761486848?logs=lint#L1474\r\nUpdated 538c780d078ecf400eb7b509f9fbcd176cdd290c -> d1f1faa851d25685fb264c4a83669161632719c6 ([`pr/fee.73`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.73) -> [`pr/fee.74`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.74), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.73..pr/fee.74)) to fix test failure https://cirrus-ci.com/task/4838035710803968\r\nRebased d1f1faa851d25685fb264c4a83669161632719c6 -> 1288ad00a5215cfa0e303e7ce765c049d603adc8 ([`pr/fee.74`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.74) -> [`pr/fee.75`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.75), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.74-rebase..pr/fee.75)) due to conflict with #26286\r\nRebased 1288ad00a5215cfa0e303e7ce765c049d603adc8 -> 6e28e72462a9ebcb4ca9daa3412d15b451cba018 ([`pr/fee.75`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.75) -> [`pr/fee.76`](https://github.com/ryanofsky/bitcoin/commits/pr/fee.76), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/fee.75-rebase..pr/fee.76)) due to conflicts with #26705 and #27036\r\n",
      "created_at" : "2021-03-23T04:55:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-804616485",
      "id" : 804616485,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgwNDYxNjQ4NQ==",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804616485/reactions"
      },
      "updated_at" : "2023-02-13T18:04:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/804616485",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-04-13T14:26:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-818779575",
      "id" : 818779575,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDgxODc3OTU3NQ==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-04-13T14:26:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818779575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-26T09:57:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-848637552",
      "id" : 848637552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0ODYzNzU1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-26T09:57:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/848637552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-05-27T21:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-849956152",
      "id" : 849956152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "MDEyOklzc3VlQ29tbWVudDg0OTk1NjE1Mg==",
      "performed_via_github_app" : null,
      "updated_at" : "2021-05-27T21:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/849956152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-08-31T14:44:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-909304560",
      "id" : 909304560,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII5842MuLw",
      "performed_via_github_app" : null,
      "updated_at" : "2021-08-31T14:44:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/909304560",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-09-22T13:50:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-924950696",
      "id" : 924950696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII5843IaCo",
      "performed_via_github_app" : null,
      "updated_at" : "2021-09-22T13:50:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/924950696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-10-15T09:41:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-944152568",
      "id" : 944152568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII5844Rp_4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944152568/reactions"
      },
      "updated_at" : "2021-10-15T09:41:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/944152568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2021-12-01T18:41:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-983949408",
      "id" : 983949408,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII5846peBg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983949408/reactions"
      },
      "updated_at" : "2021-12-01T18:41:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/983949408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\nCI is failing though.",
      "created_at" : "2022-10-17T09:19:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1280546856",
      "id" : 1280546856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585MU5go",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1280546856/reactions"
      },
      "updated_at" : "2022-10-17T09:19:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1280546856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996874699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874699"
         }
      },
      "author_association" : "MEMBER",
      "body" : "538c780d078ecf400eb7b509f9fbcd176cdd290c\r\n```suggestion\r\n    const CBlockPolicyEstimator& estimator)\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2022-10-17T10:11:57Z",
      "diff_hunk" : "@@ -0,0 +1,331 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996874699",
      "id" : 996874699,
      "line" : 151,
      "node_id" : "PRRC_kwDOABII5847axnL",
      "original_commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "original_line" : 151,
      "original_position" : 151,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 151,
      "pull_request_review_id" : 1143887240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874699/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T10:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996874793"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874793"
         }
      },
      "author_association" : "MEMBER",
      "body" : "55016bfa39f496c08ea0c18260a3b6abbdb23550\r\nnit: use class initialization",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2022-10-17T10:12:04Z",
      "diff_hunk" : "@@ -527,8 +526,8 @@ bool CBlockPolicyEstimator::_removeTx(const uint256& hash, bool inBlock)\n     }\n }\n \n-CBlockPolicyEstimator::CBlockPolicyEstimator(const fs::path& estimation_filepath)\n-    : m_estimation_filepath{estimation_filepath}, nBestSeenHeight{0}, firstRecordedHeight{0}, historicalFirst{0}, historicalBest{0}, trackedTxs{0}, untrackedTxs{0}\n+CBlockPolicyEstimator::CBlockPolicyEstimator()\n+    : nBestSeenHeight{0}, firstRecordedHeight{0}, historicalFirst{0}, historicalBest{0}, trackedTxs{0}, untrackedTxs{0}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996874793",
      "id" : 996874793,
      "line" : 530,
      "node_id" : "PRRC_kwDOABII5847axop",
      "original_commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "original_line" : 530,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/policy/fees.cpp",
      "position" : 15,
      "pull_request_review_id" : 1143887240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874793/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T10:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996874793",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996879886"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996879886"
         }
      },
      "author_association" : "MEMBER",
      "body" : "538c780d078ecf400eb7b509f9fbcd176cdd290c\r\n```suggestion\r\nvoid PrintCross(const TxMap& txMap)\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2022-10-17T10:17:20Z",
      "diff_hunk" : "@@ -0,0 +1,331 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            CAmount feeRate = estimator.estimateSmartFee(target, nullptr /* fee_calc */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            size_t j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<CAmount> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            CAmount feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)\n+{\n+    if (*tx.first.begin() == 0) {\n+        auto it = std::lower_bound(targets.begin(), targets.end(), nullptr, [&](unsigned int target, std::nullptr_t) {\n+            CAmount estFee = estimator.estimateSmartFee(target, nullptr /* fee_calc */, false /* conservative */)\n+                                 .GetFee(tx.second.size);\n+            return estFee <= 1 || tx.second.fee < estFee;\n+        });\n+        tx.second.expectedBlocks = it == targets.end() ? std::numeric_limits<int>::max() : int(*it);\n+        return false;\n+    }\n+    return true;\n+}\n+\n+void PrintCross(const TxMap& txMap, CBlockPolicyEstimator&)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996879886",
      "id" : 996879886,
      "line" : 231,
      "node_id" : "PRRC_kwDOABII5847ay4O",
      "original_commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "original_line" : 231,
      "original_position" : 231,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 231,
      "pull_request_review_id" : 1143887240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996879886/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T10:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996879886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996886059"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996886059"
         }
      },
      "author_association" : "MEMBER",
      "body" : "538c780d078ecf400eb7b509f9fbcd176cdd290c\r\n```suggestion\r\nbool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, const CBlockPolicyEstimator& estimator)\r\n```",
      "commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "created_at" : "2022-10-17T10:24:04Z",
      "diff_hunk" : "@@ -0,0 +1,331 @@\n+// Copyright (c) 2018 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <policy/fees.h>\n+#include <policy/fees_input.h>\n+#include <util/system.h>\n+#include <util/translation.h>\n+\n+#include <univalue.h>\n+\n+#include <fstream>\n+#include <random>\n+#include <stdio.h>\n+\n+const std::function<std::string(const char*)> G_TRANSLATION_FUN = nullptr;\n+\n+std::string Usage()\n+{\n+    std::string usage = \"Usage: fee_est [options] <estlog.txt>\\n\";\n+    usage += HelpMessageGroup(\"Options:\");\n+    usage += HelpMessageOpt(\"-?, -help\", \"This help message\");\n+    usage += HelpMessageOpt(\"-ograph=<graph.html>\", \"Generate target vs feerate graph output after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-odat=<fee_estimates.dat>\", \"Save fee estimator state after after replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-idat=<fee_estimates.dat>\", \"Load fee estimator state after before replaying transaction log.\");\n+    usage += HelpMessageOpt(\"-dat=<fee_estimates.dat>\", \"Shortcut for -idat=<fee_estimates.dat> -odat=<fee_estimates.dat>\");\n+    usage += HelpMessageOpt(\"-cross\", \"Treat half the transactions from the log as test data and print cross-validation statistics.\");\n+    return usage;\n+}\n+\n+struct Options {\n+    std::string logFileIn;\n+    std::string dataFileIn;\n+    std::string dataFileOut;\n+    std::string graphFileOut;\n+    bool cross = false;\n+    bool help = false;\n+    bool error = false;\n+};\n+\n+Options ParseCommandLine(int argc, char** argv)\n+{\n+    auto match = [&](const char* arg, const char* name, const char** value = nullptr) {\n+        if (arg[0] != '-') return false;\n+        size_t n = strlen(name);\n+        if (strncmp(arg + 1, name, n) != 0) return false;\n+        if (value) return (*value = arg[n + 1] == '=' ? arg + n + 2 : nullptr) != nullptr;\n+        return arg[n + 1] == '\\0';\n+    };\n+\n+    Options options;\n+    for (int i = 1; i < argc; ++i) {\n+        const char* arg = argv[i];\n+        const char* value;\n+        if (match(arg, \"ograph\", &value)) {\n+            options.graphFileOut = value;\n+        } else if (match(arg, \"odat\", &value)) {\n+            options.dataFileOut = value;\n+        } else if (match(arg, \"idat\", &value)) {\n+            options.dataFileIn = value;\n+        } else if (match(arg, \"dat\", &value)) {\n+            options.dataFileIn = options.dataFileOut = value;\n+        } else if (match(arg, \"cross\")) {\n+            options.cross = true;\n+        } else if (match(arg, \"help\") || match(arg, \"h\") || match(arg, \"?\")) {\n+            options.help = true;\n+        } else if (arg[0] != '-' && options.logFileIn.empty()) {\n+            options.logFileIn = arg;\n+        } else {\n+            fprintf(stderr, \"Error: unexpected argument: '%s'\\n\", arg);\n+            options.error = true;\n+        }\n+    }\n+\n+    if (options.logFileIn.empty() && !options.help) {\n+        fprintf(stderr, \"Error: missing required log file argument.\\n\");\n+        options.error = true;\n+    }\n+\n+    return options;\n+}\n+\n+struct TxData {\n+    TxData(CAmount fee, size_t size, int height) : fee(fee), size(size), height(height) {}\n+    CAmount fee;\n+    size_t size;\n+    int height;\n+    int expectedBlocks = -1;\n+    int actualBlocks = -1;\n+};\n+\n+using TxMap = std::map<uint256, TxData>;\n+\n+const char* const GRAPH_HTML = R\"(<!DOCTYPE html>\n+<meta charset=\"utf-8\">\n+<title>Fee Graph</title>\n+<script src=\"https://d3js.org/d3.v3.min.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js\"></script>\n+<style media=\"screen\">\n+.vega-actions a {\n+    margin-right: 5px;\n+}\n+</style>\n+<div id=vis></div>\n+<script>\n+var spec = {\n+  \"$schema\": \"https://vega.github.io/schema/vega-lite/v2.json\",\n+  \"width\": 800,\n+  \"height\": 600,\n+  \"layer\": [\n+    {\n+        \"data\": {\n+            \"values\": %s\n+        },\n+        \"mark\": \"tick\",\n+        \"encoding\": {\n+            \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+            \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+            \"color\": {\"field\": \"height\", \"type\": \"quantitative\"}\n+        }\n+    },\n+    {\n+      \"data\": {\n+        \"values\": %s\n+      },\n+      \"encoding\": {\n+        \"x\": {\"field\": \"blocks\", \"type\": \"quantitative\"},\n+        \"y\": {\"field\": \"feeRate\", \"type\": \"quantitative\"},\n+        \"color\": {\"field\": \"mode\", \"type\": \"nominal\"}\n+      },\n+      \"mark\": \"line\",\n+    }\n+  ]\n+}\n+vega.embed(\"#vis\", spec);\n+</script>\n+)\";\n+\n+// Maximum number of randomly sampled transactions to show on graph.\n+const size_t SAMPLE_TXS = 50000;\n+\n+// Drop 1/20th of sampled transactions with highest feerates if they are\n+// outliers that would change the scale of the graph.\n+const int DROP_FRAC = 20;\n+\n+void WriteGraph(const std::string& filename,\n+    const TxMap& txMap,\n+    const std::vector<unsigned int>& targets,\n+    CBlockPolicyEstimator& estimator)\n+{\n+    UniValue fees(UniValue::VARR);\n+\n+    int64_t maxFeeRate = 0;\n+    const unsigned int maxTarget = estimator.getMaxTarget();\n+    for (bool conservative : {false, true}) {\n+        for (unsigned int target : targets) {\n+            if (target > maxTarget) continue;\n+            UniValue fee(UniValue::VOBJ);\n+            fee.pushKV(\"mode\", conservative ? \"conservative\" : \"default\");\n+            fee.pushKV(\"blocks\", int(target));\n+            CAmount feeRate = estimator.estimateSmartFee(target, nullptr /* fee_calc */, conservative).GetFeePerK();\n+            fee.pushKV(\"feeRate\", feeRate);\n+            fees.push_back(fee);\n+            maxFeeRate = std::max(maxFeeRate, feeRate);\n+        }\n+    }\n+\n+    std::vector<const TxMap::value_type*> sample;\n+    sample.reserve(SAMPLE_TXS);\n+    int i = 0;\n+    std::minstd_rand randint;\n+    for (const auto& entry : txMap) {\n+        if (entry.second.actualBlocks > int(maxTarget)) {\n+            continue;\n+        } else if (sample.size() < SAMPLE_TXS) {\n+            sample.emplace_back(&entry);\n+        } else {\n+            size_t j = randint() % i;\n+            if (j < SAMPLE_TXS) {\n+                sample[j] = &entry;\n+            }\n+        }\n+        ++i;\n+    }\n+\n+    if (!sample.empty()) {\n+        std::vector<CAmount> feeRates;\n+        feeRates.reserve(sample.size());\n+        for (const auto& entry : sample) {\n+            feeRates.emplace_back(CFeeRate(entry->second.fee, entry->second.size).GetFeePerK());\n+        }\n+        auto nth = feeRates.begin() + sample.size() / DROP_FRAC;\n+        std::nth_element(feeRates.begin(), nth, feeRates.end(), std::greater<int64_t>());\n+        maxFeeRate = std::max(maxFeeRate, *nth);\n+    }\n+\n+    UniValue txs(UniValue::VARR);\n+    for (const auto& entry : sample) {\n+        if (entry->second.actualBlocks > 0) {\n+            CAmount feeRate = CFeeRate(entry->second.fee, entry->second.size).GetFeePerK();\n+            if (feeRate <= maxFeeRate) {\n+                UniValue tx(UniValue::VOBJ);\n+                tx.pushKV(\"feeRate\", feeRate);\n+                tx.pushKV(\"blocks\", entry->second.actualBlocks);\n+                tx.pushKV(\"height\", entry->second.height);\n+                txs.push_back(std::move(tx));\n+            }\n+        }\n+    }\n+\n+    std::ofstream file(filename);\n+    file << strprintf(GRAPH_HTML, txs.write(), fees.write());\n+}\n+\n+bool UpdateCross(TxMap::value_type& tx, const std::vector<unsigned int>& targets, CBlockPolicyEstimator& estimator)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#discussion_r996886059",
      "id" : 996886059,
      "line" : 217,
      "node_id" : "PRRC_kwDOABII5847a0Yr",
      "original_commit_id" : "538c780d078ecf400eb7b509f9fbcd176cdd290c",
      "original_line" : 217,
      "original_position" : 217,
      "original_start_line" : null,
      "path" : "src/test/fee_est/fee_est.cpp",
      "position" : 217,
      "pull_request_review_id" : 1143887240,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/10443",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996886059/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-10-17T10:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996886059",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22493292?v=4",
         "events_url" : "https://api.github.com/users/aureleoules/events{/privacy}",
         "followers_url" : "https://api.github.com/users/aureleoules/followers",
         "following_url" : "https://api.github.com/users/aureleoules/following{/other_user}",
         "gists_url" : "https://api.github.com/users/aureleoules/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/aureleoules",
         "id" : 22493292,
         "login" : "aureleoules",
         "node_id" : "MDQ6VXNlcjIyNDkzMjky",
         "organizations_url" : "https://api.github.com/users/aureleoules/orgs",
         "received_events_url" : "https://api.github.com/users/aureleoules/received_events",
         "repos_url" : "https://api.github.com/users/aureleoules/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/aureleoules/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/aureleoules/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/aureleoules"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "created_at" : "2022-10-19T09:32:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1283709623",
      "id" : 1283709623,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585Mg9q3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283709623/reactions"
      },
      "updated_at" : "2022-10-19T09:32:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283709623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-01-17T01:38:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1384731695",
      "id" : 1384731695,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585SiVQv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384731695/reactions"
      },
      "updated_at" : "2023-01-17T01:38:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1384731695",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-01T11:40:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1411919969",
      "id" : 1411919969,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585UKDBh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411919969/reactions"
      },
      "updated_at" : "2023-02-01T11:40:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1411919969",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-21T10:43:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1517635807",
      "id" : 1517635807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585adUjf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517635807/reactions"
      },
      "updated_at" : "2023-04-21T10:43:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1517635807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Haven't dug into the code, but I'm leaning toward Concept ACK, Approach NACK\r\n\r\nAs someone who is planning to do fee estimation research in the near future, I don't think I'd use something like this the way it's currently written. I would much prefer something that logs Bitcoin Core's live _fee rate_ estimations, or some option that would allow me to tell Bitcoin Core it's at a certain chain height, feed it some mempool data, and then ask it for fee estimations.\r\n\r\nI also agree that the tool for analyzing the data shouldn't be in this repo. Much better if we can figure out what data is missing for people who want to do fee estimation analysis and provide an option for logging that data.\r\n\r\nPerhaps a good next step would be to talk to people who are currently doing fee estimation work and see what data would help with their projects/PRs? @ClaraShk @darosior @Xekyo ?\r\n",
      "created_at" : "2023-05-01T13:03:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1529690116",
      "id" : 1529690116,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585bLTgE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529690116/reactions"
      },
      "updated_at" : "2023-05-01T13:03:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529690116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@josibake thanks for looking at this. I don't think I understand what the idea behind an approach NACK would be based on what you are saying, though.\r\n\r\nIt sounds more like you're asking for an additional feature which would be easy to implement on top of the first commit, not pointing to a drawback of the approach. If you want to gather live fee estimates, the first commit outputs a structured [jsonl](https://jsonlines.org/) log of fee estimation events, so it would be easy to add the actual fee estimates to this log, or add internal metrics used to produce the fee estimates, or add any other data points that might be interesting. It is also possible to take the existing log files this PR already generates, and feed them to the fee estimation algorithm by modifying the tool in the second commit to produce live fee estimates or a history of estimates over time.\r\n\r\nIf you just think I should drop the second commit, or trim it down, I think that would be reasonable. The point of the second commit is mainly to provide example code that demonstrates how to read the JSONL log file and how to call the fee estimator API. The idea is to avoid needing reinvent the wheel each time you want to monitor fee estimation behavior, or reproduce a bug, or determine the effects of a change.\r\n\r\n> I would much prefer [...] some option that would allow me to tell Bitcoin Core it's at a certain chain height, feed it some mempool data, and then ask it for fee estimations.\r\n\r\nThis is actually what the second commit provides. The .jsonl log contains chain and mempool data. You can feed it to the test program in the second commit, and it calls fee estimation code to produce fee estimates. It can produce a graph of the fee estimates, and calculate how accurate they were by looking at all the transactions that got confirmed and outputting the mean squared error of how many blocks it actually took the transactions to be confirmed vs how many blocks the fee estimation algorithm predicted it would take to get them confirmed based on their feerate.\r\n\r\nThis PR is a few years old, so I would probably implement the second commit a little differently today. Instead of adding a standalone c++ executable that calls fee estimator code and produces graphs and metrics, I might want to just add a python module that exposes the `CBlockPolicyEstimator` class, and generate the graphs and metrics from a python notebook.",
      "created_at" : "2023-05-01T15:23:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1529830672",
      "id" : 1529830672,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585bL10Q",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529830672/reactions"
      },
      "updated_at" : "2023-05-01T15:24:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1529830672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for the thorough response @ryanofsky. I realize I didn't explain myself very well in my initial comment.\r\n\r\n> It sounds more like you're asking for an additional feature which would be easy to implement on top of the first commit, not pointing to a drawback of the approach\r\n\r\nSince we already record mempool events in the debug log file (this is what @jamesob and I are using to log mempool events in [bmon](https://github.com/chaincodelabs/bmon)), it feels a bit strange to have special code for logging transactions again here for fee estimation. It's possible I'm not understanding something here, though: is there some special information in the log you are writing that we can't get from the debug log file?\r\n\r\n> This is actually what the second commit provides. The .jsonl log contains chain and mempool data. You can feed it to the test program in the second commit, and it calls fee estimation code to produce fee estimates\r\n\r\nI think what I was envisioning was even simpler: have a flag to make Bitcoin Core log `fee_rate` estimates per block and then have some way to walk the node back to some point in the past, have it log `fee_rate` estimates (perhaps with a code change) and then leave it up to the individual on how to analyze the diff between those logs. Perhaps this is easier said than done since the fee estimation code in Bitcoin Core today seems to work on a per transaction basis?",
      "created_at" : "2023-05-03T09:53:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1532747667",
      "id" : 1532747667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585bW9-T",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1532747667/reactions"
      },
      "updated_at" : "2023-05-03T09:53:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1532747667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> is there some special information in the log you are writing that we can't get from the debug log file?\r\n\r\nI think so. The json log captures all inputs to fee estimator to used update its internal state. It includes not just mempool events but also information about which transactions are included in blocks, flush events, and contents of `fee_estimates.dat` blobs that are loaded. It makes fee estimation code reproducible, so if you make a change to the fee estimation code or parameters, you can evaluate the effects of the change with real world inputs offline. [^1]\r\n\r\n[^1]: I also think in practice parsing a json log file is cleaner and more straightforward than parsing a debug.log file. Compare\r\n[readLog](https://github.com/ryanofsky/bitcoin/blob/26240e1a5f320e8a9da71cf4b7e6313a9b494aff/src/policy/fees_input.cpp#L162-L228) vs [logparse](https://github.com/chaincodelabs/bmon/blob/26032dbec86f14044c9af0af0e06528750ad6fc8/bmon/logparse.py). But I recognize there could be other advantages to using debug.log files, especially since debug.log files are omnipresent and already exist.\r\n\r\n> I think what I was envisioning was even simpler: have a flag to make Bitcoin Core log fee_rate estimates per block and then have some way to walk the node back to some point in the past, have it log fee_rate estimates (perhaps with a code change) and then leave it up to the individual on how to analyze the diff between those logs. Perhaps this is easier said than done since the fee estimation code in Bitcoin Core today seems to work on a per transaction basis?\r\n\r\nI think I don't actually understand the proposal or don't understand the intended use-case. Use-cases for PR this are to:\r\n\r\n- Be able to make changes to the fee estimation algorithm and be able to see how the changes affect fee estimates in a quick feedback loop\r\n- Be able to evaluate quality of fee estimates. The example program compares how quickly fee estimator expects transactions get to get confirmed (based on feerate) vs how quickly they actually get confirmed. This could be one metric for comparing quality of different fee estimation algorithms, or seeing if one algorithm starts to perform better or worse over time. It should also be possible to implement other metrics besides this one and do similar things.\r\n\r\nIs your proposal basically to save a `fee_estimates.dat` file each time a block is connected and then use those files for something? I'm guess I'm not sure how you would use those files to improve fee estimates. This PR does capture a superset of that information, too. For example, it would be possible to generate those files offline from the json log file produced in this PR by adding a few lines to the [`filter`](https://github.com/ryanofsky/bitcoin/blob/26240e1a5f320e8a9da71cf4b7e6313a9b494aff/src/test/fee_est/fee_est.cpp#L285) callback:\r\n\r\n```c++\r\nconst UniValue& block = value[\"block\"];\r\nif (block.isObject()) {\r\n    AutoFile file{fsbridge::fopen(strprintf(\"fee_estimates-%07d.dat\", block[\"height\"].getInt<int>());, \"wb\")};\r\n    estimator.Write(file);\r\n}\r\n```\r\n\r\nAnother advantage of this change is that it decouples `CBlockPolicyEstimator` from the mempool, so it's possible to call it offline. The external API changes from:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/7b45d171f549595a831489827c28e8493f36c00c/src/policy/fees.h#L189-L200\r\n\r\nto:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/26240e1a5f320e8a9da71cf4b7e6313a9b494aff/src/policy/fees.h#L191-L201\r\n\r\nThere are probably lots of changes that could be made to this PR to improve it, or trim it down if it is doing too much, but in general I think takes a good first step of pulling things out of `CBlockPolicyEstimator` that don't belong there (mempool access, filesystem access), and then builds some useful features on top of that.",
      "created_at" : "2023-05-03T14:55:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1533184415",
      "id" : 1533184415,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585bYomf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1533184415/reactions"
      },
      "updated_at" : "2023-05-03T14:55:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1533184415",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-20T17:24:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1599213071",
      "id" : 1599213071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585fUg4P",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599213071/reactions"
      },
      "updated_at" : "2023-06-20T17:24:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1599213071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? â¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? â¡ï¸ Please close.\n* Did the author lose interest or time to work on this? â¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "created_at" : "2023-09-18T00:13:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/10443#issuecomment-1722610299",
      "id" : 1722610299,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/10443",
      "node_id" : "IC_kwDOABII585mrPJ7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1722610299/reactions"
      },
      "updated_at" : "2023-09-18T00:13:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1722610299",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
