[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1737390554), [sipa](https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1737453972) |\n| Concept ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/28525#pullrequestreview-1647106317), [theStack](https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1738105708) |\n| Approach ACK | [ajtowns](https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1735129734) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-09-24T13:46:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1732574160",
      "id" : 1732574160,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585nRPvQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1732574160/reactions"
      },
      "updated_at" : "2023-09-27T21:31:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1732574160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336842411"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336842411"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">further packets are expected to use the empty string as AAD.\r\n\r\nthis part is irrelevant here?",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T08:38:08Z",
      "diff_hunk" : "@@ -1266,18 +1253,16 @@ bool V2Transport::ProcessReceivedPacketBytes() noexcept\n         // At this point we have a valid packet decrypted into m_recv_decode_buffer. Depending on\n         // the current state, decide what to do with it.\n         switch (m_recv_state) {\n-        case RecvState::GARBAUTH:\n-            // Ignore flag does not matter for garbage authentication. Any valid packet functions\n-            // as authentication. Receive and process the version packet next.\n-            SetReceiveState(RecvState::VERSION);\n-            ClearShrink(m_recv_garbage);\n-            break;\n         case RecvState::VERSION:\n             if (!ignore) {\n                 // Version message received; transition to application phase. The contents is\n                 // ignored, but can be used for future extensions.\n                 SetReceiveState(RecvState::APP);\n             }\n+            // We have decrypted one valid packet (which may or may not have been a decoy) with the\n+            // received garbage as AAD. We no longer need the received garbage and further packets",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336842411",
      "id" : 1336842411,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Prpir",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 1263,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1643691130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336842411/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:48:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336842411",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336844877"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336844877"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`non-decoy decoy`? Not sure if this is intentional, although i can see some sense in this... :)",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T08:39:55Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336844877",
      "id" : 1336844877,
      "line" : 497,
      "node_id" : "PRRC_kwDOABII585PrqJN",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 497,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 40,
      "pull_request_review_id" : 1643691130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336844877/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:48:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336844877",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336851588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336851588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This description is confusing.\r\nCurrently, we will switch to APP no matter whether the authenticating package was decoy or version.\r\n\r\nIn future, `the state becomes APP, and the decrypted contents is interpreted as version negotiation`might not be the case, if the authenticating package was decoy.\r\n\r\nAt that point we might as well change this comment, but why having something certainly confusing in the first place?",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T08:44:59Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * decoy) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1336851588",
      "id" : 1336851588,
      "line" : 499,
      "node_id" : "PRRC_kwDOABII585PrryE",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 499,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 42,
      "pull_request_review_id" : 1643691130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336851588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T08:48:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1336851588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Approach ACK assuming BIP change is accepted",
      "created_at" : "2023-09-26T09:04:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1735129734",
      "id" : 1735129734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585na_qG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735129734/reactions"
      },
      "updated_at" : "2023-09-26T09:04:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735129734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337026829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337026829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Oh, I wanted to write \"first non-decoy **packet**\" here. Fixed.",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T10:58:59Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337026829",
      "id" : 1337026829,
      "in_reply_to_id" : 1336844877,
      "line" : 497,
      "node_id" : "PRRC_kwDOABII585PsWkN",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 497,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 40,
      "pull_request_review_id" : 1643975973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337026829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T11:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337026829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337030584"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337030584"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> In future, `the state becomes APP, and the decrypted contents is interpreted as version negotiation` might not be the case, if the authenticating package was decoy.\r\n\r\n`the state becomes APP, and the decrypted contents is interpreted as version negotiation` *is* always the case. The first non-decoy packet received in VERSION state is the version packet, and that means that we interpret the contents as version info and switch to APP.\r\n\r\n> At that point we might as well change this comment, but why having something certainly confusing in the first place?\r\n\r\nI'm not sure what you're suggesting. Can you elaborate? (Maybe it's based on a misunderstanding that has been resolved now?)",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T11:02:32Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * decoy) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337030584",
      "id" : 1337030584,
      "in_reply_to_id" : 1336851588,
      "line" : 499,
      "node_id" : "PRRC_kwDOABII585PsXe4",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 499,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 42,
      "pull_request_review_id" : 1643975973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337030584/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T11:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337030584",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337071855"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337071855"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hah, it's not. We need to clear `m_recv_garbage` to make sure potential further packets in VERSION state don't except AAD. I agree that it's confusing. Added a commit to simply further. (Happy to squash if that's simpler.)",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T11:38:24Z",
      "diff_hunk" : "@@ -1266,18 +1253,16 @@ bool V2Transport::ProcessReceivedPacketBytes() noexcept\n         // At this point we have a valid packet decrypted into m_recv_decode_buffer. Depending on\n         // the current state, decide what to do with it.\n         switch (m_recv_state) {\n-        case RecvState::GARBAUTH:\n-            // Ignore flag does not matter for garbage authentication. Any valid packet functions\n-            // as authentication. Receive and process the version packet next.\n-            SetReceiveState(RecvState::VERSION);\n-            ClearShrink(m_recv_garbage);\n-            break;\n         case RecvState::VERSION:\n             if (!ignore) {\n                 // Version message received; transition to application phase. The contents is\n                 // ignored, but can be used for future extensions.\n                 SetReceiveState(RecvState::APP);\n             }\n+            // We have decrypted one valid packet (which may or may not have been a decoy) with the\n+            // received garbage as AAD. We no longer need the received garbage and further packets",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337071855",
      "id" : 1337071855,
      "in_reply_to_id" : 1336842411,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Pshjv",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 1263,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1643975973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337071855/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T11:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337071855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337119907"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337119907"
         }
      },
      "author_association" : "MEMBER",
      "body" : "~~The ` if (m_recv_state != RecvState::APP_READY) ClearShrink(m_recv_decode_buffer);` below could be moved into this state transition.~~\r\n\r\nEDIT: no, we also want to do that for decoy packets.",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T12:19:49Z",
      "diff_hunk" : "@@ -1249,45 +1236,37 @@ bool V2Transport::ProcessReceivedPacketBytes() noexcept\n         // as GetMaxBytesToProcess only allows up to LENGTH_LEN into the buffer before that point.\n         m_recv_decode_buffer.resize(m_recv_len);\n         bool ignore{false};\n-        Span<const std::byte> aad;\n-        if (m_recv_state == RecvState::GARBAUTH) aad = MakeByteSpan(m_recv_garbage);\n         bool ret = m_cipher.Decrypt(\n             /*input=*/MakeByteSpan(m_recv_buffer).subspan(BIP324Cipher::LENGTH_LEN),\n-            /*aad=*/aad,\n+            /*aad=*/MakeByteSpan(m_recv_aad),\n             /*ignore=*/ignore,\n             /*contents=*/MakeWritableByteSpan(m_recv_decode_buffer));\n         if (!ret) {\n             LogPrint(BCLog::NET, \"V2 transport error: packet decryption failure (%u bytes), peer=%d\\n\", m_recv_len, m_nodeid);\n             return false;\n         }\n+        // We have decrypted a valid packet with the AAD we expected, so clear the expected AAD.\n+        ClearShrink(m_recv_aad);\n         // Feed the last 4 bytes of the Poly1305 authentication tag (and its timing) into our RNG.\n         RandAddEvent(ReadLE32(m_recv_buffer.data() + m_recv_buffer.size() - 4));\n \n-        // At this point we have a valid packet decrypted into m_recv_decode_buffer. Depending on\n-        // the current state, decide what to do with it.\n-        switch (m_recv_state) {\n-        case RecvState::GARBAUTH:\n-            // Ignore flag does not matter for garbage authentication. Any valid packet functions\n-            // as authentication. Receive and process the version packet next.\n-            SetReceiveState(RecvState::VERSION);\n-            ClearShrink(m_recv_garbage);\n-            break;\n-        case RecvState::VERSION:\n-            if (!ignore) {\n+        // At this point we have a valid packet decrypted into m_recv_decode_buffer. If it's not a\n+        // decoy, which we simply ignore, use the current state to decide what to do with it.\n+        if (!ignore) {\n+            switch (m_recv_state) {\n+            case RecvState::VERSION:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337119907",
      "id" : 1337119907,
      "line" : 1257,
      "node_id" : "PRRC_kwDOABII585PstSj",
      "original_commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "original_line" : 1257,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 101,
      "pull_request_review_id" : 1644125951,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337119907/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T12:23:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337119907",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337126185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337126185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "~~You mean \"into this `switch`\"? Since I moved the `switch` block into the `if (!ignore)` block, this means we would not clean the buffer in case of a decoy packet. That seems fine to me, but is this what you're suggesting?~~",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T12:24:56Z",
      "diff_hunk" : "@@ -1249,45 +1236,37 @@ bool V2Transport::ProcessReceivedPacketBytes() noexcept\n         // as GetMaxBytesToProcess only allows up to LENGTH_LEN into the buffer before that point.\n         m_recv_decode_buffer.resize(m_recv_len);\n         bool ignore{false};\n-        Span<const std::byte> aad;\n-        if (m_recv_state == RecvState::GARBAUTH) aad = MakeByteSpan(m_recv_garbage);\n         bool ret = m_cipher.Decrypt(\n             /*input=*/MakeByteSpan(m_recv_buffer).subspan(BIP324Cipher::LENGTH_LEN),\n-            /*aad=*/aad,\n+            /*aad=*/MakeByteSpan(m_recv_aad),\n             /*ignore=*/ignore,\n             /*contents=*/MakeWritableByteSpan(m_recv_decode_buffer));\n         if (!ret) {\n             LogPrint(BCLog::NET, \"V2 transport error: packet decryption failure (%u bytes), peer=%d\\n\", m_recv_len, m_nodeid);\n             return false;\n         }\n+        // We have decrypted a valid packet with the AAD we expected, so clear the expected AAD.\n+        ClearShrink(m_recv_aad);\n         // Feed the last 4 bytes of the Poly1305 authentication tag (and its timing) into our RNG.\n         RandAddEvent(ReadLE32(m_recv_buffer.data() + m_recv_buffer.size() - 4));\n \n-        // At this point we have a valid packet decrypted into m_recv_decode_buffer. Depending on\n-        // the current state, decide what to do with it.\n-        switch (m_recv_state) {\n-        case RecvState::GARBAUTH:\n-            // Ignore flag does not matter for garbage authentication. Any valid packet functions\n-            // as authentication. Receive and process the version packet next.\n-            SetReceiveState(RecvState::VERSION);\n-            ClearShrink(m_recv_garbage);\n-            break;\n-        case RecvState::VERSION:\n-            if (!ignore) {\n+        // At this point we have a valid packet decrypted into m_recv_decode_buffer. If it's not a\n+        // decoy, which we simply ignore, use the current state to decide what to do with it.\n+        if (!ignore) {\n+            switch (m_recv_state) {\n+            case RecvState::VERSION:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337126185",
      "id" : 1337126185,
      "in_reply_to_id" : 1337119907,
      "line" : 1257,
      "node_id" : "PRRC_kwDOABII585Psu0p",
      "original_commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "original_line" : 1257,
      "original_position" : 101,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 101,
      "pull_request_review_id" : 1644135666,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337126185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T12:27:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337126185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337132054"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337132054"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: the `it` in this sentence is easily interpreted as \"decryption/verification of the first non-decoy packet\", which is slightly confusing, as failure to decrypt will causing aborting even for decoy packets.\r\n\r\nSuggestion:\r\n\r\n> A packet is received, and decrypted/verified. If that fails, the connection aborts. The first received packet in this state (whether it's a decoy or not) is expected to authenticate the garbage received during the GARB_GARBTERM state as AAD. The first non-decoy packet in this state is interpreted as version negotiation (currently, that means ignoring it, but it can be used for negotiating future extensions), and afterwards the state becomes APP.",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T12:29:41Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * packet) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for\n+         * negotiating future extensions). If it fails, the connection aborts. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337132054",
      "id" : 1337132054,
      "line" : 500,
      "node_id" : "PRRC_kwDOABII585PswQW",
      "original_commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "original_line" : 500,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 43,
      "pull_request_review_id" : 1644144918,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337132054/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T12:29:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337132054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337678247"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337678247"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment is outdated (\"authentication packet\") here.",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-26T19:21:04Z",
      "diff_hunk" : "@@ -1193,25 +1195,26 @@ class V2TransportTester\n \n     /** Schedule garbage terminator and authentication packet to be sent to the transport (only",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1337678247",
      "id" : 1337678247,
      "line" : 1196,
      "node_id" : "PRRC_kwDOABII585Pu1mn",
      "original_commit_id" : "f93f8b457f1062af7b42a8e728ae3d5ab4b32d0f",
      "original_line" : 1196,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 1645033013,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337678247/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T19:24:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337678247",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338153772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338153772"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think my issue was resolved with the typo fix right above.",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-27T07:19:34Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * decoy) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338153772",
      "id" : 1338153772,
      "in_reply_to_id" : 1336851588,
      "line" : 499,
      "node_id" : "PRRC_kwDOABII585Pwpss",
      "original_commit_id" : "8753b6af9bf8767be50d71d1bf7e3711738fcfd2",
      "original_line" : 499,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 42,
      "pull_request_review_id" : 1645769653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338153772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T07:19:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338153772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338156510"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338156510"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">currently, that means ignoring it, but it can be used for negotiating future extensions\r\n\r\nPerhaps say `ignoring the content`, to make sure aad is not meant to be ignored?",
      "commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "created_at" : "2023-09-27T07:22:13Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * packet) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for\n+         * negotiating future extensions). If it fails, the connection aborts. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338156510",
      "id" : 1338156510,
      "in_reply_to_id" : 1337132054,
      "line" : 500,
      "node_id" : "PRRC_kwDOABII585PwqXe",
      "original_commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "original_line" : 500,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 43,
      "pull_request_review_id" : 1645773914,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338156510/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T07:22:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338156510",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338392808"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338392808"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Fixed, along with some more outdated comments found by grepping for \"auth\" in all touched files.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T10:20:24Z",
      "diff_hunk" : "@@ -1193,25 +1195,26 @@ class V2TransportTester\n \n     /** Schedule garbage terminator and authentication packet to be sent to the transport (only",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338392808",
      "id" : 1338392808,
      "in_reply_to_id" : 1337678247,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PxkDo",
      "original_commit_id" : "f93f8b457f1062af7b42a8e728ae3d5ab4b32d0f",
      "original_line" : 1196,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1646127757,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338392808/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T10:20:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338392808",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338393030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338393030"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, done.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T10:20:36Z",
      "diff_hunk" : "@@ -485,24 +485,19 @@ class V2Transport final : public Transport\n         /** Garbage and garbage terminator.\n          *\n          * Whenever a byte is received, the last 16 bytes are compared with the expected garbage\n-         * terminator. When that happens, the state becomes GARBAUTH. If no matching terminator is\n+         * terminator. When that happens, the state becomes VERSION. If no matching terminator is\n          * received in 4111 bytes (4095 for the maximum garbage length, and 16 bytes for the\n          * terminator), the connection aborts. */\n         GARB_GARBTERM,\n \n-        /** Garbage authentication packet.\n-         *\n-         * A packet is received, and decrypted/verified with AAD set to the garbage received during\n-         * the GARB_GARBTERM state. If that succeeds, the state becomes VERSION. If it fails the\n-         * connection aborts. */\n-        GARBAUTH,\n-\n         /** Version packet.\n          *\n-         * A packet is received, and decrypted/verified. If that succeeds, the state becomes APP,\n-         * and the decrypted contents is interpreted as version negotiation (currently, that means\n-         * ignoring it, but it can be used for negotiating future extensions). If it fails, the\n-         * connection aborts. */\n+         * A packet is received, and decrypted/verified. The first received packet in this state\n+         * (whether it's a decoy or not) is expected to authenticate the garbage received during\n+         * the GARB_GARBTERM state as AAD. If decryption/verification (of the first non-decoy\n+         * packet) succeeds, the state becomes APP, and the decrypted contents is interpreted as\n+         * version negotiation (currently, that means ignoring it, but it can be used for\n+         * negotiating future extensions). If it fails, the connection aborts. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338393030",
      "id" : 1338393030,
      "in_reply_to_id" : 1337132054,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PxkHG",
      "original_commit_id" : "f02fb7119eca6ee9744fa7c28291e6351650291a",
      "original_line" : 500,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1646128074,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338393030/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T10:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338393030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "The [CI failure](https://github.com/bitcoin/bitcoin/actions/runs/6324609410/job/17174453679?pr=28525#step:28:927) seems unrelated: ` test_framework.authproxy.JSONRPCException: Unable to create transaction. Fee exceeds maximum configured by user (e.g. -maxtxfee, maxfeerate) (-4)`. edit: Okay, this is https://github.com/bitcoin/bitcoin/issues/28491.",
      "created_at" : "2023-09-27T11:40:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1737226795",
      "id" : 1737226795,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585ni_or",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737226795/reactions"
      },
      "updated_at" : "2023-09-27T11:41:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737226795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T13:22:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1737390554",
      "id" : 1737390554,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585njnna",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737390554/reactions"
      },
      "updated_at" : "2023-09-27T13:22:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737390554",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK e3720bca398820038b3e97f467adb2c45ef9ef5f. Re-ran the v2 transport fuzzer overnight.",
      "created_at" : "2023-09-27T13:56:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1737453972",
      "id" : 1737453972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585nj3GU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737453972/reactions"
      },
      "updated_at" : "2023-09-27T13:56:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1737453972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338861777"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338861777"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Conceptually it's a bit weird to receive an AAD in one message but then verify it in the next message. Perhaps it's cleaner to to keep `m_recv_garbage` around and explicitly move it into `m_recv_aad` as soon as we start receiving bytes for the decoy/version message?\r\n\r\nThat way we can `Assume` that `m_recv_aad` is empty when start receiving bytes and clear it when we're done processing a message. (this commit already does the latter)",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T16:15:32Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338861777",
      "id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585PzWjR",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1647106317,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338861777/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T16:19:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338861777",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338928377"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338928377"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Perhaps it's cleaner to to keep m_recv_garbage around and explicitly move it into m_recv_aad as soon as we start receiving bytes for the decoy/version message?\r\n\r\nWe receive data into `m_recv_buffer`, and by the time we process it, we're effectively already done with it. So what you're suggesting would just amount to moving/shrinking from `m_recv_buffer` to `m_recv_garbage` and immediately after (on the next line) moving that to `m_recv_aad`.\r\n\r\nI think the better way of looking at it is not that the AAD is data *received* at all; it's a side effect of processing data in a particular phase that results in a requirement that the next message commit to it. For now, the only place where this happens is that during the processing of received bytes in the `GARB_TERM` phase the garbage needs to be committed to (but not all the data received during that phase, as it doesn't include the terminator).\r\n\r\n> That way we can `Assume` that `m_recv_aad` is empty when start receiving bytes and clear it when we're done processing a message. (this commit already does the latter).\r\n\r\nI don't think that works? At the start of the version phase, the previous garbage will be in `m_recv_aad`.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T16:58:58Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338928377",
      "id" : 1338928377,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585Pzmz5",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1647184782,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338928377/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T17:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338928377",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338983254"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338983254"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Conceptually it's a bit weird to receive an AAD in one message but then verify it in the next message. Perhaps it's cleaner to to keep `m_recv_garbage` around and explicitly move it into `m_recv_aad` as soon as we start receiving bytes for the decoy/version message?\r\n\r\nIf I understand correctly, this is roughly equivalent to dropping the second commit again, and I don't think this was cleaner.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-27T17:44:21Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1338983254",
      "id" : 1338983254,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585Pz0NW",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1647256728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338983254/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T17:44:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338983254",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-09-27T21:31:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1738105708",
      "id" : 1738105708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585nmWNs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738105708/reactions"
      },
      "updated_at" : "2023-09-27T21:31:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738105708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Observation during discussion with @achow101: the old behavior is actually equivalent to the new behavior, but with the added rule that the very first packet is implicitly a decoy (whether the bit is set or not).",
      "created_at" : "2023-09-27T21:57:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1738132350",
      "id" : 1738132350,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585nmct-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738132350/reactions"
      },
      "updated_at" : "2023-09-27T21:57:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738132350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> old behavior [...] with the added rule that the very first packet is implicitly a decoy (whether the bit is set or not).\r\n\r\nInteresting observation, and this confirms that the old behavior is somewhat unnatural.",
      "created_at" : "2023-09-28T07:23:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#issuecomment-1738616650",
      "id" : 1738616650,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28525",
      "node_id" : "IC_kwDOABII585noS9K",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738616650/reactions"
      },
      "updated_at" : "2023-09-28T07:23:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738616650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339728856"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339728856"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> At the start of the version phase, the previous garbage will be in `m_recv_aad`.\r\n\r\nThis is the part that feels a bit strange to me. But may it's not too bad:\r\n\r\nWe could instead `Assume` that `m_recv_aad` is empty when we enter the `APP` and when we enter the `APP_READY` state. It can be cleared in the `VERSION` state and after each normal message in the `APP` state, which indeed this PR does.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-28T08:24:48Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339728856",
      "id" : 1339728856,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585P2qPY",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1648187290,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339728856/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T08:24:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339728856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339810858"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339810858"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I suppose an `Assume` in `APP` may or may not be future proof, because it depends on how AADs will be used: do we know what to expect for the next message (as is the case here for garbage), do we infer it from the current message, is it some time dependent thing or even a constant?",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-28T09:24:46Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339810858",
      "id" : 1339810858,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585P2-Qq",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1648306061,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339810858/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T09:24:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339810858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339879610"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339879610"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I suppose an `Assume` in `APP` may or may not be future proof, because it depends on how AADs will be used: do we know what to expect for the next message (as is the case here for garbage), do we infer it from the current message, is it some time dependent thing or even a constant?\r\n\r\nWell, if we ever have a v3 that uses AAD for more than the garbage, we could drop the `Assume`, so I guess that's not a big deal.\r\n\r\nOn the other hand, I don't see that much value in adding an `Assume`. The sender and receiver code are sufficiently independent. So unless we have the exact same bug in the sender logic, a bug in the receiver logic that leads to `m_recv_aad` being non-empty would lead to an immediate disconnect. That is, such a bug will certainly be noticed during testing, even without the `Assume`. (The `Assume` would just make it easier to find the cause.) \r\n\r\nMy current thinking is that I don't want to touch the PR now that it has three ACKs. But I'll add an `Assume` if there's another good reason to touch it (or if you have strong opinions on this, of course.) ",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-28T10:15:54Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339879610",
      "id" : 1339879610,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585P3PC6",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1648400991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339879610/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T10:15:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339879610",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339889801"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339889801"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not totally relevant to the PR but some remarks:\r\n\r\n> do we know what to expect for the next message (as is the case here for garbage)\r\n> do we infer it from the current message,\r\n\r\nI think one of these two is true in 99.9% of the cases I can imagine.\r\n\r\nAs for inferring it from current message: Inferring it from the contents of the AEAD is excluded by design (you can't decrypt a ciphertext that doesn't verify). It would just be possible for data in the \"outer\" header (currently that's just the length field). But even if we want some additional data in the outer header, this doesn't really contradict the current logic in the code (e.g., we could concatenate the current-message thing to whatever `m_recv_aad` is, or then start Assuming it's empty).\r\n\r\n> is it some time dependent thing\r\n\r\nThat will be too fragile, i.e., we would abort the connection if clocks are off.\r\n\r\n> even a constant?\r\n\r\nThen there will be no reason to include it.\r\n\r\n",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-28T10:24:32Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339889801",
      "id" : 1339889801,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585P3RiJ",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1648414459,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339889801/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T10:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339889801",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1071625?v=4",
         "events_url" : "https://api.github.com/users/real-or-random/events{/privacy}",
         "followers_url" : "https://api.github.com/users/real-or-random/followers",
         "following_url" : "https://api.github.com/users/real-or-random/following{/other_user}",
         "gists_url" : "https://api.github.com/users/real-or-random/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/real-or-random",
         "id" : 1071625,
         "login" : "real-or-random",
         "node_id" : "MDQ6VXNlcjEwNzE2MjU=",
         "organizations_url" : "https://api.github.com/users/real-or-random/orgs",
         "received_events_url" : "https://api.github.com/users/real-or-random/received_events",
         "repos_url" : "https://api.github.com/users/real-or-random/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/real-or-random/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/real-or-random/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/real-or-random"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339902114"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339902114"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks for the clarifications. Agree that adding an `Assume` can wait.",
      "commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "created_at" : "2023-09-28T10:33:52Z",
      "diff_hunk" : "@@ -578,13 +573,13 @@ class V2Transport final : public Transport\n \n     /** Lock for receiver-side fields. */\n     mutable Mutex m_recv_mutex ACQUIRED_BEFORE(m_send_mutex);\n-    /** In {GARBAUTH, VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n+    /** In {VERSION, APP}, the decrypted packet length, if m_recv_buffer.size() >=\n      *  BIP324Cipher::LENGTH_LEN. Unspecified otherwise. */\n     uint32_t m_recv_len GUARDED_BY(m_recv_mutex) {0};\n     /** Receive buffer; meaning is determined by m_recv_state. */\n     std::vector<uint8_t> m_recv_buffer GUARDED_BY(m_recv_mutex);\n-    /** During GARBAUTH, the garbage received during GARB_GARBTERM. */\n-    std::vector<uint8_t> m_recv_garbage GUARDED_BY(m_recv_mutex);\n+    /** AAD expected in next received packet (currently used only for garbage). */\n+    std::vector<uint8_t> m_recv_aad GUARDED_BY(m_recv_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28525#discussion_r1339902114",
      "id" : 1339902114,
      "in_reply_to_id" : 1338861777,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585P3Uii",
      "original_commit_id" : "e3720bca398820038b3e97f467adb2c45ef9ef5f",
      "original_line" : 582,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 73,
      "pull_request_review_id" : 1648430793,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28525",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339902114/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T10:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1339902114",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
