[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28574).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/28574#pullrequestreview-1669633382), [theStack](https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1803694990) |\n| Stale ACK | [josibake](https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1967094322) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29256](https://github.com/bitcoin/bitcoin/pull/29256) (Improve new LogDebug/Trace/Info/Warning/Error Macros by ryanofsky)\n* [#29129](https://github.com/bitcoin/bitcoin/pull/29129) (wallet, rpc: add BIP44 `account` in `createwallet` by brunoerg)\n* [#28333](https://github.com/bitcoin/bitcoin/pull/28333) (wallet: Construct ScriptPubKeyMans with all data rather than loaded progressively by achow101)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-10-03T13:54:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1745029746",
      "id" : 1745029746,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585oAwpy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1745029746/reactions"
      },
      "updated_at" : "2024-05-02T07:46:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1745029746",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI fails",
      "created_at" : "2023-10-04T15:40:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1747161126",
      "id" : 1747161126,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585oI5Am",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1747161126/reactions"
      },
      "updated_at" : "2023-10-04T15:40:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1747161126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-11-09T11:57:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1803694990",
      "id" : 1803694990,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585rgjOO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1803694990/reactions"
      },
      "updated_at" : "2023-11-09T11:57:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1803694990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #28894 merge.",
      "created_at" : "2023-12-08T20:13:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1847787491",
      "id" : 1847787491,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585uIv_j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847787491/reactions"
      },
      "updated_at" : "2024-01-03T14:28:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1847787491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-02T16:00:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1874213686",
      "id" : 1874213686,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585vtjs2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1874213686/reactions"
      },
      "updated_at" : "2024-01-02T16:00:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1874213686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-04T16:22:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1877384968",
      "id" : 1877384968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585v5p8I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1877384968/reactions"
      },
      "updated_at" : "2024-01-04T16:22:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1877384968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-08T14:54:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1881164414",
      "id" : 1881164414,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585wIEp-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1881164414/reactions"
      },
      "updated_at" : "2024-01-08T14:54:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1881164414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Decoupled the address book cloning related commits to #26836. I am marking this PR as a draft until the preceding PRs are merged.",
      "created_at" : "2024-01-21T16:14:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1902683295",
      "id" : 1902683295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585xaKSf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1902683295/reactions"
      },
      "updated_at" : "2024-01-21T16:15:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1902683295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nStarting to review, if you get a chance can you rebase this so that it's only the relevant outstanding commits? ",
      "created_at" : "2024-02-13T12:14:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1941383895",
      "id" : 1941383895,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII585ztyrX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941383895/reactions"
      },
      "updated_at" : "2024-02-13T12:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1941383895",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1489365242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489365242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n        auto filename{PathFromString(strprintf(\"legacy_%d\", wallet_num));\r\n```\r\n\r\nI don't like the c_str below. Also, it doesn't compile on Windows.\r\n\r\nUsing `PathFromString` should be fine to \"convert\" ascii to a path segment, IIUC\r\n\r\nSame above and  https://github.com/bitcoin/bitcoin/pull/28894#discussion_r1420361508",
      "commit_id" : "3346b0ca7d3c13314d43d269c0371f550d2be044",
      "created_at" : "2024-02-14T12:04:02Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <interfaces/chain.h>\n+#include <node/context.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/test/util.h>\n+#include <wallet/context.h>\n+#include <wallet/receive.h>\n+#include <wallet/wallet.h>\n+\n+#include <optional>\n+\n+#ifdef USE_BDB // only enable benchmark when bdb and sqlite are enabled\n+#ifdef USE_SQLITE\n+\n+namespace wallet{\n+\n+static void WalletMigration(benchmark::Bench& bench)\n+{\n+    const auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    // Number of wallets to migrate\n+    int NUM_WALLETS = 1;\n+    // Number of imported watch only addresses\n+    int NUM_WATCH_ONLY_ADDR = 20;\n+\n+    // Setup legacy wallets\n+    for (int i = 0; i < NUM_WALLETS; ++i) {\n+        DatabaseOptions options;\n+        DatabaseStatus status;\n+        bilingual_str error;\n+        std::string filename = strprintf(\"legacy_%d\", i);\n+        auto database = MakeWalletDatabase(test_setup->m_path_root / filename.c_str(), options, status, error);\n+        uint64_t create_flags = 0;\n+        auto wallet = TestLoadWallet(std::move(database), context, create_flags);\n+\n+        // Add watch-only addresses\n+        std::vector<CScript> scripts_watch_only;\n+        for (int w = 0; w < NUM_WATCH_ONLY_ADDR; ++w) {\n+            CKey key;\n+            key.MakeNewKey(true);\n+            LOCK(wallet->cs_wallet);\n+            const CScript& script = scripts_watch_only.emplace_back(GetScriptForDestination(GetDestinationForKey(key.GetPubKey(), OutputType::LEGACY)));\n+            bool res = wallet->ImportScriptPubKeys(strprintf(\"watch_%d\", w), {script},\n+                                        /*have_solving_data=*/false, /*apply_label=*/true, /*timestamp=*/1);\n+            assert(res);\n+        }\n+\n+        // Generate transactions and local addresses\n+        for (int j = 0; j < 400; ++j) {\n+            CMutableTransaction mtx;\n+            mtx.vout.emplace_back(COIN, GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, strprintf(\"bench_%d\", j)))));\n+            mtx.vout.emplace_back(COIN, GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::LEGACY, strprintf(\"legacy_%d\", j)))));\n+            mtx.vout.emplace_back(COIN, scripts_watch_only.at(j % NUM_WATCH_ONLY_ADDR));\n+            mtx.vin.resize(2);\n+            wallet->AddToWallet(MakeTransactionRef(mtx), TxStateInactive{}, /*update_wtx=*/nullptr, /*fFlushOnClose=*/false, /*rescanning_old_block=*/true);\n+        }\n+\n+        // Unload so the migration process loads it\n+        TestUnloadWallet(std::move(wallet));\n+    }\n+\n+    int wallet_num = 0;\n+    bench.epochs(NUM_WALLETS).run([&] {\n+        std::string filename = strprintf(\"legacy_%d\", wallet_num);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1489365242",
      "id" : 1489365242,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Yxej6",
      "original_commit_id" : "ac643893c61678c07d4ea29b19a67fbd63cb5113",
      "original_line" : 73,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/bench/wallet_migration.cpp",
      "position" : null,
      "pull_request_review_id" : 1880111708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489365242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-14T12:04:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489365242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1489408285"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489408285"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I don't like the c_str below. Also, it doesn't compile on Windows.\r\n\r\nyeah, me neither.. I just did this 5 months ago. Fixed, thanks.",
      "commit_id" : "3346b0ca7d3c13314d43d269c0371f550d2be044",
      "created_at" : "2024-02-14T12:42:01Z",
      "diff_hunk" : "@@ -0,0 +1,87 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <interfaces/chain.h>\n+#include <node/context.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/test/util.h>\n+#include <wallet/context.h>\n+#include <wallet/receive.h>\n+#include <wallet/wallet.h>\n+\n+#include <optional>\n+\n+#ifdef USE_BDB // only enable benchmark when bdb and sqlite are enabled\n+#ifdef USE_SQLITE\n+\n+namespace wallet{\n+\n+static void WalletMigration(benchmark::Bench& bench)\n+{\n+    const auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    // Number of wallets to migrate\n+    int NUM_WALLETS = 1;\n+    // Number of imported watch only addresses\n+    int NUM_WATCH_ONLY_ADDR = 20;\n+\n+    // Setup legacy wallets\n+    for (int i = 0; i < NUM_WALLETS; ++i) {\n+        DatabaseOptions options;\n+        DatabaseStatus status;\n+        bilingual_str error;\n+        std::string filename = strprintf(\"legacy_%d\", i);\n+        auto database = MakeWalletDatabase(test_setup->m_path_root / filename.c_str(), options, status, error);\n+        uint64_t create_flags = 0;\n+        auto wallet = TestLoadWallet(std::move(database), context, create_flags);\n+\n+        // Add watch-only addresses\n+        std::vector<CScript> scripts_watch_only;\n+        for (int w = 0; w < NUM_WATCH_ONLY_ADDR; ++w) {\n+            CKey key;\n+            key.MakeNewKey(true);\n+            LOCK(wallet->cs_wallet);\n+            const CScript& script = scripts_watch_only.emplace_back(GetScriptForDestination(GetDestinationForKey(key.GetPubKey(), OutputType::LEGACY)));\n+            bool res = wallet->ImportScriptPubKeys(strprintf(\"watch_%d\", w), {script},\n+                                        /*have_solving_data=*/false, /*apply_label=*/true, /*timestamp=*/1);\n+            assert(res);\n+        }\n+\n+        // Generate transactions and local addresses\n+        for (int j = 0; j < 400; ++j) {\n+            CMutableTransaction mtx;\n+            mtx.vout.emplace_back(COIN, GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::BECH32, strprintf(\"bench_%d\", j)))));\n+            mtx.vout.emplace_back(COIN, GetScriptForDestination(*Assert(wallet->GetNewDestination(OutputType::LEGACY, strprintf(\"legacy_%d\", j)))));\n+            mtx.vout.emplace_back(COIN, scripts_watch_only.at(j % NUM_WATCH_ONLY_ADDR));\n+            mtx.vin.resize(2);\n+            wallet->AddToWallet(MakeTransactionRef(mtx), TxStateInactive{}, /*update_wtx=*/nullptr, /*fFlushOnClose=*/false, /*rescanning_old_block=*/true);\n+        }\n+\n+        // Unload so the migration process loads it\n+        TestUnloadWallet(std::move(wallet));\n+    }\n+\n+    int wallet_num = 0;\n+    bench.epochs(NUM_WALLETS).run([&] {\n+        std::string filename = strprintf(\"legacy_%d\", wallet_num);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1489408285",
      "id" : 1489408285,
      "in_reply_to_id" : 1489365242,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585YxpEd",
      "original_commit_id" : "ac643893c61678c07d4ea29b19a67fbd63cb5113",
      "original_line" : 73,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/bench/wallet_migration.cpp",
      "position" : null,
      "pull_request_review_id" : 1880179669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489408285/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-14T12:44:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1489408285",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-02-20T11:50:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1954051167",
      "id" : 1954051167,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII5850eHRf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1954051167/reactions"
      },
      "updated_at" : "2024-02-20T11:50:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1954051167",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21767740453</sub>",
      "created_at" : "2024-02-26T19:47:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1965129972",
      "id" : 1965129972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII5851IYD0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1965129972/reactions"
      },
      "updated_at" : "2024-02-26T19:47:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1965129972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504024046"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504024046"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"bench: add coverage for wallet migration process\" (https://github.com/bitcoin/bitcoin/pull/28574/commits/a2866d6ce0a4bf8b249ca13c19747d6a209dadab):\r\n\r\nWhy the loop setup if we are only going to do one wallet? Seems better to either run multiple epochs or simplify the benchmark and take out the loop.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T10:44:49Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <bench/bench.h>\n+#include <interfaces/chain.h>\n+#include <node/context.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/test/util.h>\n+#include <wallet/context.h>\n+#include <wallet/receive.h>\n+#include <wallet/wallet.h>\n+\n+#include <optional>\n+\n+#ifdef USE_BDB // only enable benchmark when bdb and sqlite are enabled\n+#ifdef USE_SQLITE\n+\n+namespace wallet{\n+\n+static void WalletMigration(benchmark::Bench& bench)\n+{\n+    const auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    // Number of wallets to migrate\n+    int NUM_WALLETS = 1;\n+    // Number of imported watch only addresses\n+    int NUM_WATCH_ONLY_ADDR = 20;\n+\n+    // Setup legacy wallets\n+    for (int i = 0; i < NUM_WALLETS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504024046",
      "id" : 1504024046,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZpZXu",
      "original_commit_id" : "a2866d6ce0a4bf8b249ca13c19747d6a209dadab",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : 35,
      "path" : "src/bench/wallet_migration.cpp",
      "position" : null,
      "pull_request_review_id" : 1903160648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504024046/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-27T12:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504024046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504030030"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504030030"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"wallet: batch MigrateToDescriptor() db transactions\" (https://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7):\r\n\r\nWhat about \"Error during legacy wallet migration,\" instead? ",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T10:49:25Z",
      "diff_hunk" : "@@ -1782,6 +1782,12 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n         keyid_it++;\n     }\n \n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!batch.TxnBegin()) {\n+        LogPrintf(\"Error during descriptors migration, cannot initialize db transaction\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504030030",
      "id" : 1504030030,
      "line" : 1787,
      "node_id" : "PRRC_kwDOABII585Zpa1O",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1787,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 6,
      "pull_request_review_id" : 1903160648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504030030/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T12:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504030030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504041868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504041868"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"wallet: batch MigrateToDescriptor() db transactions\" (https://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7):\r\n\r\n`key.GetPubKey()` is a pretty expensive operation and we are calling it above:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7#diff-55ce403d9c3440b4a38a261b7d452f84dd9a1d09b2a5ef1b4d3ac0c3567b9106R1812\r\n\r\nand then again here. Not a big deal compared to some of the other stuff, but I ran the bench locally with and without the suggested change and its ~1.5% speedup (assuming I'm reading the bench results correctly :sweat_smile: ):\r\n\r\n```\r\n# before\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|    6,936,309,493.00 |                0.14 |    0.0% |32,790,301,157.00 |11,790,224,744.00 |  2.781 |3,044,271,114.00 |    0.2% |      6.94 | `WalletMigration`\r\n\r\n\r\n# after\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|    6,836,475,065.00 |                0.15 |    0.0% |32,795,704,156.00 |11,732,850,832.00 |  2.795 |3,044,413,213.00 |    0.2% |      6.84 | `WalletMigration`",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T10:58:41Z",
      "diff_hunk" : "@@ -1811,8 +1817,8 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n \n         // Make the DescriptorScriptPubKeyMan and get the scriptPubKeys\n         auto desc_spk_man = std::unique_ptr<DescriptorScriptPubKeyMan>(new DescriptorScriptPubKeyMan(m_storage, w_desc, m_keypool_size));\n-        desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n-        desc_spk_man->TopUp();\n+        WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504041868",
      "id" : 1504041868,
      "line" : 1820,
      "node_id" : "PRRC_kwDOABII585ZpduM",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1820,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 19,
      "pull_request_review_id" : 1903160648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504041868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T12:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504041868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504090385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504090385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Also, in `mapCryptedKey`, the `CPubKey` is already there, so you could pull it out and avoid recalculating it: https://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7#diff-55ce403d9c3440b4a38a261b7d452f84dd9a1d09b2a5ef1b4d3ac0c3567b9106R1762\r\n\r\nBut I'm not sure that's worth the extra effort considering it would only make a difference if a majority of the keys come from `mapCryptedKey` and it seems that this isn't making much of an improvement anyways.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T11:39:50Z",
      "diff_hunk" : "@@ -1811,8 +1817,8 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n \n         // Make the DescriptorScriptPubKeyMan and get the scriptPubKeys\n         auto desc_spk_man = std::unique_ptr<DescriptorScriptPubKeyMan>(new DescriptorScriptPubKeyMan(m_storage, w_desc, m_keypool_size));\n-        desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n-        desc_spk_man->TopUp();\n+        WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504090385",
      "id" : 1504090385,
      "in_reply_to_id" : 1504041868,
      "line" : 1820,
      "node_id" : "PRRC_kwDOABII585ZppkR",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1820,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 19,
      "pull_request_review_id" : 1903160648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504090385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T12:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504090385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504103851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504103851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in \"wallet: batch MigrateToDescriptor() db transactions\" (https://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7):\r\n\r\nCould get rid of the `key.GetPubKey()` call here and completely get rid of the `privkeyid` set above:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/28574/commits/5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7#diff-55ce403d9c3440b4a38a261b7d452f84dd9a1d09b2a5ef1b4d3ac0c3567b9106R1907-R1910\r\n\r\nsince `keys.origins` is a pair of the `keyid` and `CPubKey`. Running the bench with with this suggestion seemed to help:\r\n\r\n```\r\n# after\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|    6,395,421,573.00 |                0.16 |    0.0% |32,790,285,573.00 |11,895,327,005.00 |  2.757 |3,044,102,935.00 |    0.2% |      6.40 | `WalletMigration`\r\n```\r\n\r\n6.94 -> 6.84 -> 6.4\r\n",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T11:51:18Z",
      "diff_hunk" : "@@ -1923,9 +1929,9 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n                 if (!GetKey(keyid, key)) {\n                     continue;\n                 }\n-                desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n+                WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504103851",
      "id" : 1504103851,
      "line" : 1932,
      "node_id" : "PRRC_kwDOABII585Zps2r",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1932,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 40,
      "pull_request_review_id" : 1903160648,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504103851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T12:00:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504103851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504226516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504226516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Why the loop setup if we are only going to do one wallet? Seems better to either run multiple epochs or simplify the benchmark and take out the loop.\r\n\r\nThe idea was to run it multiple times to decrease the noise by taking the median. But the time this test was taking originally (10-15 min) was too much. Thus why I left everything in-place for when the migration time decreases.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T13:22:21Z",
      "diff_hunk" : "@@ -0,0 +1,93 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#if defined(HAVE_CONFIG_H)\n+#include <config/bitcoin-config.h>\n+#endif\n+\n+#include <bench/bench.h>\n+#include <interfaces/chain.h>\n+#include <node/context.h>\n+#include <test/util/mining.h>\n+#include <test/util/setup_common.h>\n+#include <wallet/test/util.h>\n+#include <wallet/context.h>\n+#include <wallet/receive.h>\n+#include <wallet/wallet.h>\n+\n+#include <optional>\n+\n+#ifdef USE_BDB // only enable benchmark when bdb and sqlite are enabled\n+#ifdef USE_SQLITE\n+\n+namespace wallet{\n+\n+static void WalletMigration(benchmark::Bench& bench)\n+{\n+    const auto test_setup = MakeNoLogFileContext<TestingSetup>();\n+\n+    WalletContext context;\n+    context.args = &test_setup->m_args;\n+    context.chain = test_setup->m_node.chain.get();\n+\n+    // Number of wallets to migrate\n+    int NUM_WALLETS = 1;\n+    // Number of imported watch only addresses\n+    int NUM_WATCH_ONLY_ADDR = 20;\n+\n+    // Setup legacy wallets\n+    for (int i = 0; i < NUM_WALLETS; ++i) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504226516",
      "id" : 1504226516,
      "in_reply_to_id" : 1504024046,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZqKzU",
      "original_commit_id" : "a2866d6ce0a4bf8b249ca13c19747d6a209dadab",
      "original_line" : 40,
      "original_position" : 40,
      "original_start_line" : 35,
      "path" : "src/bench/wallet_migration.cpp",
      "position" : null,
      "pull_request_review_id" : 1903495948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504226516/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-27T13:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504226516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504236981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504236981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> What about \"Error during legacy wallet migration,\" instead?\r\n\r\nThe idea of the error message is to point out at which part of the process failed. Saying \"Error during legacy wallet migration\" is too broad (the same message could arise anywhere along migration).\r\nThis part of the process generates descriptors from the legacy SKPM keys and scripts.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T13:29:29Z",
      "diff_hunk" : "@@ -1782,6 +1782,12 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n         keyid_it++;\n     }\n \n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!batch.TxnBegin()) {\n+        LogPrintf(\"Error during descriptors migration, cannot initialize db transaction\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504236981",
      "id" : 1504236981,
      "in_reply_to_id" : 1504030030,
      "line" : 1787,
      "node_id" : "PRRC_kwDOABII585ZqNW1",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1787,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 6,
      "pull_request_review_id" : 1903495948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504236981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T13:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504236981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504260053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504260053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good. We could go further and remove the `GetKey()` from the `keyids` for-loop too (`GetKey()` access `mapKeys` for unencrypted wallets and `mapCryptedKeys` for encrypted ones --> which we already do at the beginning of the process).\r\nStill, maybe better to leave this and your suggestion for a follow-up. Just so this PR can be scoped to the db txn batching changes.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T13:45:50Z",
      "diff_hunk" : "@@ -1811,8 +1817,8 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n \n         // Make the DescriptorScriptPubKeyMan and get the scriptPubKeys\n         auto desc_spk_man = std::unique_ptr<DescriptorScriptPubKeyMan>(new DescriptorScriptPubKeyMan(m_storage, w_desc, m_keypool_size));\n-        desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n-        desc_spk_man->TopUp();\n+        WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504260053",
      "id" : 1504260053,
      "in_reply_to_id" : 1504041868,
      "line" : 1820,
      "node_id" : "PRRC_kwDOABII585ZqS_V",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1820,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 19,
      "pull_request_review_id" : 1903495948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504260053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T13:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504260053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504278574"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504278574"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sounds good but I would rather leave the improvement for a follow-up. Mainly to scope the PR changes to the db txn batching changes.",
      "commit_id" : "6984426dcac8a6c0bcd40d4f47eb76be03d77ab8",
      "created_at" : "2024-02-27T13:57:59Z",
      "diff_hunk" : "@@ -1923,9 +1929,9 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n                 if (!GetKey(keyid, key)) {\n                     continue;\n                 }\n-                desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n+                WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504278574",
      "id" : 1504278574,
      "in_reply_to_id" : 1504103851,
      "line" : 1932,
      "node_id" : "PRRC_kwDOABII585ZqXgu",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1932,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 40,
      "pull_request_review_id" : 1903495948,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504278574/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T13:58:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504278574",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504586396"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504586396"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I see, maybe \"Error generating descriptors for migration, cannot initialize db transaction\"? Also not a big deal, its just he current message is confusing to me in that we aren't migrating descriptors, but taking existing keys, creating descriptors and then saving them in a new wallet.",
      "commit_id" : "868e2f64a9d7de3a980e64fd7acd7323214d3765",
      "created_at" : "2024-02-27T16:37:30Z",
      "diff_hunk" : "@@ -1782,6 +1782,12 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n         keyid_it++;\n     }\n \n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!batch.TxnBegin()) {\n+        LogPrintf(\"Error during descriptors migration, cannot initialize db transaction\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504586396",
      "id" : 1504586396,
      "in_reply_to_id" : 1504030030,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zriqc",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1787,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1904103165,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504586396/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T16:37:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504586396",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504592242"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504592242"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Makes sense! I misread the title as meaning this PR is both optimizing the process and batching db transactions, but its clear from the PR description that this is focused on just the batching logic.",
      "commit_id" : "868e2f64a9d7de3a980e64fd7acd7323214d3765",
      "created_at" : "2024-02-27T16:39:57Z",
      "diff_hunk" : "@@ -1923,9 +1929,9 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n                 if (!GetKey(keyid, key)) {\n                     continue;\n                 }\n-                desc_spk_man->AddDescriptorKey(key, key.GetPubKey());\n+                WITH_LOCK(desc_spk_man->cs_desc_man, desc_spk_man->AddDescriptorKeyWithDB(batch, key, key.GetPubKey()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504592242",
      "id" : 1504592242,
      "in_reply_to_id" : 1504103851,
      "line" : 1932,
      "node_id" : "PRRC_kwDOABII585ZrkFy",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1932,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 40,
      "pull_request_review_id" : 1904114196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504592242/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T16:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504592242",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504604148"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504604148"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure. Done as suggested.",
      "commit_id" : "868e2f64a9d7de3a980e64fd7acd7323214d3765",
      "created_at" : "2024-02-27T16:45:25Z",
      "diff_hunk" : "@@ -1782,6 +1782,12 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n         keyid_it++;\n     }\n \n+    WalletBatch batch(m_storage.GetDatabase());\n+    if (!batch.TxnBegin()) {\n+        LogPrintf(\"Error during descriptors migration, cannot initialize db transaction\\n\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1504604148",
      "id" : 1504604148,
      "in_reply_to_id" : 1504030030,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Zrm_0",
      "original_commit_id" : "5cc89e5eba7330ea3ab64ca66e364170dcd0b4f7",
      "original_line" : 1787,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1904136041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504604148/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-27T16:45:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1504604148",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/28574/commits/868e2f64a9d7de3a980e64fd7acd7323214d3765\r\n\r\nCode reviewed and verified the bench results. Thanks for taking the suggestions!",
      "created_at" : "2024-02-27T16:51:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-1967094322",
      "id" : 1967094322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII5851P3oy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1967094322/reactions"
      },
      "updated_at" : "2024-02-27T16:51:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1967094322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536221160"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536221160"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In cd694033173ec7de2a16187432a3d7aa33ff62ca \"wallet: introduce 'DeleteRecords(batch)' to be used within an external db txn\"\r\n\r\nAfter this PR, this `DeleteRecords()` overload is only used by the tests, so I think it can just be removed (and perhaps never introduced).",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-22T21:03:05Z",
      "diff_hunk" : "@@ -2009,9 +2009,15 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n }\n \n bool LegacyScriptPubKeyMan::DeleteRecords()\n+{\n+    return RunWithinTxn(m_storage.GetDatabase(), /*process_desc=*/\"delete legacy records\", [&](WalletBatch& batch){\n+        return DeleteRecords(batch);\n+    });\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536221160",
      "id" : 1536221160,
      "line" : 2016,
      "node_id" : "PRRC_kwDOABII585bkN_o",
      "original_commit_id" : "cd694033173ec7de2a16187432a3d7aa33ff62ca",
      "original_line" : 2016,
      "original_position" : 8,
      "original_start_line" : 2011,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 66,
      "pull_request_review_id" : 1955796645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536221160/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2011,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-22T21:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536221160",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536223516"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536223516"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 868e2f64a9d7de3a980e64fd7acd7323214d3765 \"wallet: ApplyMigrationData, group all db txs into a single atomic operation\"\r\n\r\nI don't think it's necessary to connect the signals anymore since the local wallet exists outside of any contexts. Although removing this should be its own commit.\r\n\r\nIf you choose to not remove this, for completeness, this should also do `NotifyCanGetAddressesChanged` to match the previous behavior.",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-22T21:06:42Z",
      "diff_hunk" : "@@ -4280,11 +4266,16 @@ bool DoMigration(CWallet& wallet, WalletContext& context, bilingual_str& error,\n     }\n \n     // Add the descriptors to wallet, remove LegacyScriptPubKeyMan, and cleanup txs and address book data\n-    if (auto res_migration = wallet.ApplyMigrationData(*data); !res_migration) {\n-        error = util::ErrorString(res_migration);\n-        return false;\n-    }\n-    return true;\n+    return RunWithinTxn(wallet.GetDatabase(), /*process_desc=*/\"apply migration process\", [&](WalletBatch& batch) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet){\n+        if (auto res_migration = wallet.ApplyMigrationData(batch, *data); !res_migration) {\n+            error = util::ErrorString(res_migration);\n+            return false;\n+        }\n+        // Process succeed, connect the SPKM signals\n+        wallet.ConnectScriptPubKeyManNotifiers();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536223516",
      "id" : 1536223516,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bkOkc",
      "original_commit_id" : "868e2f64a9d7de3a980e64fd7acd7323214d3765",
      "original_line" : 4275,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1955796645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536223516/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T21:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536223516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536231470"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536231470"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 4b3ec698a228fc531cca946f9a572e1dbdc4b0d5 \"wallet: prepare RemoveTxs to be used within a broader db txn procedure\"\r\n\r\nI don't really like this refactor. This means that any callers of this particular overload will have to remember to do `ClearTxs`, whereas callers of the other one don't. This seems like something that could result in programming mistakes in the future. Generally our overloads should do basically the same things, just with the option of providing different arguments. Not clearing the txs from `mapWallet` in one overload is a pretty big difference that may not be easily noticed.\r\n\r\nI think it would actually be a bit cleaner and better to have `RemoveTxs` detect if a database transaction has been started already and just choose to not begin a transaction if that's the case.",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-22T21:15:22Z",
      "diff_hunk" : "@@ -2334,12 +2334,22 @@ DBErrors CWallet::LoadWallet()\n util::Result<void> CWallet::RemoveTxs(std::vector<uint256>& txs_to_remove)\n {\n     AssertLockHeld(cs_wallet);\n-    WalletBatch batch(GetDatabase());\n-    if (!batch.TxnBegin()) return util::Error{_(\"Error starting db txn for wallet transactions removal\")};\n+    util::Result<std::vector<CWallet::MapWalletIt>> res{util::Error{}}; // Note: Make RunWithinTxn generic.\n+    bool was_txn_committed = RunWithinTxn(GetDatabase(), /*process_desc=*/\"remove transactions\", [&](WalletBatch& batch) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        return (res = RemoveTxs(batch, txs_to_remove)).has_value();\n+    });\n+    if (!res) return util::Error{util::ErrorString(res)};\n+    if (!was_txn_committed) return util::Error{_(\"Error starting/committing db txn for wallet transactions removal process\")};\n \n+    // Now that txs have been deleted from disk, erase them from memory.\n+    ClearTxs(*res);\n+    return {};\n+}\n+\n+util::Result<std::vector<CWallet::MapWalletIt>> CWallet::RemoveTxs(WalletBatch& batch, std::vector<uint256>& txs_to_remove) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536231470",
      "id" : 1536231470,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bkQgu",
      "original_commit_id" : "4b3ec698a228fc531cca946f9a572e1dbdc4b0d5",
      "original_line" : 2349,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1955796645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536231470/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T21:16:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536231470",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536732130"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536732130"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> After this PR, this DeleteRecords() overload is only used by the tests, so I think it can just be removed (and perhaps never introduced).\r\n\r\nI didn't do it because, aside from the test changes, it also requires creating a new batch object and beginning + committing the db txn inside ApplyMigrationData on https://github.com/bitcoin/bitcoin/commit/cd694033173ec7de2a16187432a3d7aa33ff62ca. And these changes will need to be removed in the last commit.\r\n",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-24T03:53:55Z",
      "diff_hunk" : "@@ -2009,9 +2009,15 @@ std::optional<MigrationData> LegacyScriptPubKeyMan::MigrateToDescriptor()\n }\n \n bool LegacyScriptPubKeyMan::DeleteRecords()\n+{\n+    return RunWithinTxn(m_storage.GetDatabase(), /*process_desc=*/\"delete legacy records\", [&](WalletBatch& batch){\n+        return DeleteRecords(batch);\n+    });\n+}",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536732130",
      "id" : 1536732130,
      "in_reply_to_id" : 1536221160,
      "line" : 2016,
      "node_id" : "PRRC_kwDOABII585bmKvi",
      "original_commit_id" : "cd694033173ec7de2a16187432a3d7aa33ff62ca",
      "original_line" : 2016,
      "original_position" : 8,
      "original_start_line" : 2011,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 66,
      "pull_request_review_id" : 1956468761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536732130/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2011,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-26T14:10:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536732130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536734042"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734042"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Sure. The wallet is also unloaded few lines after this signal connection. Will remove the lines.",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-24T04:13:55Z",
      "diff_hunk" : "@@ -4280,11 +4266,16 @@ bool DoMigration(CWallet& wallet, WalletContext& context, bilingual_str& error,\n     }\n \n     // Add the descriptors to wallet, remove LegacyScriptPubKeyMan, and cleanup txs and address book data\n-    if (auto res_migration = wallet.ApplyMigrationData(*data); !res_migration) {\n-        error = util::ErrorString(res_migration);\n-        return false;\n-    }\n-    return true;\n+    return RunWithinTxn(wallet.GetDatabase(), /*process_desc=*/\"apply migration process\", [&](WalletBatch& batch) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet){\n+        if (auto res_migration = wallet.ApplyMigrationData(batch, *data); !res_migration) {\n+            error = util::ErrorString(res_migration);\n+            return false;\n+        }\n+        // Process succeed, connect the SPKM signals\n+        wallet.ConnectScriptPubKeyManNotifiers();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536734042",
      "id" : 1536734042,
      "in_reply_to_id" : 1536223516,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bmLNa",
      "original_commit_id" : "868e2f64a9d7de3a980e64fd7acd7323214d3765",
      "original_line" : 4275,
      "original_position" : 145,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1956468761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734042/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T23:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734042",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536734246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734246"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think it would actually be a bit cleaner and better to have RemoveTxs detect if a database transaction has been started already and just choose to not begin a transaction if that's the case.\r\n\r\nThe rationale behind the decoupling wasn't related to the existing (or not) db txn. It was to prevent another programming mistake: The provided db transaction could be aborted by the calling function (deliberately or undeliberately), causing the wallet to enter an inconsistent state where the data in memory differs from the data on disk. This would happen because, in the all-in-one version of this function, the transactions are cleared from the in-memory map.\r\n\r\nI understand that for the migration process, this isn't really an issue because the wallet will be unloaded anyway. We could go back to the all-in-one version of this function, but for other processes, if we ever decide to abort the db txn, the wallet will need to be reloaded from disk to recover the previous state.\r\n\r\nI'm ok with merging back these functions. We just need to be careful not to abort the db txn and continue as if nothing happened after calling this method.",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-24T04:16:28Z",
      "diff_hunk" : "@@ -2334,12 +2334,22 @@ DBErrors CWallet::LoadWallet()\n util::Result<void> CWallet::RemoveTxs(std::vector<uint256>& txs_to_remove)\n {\n     AssertLockHeld(cs_wallet);\n-    WalletBatch batch(GetDatabase());\n-    if (!batch.TxnBegin()) return util::Error{_(\"Error starting db txn for wallet transactions removal\")};\n+    util::Result<std::vector<CWallet::MapWalletIt>> res{util::Error{}}; // Note: Make RunWithinTxn generic.\n+    bool was_txn_committed = RunWithinTxn(GetDatabase(), /*process_desc=*/\"remove transactions\", [&](WalletBatch& batch) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        return (res = RemoveTxs(batch, txs_to_remove)).has_value();\n+    });\n+    if (!res) return util::Error{util::ErrorString(res)};\n+    if (!was_txn_committed) return util::Error{_(\"Error starting/committing db txn for wallet transactions removal process\")};\n \n+    // Now that txs have been deleted from disk, erase them from memory.\n+    ClearTxs(*res);\n+    return {};\n+}\n+\n+util::Result<std::vector<CWallet::MapWalletIt>> CWallet::RemoveTxs(WalletBatch& batch, std::vector<uint256>& txs_to_remove) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1536734246",
      "id" : 1536734246,
      "in_reply_to_id" : 1536231470,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bmLQm",
      "original_commit_id" : "4b3ec698a228fc531cca946f9a572e1dbdc4b0d5",
      "original_line" : 2349,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1956468761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T23:58:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536734246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1539335783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539335783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I understand that for the migration process, this isn't really an issue because the wallet will be unloaded anyway. We could go back to the all-in-one version of this function, but for other processes, if we ever decide to abort the db txn, the wallet will need to be reloaded from disk to recover the previous state.\r\n>\r\n> I'm ok with merging back these functions. We just need to be careful not to abort the db txn and continue as if nothing happened after calling this method.\r\n\r\nEnded up introducing a mechanism to listen for the db txn outcomes. This way, internal procedures can register callbacks to update the in-memory state only when the data is successfully committed to disk.",
      "commit_id" : "18397d3101081d6e2bc8dc64d957a4fe72e93ab3",
      "created_at" : "2024-03-26T14:13:57Z",
      "diff_hunk" : "@@ -2334,12 +2334,22 @@ DBErrors CWallet::LoadWallet()\n util::Result<void> CWallet::RemoveTxs(std::vector<uint256>& txs_to_remove)\n {\n     AssertLockHeld(cs_wallet);\n-    WalletBatch batch(GetDatabase());\n-    if (!batch.TxnBegin()) return util::Error{_(\"Error starting db txn for wallet transactions removal\")};\n+    util::Result<std::vector<CWallet::MapWalletIt>> res{util::Error{}}; // Note: Make RunWithinTxn generic.\n+    bool was_txn_committed = RunWithinTxn(GetDatabase(), /*process_desc=*/\"remove transactions\", [&](WalletBatch& batch) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        return (res = RemoveTxs(batch, txs_to_remove)).has_value();\n+    });\n+    if (!res) return util::Error{util::ErrorString(res)};\n+    if (!was_txn_committed) return util::Error{_(\"Error starting/committing db txn for wallet transactions removal process\")};\n \n+    // Now that txs have been deleted from disk, erase them from memory.\n+    ClearTxs(*res);\n+    return {};\n+}\n+\n+util::Result<std::vector<CWallet::MapWalletIt>> CWallet::RemoveTxs(WalletBatch& batch, std::vector<uint256>& txs_to_remove) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#discussion_r1539335783",
      "id" : 1539335783,
      "in_reply_to_id" : 1536231470,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bwGZn",
      "original_commit_id" : "4b3ec698a228fc531cca946f9a572e1dbdc4b0d5",
      "original_line" : 2349,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1960549193,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28574",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539335783/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T14:16:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539335783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-29T11:10:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-2027088530",
      "id" : 2027088530,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII58540uqS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2027088530/reactions"
      },
      "updated_at" : "2024-03-29T11:10:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2027088530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased after #29130 merge.",
      "created_at" : "2024-03-29T13:59:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-2027285885",
      "id" : 2027285885,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII58541e19",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2027285885/reactions"
      },
      "updated_at" : "2024-03-29T13:59:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2027285885",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23239600985</sub>",
      "created_at" : "2024-05-01T21:59:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-2089200995",
      "id" : 2089200995,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII5858hq1j",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2089200995/reactions"
      },
      "updated_at" : "2024-05-01T21:59:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2089200995",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Turned into draft for now, due to failing CI. If this is no longer a WIP, you can move it out of draft.",
      "created_at" : "2024-05-13T08:05:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28574#issuecomment-2106910223",
      "id" : 2106910223,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28574",
      "node_id" : "IC_kwDOABII5859lOYP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2106910223/reactions"
      },
      "updated_at" : "2024-05-13T08:05:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2106910223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
