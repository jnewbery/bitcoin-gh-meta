[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/28538#pullrequestreview-1645785051), [amitiuttarwar](https://github.com/bitcoin/bitcoin/pull/28538#pullrequestreview-1653859586) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-09-26T19:13:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#issuecomment-1736143850",
      "id" : 1736143850,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28538",
      "node_id" : "IC_kwDOABII585ne3Pq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1736143850/reactions"
      },
      "updated_at" : "2023-10-03T00:25:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1736143850",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1338163650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338163650"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`inbound` -> `outbound`",
      "commit_id" : "32f044df80c69dda0313f0432c745effcc3f0a30",
      "created_at" : "2023-09-27T07:28:15Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full inbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1338163650",
      "id" : 1338163650,
      "line" : 3334,
      "node_id" : "PRRC_kwDOABII585PwsHC",
      "original_commit_id" : "6fa1a219db252106247ce317cbda63bf68ff54de",
      "original_line" : 3334,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1645785051,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338163650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T07:33:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338163650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1338613561"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338613561"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oops - fixed!",
      "commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "created_at" : "2023-09-27T13:29:36Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full inbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1338613561",
      "id" : 1338613561,
      "in_reply_to_id" : 1338163650,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PyZ85",
      "original_commit_id" : "6fa1a219db252106247ce317cbda63bf68ff54de",
      "original_line" : 3334,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1646540255,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338613561/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T13:29:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338613561",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1340225724"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340225724"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In 82e7a7dc3b4447e4affe3a98e1af8b478aa4dc04: Perhaps we could mention on this comment that it doesn't apply in case we're running in `-blocksonly` mode.\r\n```suggestion\r\n        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode) unless we are in -blocksonly mode.\r\n```",
      "commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "created_at" : "2023-09-28T14:15:53Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1340225724",
      "id" : 1340225724,
      "line" : 3334,
      "node_id" : "PRRC_kwDOABII585P4ji8",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3334,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 5,
      "pull_request_review_id" : 1648983811,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340225724/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T14:15:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340225724",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1340936539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340936539"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Rather than doing this immediaely upon connection (ie, after receiving their VERSION message), would it be better to do it only when we have all our outbound slots filled up (ie, as part of `EvictExtraOutboundPeers`) ?\r\n\r\nAlso, doing the check repeatedy would mean that we could keep blocks-only peers while we're doing IBD, only dropping them when we exit IBD and start caring about tx relay.",
      "commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "created_at" : "2023-09-29T06:13:17Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1340936539",
      "id" : 1340936539,
      "line" : 3337,
      "node_id" : "PRRC_kwDOABII585P7RFb",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1650112112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340936539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T06:13:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340936539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1341787514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341787514"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Rather than doing this immediaely upon connection (ie, after receiving their VERSION message), would it be better to do it only when we have all our outbound slots filled up (ie, as part of EvictExtraOutboundPeers) ?\r\n\r\nI like that idea. If for some strange reason we wouldn't be able to find any other peers we wouldn't end up connecting the only ones we have. But I think we would want to start evicting if we are at the limit (so in `CheckForStaleTipAndEvictPeers`), not just if we have exceeded it (`EvictExtraOutboundPeers`).\r\n\r\n> Also, doing the check repeatedy would mean that we could keep blocks-only peers while we're doing IBD, only dropping them when we exit IBD and start caring about tx relay.\r\n\r\nDo we really want that? The main reason to run in `-blocksonly` mode is to save traffic. I would assume that most nodes wouldn't enable listening anyway, but those that do (maybe not even on purpose), maybe it would be nicer not to use them for IBD?",
      "commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "created_at" : "2023-09-29T20:59:17Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1341787514",
      "id" : 1341787514,
      "in_reply_to_id" : 1340936539,
      "line" : 3337,
      "node_id" : "PRRC_kwDOABII585P-g16",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1651470496,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341787514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T20:59:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341787514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1342512709"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1342512709"
         }
      },
      "author_association" : "MEMBER",
      "body" : ">start evicting if we are at the limit (so in CheckForStaleTipAndEvictPeers), not just if we have exceeded it (EvictExtraOutboundPeers).\r\n\r\nI agree.\r\n\r\n>Do we really want that? The main reason to run in -blocksonly mode is to save traffic. I would assume that most nodes wouldn't enable listening anyway, but those that do (maybe not even on purpose), maybe it would be nicer not to use them for IBD?\r\n\r\nNot sure about this. You seem to care specifically about those users which do `-blocksonly` and forget to disable inbounds. Perhaps this is better communicated through documentation and logging. I think we should leave them a chance to strengthen the block relaying network.",
      "commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "created_at" : "2023-10-02T10:17:29Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1342512709",
      "id" : 1342512709,
      "in_reply_to_id" : 1340936539,
      "line" : 3337,
      "node_id" : "PRRC_kwDOABII585QBR5F",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 8,
      "pull_request_review_id" : 1652470431,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1342512709/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-02T10:17:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1342512709",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1343278866"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1343278866"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "+1 to having the logic in eviction instead of connection\r\n\r\nRE IBD: \r\nit seems odd / logically inconsistent to run a node in `-blocksonly` and enable inbounds, so I don't think it's worth overly optimizing for the use case. If we want to improve the user experience, we could have a soft param interaction between the two (independent of these changes)",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-03T00:24:47Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1343278866",
      "id" : 1343278866,
      "in_reply_to_id" : 1340936539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QEM8S",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1653859586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1343278866/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-03T00:25:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1343278866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I've now changed the approach to @ajtowns suggestion to disconnecting during eviction.",
      "created_at" : "2023-10-04T22:07:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#issuecomment-1747715639",
      "id" : 1747715639,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28538",
      "node_id" : "IC_kwDOABII585oLAY3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1747715639/reactions"
      },
      "updated_at" : "2023-10-04T22:07:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1747715639",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346531209"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531209"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> it seems odd / logically inconsistent to run a node in -blocksonly and enable inbounds, so I don't think it's worth overly optimizing for the use case\r\n\r\nMaybe there is a use case for wanting to help the network by providing inbound capacity, but still minimize traffic at the same time? Although then it often doesn't make a lot of sense to run a non-pruned node - unless you also need the entire chain for selfish purposes (e.g. txindex).\r\nIn any case, I have included the suggestion to not evict while in ibd in the latest push!",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-04T22:13:34Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346531209",
      "id" : 1346531209,
      "in_reply_to_id" : 1340936539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QQm-J",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1658576755,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531209/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T22:13:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531209",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346531816"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531816"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I have included this info in the doc for the new spot!",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-04T22:14:27Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346531816",
      "id" : 1346531816,
      "in_reply_to_id" : 1340225724,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QQnHo",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3334,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1658577461,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531816/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T22:14:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346531816",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346632185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346632185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Do we really want that? The main reason to run in `-blocksonly` mode is to save traffic.\r\n\r\nIn that case you'd be better off doing `-maxuploadtarget` either instead of or in addition to `-blocksonly`?\r\n\r\n> it seems odd / logically inconsistent to run a node in `-blocksonly` and enable inbounds,\r\n\r\nI think it would make sense to expect that if 100% (or 99.9%) of nodes were `-blocksonly` that they would still manage to propagate blocks sensibly, bring up new nodes efficiently, etc. In theory with this PR, we would also be able to propagate txs successfully in the 99.9% `-blocksonly` case.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-05T00:38:09Z",
      "diff_hunk" : "@@ -3330,6 +3330,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         }\n         if (!vRecv.empty())\n             vRecv >> fRelay;\n+\n+        // Don't waste any of our full outbound slots on peers that don't want tx relay (because they might be in -blocksonly mode)\n+        if (!fRelay && !m_opts.ignore_incoming_txs && pfrom.IsFullOutboundConn())\n+        {\n+            LogPrint(BCLog::NET, \"peer=%d (full-relay outbound) does not participate in transaction relay; disconnecting\\n\", pfrom.GetId());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1346632185",
      "id" : 1346632185,
      "in_reply_to_id" : 1340936539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QQ_n5",
      "original_commit_id" : "0034a8fa9beae1ffc2a1fbe0c4305d4f933324ac",
      "original_line" : 3337,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1658702432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346632185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T00:38:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346632185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353428699"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353428699"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `Dict::pop` can be provided a default. This could be simplified to:\r\n\r\n```suggestion\r\n        txrelay = kwargs.pop('txrelay', True)\r\n```",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-10T21:09:10Z",
      "diff_hunk" : "@@ -368,13 +371,16 @@ def peer_connect(self, *args, services=P2P_SERVICES, send_version=True, **kwargs\n         create_conn = super().peer_connect(*args, **kwargs)\n \n         if send_version:\n-            self.peer_connect_send_version(services)\n+            self.peer_connect_send_version(services, txrelay=True)\n \n         return create_conn\n \n     def peer_accept_connection(self, *args, services=P2P_SERVICES, **kwargs):\n+        txrelay = True\n+        if 'txrelay' in kwargs:\n+            txrelay = kwargs.pop('txrelay')",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353428699",
      "id" : 1353428699,
      "line" : 381,
      "node_id" : "PRRC_kwDOABII585Qq67b",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 381,
      "original_position" : 30,
      "original_start_line" : 379,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 30,
      "pull_request_review_id" : 1669020341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353428699/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 379,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-11T15:11:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353428699",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353431707"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353431707"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: This can be simplified using the ternary operator\r\n\r\n```suggestion\r\n        vt.relay = P2P_VERSION_RELAY if txrelay else 0\r\n```\r\n\r\nBut also, it may be just simpler to give `txrelay` a default value in the function signature:\r\n\r\n```\r\npeer_connect_send_version(self, services, txrelay=0)\r\n```",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-10T21:13:16Z",
      "diff_hunk" : "@@ -351,12 +351,15 @@ def __init__(self, support_addrv2=False, wtxidrelay=True):\n         # If the peer supports wtxid-relay\n         self.wtxidrelay = wtxidrelay\n \n-    def peer_connect_send_version(self, services):\n+    def peer_connect_send_version(self, services, txrelay):\n         # Send a version msg\n         vt = msg_version()\n         vt.nVersion = P2P_VERSION\n         vt.strSubVer = P2P_SUBVERSION\n-        vt.relay = P2P_VERSION_RELAY\n+        if txrelay:\n+            vt.relay = P2P_VERSION_RELAY\n+        else:\n+            vt.relay = 0",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353431707",
      "id" : 1353431707,
      "line" : 362,
      "node_id" : "PRRC_kwDOABII585Qq7qb",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 362,
      "original_position" : 14,
      "original_start_line" : 359,
      "path" : "test/functional/test_framework/p2p.py",
      "position" : 14,
      "pull_request_review_id" : 1669020341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353431707/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 359,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-11T15:10:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353431707",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353453538"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353453538"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think we should make at least two connections here, otherwise we are not making sure that we are actually not disconnecting **all our outbound** instead of just evicting enough to go bellow the limit",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-10T21:33:17Z",
      "diff_hunk" : "@@ -78,6 +78,33 @@ def blocksonly_mode_tests(self):\n         self.nodes[0].disconnect_p2ps()\n         self.generate(self.nodes[0], 1)\n \n+        self.log.info(\"Check that we sustain full-relay outbound connections to blocksonly peers when not at the full oubound limit\")\n+        blocksonly_peer = self.nodes[0].add_outbound_p2p_connection(P2PInterface(), p2p_idx=1, txrelay=False)\n+        # Trigger CheckForStaleTipAndEvictPeers, which is scheduled every 45s (EXTRA_PEER_CHECK_INTERVAL)\n+        self.nodes[0].mockscheduler(46)\n+        blocksonly_peer.sync_with_ping()\n+        blocksonly_peer.peer_disconnect()\n+\n+        self.log.info(\"Check that we evict full-relay outbound connections to blocksonly peers at the full outbound limit\")\n+        # Simulate the situation of being at the max limit of full-outbound connections by setting -maxconnections=1\n+        self.restart_node(0, [\"-maxconnections=1\"])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353453538",
      "id" : 1353453538,
      "line" : 90,
      "node_id" : "PRRC_kwDOABII585QrA_i",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 90,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/p2p_blocksonly.py",
      "position" : 13,
      "pull_request_review_id" : 1669020341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353453538/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-11T15:12:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353453538",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353461371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353461371"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we need to make this change though? It doesn't look like negative numbers are being used anyway, only whether we are above, or at, zero.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-10T21:39:59Z",
      "diff_hunk" : "@@ -2410,7 +2411,7 @@ int CConnman::GetExtraFullOutboundCount() const\n             }\n         }\n     }\n-    return std::max(full_outbound_peers - m_max_outbound_full_relay, 0);\n+    return full_outbound_peers - m_max_outbound_full_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1353461371",
      "id" : 1353461371,
      "line" : 2414,
      "node_id" : "PRRC_kwDOABII585QrC57",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 2414,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 13,
      "pull_request_review_id" : 1669020341,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353461371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-11T15:10:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1353461371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1354990742"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354990742"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit f3b74d43823a038fb0aa4e0bcb7d4f99a7f90688:\r\n\r\nThe 2 logical paths depending on the value of `extra_outbound_count` could be more clear if this were an `if/else if` block.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-11T13:12:19Z",
      "diff_hunk" : "@@ -5246,6 +5247,28 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             }\n         }\n     }\n+\n+    // If we are at the max full outbound limit but not above, check if any peers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1354990742",
      "id" : 1354990742,
      "line" : 5251,
      "node_id" : "PRRC_kwDOABII585Qw4SW",
      "original_commit_id" : "f3b74d43823a038fb0aa4e0bcb7d4f99a7f90688",
      "original_line" : 5251,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 15,
      "pull_request_review_id" : 1671206009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354990742/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-11T13:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354990742",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1354994889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354994889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "831ed4960bfb1eafb763cb2a52201a97a17f8168: seems like this should be in the `peer_connect_send_version` function docstring?",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-11T13:15:13Z",
      "diff_hunk" : "@@ -673,6 +673,7 @@ def add_p2p_connection(self, p2p_conn, *, wait_for_verack=True, **kwargs):\n     def add_outbound_p2p_connection(self, p2p_conn, *, wait_for_verack=True, p2p_idx, connection_type=\"outbound-full-relay\", **kwargs):\n         \"\"\"Add an outbound p2p connection from node. Must be an\n         \"outbound-full-relay\", \"block-relay-only\", \"addr-fetch\" or \"feeler\" connection.\n+        The txrelay arg determines whether our peer will signal support for txrelay in their version message.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1354994889",
      "id" : 1354994889,
      "line" : 676,
      "node_id" : "PRRC_kwDOABII585Qw5TJ",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 676,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/test_node.py",
      "position" : 4,
      "pull_request_review_id" : 1671206009,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354994889/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-11T13:17:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1354994889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1355464069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355464069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What if there is, at least, a node already flagged to be disconnected? Shouldn't we skip this altogether? Otherwise, it could be the case that we end up evicting more nodes that we really need to",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-11T17:44:48Z",
      "diff_hunk" : "@@ -5246,6 +5247,28 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             }\n         }\n     }\n+\n+    // If we are at the max full outbound limit but not above, check if any peers\n+    // don't support tx relay (they might be in -blocksonly mode) - if so,\n+    // evict the newest of them so we can fill the slot with a tx-relaying outbound peer\n+    // This is not done if we are in -blocksonly mode ourselves or still in IBD,\n+    // because then we don't care if our peer supports tx relay.\n+    if (extra_outbound_count == 0 && !m_opts.ignore_incoming_txs && !m_chainman.IsInitialBlockDownload()) {\n+        std::optional<NodeId> node_to_evict;\n+        m_connman.ForEachNode([&node_to_evict](CNode* node) {\n+            if (!node->IsFullOutboundConn() || node->m_relays_txs) return;\n+            if (!node_to_evict.has_value() || *node_to_evict < node->GetId()) {\n+                node_to_evict = node->GetId();\n+            }\n+        });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1355464069",
      "id" : 1355464069,
      "line" : 5263,
      "node_id" : "PRRC_kwDOABII585Qyr2F",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 5263,
      "original_position" : 27,
      "original_start_line" : 5258,
      "path" : "src/net_processing.cpp",
      "position" : 27,
      "pull_request_review_id" : 1672063437,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355464069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5258,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-11T17:45:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355464069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1355494051"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355494051"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nvm, `ForEachNode` already checks `NodeFullyConnected`",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-11T17:57:59Z",
      "diff_hunk" : "@@ -5246,6 +5247,28 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             }\n         }\n     }\n+\n+    // If we are at the max full outbound limit but not above, check if any peers\n+    // don't support tx relay (they might be in -blocksonly mode) - if so,\n+    // evict the newest of them so we can fill the slot with a tx-relaying outbound peer\n+    // This is not done if we are in -blocksonly mode ourselves or still in IBD,\n+    // because then we don't care if our peer supports tx relay.\n+    if (extra_outbound_count == 0 && !m_opts.ignore_incoming_txs && !m_chainman.IsInitialBlockDownload()) {\n+        std::optional<NodeId> node_to_evict;\n+        m_connman.ForEachNode([&node_to_evict](CNode* node) {\n+            if (!node->IsFullOutboundConn() || node->m_relays_txs) return;\n+            if (!node_to_evict.has_value() || *node_to_evict < node->GetId()) {\n+                node_to_evict = node->GetId();\n+            }\n+        });",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1355494051",
      "id" : 1355494051,
      "in_reply_to_id" : 1355464069,
      "line" : 5263,
      "node_id" : "PRRC_kwDOABII585QyzKj",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 5263,
      "original_position" : 27,
      "original_start_line" : 5258,
      "path" : "src/net_processing.cpp",
      "position" : 27,
      "pull_request_review_id" : 1672122122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355494051/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 5258,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-11T17:57:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1355494051",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1356102682"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356102682"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Negative numbers mean neither of those code blocks are executed; if it was `max{...,0}` then the \"at zero\" code block would be executed when it shouldn't be.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-12T06:05:03Z",
      "diff_hunk" : "@@ -2410,7 +2411,7 @@ int CConnman::GetExtraFullOutboundCount() const\n             }\n         }\n     }\n-    return std::max(full_outbound_peers - m_max_outbound_full_relay, 0);\n+    return full_outbound_peers - m_max_outbound_full_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1356102682",
      "id" : 1356102682,
      "in_reply_to_id" : 1353461371,
      "line" : 2414,
      "node_id" : "PRRC_kwDOABII585Q1Hwa",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 2414,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 13,
      "pull_request_review_id" : 1673093885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356102682/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T06:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356102682",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1356897453"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356897453"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, because we want to execute code for the case in which we are exactly at the limit, and being under the limit will be mapped to the same value. My bad.\r\n\r\nI have to say though that, after this change, the function name becomes a bit confusing.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-12T14:15:20Z",
      "diff_hunk" : "@@ -2410,7 +2411,7 @@ int CConnman::GetExtraFullOutboundCount() const\n             }\n         }\n     }\n-    return std::max(full_outbound_peers - m_max_outbound_full_relay, 0);\n+    return full_outbound_peers - m_max_outbound_full_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1356897453",
      "id" : 1356897453,
      "in_reply_to_id" : 1353461371,
      "line" : 2414,
      "node_id" : "PRRC_kwDOABII585Q4Jyt",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 2414,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 13,
      "pull_request_review_id" : 1674295407,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356897453/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T14:15:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1356897453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
         "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sr-gi/followers",
         "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sr-gi",
         "id" : 6665628,
         "login" : "sr-gi",
         "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
         "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
         "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
         "repos_url" : "https://api.github.com/users/sr-gi/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sr-gi"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1357316623"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1357316623"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> I have to say though that, after this change, the function name becomes a bit confusing.\r\n\r\nI had a quick look at changing it to `return full_outbound_peers` and doing the comparison with `m_max_outbound_full_relay` in the caller. Would require exposing the latter value to net_processing, but otherwise seems like it works. Wasn't convinced it was enough of an improvement to bother though.",
      "commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "created_at" : "2023-10-12T19:40:37Z",
      "diff_hunk" : "@@ -2410,7 +2411,7 @@ int CConnman::GetExtraFullOutboundCount() const\n             }\n         }\n     }\n-    return std::max(full_outbound_peers - m_max_outbound_full_relay, 0);\n+    return full_outbound_peers - m_max_outbound_full_relay;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28538#discussion_r1357316623",
      "id" : 1357316623,
      "in_reply_to_id" : 1353461371,
      "line" : 2414,
      "node_id" : "PRRC_kwDOABII585Q5wIP",
      "original_commit_id" : "831ed4960bfb1eafb763cb2a52201a97a17f8168",
      "original_line" : 2414,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 13,
      "pull_request_review_id" : 1675033877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28538",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1357316623/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-12T19:40:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1357316623",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
