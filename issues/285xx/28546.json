{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "During migration, `CWalletTx` objects that no longer belong to the migrated wallet are moved to a watchonly wallet. But because the migrated wallet is offline (has null `m_chain`), the `confirmed_block_height` and `conflicting_block_height` values in these transactions are -1. These values need to be updated before they are moved to the watchonly wallet, because the watchonly wallet is online, and remains loaded after the migration is complete. Not updating these values could lead to the watchonly wallet returning incorrect information and potentially triggering assert failures.\r\n\r\nThe problem is only temporary since the height values would be refreshed the next time the watchonly wallet is loaded, but it is worth fixing to avoid unpredictable behavior.\r\n\r\nNoticed while reviewing #28542, and looking for other cases where negative confirmed_block_height and conflicting_block_height values might be used.\r\n\r\nAn easy way to test this bug is to revert the bugfix in the second commit. Then the assert added in the third commit will trigger a crash when `getwalletinfo` is called in [`wallet_migration.py`](https://github.com/bitcoin/bitcoin/blob/c9f288244b8d183e09a917025922b99e3368ef78/test/functional/wallet_migration.py#L250)\r\n\r\n\r\n \r\n",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546/comments",
   "created_at" : "2023-09-27T17:22:33Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/28546",
   "id" : 1916017881,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585bXTk0",
   "number" : 28546,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/28546.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28546",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/28546.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28546"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546/timeline",
   "title" : "bugfix: watchonly wallets created after migration have incorrect height values",
   "updated_at" : "2023-09-27T17:34:09Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28546",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
      "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ryanofsky/followers",
      "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ryanofsky",
      "id" : 7133040,
      "login" : "ryanofsky",
      "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
      "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
      "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
      "repos_url" : "https://api.github.com/users/ryanofsky/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ryanofsky"
   }
}
