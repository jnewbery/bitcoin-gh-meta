[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28775).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28622](https://github.com/bitcoin/bitcoin/pull/28622) (build: use macOS 14 SDK (Xcode 15.0) by fanquake)\n* [#21778](https://github.com/bitcoin/bitcoin/pull/21778) (build: LLD based macOS toolchain by fanquake)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-11-02T13:45:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28775#issuecomment-1790766080",
      "id" : 1790766080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28775",
      "node_id" : "IC_kwDOABII585qvOwA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790766080/reactions"
      },
      "updated_at" : "2023-11-02T14:27:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790766080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you explain the patch? What is the actual problem, and how does this fix it?\r\nSeems a bit odd to have to patch version detection checks inside Qt, can the correct values not be passed in from the outside?",
      "created_at" : "2023-11-02T13:49:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28775#issuecomment-1790775227",
      "id" : 1790775227,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28775",
      "node_id" : "IC_kwDOABII585qvQ-7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790775227/reactions"
      },
      "updated_at" : "2023-11-02T13:49:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790775227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you explain the patch? What is the actual problem, and how does this fix it? Seems a bit odd to have to patch version detection checks inside Qt, can the correct values not be passed in from the outside?\r\n\r\nIn macOS SDK, the problematic `os/activity.h` header relies on the `OS_LOG_TARGET_HAS_10_12_FEATURES` macro:\r\n```c++\r\n#if OS_LOG_TARGET_HAS_10_12_FEATURES\r\n#ifndef OS_ACTIVITY_OBJECT_API\r\n#define OS_ACTIVITY_OBJECT_API 1\r\n#endif // OS_ACTIVITY_OBJECT_API\r\n#else\r\n#if OS_ACTIVITY_OBJECT_API\r\n#error Please change your minimum OS requirements because OS_ACTIVITY_OBJECT_API is not available\r\n#endif // OS_ACTIVITY_OBJECT_API\r\n#define OS_ACTIVITY_OBJECT_API 0\r\n#endif // OS_LOG_TARGET_HAS_10_12_FEATURES\r\n```\r\n\r\nThat macro in turn is defined in the `os/trace_base.h` header:\r\n```c++\r\n#if __OS_LOG_OS_FEATURES_AT_LEAST(10_12, 10_0, 10_0, 3_0)\r\n#define OS_LOG_TARGET_HAS_10_12_FEATURES 1\r\n#else\r\n#define OS_LOG_TARGET_HAS_10_12_FEATURES 0\r\n#endif\r\n```\r\n\r\nwhich depends on the `__MAC_OS_X_VERSION_MIN_REQUIRED` macro value.\r\n\r\nThe patch modifies the only code in the whole Qt codebase where the `__MAC_OS_X_VERSION_MIN_REQUIRED` macro is defined. The other `MAC_OS_X_VERSION_MIN_REQUIRED` macro is adjusted for consistency.",
      "created_at" : "2023-11-02T13:59:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28775#issuecomment-1790792236",
      "id" : 1790792236,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28775",
      "node_id" : "IC_kwDOABII585qvVIs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790792236/reactions"
      },
      "updated_at" : "2023-11-02T13:59:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790792236",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> the problematic os/activity.h header \r\n\r\nWhat is the problem with the header?\r\n\r\nThe (availability.h) macros are set via the `-mmacosx-version-min` flag (which we set): \r\n> For these macros to function properly, a program must specify the OS version range \r\n> it is targeting.  The min OS version is specified as an option to the compiler:\r\n> -mmacosx-version-min=10.x when building for Mac OS X, \r\n\r\nWhy do we need to hardcode them to the values that they should already be being set too?",
      "created_at" : "2023-11-02T14:13:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28775#issuecomment-1790817038",
      "id" : 1790817038,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28775",
      "node_id" : "IC_kwDOABII585qvbMO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790817038/reactions"
      },
      "updated_at" : "2023-11-02T14:13:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790817038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > the problematic os/activity.h header\r\n> \r\n> What is the problem with the header?\r\n\r\nThe `OS_ACTIVITY_OBJECT_API` is set to `0`, which makes a bunch of code unavailable, which in turn causes compile errors.\r\n\r\n> The (availability.h) macros are set via the `-mmacosx-version-min` flag (which we set):\r\n> \r\n> > For these macros to function properly, a program must specify the OS version range\r\n> > it is targeting.  The min OS version is specified as an option to the compiler:\r\n> > -mmacosx-version-min=10.x when building for Mac OS X,\r\n\r\nI know this. But I can't see in the code how the `-mmacosx-version-min` flag affect the `__MAC_OS_X_VERSION_MIN_REQUIRED` macro, which is the one that is evaluated in the `os/activity.h` header.\r\n\r\nAlso, there is a comment in the `Availability.h` header:\r\n```\r\n    It is also possible to use the *_VERSION_MIN_REQUIRED in source code to make one\r\n    source base that can be compiled to target a range of OS versions.  It is best\r\n    to not use the _MAC_* and __IPHONE_* macros for comparisons, but rather their values.\r\n    That is because you might get compiled on an old OS that does not define a later\r\n    OS version macro, and in the C preprocessor undefined values evaluate to zero\r\n    in expresssions, which could cause the #if expression to evaluate in an unexpected\r\n    way.\r\n    \r\n        #ifdef __MAC_OS_X_VERSION_MIN_REQUIRED\r\n            // code only compiled when targeting Mac OS X and not iPhone\r\n            // note use of 1050 instead of __MAC_10_5\r\n            #if __MAC_OS_X_VERSION_MIN_REQUIRED < 1050\r\n                // code in here might run on pre-Leopard OS\r\n            #else\r\n                // code here can assume Leopard or later\r\n            #endif\r\n        #endif\r\n```\r\n\r\n> Why do we need to hardcode them to the values that they should already be being set too?\r\n\r\nWe don't introduce hardcoded values. We rather are adjusting the current inappropriate values, no?",
      "created_at" : "2023-11-02T14:27:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28775#issuecomment-1790840873",
      "id" : 1790840873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28775",
      "node_id" : "IC_kwDOABII585qvhAp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790840873/reactions"
      },
      "updated_at" : "2023-11-02T14:27:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1790840873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   }
]
