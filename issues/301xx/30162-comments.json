[
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615703491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491"
         }
      },
      "author_association" : "NONE",
      "body" : "In the previous implementation, it seemed a little unusual that `b'a'` was added first, and then more padding was added later. The newer approach seems cleaner where padding is added only once.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:34:55Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615703491",
      "id" : 1615703491,
      "line" : 124,
      "node_id" : "PRRC_kwDOABII585gTa3D",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 124,
      "original_position" : 20,
      "original_start_line" : 122,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 28,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491/reactions"
      },
      "side" : "LEFT",
      "start_line" : 122,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615703491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615705400"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400"
         }
      },
      "author_association" : "NONE",
      "body" : "Though it's older implementation, for my understanding, why is the actual weight more than the `target_weight`. Doesn't `target_weight` become a misnomer with this?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:36:27Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615705400",
      "id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gTbU4",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615705400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615708591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591"
         }
      },
      "author_association" : "NONE",
      "body" : "Non blocking nit: This seems to be testing for a specific piece and if you don't anticipate it to be updated later, WDYT about either adding this test in an existing functional test, or adding this in the unit tests of the functional test framework?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:38:59Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2024 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test MiniWallet.\"\"\"\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+    MiniWalletMode,\n+)\n+\n+\n+class FeatureFrameworkMiniWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def test_tx_padding(self):\n+        \"\"\"Verify that MiniWallet's transaction padding (`target_weight` parameter)\n+           works accurately enough (i.e. at most 3 WUs higher) with all modes.\"\"\"\n+        for mode_name, wallet in self.wallets:\n+            self.log.info(f\"Test tx padding with MiniWallet mode {mode_name}...\")\n+            utxo = wallet.get_utxo(mark_as_spent=False)\n+            for target_weight in [1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000, 4000000,\n+                                  989,  2001, 4337, 13371, 23219, 49153, 102035, 223419, 3999989]:\n+                tx = wallet.create_self_transfer(utxo_to_spend=utxo, target_weight=target_weight)[\"tx\"]\n+                self.log.debug(f\"-> target weight: {target_weight}, actual weight: {tx.get_weight()}\")\n+                assert_greater_than_or_equal(tx.get_weight(), target_weight)\n+                assert_greater_than_or_equal(target_weight + 3, tx.get_weight())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615708591",
      "id" : 1615708591,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585gTcGv",
      "original_commit_id" : "372e5a7492b0beb60e096efc96c11391a88cb321",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 31,
      "path" : "test/functional/feature_framework_miniwallet.py",
      "position" : 32,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 31,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615708591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615710140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140"
         }
      },
      "author_association" : "NONE",
      "body" : "Should there also be an assertion disallowing passing both `target_weight` and `fee`?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:40:17Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615710140",
      "id" : 1615710140,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585gTce8",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 374,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615710140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615711645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645"
         }
      },
      "author_association" : "NONE",
      "body" : "As per the code in `_bulk_tx`, the actual weight is indeed off by 3 WUs, consider getting rid of `might be` here, it adds a bit of uncertainty imo.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:41:21Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615711645",
      "id" : 1615711645,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII585gTc2d",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 375,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615711645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615712714"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice to see the removal of many of these repetitive fee calculation code!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:42:16Z",
      "diff_hunk" : "@@ -59,7 +59,7 @@ def test_rbf_carveout_disallowed(self):\n         mempoolmin_feerate = node.getmempoolinfo()[\"mempoolminfee\"]\n         tx_A = self.wallet.send_self_transfer(\n             from_node=node,\n-            fee=(mempoolmin_feerate / 1000) * (A_weight // 4) + Decimal('0.000001'),\n+            fee_rate=mempoolmin_feerate,",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615712714",
      "id" : 1615712714,
      "line" : 62,
      "node_id" : "PRRC_kwDOABII585gTdHK",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 62,
      "original_position" : 5,
      "original_start_line" : 62,
      "path" : "test/functional/mempool_limit.py",
      "position" : 5,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 62,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615712714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615734654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654"
         }
      },
      "author_association" : "NONE",
      "body" : "The previous implementation is 10^-5, and the newer one is 10^-6.\r\nIMO, it's worth creating it a constant with an expressive name to make reading this piece easier.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T08:58:59Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615734654",
      "id" : 1615734654,
      "line" : 317,
      "node_id" : "PRRC_kwDOABII585gTid-",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 317,
      "original_position" : 46,
      "original_start_line" : 317,
      "path" : "test/functional/mempool_limit.py",
      "position" : 46,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 317,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615734654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615736403"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403"
         }
      },
      "author_association" : "NONE",
      "body" : "Preference style: Although this is not a fresh test, but IMHO it makes it far easier for the reviewer to read when the variable name contains the unit as well such as `child_feerate_satvb` or `child_fee_sat`.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T09:00:16Z",
      "diff_hunk" : "@@ -314,18 +314,20 @@ def run_test(self):\n         target_weight_each = 200000\n         assert_greater_than(target_weight_each * 2, node.getmempoolinfo()[\"maxmempool\"] - node.getmempoolinfo()[\"bytes\"])\n         # Should be a true CPFP: parent's feerate is just below mempool min feerate\n-        parent_fee = (mempoolmin_feerate / 1000) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        parent_feerate = mempoolmin_feerate - Decimal(\"0.000001\")  # 0.1 sats/vbyte below min feerate\n         # Parent + child is above mempool minimum feerate\n-        child_fee = (worst_feerate_btcvb) * (target_weight_each // 4) - Decimal(\"0.00001\")\n+        child_feerate = (worst_feerate_btcvb * 1000) - Decimal(\"0.000001\")  # 0.1 sats/vbyte below worst feerate",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615736403",
      "id" : 1615736403,
      "line" : 319,
      "node_id" : "PRRC_kwDOABII585gTi5T",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 319,
      "original_position" : 49,
      "original_start_line" : 319,
      "path" : "test/functional/mempool_limit.py",
      "position" : 49,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 319,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615736403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615739344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344"
         }
      },
      "author_association" : "NONE",
      "body" : "Nice catch here that fixes the calculation!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T09:02:32Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1615739344",
      "id" : 1615739344,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585gTjnQ",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 127,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 31,
      "pull_request_review_id" : 2080359105,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T09:04:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1615739344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Each byte in the output script counts as four weight units, so with the padding method used here, we can only ever increase the weight by multiples of four. If the weight of the unpadded tx is not a multiple of four already (i.e. tx.get_weight() % 4 != 0), it will also not be after the padding and the best we can do is to be not more off than 3 WUs in the worst case.\r\n\r\nIt would be nice if we could somehow do exact padding with weight unit precision, but to my knowledge there is no general way to add extra witness data to transactions without making them non-standard. (For example, the test feature_fastprune.py [uses an annex in the witness for padding](https://github.com/bitcoin/bitcoin/blob/327f08bb0cd91a22249395adeb34549e3c86ca76/test/functional/feature_fastprune.py#L22), but that is only consensus-valid, [not policy-valid](https://github.com/bitcoin/bitcoin/blob/327f08bb0cd91a22249395adeb34549e3c86ca76/src/policy/policy.cpp#L268-L271)).",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:35:47Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751",
      "id" : 1616064751,
      "in_reply_to_id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gUzDv",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2080944224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:35:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We need a running node to create a MiniWallet instance, so unfortunately doing these checks in an unit test wouldn't work. I considered putting it into an existing functional test but wouldn't know which one to pick, so creating a new MiniWallet-specific test where features can tested independently seemed to make the most sense.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:00Z",
      "diff_hunk" : "@@ -0,0 +1,49 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2024 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test MiniWallet.\"\"\"\n+from test_framework.blocktools import COINBASE_MATURITY\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_greater_than_or_equal,\n+)\n+from test_framework.wallet import (\n+    MiniWallet,\n+    MiniWalletMode,\n+)\n+\n+\n+class FeatureFrameworkMiniWalletTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+\n+    def test_tx_padding(self):\n+        \"\"\"Verify that MiniWallet's transaction padding (`target_weight` parameter)\n+           works accurately enough (i.e. at most 3 WUs higher) with all modes.\"\"\"\n+        for mode_name, wallet in self.wallets:\n+            self.log.info(f\"Test tx padding with MiniWallet mode {mode_name}...\")\n+            utxo = wallet.get_utxo(mark_as_spent=False)\n+            for target_weight in [1000, 2000, 5000, 10000, 20000, 50000, 100000, 200000, 4000000,\n+                                  989,  2001, 4337, 13371, 23219, 49153, 102035, 223419, 3999989]:\n+                tx = wallet.create_self_transfer(utxo_to_spend=utxo, target_weight=target_weight)[\"tx\"]\n+                self.log.debug(f\"-> target weight: {target_weight}, actual weight: {tx.get_weight()}\")\n+                assert_greater_than_or_equal(tx.get_weight(), target_weight)\n+                assert_greater_than_or_equal(target_weight + 3, tx.get_weight())",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064960",
      "id" : 1616064960,
      "in_reply_to_id" : 1615708591,
      "line" : 32,
      "node_id" : "PRRC_kwDOABII585gUzHA",
      "original_commit_id" : "372e5a7492b0beb60e096efc96c11391a88cb321",
      "original_line" : 32,
      "original_position" : 32,
      "original_start_line" : 31,
      "path" : "test/functional/feature_framework_miniwallet.py",
      "position" : 32,
      "pull_request_review_id" : 2080944602,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 31,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616064960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Passing `target_weight` with an absolute `fee` should still work fine. There is arguably less reason now to do so as passing a `fee_rate` is likely more convenient for most use-cases, but I don't think we have to disallow padding txs with an absolute fee.",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:10Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065138",
      "id" : 1616065138,
      "in_reply_to_id" : 1615710140,
      "line" : 374,
      "node_id" : "PRRC_kwDOABII585gUzJy",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 374,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 12,
      "pull_request_review_id" : 2080944925,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065536"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The actual weight can be larger by at most 3 WUs, [see comment above](https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616064751).",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-27T13:36:34Z",
      "diff_hunk" : "@@ -370,6 +371,10 @@ def create_self_transfer(\n             vsize = Decimal(168)  # P2PK (73 bytes scriptSig + 35 bytes scriptPubKey + 60 bytes other)\n         else:\n             assert False\n+        if target_weight and not fee:  # respect fee_rate if target weight is passed\n+            # the actual weight might be off by 3 WUs, so calculate based on that (see self._bulk_tx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1616065536",
      "id" : 1616065536,
      "in_reply_to_id" : 1615711645,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII585gUzQA",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 375,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 13,
      "pull_request_review_id" : 2080945639,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-27T13:36:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1616065536",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620213384"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384"
         }
      },
      "author_association" : "NONE",
      "body" : "Hmm from the way I understand this, addition of 3 is helpful in the case when `(target_weight - tx.get_weight() < 4` because otherwise the floor division by 4 will cause no padding to be added and the transaction will end up being same in vbytes. Is this the right way to understand this?\r\n\r\nTying this to an earlier comment of mine - if `target_weight` had been called `target_weight_wu`, the code would become more self explanatory.\r\n\r\nI feel this is worth adding as a comment for reference in the code, and thanks for the explanation!",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T08:10:36Z",
      "diff_hunk" : "@@ -119,13 +121,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620213384",
      "id" : 1620213384,
      "in_reply_to_id" : 1615705400,
      "line" : 126,
      "node_id" : "PRRC_kwDOABII585gkn6I",
      "original_commit_id" : "0dda80b759e9a58bfae941ef629bee43da79152d",
      "original_line" : 125,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 27,
      "pull_request_review_id" : 2087557101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T08:10:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620213384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620225868"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868"
         }
      },
      "author_association" : "NONE",
      "body" : "I've been trying to think why 1 is subtracted here, but could not come up with a thorough reason. Is it somehow related to excluding the already serialised length of the output script before padding?",
      "commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "created_at" : "2024-05-30T08:16:00Z",
      "diff_hunk" : "@@ -119,13 +122,14 @@ def _bulk_tx(self, tx, target_weight):\n         \"\"\"Pad a transaction with extra outputs until it reaches a target weight (or higher).\n         returns the tx\n         \"\"\"\n-        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN, b'a'])))\n+        tx.vout.append(CTxOut(nValue=0, scriptPubKey=CScript([OP_RETURN])))\n         dummy_vbytes = (target_weight - tx.get_weight() + 3) // 4\n-        tx.vout[-1].scriptPubKey = CScript([OP_RETURN, b'a' * dummy_vbytes])\n-        # Lower bound should always be off by at most 3\n+        # compensate for the compact-size encoded script length\n+        dummy_vbytes -= len(ser_compact_size(dummy_vbytes)) - 1",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30162#discussion_r1620225868",
      "id" : 1620225868,
      "line" : 128,
      "node_id" : "PRRC_kwDOABII585gkq9M",
      "original_commit_id" : "93527b82e70c8e19d7317ce5287b0ee2a0020f1b",
      "original_line" : 128,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/wallet.py",
      "position" : 31,
      "pull_request_review_id" : 2087576041,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30162",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T08:16:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1620225868",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5960750?v=4",
         "events_url" : "https://api.github.com/users/rkrux/events{/privacy}",
         "followers_url" : "https://api.github.com/users/rkrux/followers",
         "following_url" : "https://api.github.com/users/rkrux/following{/other_user}",
         "gists_url" : "https://api.github.com/users/rkrux/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/rkrux",
         "id" : 5960750,
         "login" : "rkrux",
         "node_id" : "MDQ6VXNlcjU5NjA3NTA=",
         "organizations_url" : "https://api.github.com/users/rkrux/orgs",
         "received_events_url" : "https://api.github.com/users/rkrux/received_events",
         "repos_url" : "https://api.github.com/users/rkrux/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/rkrux/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/rkrux/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/rkrux"
      }
   }
]
