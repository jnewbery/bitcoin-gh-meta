[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30125).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/30125#issuecomment-2116045523) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2024-05-16T17:48:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30125#issuecomment-2115856230",
      "id" : 2115856230,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30125",
      "node_id" : "IC_kwDOABII585-HWdm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2115856230/reactions"
      },
      "updated_at" : "2024-05-16T19:37:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2115856230",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30125#discussion_r1603933797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30125"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603933797"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might want to note that the implemenation handles only bdb files with the same endian as the host.",
      "commit_id" : "d166e8886c21db074b2f9a490ba6bb10304e3a89",
      "created_at" : "2024-05-16T19:30:45Z",
      "diff_hunk" : "@@ -6,44 +6,54 @@\n Utilities for working directly with the wallet's BDB database file\n \n This is specific to the configuration of BDB used in this project:\n-    - pagesize: 4096 bytes\n     - Outer database contains single subdatabase named 'main'\n     - btree\n-    - btree leaf pages\n+    - btree internal, leaf and overflow pages\n \n-Each key-value pair is two entries in a btree leaf. The first is the key, the one that follows\n+Each key-value pair is two entries in a btree leaf, which optionally refers to overflow pages\n+if the data doesn't fit into a single page. The first entry is the key, the one that follows\n is the value. And so on. Note that the entry data is itself not in the correct order. Instead\n entry offsets are stored in the correct order and those offsets are needed to then retrieve\n the data itself.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30125#discussion_r1603933797",
      "id" : 1603933797,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII585fmhZl",
      "original_commit_id" : "d166e8886c21db074b2f9a490ba6bb10304e3a89",
      "original_line" : 17,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/bdb.py",
      "position" : 15,
      "pull_request_review_id" : 2061712087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30125",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603933797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-16T19:30:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603933797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30125#discussion_r1603934797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30125"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603934797"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Forgot `=`\r\nEdit: doesn't matter, it only affects alignment versus the default of `@`, and a byte after a short will always have the same alignment",
      "commit_id" : "d166e8886c21db074b2f9a490ba6bb10304e3a89",
      "created_at" : "2024-05-16T19:31:49Z",
      "diff_hunk" : "@@ -56,20 +66,35 @@ def dump_leaf_page(data):\n     page_info['entry_offsets'] = struct.unpack('{}H'.format(entries), data[26:26 + entries * 2])\n     page_info['entries'] = []\n \n-    if pg_type == BTREE_INTERNAL:\n-        # Skip internal pages. These are the internal nodes of the btree and don't contain anything relevant to us\n-        return None\n+    assert pg_type in (BTREE_INTERNAL, BTREE_LEAF, OVERFLOW_DATA)\n \n-    assert pg_type == BTREE_LEAF, 'A non-btree leaf page has been encountered while dumping leaves'\n+    if pg_type == OVERFLOW_DATA:\n+        assert entries == 1\n+        page_info['entries'].append({'data': data[26:26 + hf_offset]})\n+        return page_info\n \n     for i in range(0, entries):\n+        entry = {}\n         offset = page_info['entry_offsets'][i]\n-        entry = {'offset': offset}\n-        page_data_header = data[offset:offset + 3]\n-        e_len, pg_type = struct.unpack('HB', page_data_header)\n-        entry['len'] = e_len\n-        entry['pg_type'] = pg_type\n-        entry['data'] = data[offset + 3:offset + 3 + e_len]\n+        record_header = data[offset:offset + 3]\n+        offset += 3\n+        e_len, record_type = struct.unpack('HB', record_header)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30125#discussion_r1603934797",
      "id" : 1603934797,
      "line" : 81,
      "node_id" : "PRRC_kwDOABII585fmhpN",
      "original_commit_id" : "d166e8886c21db074b2f9a490ba6bb10304e3a89",
      "original_line" : 81,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/bdb.py",
      "position" : 94,
      "pull_request_review_id" : 2061713824,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30125",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603934797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-16T19:33:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603934797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Code review ACK, from what i learned about how BDB databases work internally, implementation looks correct on first glance.",
      "created_at" : "2024-05-16T19:37:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30125#issuecomment-2116045523",
      "id" : 2116045523,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30125",
      "node_id" : "IC_kwDOABII585-IErT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2116045523/reactions"
      },
      "updated_at" : "2024-05-16T19:37:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2116045523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/126646?v=4",
         "events_url" : "https://api.github.com/users/laanwj/events{/privacy}",
         "followers_url" : "https://api.github.com/users/laanwj/followers",
         "following_url" : "https://api.github.com/users/laanwj/following{/other_user}",
         "gists_url" : "https://api.github.com/users/laanwj/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/laanwj",
         "id" : 126646,
         "login" : "laanwj",
         "node_id" : "MDQ6VXNlcjEyNjY0Ng==",
         "organizations_url" : "https://api.github.com/users/laanwj/orgs",
         "received_events_url" : "https://api.github.com/users/laanwj/received_events",
         "repos_url" : "https://api.github.com/users/laanwj/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/laanwj/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/laanwj"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-05-21T10:53:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30125#issuecomment-2122358636",
      "id" : 2122358636,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30125",
      "node_id" : "IC_kwDOABII585-gJ9s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2122358636/reactions"
      },
      "updated_at" : "2024-05-21T10:53:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2122358636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
