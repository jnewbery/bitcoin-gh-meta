[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30141).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [ajtowns](https://github.com/bitcoin/bitcoin/pull/30141#pullrequestreview-2066739761), [theuni](https://github.com/bitcoin/bitcoin/pull/30141#pullrequestreview-2145715522) |\n| Stale ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2180895187), [stickies-v](https://github.com/bitcoin/bitcoin/pull/30141#pullrequestreview-2128509733) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30344](https://github.com/bitcoin/bitcoin/pull/30344) (kernel: remove mempool_persist by theuni)\n* [#30342](https://github.com/bitcoin/bitcoin/pull/30342) (kernel, logging: Pass Logger instances to kernel objects by ryanofsky)\n* [#30332](https://github.com/bitcoin/bitcoin/pull/30332) (Stratum v2 connectivity by Sjors)\n* [#29745](https://github.com/bitcoin/bitcoin/pull/29745) (bench: Adds a benchmark for CheckInputScripts by kevkevinpal)\n* [#28676](https://github.com/bitcoin/bitcoin/pull/28676) ([WIP] Cluster mempool implementation by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-05-19T14:17:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2119254138",
      "id" : 2119254138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII585-UUB6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2119254138/reactions"
      },
      "updated_at" : "2024-06-28T11:37:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2119254138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607094214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607094214"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Rather than adding an error return in the constructor here, wouldn't it be better to change our cuckoo cache to clamp its size when given too large a value? ie, `InitScriptExecutionCache(135000000)` is treated as `134,217,727` instead? The value passed in is only used as an approximate target in the first place. Historical context is #25527.\r\n\r\n<details>\r\n<summary>(example patch)</summary>\r\n\r\n```diff\r\n--- a/src/cuckoocache.h\r\n+++ b/src/cuckoocache.h\r\n@@ -360,16 +360,16 @@ public:\r\n      * structure\r\n      * @returns A pair of the maximum number of elements storable (see setup()\r\n      * documentation for more detail) and the approximate total size of these\r\n-     * elements in bytes or std::nullopt if the size requested is too large.\r\n+     * elements in bytes.\r\n      */\r\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\r\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\r\n     {\r\n         size_t requested_num_elems = bytes / sizeof(Element);\r\n         if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\r\n-            return std::nullopt;\r\n+            requested_num_elems = std::numeric_limits<uint32_t>::max();\r\n         }\r\n \r\n-        auto num_elems = setup(bytes/sizeof(Element));\r\n+        auto num_elems = setup(requested_num_elems);\r\n \r\n         size_t approx_size_bytes = num_elems * sizeof(Element);\r\n         return std::make_pair(num_elems, approx_size_bytes);\r\n--- a/src/script/sigcache.cpp\r\n+++ b/src/script/sigcache.cpp\r\n@@ -77,7 +77,7 @@ public:\r\n         std::unique_lock<std::shared_mutex> lock(cs_sigcache);\r\n         setValid.insert(entry);\r\n     }\r\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t n)\r\n+    std::pair<uint32_t, size_t> setup_bytes(size_t n)\r\n     {\r\n         return setValid.setup_bytes(n);\r\n     }\r\n@@ -96,10 +96,7 @@ static CSignatureCache signatureCache;\r\n // signatureCache.\r\n bool InitSignatureCache(size_t max_size_bytes)\r\n {\r\n-    auto setup_results = signatureCache.setup_bytes(max_size_bytes);\r\n-    if (!setup_results) return false;\r\n-\r\n-    const auto [num_elems, approx_size_bytes] = *setup_results;\r\n+    const auto [num_elems, approx_size_bytes] = signatureCache.setup_bytes(max_size_bytes);\r\n     LogPrintf(\"Using %zu MiB out of %zu MiB requested for signature cache, able to store %zu elements\\n\",\r\n               approx_size_bytes >> 20, max_size_bytes >> 20, num_elems);\r\n     return true;\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -1939,10 +1939,8 @@ bool InitScriptExecutionCache(size_t max_size_bytes)\r\n     g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\r\n     g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\r\n \r\n-    auto setup_results = g_scriptExecutionCache.setup_bytes(max_size_bytes);\r\n-    if (!setup_results) return false;\r\n+    const auto [num_elems, approx_size_bytes] = g_scriptExecutionCache.setup_bytes(max_size_bytes);\r\n \r\n-    const auto [num_elems, approx_size_bytes] = *setup_results;\r\n     LogPrintf(\"Using %zu MiB out of %zu MiB requested for script execution cache, able to store %zu elements\\n\",\r\n               approx_size_bytes >> 20, max_size_bytes >> 20, num_elems);\r\n     return true;\r\n```\r\n</detail>",
      "commit_id" : "79c9c55b27bd113885da2c36ad76e5ed145027b3",
      "created_at" : "2024-05-20T18:04:56Z",
      "diff_hunk" : "@@ -924,7 +930,7 @@ class ChainstateManager\n public:\n     using Options = kernel::ChainstateManagerOpts;\n \n-    explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n+    explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options, bilingual_str& error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607094214",
      "id" : 1607094214,
      "line" : 937,
      "node_id" : "PRRC_kwDOABII585fyk_G",
      "original_commit_id" : "353ba0a19e73e888b5788f5fa10fca682b5ea4f5",
      "original_line" : 933,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 69,
      "pull_request_review_id" : 2066739761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607094214/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-20T18:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607094214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607175446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607175446"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Any reason to not make `max_size_bytes` a `CSignatureCache` constructor param? That way `InitSignatureCache` could go away.",
      "commit_id" : "79c9c55b27bd113885da2c36ad76e5ed145027b3",
      "created_at" : "2024-05-20T19:19:12Z",
      "diff_hunk" : "@@ -62,19 +62,11 @@ std::optional<std::pair<uint32_t, size_t>> CSignatureCache::setup_bytes(size_t n\n     return setValid.setup_bytes(n);\n }\n \n-/* In previous versions of this code, signatureCache was a local static variable\n- * in CachingTransactionSignatureChecker::VerifySignature.  We initialize\n- * signatureCache outside of VerifySignature to avoid the atomic operation per\n- * call overhead associated with local static variables even though\n- * signatureCache could be made local to VerifySignature.\n-*/\n-static CSignatureCache signatureCache;\n-\n // To be called once in AppInitMain/BasicTestingSetup to initialize the\n // signatureCache.\n-bool InitSignatureCache(size_t max_size_bytes)\n+bool InitSignatureCache(size_t max_size_bytes, CSignatureCache& signature_cache)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607175446",
      "id" : 1607175446,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585fy40W",
      "original_commit_id" : "79c9c55b27bd113885da2c36ad76e5ed145027b3",
      "original_line" : 67,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 15,
      "pull_request_review_id" : 2066862012,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607175446/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-20T19:19:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607175446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607890616"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607890616"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like this, no need to introduce all this error handling infrastructure for a debug-only option. Applied.",
      "commit_id" : "4a1df97a016935348e50f384ed52a6671990835f",
      "created_at" : "2024-05-21T08:38:04Z",
      "diff_hunk" : "@@ -924,7 +930,7 @@ class ChainstateManager\n public:\n     using Options = kernel::ChainstateManagerOpts;\n \n-    explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n+    explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options, bilingual_str& error);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607890616",
      "id" : 1607890616,
      "in_reply_to_id" : 1607094214,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585f1na4",
      "original_commit_id" : "353ba0a19e73e888b5788f5fa10fca682b5ea4f5",
      "original_line" : 933,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 2067938954,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607890616/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-21T08:38:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607890616",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 79c9c55b27bd113885da2c36ad76e5ed145027b3 -> 4a1df97a016935348e50f384ed52a6671990835f ([noGlobalScriptCache_0](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_0) -> [noGlobalScriptCache_1](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_1), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_0..noGlobalScriptCache_1))\r\n\r\n* Addressed @theuni's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607175446), made `CSignatureCache` more RAII styled.\r\n* Addressed @ajtowns's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1607094214), applied his suggestion of dropping the error handling if the cache size exceeds the `uint32_t` maximum value.",
      "created_at" : "2024-05-21T08:47:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2122100379",
      "id" : 2122100379,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII585-fK6b",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2122100379/reactions"
      },
      "updated_at" : "2024-05-21T08:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2122100379",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1608951984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608951984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Comment is now out of date.",
      "commit_id" : "5b1576bbc664a07e00b5528e13c1928df9bc9b0c",
      "created_at" : "2024-05-21T21:06:15Z",
      "diff_hunk" : "@@ -53,6 +53,16 @@ util::Result<void> ApplyArgsManOptions(const ArgsManager& args, ChainstateManage\n     opts.worker_threads_num = std::clamp(script_threads - 1, 0, MAX_SCRIPTCHECK_THREADS);\n     LogPrintf(\"Script verification uses %d additional threads\\n\", opts.worker_threads_num);\n \n+    if (auto max_size = args.GetIntArg(\"-maxsigcachesize\")) {\n+        // 1. When supplied with a max_size of 0, both InitSignatureCache and\n+        //    InitScriptExecutionCache create the minimum possible cache (2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1608951984",
      "id" : 1608951984,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585f5qiw",
      "original_commit_id" : "4a1df97a016935348e50f384ed52a6671990835f",
      "original_line" : 58,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/chainstatemanager_args.cpp",
      "position" : null,
      "pull_request_review_id" : 2069624268,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608951984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-21T21:06:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608951984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated 4a1df97a016935348e50f384ed52a6671990835f -> 5b1576bbc664a07e00b5528e13c1928df9bc9b0c ([noGlobalScriptCache_1](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_1) -> [noGlobalScriptCache_2](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_2), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_1..noGlobalScriptCache_2))\r\n\r\n* Addressed @theuni's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1608951984), fixed outdated comment.\r\n",
      "created_at" : "2024-05-21T21:20:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2123462834",
      "id" : 2123462834,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII585-kXiy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2123462834/reactions"
      },
      "updated_at" : "2024-05-21T21:20:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2123462834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1608966851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608966851"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, fixed.",
      "commit_id" : "5b1576bbc664a07e00b5528e13c1928df9bc9b0c",
      "created_at" : "2024-05-21T21:21:06Z",
      "diff_hunk" : "@@ -53,6 +53,16 @@ util::Result<void> ApplyArgsManOptions(const ArgsManager& args, ChainstateManage\n     opts.worker_threads_num = std::clamp(script_threads - 1, 0, MAX_SCRIPTCHECK_THREADS);\n     LogPrintf(\"Script verification uses %d additional threads\\n\", opts.worker_threads_num);\n \n+    if (auto max_size = args.GetIntArg(\"-maxsigcachesize\")) {\n+        // 1. When supplied with a max_size of 0, both InitSignatureCache and\n+        //    InitScriptExecutionCache create the minimum possible cache (2",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1608966851",
      "id" : 1608966851,
      "in_reply_to_id" : 1608951984,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585f5uLD",
      "original_commit_id" : "4a1df97a016935348e50f384ed52a6671990835f",
      "original_line" : 58,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/node/chainstatemanager_args.cpp",
      "position" : null,
      "pull_request_review_id" : 2069646556,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608966851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-21T21:21:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608966851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-06-17T21:16:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2174440121",
      "id" : 2174440121,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586Bm1K5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2174440121/reactions"
      },
      "updated_at" : "2024-06-17T21:16:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2174440121",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased 5b1576bbc664a07e00b5528e13c1928df9bc9b0c -> 63923c8da686da42f522771f338ea8f2a4f4e568 ([noGlobalScriptCache_2](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_2) -> [noGlobalScriptCache_3](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_3), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_2..noGlobalScriptCache_3))\r\n\r\n* Fixed conflict with #30058",
      "created_at" : "2024-06-18T08:40:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2175538120",
      "id" : 2175538120,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586BrBPI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2175538120/reactions"
      },
      "updated_at" : "2024-06-18T08:40:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2175538120",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644210320"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644210320"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: declaring `requested_num_elems` as a `uint32_t` would seem more intuitive:\r\n\r\n<details>\r\n<summary>git diff on 8960bc986b</summary>\r\n\r\n```diff\r\ndiff --git a/src/cuckoocache.h b/src/cuckoocache.h\r\nindex c9bd45befc..85556a4da5 100644\r\n--- a/src/cuckoocache.h\r\n+++ b/src/cuckoocache.h\r\n@@ -364,10 +364,10 @@ public:\r\n      */\r\n     std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\r\n     {\r\n-        size_t requested_num_elems = bytes / sizeof(Element);\r\n-        if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\r\n-            requested_num_elems = std::numeric_limits<uint32_t>::max();\r\n-        }\r\n+        uint32_t requested_num_elems{(uint32_t)std::min(\r\n+            bytes / sizeof(Element),\r\n+            (size_t)std::numeric_limits<uint32_t>::max()\r\n+        )};\r\n \r\n         auto num_elems = setup(requested_num_elems);\r\n \r\n\r\n```\r\n</details>\r\n",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-18T10:17:56Z",
      "diff_hunk" : "@@ -360,16 +360,16 @@ class cache\n      * structure\n      * @returns A pair of the maximum number of elements storable (see setup()\n      * documentation for more detail) and the approximate total size of these\n-     * elements in bytes or std::nullopt if the size requested is too large.\n+     * elements in bytes.\n      */\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\n     {\n         size_t requested_num_elems = bytes / sizeof(Element);\n         if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\n-            return std::nullopt;\n+            requested_num_elems = std::numeric_limits<uint32_t>::max();\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644210320",
      "id" : 1644210320,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585iAKiQ",
      "original_commit_id" : "8960bc986b5361108f168c20af280b298061d706",
      "original_line" : 370,
      "original_position" : 14,
      "original_start_line" : 367,
      "path" : "src/cuckoocache.h",
      "position" : 14,
      "pull_request_review_id" : 2125109551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644210320/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 367,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-18T20:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644210320",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644415772"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644415772"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "To minimize future footguns by accidentally passing a cache by value, perhaps best to disable the copy constructor and copy assignment operator? (+ same for `CSignatureCache` in 63923c8da686da42f522771f338ea8f2a4f4e568)\r\n\r\n<details>\r\n<summary>git diff on 1409fa4f41</summary>\r\n\r\n```diff\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex 9f858bff1d..90f484bc9f 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -369,6 +369,10 @@ static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\r\n struct ValidationCache {\r\n     ScriptCache m_script_execution_cache;\r\n     ValidationCache(size_t script_execution_cache_bytes);\r\n+\r\n+    // ValidationCache should only be passed by reference or pointer\r\n+    ValidationCache(const ValidationCache&) = delete;\r\n+    ValidationCache& operator=(const ValidationCache&) = delete;\r\n };\r\n \r\n /** Functions for validating blocks and updating the block tree */\r\n\r\n```\r\n</details>\r\n",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-18T12:53:01Z",
      "diff_hunk" : "@@ -360,8 +363,13 @@ static_assert(std::is_nothrow_move_assignable_v<CScriptCheck>);\n static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n-/** Initializes the script-execution cache */\n-[[nodiscard]] bool InitScriptExecutionCache(size_t max_size_bytes);\n+/**\n+ * Convenience struct for initializing and passing the script execution cache.\n+ */\n+struct ValidationCache {\n+    ScriptCache m_script_execution_cache;\n+    ValidationCache(size_t script_execution_cache_bytes);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644415772",
      "id" : 1644415772,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iA8sc",
      "original_commit_id" : "1409fa4f4144308ad8ffeaca927bc76ad982e2a8",
      "original_line" : 371,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : null,
      "pull_request_review_id" : 2125109551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644415772/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-18T20:47:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644415772",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645009465"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645009465"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I understand correctly, `m_script_execution_cache_hasher` is a pre-initialized hasher that we want to copy every time we use it, and we definitely don't want to modify in-place. I think having it as a public struct member is not very robust to enforce that, perhaps better to use a getter here? E.g. something like:\r\n\r\n<details>\r\n<summary>git diff on 63923c8da6</summary>\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 39ab7b56ab..600c427c93 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -2095,17 +2095,22 @@ bool CScriptCheck::operator()() {\r\n     return VerifyScript(scriptSig, m_tx_out.scriptPubKey, witness, nFlags, CachingTransactionSignatureChecker(ptxTo, nIn, m_tx_out.nValue, cacheStore, *m_signature_cache, *txdata), &error);\r\n }\r\n \r\n-ValidationCache::ValidationCache(size_t script_execution_cache_bytes, size_t signature_cache_bytes)\r\n-    : m_signature_cache{signature_cache_bytes / 2}\r\n+CSHA256 ValidationCache::CreateScriptExecutionCacheHasher()\r\n {\r\n     // Setup the salted hasher\r\n     uint256 nonce = GetRandHash();\r\n     // We want the nonce to be 64 bytes long to force the hasher to process\r\n     // this chunk, which makes later hash computations more efficient. We\r\n     // just write our 32-byte entropy twice to fill the 64 bytes.\r\n-    m_script_execution_cache_hasher.Write(nonce.begin(), 32);\r\n-    m_script_execution_cache_hasher.Write(nonce.begin(), 32);\r\n+    CSHA256 hasher;\r\n+    hasher.Write(nonce.begin(), 32);\r\n+    hasher.Write(nonce.begin(), 32);\r\n+    return hasher;\r\n+}\r\n \r\n+ValidationCache::ValidationCache(size_t script_execution_cache_bytes, size_t signature_cache_bytes)\r\n+    : m_signature_cache{signature_cache_bytes / 2}\r\n+{\r\n     const auto [num_elems, approx_size_bytes] = m_script_execution_cache.setup_bytes(script_execution_cache_bytes);\r\n     LogPrintf(\"Using %zu MiB out of %zu MiB requested for script execution cache, able to store %zu elements\\n\",\r\n               approx_size_bytes >> 20, script_execution_cache_bytes >> 20, num_elems);\r\n@@ -2148,7 +2153,7 @@ bool CheckInputScripts(const CTransaction& tx, TxValidationState& state,\r\n     // properly commits to the scriptPubKey in the inputs view of that\r\n     // transaction).\r\n     uint256 hashCacheEntry;\r\n-    CSHA256 hasher = validation_cache.m_script_execution_cache_hasher;\r\n+    auto hasher{validation_cache.ScriptExecutionCacheHasher()};\r\n     hasher.Write(UCharCast(tx.GetWitnessHash().begin()), 32).Write((unsigned char*)&flags, sizeof(flags)).Finalize(hashCacheEntry.begin());\r\n     AssertLockHeld(cs_main); //TODO: Remove this requirement by making CuckooCache not require external locks\r\n     if (validation_cache.m_script_execution_cache.contains(hashCacheEntry, !cacheFullScriptStore)) {\r\ndiff --git a/src/validation.h b/src/validation.h\r\nindex c4b49ec3e8..1e48f6b4a4 100644\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -369,11 +369,16 @@ static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\r\n  * Convenience struct for initializing and passing the script execution cache\r\n  * and signature cache.\r\n  */\r\n-struct ValidationCache {\r\n+class ValidationCache {\r\n+public:\r\n     ScriptCache m_script_execution_cache;\r\n-    CSHA256 m_script_execution_cache_hasher;\r\n+    CSHA256 ScriptExecutionCacheHasher() { return m_script_execution_cache_hasher; }\r\n     CSignatureCache m_signature_cache;\r\n     ValidationCache(size_t script_execution_cache_bytes, size_t signature_cache_bytes);\r\n+private:\r\n+    static CSHA256 CreateScriptExecutionCacheHasher();\r\n+    //! Pre-initialized hasher to avoid having to recreate it for every hash calculation\r\n+    const CSHA256 m_script_execution_cache_hasher{CreateScriptExecutionCacheHasher()};\r\n };\r\n \r\n /** Functions for validating blocks and updating the block tree */\r\n\r\n```\r\n</details>\r\n\r\nIt seems this is quite brittle on master too, so not a regression, but probably something to address here?",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-18T20:20:15Z",
      "diff_hunk" : "@@ -360,8 +365,16 @@ static_assert(std::is_nothrow_move_assignable_v<CScriptCheck>);\n static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n-/** Initializes the script-execution cache */\n-[[nodiscard]] bool InitScriptExecutionCache(size_t max_size_bytes);\n+/**\n+ * Convenience struct for initializing and passing the script execution cache\n+ * and signature cache.\n+ */\n+struct ValidationCache {\n+    ScriptCache m_script_execution_cache;\n+    CSHA256 m_script_execution_cache_hasher;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645009465",
      "id" : 1645009465,
      "line" : 376,
      "node_id" : "PRRC_kwDOABII585iDNo5",
      "original_commit_id" : "63923c8da686da42f522771f338ea8f2a4f4e568",
      "original_line" : 376,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 57,
      "pull_request_review_id" : 2125109551,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645009465/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-18T20:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645009465",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the review @stickies-v,\r\n\r\n63923c8da686da42f522771f338ea8f2a4f4e568 -> 6ad4aa82056030a8a72b1315676e0703c1500d0d ([noGlobalScriptCache_3](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_3) -> [noGlobalScriptCache_4](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_4), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_3..noGlobalScriptCache_4))\r\n\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644415772), deleting copy and move constructor of the newly introduced `ValidationCache` class.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645009465), applying the suggestion of making the pre-initialized hasher private and adding a getter for it.",
      "created_at" : "2024-06-19T08:57:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2178139748",
      "id" : 2178139748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586B08Zk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178139748/reactions"
      },
      "updated_at" : "2024-06-19T08:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178139748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645730446"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645730446"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there a reason you added a separate initialization function for the hasher?",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-19T08:57:18Z",
      "diff_hunk" : "@@ -360,8 +365,16 @@ static_assert(std::is_nothrow_move_assignable_v<CScriptCheck>);\n static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n-/** Initializes the script-execution cache */\n-[[nodiscard]] bool InitScriptExecutionCache(size_t max_size_bytes);\n+/**\n+ * Convenience struct for initializing and passing the script execution cache\n+ * and signature cache.\n+ */\n+struct ValidationCache {\n+    ScriptCache m_script_execution_cache;\n+    CSHA256 m_script_execution_cache_hasher;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645730446",
      "id" : 1645730446,
      "in_reply_to_id" : 1645009465,
      "line" : 376,
      "node_id" : "PRRC_kwDOABII585iF9qO",
      "original_commit_id" : "63923c8da686da42f522771f338ea8f2a4f4e568",
      "original_line" : 376,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 57,
      "pull_request_review_id" : 2127572221,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645730446/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T08:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645730446",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645731158"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645731158"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Mmh, this does not feel more readable to me, because of the two casts.",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-19T08:57:47Z",
      "diff_hunk" : "@@ -360,16 +360,16 @@ class cache\n      * structure\n      * @returns A pair of the maximum number of elements storable (see setup()\n      * documentation for more detail) and the approximate total size of these\n-     * elements in bytes or std::nullopt if the size requested is too large.\n+     * elements in bytes.\n      */\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\n     {\n         size_t requested_num_elems = bytes / sizeof(Element);\n         if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\n-            return std::nullopt;\n+            requested_num_elems = std::numeric_limits<uint32_t>::max();\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645731158",
      "id" : 1645731158,
      "in_reply_to_id" : 1644210320,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585iF91W",
      "original_commit_id" : "8960bc986b5361108f168c20af280b298061d706",
      "original_line" : 370,
      "original_position" : 14,
      "original_start_line" : 367,
      "path" : "src/cuckoocache.h",
      "position" : 14,
      "pull_request_review_id" : 2127573308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645731158/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 367,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-19T08:57:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645731158",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645856227"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645856227"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's not really a readability suggestion, I just prefer having `requested_nums_elems` be the integer type for which we're doing the bounds checking. But it's just a nit so happy to leave as is.",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-19T10:10:26Z",
      "diff_hunk" : "@@ -360,16 +360,16 @@ class cache\n      * structure\n      * @returns A pair of the maximum number of elements storable (see setup()\n      * documentation for more detail) and the approximate total size of these\n-     * elements in bytes or std::nullopt if the size requested is too large.\n+     * elements in bytes.\n      */\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\n     {\n         size_t requested_num_elems = bytes / sizeof(Element);\n         if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\n-            return std::nullopt;\n+            requested_num_elems = std::numeric_limits<uint32_t>::max();\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645856227",
      "id" : 1645856227,
      "in_reply_to_id" : 1644210320,
      "line" : 370,
      "node_id" : "PRRC_kwDOABII585iGcXj",
      "original_commit_id" : "8960bc986b5361108f168c20af280b298061d706",
      "original_line" : 370,
      "original_position" : 14,
      "original_start_line" : 367,
      "path" : "src/cuckoocache.h",
      "position" : 14,
      "pull_request_review_id" : 2127765015,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645856227/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 367,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-19T10:10:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645856227",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645875138"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645875138"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Two (soft) reasons:\r\n1. to make `m_script_execution_cache_hasher` `const`\r\n2. having a separate construction function for the hasher seems more composable (e.g. testing the hasher) and makes the `ValidationCache` constructor more readable\r\n\r\nI'm fine with your approach too, though. It addresses my main concern, everything else is more of a nit.",
      "commit_id" : "6ad4aa82056030a8a72b1315676e0703c1500d0d",
      "created_at" : "2024-06-19T10:22:30Z",
      "diff_hunk" : "@@ -360,8 +365,16 @@ static_assert(std::is_nothrow_move_assignable_v<CScriptCheck>);\n static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n-/** Initializes the script-execution cache */\n-[[nodiscard]] bool InitScriptExecutionCache(size_t max_size_bytes);\n+/**\n+ * Convenience struct for initializing and passing the script execution cache\n+ * and signature cache.\n+ */\n+struct ValidationCache {\n+    ScriptCache m_script_execution_cache;\n+    CSHA256 m_script_execution_cache_hasher;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645875138",
      "id" : 1645875138,
      "in_reply_to_id" : 1645009465,
      "line" : 376,
      "node_id" : "PRRC_kwDOABII585iGg_C",
      "original_commit_id" : "63923c8da686da42f522771f338ea8f2a4f4e568",
      "original_line" : 376,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 57,
      "pull_request_review_id" : 2127794432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645875138/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T10:22:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645875138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646290588"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646290588"
         }
      },
      "author_association" : "MEMBER",
      "body" : "May be good to explain why this is needed, when `m_node.chainman->m_validation_cache` already exists?",
      "commit_id" : "fa660a266b3aa03f40c47a9330e3bce8be89bb54",
      "created_at" : "2024-06-19T14:17:21Z",
      "diff_hunk" : "@@ -5,23 +5,31 @@\n #include <consensus/validation.h>\n #include <key.h>\n #include <random.h>\n+#include <script/sigcache.h>\n #include <script/sign.h>\n #include <script/signingprovider.h>\n #include <test/util/setup_common.h>\n #include <txmempool.h>\n #include <util/chaintype.h>\n+#include <util/check.h>\n #include <validation.h>\n \n #include <boost/test/unit_test.hpp>\n \n struct Dersig100Setup : public TestChain100Setup {\n+    ValidationCache m_validation_cache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646290588",
      "id" : 1646290588,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iIGac",
      "original_commit_id" : "f015a501e4bbb4985b52783591031e4e39496009",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/txvalidationcache_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 2128427867,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646290588/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T14:17:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646290588",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646343915"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646343915"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: `std::optional` no longer needed as an include",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-19T14:53:24Z",
      "diff_hunk" : "@@ -360,16 +360,16 @@ class cache\n      * structure\n      * @returns A pair of the maximum number of elements storable (see setup()\n      * documentation for more detail) and the approximate total size of these\n-     * elements in bytes or std::nullopt if the size requested is too large.\n+     * elements in bytes.\n      */\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\n     {\n         size_t requested_num_elems = bytes / sizeof(Element);\n         if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\n-            return std::nullopt;\n+            requested_num_elems = std::numeric_limits<uint32_t>::max();\n         }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646343915",
      "id" : 1646343915,
      "in_reply_to_id" : 1644210320,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iITbr",
      "original_commit_id" : "8960bc986b5361108f168c20af280b298061d706",
      "original_line" : 370,
      "original_position" : 14,
      "original_start_line" : 367,
      "path" : "src/cuckoocache.h",
      "position" : null,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646343915/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646343915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646370563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646370563"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I was thinking it might be useful to control the caches directly for the tests, but on second thought that does not seem like a good thing. Will revert.",
      "commit_id" : "fa660a266b3aa03f40c47a9330e3bce8be89bb54",
      "created_at" : "2024-06-19T15:11:52Z",
      "diff_hunk" : "@@ -5,23 +5,31 @@\n #include <consensus/validation.h>\n #include <key.h>\n #include <random.h>\n+#include <script/sigcache.h>\n #include <script/sign.h>\n #include <script/signingprovider.h>\n #include <test/util/setup_common.h>\n #include <txmempool.h>\n #include <util/chaintype.h>\n+#include <util/check.h>\n #include <validation.h>\n \n #include <boost/test/unit_test.hpp>\n \n struct Dersig100Setup : public TestChain100Setup {\n+    ValidationCache m_validation_cache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646370563",
      "id" : 1646370563,
      "in_reply_to_id" : 1646290588,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iIZ8D",
      "original_commit_id" : "f015a501e4bbb4985b52783591031e4e39496009",
      "original_line" : 20,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/test/txvalidationcache_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 2128552072,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646370563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T15:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646370563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "6ad4aa82056030a8a72b1315676e0703c1500d0d -> fa660a266b3aa03f40c47a9330e3bce8be89bb54 ([noGlobalScriptCache_4](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_4) -> [noGlobalScriptCache_5](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_5), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_4..noGlobalScriptCache_5))\r\n\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1645856227), changing integer type of `requested_num_elems`.\r\n* Addressed @maflcko's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646290588), reverting introduction of a separate `m_validation_cache` member in the `Dersig100Setup` testing class and instead using `m_node.chainman->m_validation_cache`.",
      "created_at" : "2024-06-19T15:15:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2178956138",
      "id" : 2178956138,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586B4Dtq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178956138/reactions"
      },
      "updated_at" : "2024-06-19T15:15:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178956138",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646381635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646381635"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: You can combine the cast by using `()` over `{}`. Also you can specify the template to avoid the `size_t` cast, and ensure the right template is always picked:\r\n\r\n```cpp\r\nuint32_t requested_num_elems(std::min<size_t>(",
      "commit_id" : "fa660a266b3aa03f40c47a9330e3bce8be89bb54",
      "created_at" : "2024-06-19T15:19:58Z",
      "diff_hunk" : "@@ -360,16 +360,15 @@ class cache\n      * structure\n      * @returns A pair of the maximum number of elements storable (see setup()\n      * documentation for more detail) and the approximate total size of these\n-     * elements in bytes or std::nullopt if the size requested is too large.\n+     * elements in bytes.\n      */\n-    std::optional<std::pair<uint32_t, size_t>> setup_bytes(size_t bytes)\n+    std::pair<uint32_t, size_t> setup_bytes(size_t bytes)\n     {\n-        size_t requested_num_elems = bytes / sizeof(Element);\n-        if (std::numeric_limits<uint32_t>::max() < requested_num_elems) {\n-            return std::nullopt;\n-        }\n+        uint32_t requested_num_elems{(uint32_t)std::min(",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646381635",
      "id" : 1646381635,
      "line" : 367,
      "node_id" : "PRRC_kwDOABII585iIcpD",
      "original_commit_id" : "f1dad94b9d51db6dc7702e51f943c24a17222b1a",
      "original_line" : 367,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/cuckoocache.h",
      "position" : 14,
      "pull_request_review_id" : 2128584316,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646381635/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T15:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646381635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646473144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646473144"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This seems incorrect, we clamp the number of elements, not the number of bytes. I'd prefer not documenting the clamping behaviour here, given how generous the limit is.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-19T16:09:26Z",
      "diff_hunk" : "@@ -618,7 +618,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-test=<option>\", \"Pass a test-only option. Options include : \" + Join(TEST_OPTIONS_DOC, \", \") + \".\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to disk\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-mocktime=<n>\", \"Replace actual time with \" + UNIX_EPOCH_TIME + \" (default: 0)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n-    argsman.AddArg(\"-maxsigcachesize=<n>\", strprintf(\"Limit sum of signature cache and script execution cache sizes to <n> MiB (default: %u)\", DEFAULT_MAX_SIG_CACHE_BYTES >> 20), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-maxsigcachesize=<n>\", strprintf(\"Limit sum of signature cache and script execution cache sizes to <n> MiB (default: %u). Will clamp to %u MiB if exceeded.\", DEFAULT_MAX_SIG_CACHE_BYTES >> 20, std::numeric_limits<uint32_t>::max() >> 20), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646473144",
      "id" : 1646473144,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585iIy-4",
      "original_commit_id" : "f1dad94b9d51db6dc7702e51f943c24a17222b1a",
      "original_line" : 618,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 29,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646473144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646473144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646478869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646478869"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "typo nit\r\n```suggestion\r\n    //! Pre-initialized hasher to avoid having to recreate it for every hash calculation.\r\n```",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-19T16:13:24Z",
      "diff_hunk" : "@@ -360,8 +365,29 @@ static_assert(std::is_nothrow_move_assignable_v<CScriptCheck>);\n static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n-/** Initializes the script-execution cache */\n-[[nodiscard]] bool InitScriptExecutionCache(size_t max_size_bytes);\n+/**\n+ * Convenience class for initializing and passing the script execution cache\n+ * and signature cache.\n+ */\n+class ValidationCache\n+{\n+private:\n+    //! Pre-initialized hasher for to avoid having to recreate it for every hash calculation.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646478869",
      "id" : 1646478869,
      "line" : 375,
      "node_id" : "PRRC_kwDOABII585iI0YV",
      "original_commit_id" : "fa660a266b3aa03f40c47a9330e3bce8be89bb54",
      "original_line" : 375,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 56,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646478869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646478869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647123546"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647123546"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 594189567956063fa1a44bef9e86e72c14207027:\r\n\r\n```\r\nscript/sigcache.h should remove these lines:\r\n- #include <cstdint>  // lines 18-18\r\n- #include <utility>  // lines 20-20",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T07:49:50Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647123546",
      "id" : 1647123546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iLRxa",
      "original_commit_id" : "2412ec286353324b265612bc6ab73b7dc8286969",
      "original_line" : 20,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2128595258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647123546/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T13:53:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647123546",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "fa660a266b3aa03f40c47a9330e3bce8be89bb54 -> f946b083fe1431fb8d5d2c080ed3c2938116c37a ([noGlobalScriptCache_5](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_5) -> [noGlobalScriptCache_6](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_6), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_5..noGlobalScriptCache_6))\r\n\r\n* Addressed @maflcko's [nit](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646381635), removing unnecessary casts by using a template param and allowing type narrowing instead.",
      "created_at" : "2024-06-20T10:47:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2180376101",
      "id" : 2180376101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586B9eYl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180376101/reactions"
      },
      "updated_at" : "2024-06-20T10:47:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180376101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647514586"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647514586"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in /f946b083fe1431fb8d5d2c080ed3c2938116c37a: Unrelated change? The commit message is \"De-globalize signature cache\", but this hunk makes the script execution cache private.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T12:42:42Z",
      "diff_hunk" : "@@ -364,20 +366,27 @@ static_assert(std::is_nothrow_move_constructible_v<CScriptCheck>);\n static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n \n /**\n- * Convenience class for initializing and passing the script execution cache.\n+ * Convenience class for initializing and passing the script execution cache\n+ * and signature cache.\n  */\n class ValidationCache\n {\n+private:\n+    //! Pre-initialized hasher for to avoid having to recreate it for every hash calculation.\n+    CSHA256 m_script_execution_cache_hasher;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647514586",
      "id" : 1647514586,
      "line" : 376,
      "node_id" : "PRRC_kwDOABII585iMxPa",
      "original_commit_id" : "f946b083fe1431fb8d5d2c080ed3c2938116c37a",
      "original_line" : 376,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 57,
      "pull_request_review_id" : 2128595258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647514586/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T13:53:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647514586",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647518394"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647518394"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in /f946b083fe1431fb8d5d2c080ed3c2938116c37a: Why use a pointer when a reference is better?",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T12:45:40Z",
      "diff_hunk" : "@@ -343,10 +344,11 @@ class CScriptCheck\n     bool cacheStore;\n     ScriptError error{SCRIPT_ERR_UNKNOWN_ERROR};\n     PrecomputedTransactionData *txdata;\n+    CSignatureCache* m_signature_cache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647518394",
      "id" : 1647518394,
      "line" : 347,
      "node_id" : "PRRC_kwDOABII585iMyK6",
      "original_commit_id" : "f946b083fe1431fb8d5d2c080ed3c2938116c37a",
      "original_line" : 347,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 33,
      "pull_request_review_id" : 2128595258,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647518394/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T13:53:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647518394",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647665176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647665176"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we similarly make `CTransaction` a pointer to keep the `CScriptCheck` class `is_nothrow_move_assignable_v`.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T14:18:03Z",
      "diff_hunk" : "@@ -343,10 +344,11 @@ class CScriptCheck\n     bool cacheStore;\n     ScriptError error{SCRIPT_ERR_UNKNOWN_ERROR};\n     PrecomputedTransactionData *txdata;\n+    CSignatureCache* m_signature_cache;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647665176",
      "id" : 1647665176,
      "in_reply_to_id" : 1647518394,
      "line" : 347,
      "node_id" : "PRRC_kwDOABII585iNWAY",
      "original_commit_id" : "f946b083fe1431fb8d5d2c080ed3c2938116c37a",
      "original_line" : 347,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 33,
      "pull_request_review_id" : 2130583896,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647665176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T14:18:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647665176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "f946b083fe1431fb8d5d2c080ed3c2938116c37a -> 974934b3c23ce7f34ef46f3dfc13468cd46f4b8a ([noGlobalScriptCache_6](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_6) -> [noGlobalScriptCache_7](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_7), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_6..noGlobalScriptCache_7))\r\n\r\n* Addressed @maflcko's [nit](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647123546), removed unused includes.\r\n* Addressed @maflcko's [nit](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647514586), fixed ordering of changes.",
      "created_at" : "2024-06-20T14:36:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2180871592",
      "id" : 2180871592,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586B_XWo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180871592/reactions"
      },
      "updated_at" : "2024-06-20T14:36:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180871592",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647706071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647706071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: You added the headers in one commit, and then removed them in the next. Wrong order?",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T14:44:46Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647706071",
      "id" : 1647706071,
      "in_reply_to_id" : 1647123546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iNf_X",
      "original_commit_id" : "2412ec286353324b265612bc6ab73b7dc8286969",
      "original_line" : 20,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2130652452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647706071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T14:44:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647706071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 974934b3c23ce7f34ef46f3dfc13468cd46f4b8a ð¤\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: ACK 974934b3c23ce7f34ef46f3dfc13468cd46f4b8a ð¤\r\nt0ljkEzhaLlyhqM3Wen2M5qYseMJ8IvP7zBw8W314vzPwSnjzO8HfmrSCiuIpIyFKH9EAxgkpqPBONPeTrvwAg==\r\n```\r\n\r\n</details>\r\n",
      "created_at" : "2024-06-20T14:46:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2180895187",
      "id" : 2180895187,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586B_dHT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180895187/reactions"
      },
      "updated_at" : "2024-06-20T14:46:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2180895187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647713760"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647713760"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "They are required in 201b29e468f621a1fb055060920231ef46192414 and then no-longer in 974934b3c23ce7f34ef46f3dfc13468cd46f4b8a.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-20T14:49:45Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1647713760",
      "id" : 1647713760,
      "in_reply_to_id" : 1647123546,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iNh3g",
      "original_commit_id" : "2412ec286353324b265612bc6ab73b7dc8286969",
      "original_line" : 20,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2130664617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647713760/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-20T14:49:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1647713760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657322116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657322116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Move this into `ValidationCache`? It seems unused anywhere else.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:12:59Z",
      "diff_hunk" : "@@ -88,6 +89,8 @@ extern std::condition_variable g_best_block_cv;\n /** Used to notify getblocktemplate RPC of new tips. */\n extern uint256 g_best_block;\n \n+using ScriptCache = CuckooCache::cache<uint256, SignatureCacheHasher>;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657322116",
      "id" : 1657322116,
      "line" : 93,
      "node_id" : "PRRC_kwDOABII585iyLqE",
      "original_commit_id" : "56247bbdd0016602d6f60296b0e78e2749582579",
      "original_line" : 92,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 24,
      "pull_request_review_id" : 2145715522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657322116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657322116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657330024"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657330024"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This function can be const.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:17:50Z",
      "diff_hunk" : "@@ -368,14 +368,21 @@ static_assert(std::is_nothrow_destructible_v<CScriptCheck>);\n  */\n class ValidationCache\n {\n+private:\n+    //! Pre-initialized hasher for to avoid having to recreate it for every hash calculation.\n+    CSHA256 m_script_execution_cache_hasher;\n+\n public:\n     ScriptCache m_script_execution_cache;\n+\n     ValidationCache(size_t script_execution_cache_bytes);\n \n     ValidationCache(const ValidationCache&) = delete;\n     ValidationCache(ValidationCache&&) = delete;\n     ValidationCache& operator=(const ValidationCache&) = delete;\n     ValidationCache& operator=(ValidationCache&&) = delete;\n+\n+    CSHA256 ScriptExecutionCacheHasher() { return m_script_execution_cache_hasher; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657330024",
      "id" : 1657330024,
      "line" : 389,
      "node_id" : "PRRC_kwDOABII585iyNlo",
      "original_commit_id" : "a4fc935bf9a707098385a520714317277f3d1ffd",
      "original_line" : 385,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/validation.h",
      "position" : 70,
      "pull_request_review_id" : 2145715522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657330024/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657330024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657337310"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657337310"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Might be useful to pass the nonce in rather than generating it here to make the order of rng/ValidationCache instantiation explicit.\r\n\r\nPresumably it'd also make for easier testing with a deterministic seed.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:21:48Z",
      "diff_hunk" : "@@ -2095,17 +2095,15 @@ bool CScriptCheck::operator()() {\n     return VerifyScript(scriptSig, m_tx_out.scriptPubKey, witness, nFlags, CachingTransactionSignatureChecker(ptxTo, nIn, m_tx_out.nValue, cacheStore, *txdata), &error);\n }\n \n-static CSHA256 g_scriptExecutionCacheHasher;\n-\n ValidationCache::ValidationCache(size_t script_execution_cache_bytes)\n {\n     // Setup the salted hasher\n     uint256 nonce = GetRandHash();\n     // We want the nonce to be 64 bytes long to force the hasher to process\n     // this chunk, which makes later hash computations more efficient. We\n     // just write our 32-byte entropy twice to fill the 64 bytes.\n-    g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\n-    g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\n+    m_script_execution_cache_hasher.Write(nonce.begin(), 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657337310",
      "id" : 1657337310,
      "line" : 2106,
      "node_id" : "PRRC_kwDOABII585iyPXe",
      "original_commit_id" : "a4fc935bf9a707098385a520714317277f3d1ffd",
      "original_line" : 2105,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 90,
      "pull_request_review_id" : 2145715522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657337310/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657337310",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657354399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657354399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same comment here, would be nice to pass this in. Perhaps one nonce to rule them all? I don't think there'd be any loss of security.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:33:43Z",
      "diff_hunk" : "@@ -5,82 +5,61 @@\n \n #include <script/sigcache.h>\n \n-#include <common/system.h>\n+#include <crypto/sha256.h>\n #include <logging.h>\n #include <pubkey.h>\n #include <random.h>\n+#include <script/interpreter.h>\n+#include <span.h>\n #include <uint256.h>\n \n-#include <cuckoocache.h>\n-\n-#include <algorithm>\n #include <mutex>\n #include <shared_mutex>\n #include <vector>\n \n-namespace {\n-/**\n- * Valid signature cache, to avoid doing expensive ECDSA signature checking\n- * twice for every transaction (once when accepted into memory pool, and\n- * again when accepted into the block chain)\n- */\n-class CSignatureCache\n+CSignatureCache::CSignatureCache()\n {\n-private:\n-     //! Entries are SHA256(nonce || 'E' or 'S' || 31 zero bytes || signature hash || public key || signature):\n-    CSHA256 m_salted_hasher_ecdsa;\n-    CSHA256 m_salted_hasher_schnorr;\n-    typedef CuckooCache::cache<uint256, SignatureCacheHasher> map_type;\n-    map_type setValid;\n-    std::shared_mutex cs_sigcache;\n+    uint256 nonce = GetRandHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657354399",
      "id" : 1657354399,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585iyTif",
      "original_commit_id" : "201b29e468f621a1fb055060920231ef46192414",
      "original_line" : 22,
      "original_position" : 36,
      "original_start_line" : null,
      "path" : "src/script/sigcache.cpp",
      "position" : 67,
      "pull_request_review_id" : 2145715522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657354399/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657354399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657370573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657370573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Similar to @stickies-v's comment in a previous commit, since we're going to be passing around references and pointers to this, it'd be a good idea to make it non-copyable to avoid accidental copies.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:46:09Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>\n #include <vector>\n \n+class CTransaction;\n+class XOnlyPubKey;\n+\n // DoS prevention: limit cache size to 32MiB (over 1000000 entries on 64-bit\n // systems). Due to how we count cache size, actual memory usage is slightly\n // more (~32.25 MiB)\n static constexpr size_t DEFAULT_MAX_SIG_CACHE_BYTES{32 << 20};\n \n class CPubKey;\n \n+/**\n+ * Valid signature cache, to avoid doing expensive ECDSA signature checking\n+ * twice for every transaction (once when accepted into memory pool, and\n+ * again when accepted into the block chain)\n+ */\n+class CSignatureCache\n+{\n+private:\n+    //! Entries are SHA256(nonce || 'E' or 'S' || 31 zero bytes || signature hash || public key || signature):\n+    CSHA256 m_salted_hasher_ecdsa;\n+    CSHA256 m_salted_hasher_schnorr;\n+    typedef CuckooCache::cache<uint256, SignatureCacheHasher> map_type;\n+    map_type setValid;\n+    std::shared_mutex cs_sigcache;\n+\n+public:\n+    CSignatureCache();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657370573",
      "id" : 1657370573,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iyXfN",
      "original_commit_id" : "201b29e468f621a1fb055060920231ef46192414",
      "original_line" : 49,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2145715522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657370573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:52:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657370573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657394662"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657394662"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, I guess the mutex takes care of that for us. Still, wouldn't hurt to be explicit.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T15:55:33Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>\n #include <vector>\n \n+class CTransaction;\n+class XOnlyPubKey;\n+\n // DoS prevention: limit cache size to 32MiB (over 1000000 entries on 64-bit\n // systems). Due to how we count cache size, actual memory usage is slightly\n // more (~32.25 MiB)\n static constexpr size_t DEFAULT_MAX_SIG_CACHE_BYTES{32 << 20};\n \n class CPubKey;\n \n+/**\n+ * Valid signature cache, to avoid doing expensive ECDSA signature checking\n+ * twice for every transaction (once when accepted into memory pool, and\n+ * again when accepted into the block chain)\n+ */\n+class CSignatureCache\n+{\n+private:\n+    //! Entries are SHA256(nonce || 'E' or 'S' || 31 zero bytes || signature hash || public key || signature):\n+    CSHA256 m_salted_hasher_ecdsa;\n+    CSHA256 m_salted_hasher_schnorr;\n+    typedef CuckooCache::cache<uint256, SignatureCacheHasher> map_type;\n+    map_type setValid;\n+    std::shared_mutex cs_sigcache;\n+\n+public:\n+    CSignatureCache();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657394662",
      "id" : 1657394662,
      "in_reply_to_id" : 1657370573,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iydXm",
      "original_commit_id" : "201b29e468f621a1fb055060920231ef46192414",
      "original_line" : 49,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2145836166,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657394662/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T15:55:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657394662",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657442012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657442012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "reviewer note: orthogonal to this move-only change, but this has all kinds of under- and overflow issues. Since it's a debug option, i suppose it's not the end of the world though",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T16:25:17Z",
      "diff_hunk" : "@@ -56,6 +56,15 @@ util::Result<void> ApplyArgsManOptions(const ArgsManager& args, ChainstateManage\n     opts.worker_threads_num = std::clamp(script_threads - 1, 0, MAX_SCRIPTCHECK_THREADS);\n     LogPrintf(\"Script verification uses %d additional threads\\n\", opts.worker_threads_num);\n \n+    if (auto max_size = args.GetIntArg(\"-maxsigcachesize\")) {\n+        // 1. When supplied with a max_size of 0, both the signature cache and\n+        //    script execution cache create the minimum possible cache (2\n+        //    elements). Therefore, we can use 0 as a floor here.\n+        // 2. Multiply first, divide after to avoid integer truncation.\n+        size_t clamped_size_each = std::max<int64_t>(*max_size, 0) * (1 << 20) / 2;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657442012",
      "id" : 1657442012,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585iyo7c",
      "original_commit_id" : "56247bbdd0016602d6f60296b0e78e2749582579",
      "original_line" : 64,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/node/chainstatemanager_args.cpp",
      "position" : 9,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657442012/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-28T09:53:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657442012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657457261"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657457261"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't realize the mutex has the same practical effect when I mentioned it it in my original [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1644415772)) - but I too would still prefer to be more explicit here. If for some reason that's not a good idea, can we at least add a comment to the mutex to indicate that it also serves this purpose in case it is updated in the future?",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T16:38:55Z",
      "diff_hunk" : "@@ -6,19 +6,59 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n+#include <cstddef>\n+#include <cstdint>\n+#include <shared_mutex>\n+#include <utility>\n #include <vector>\n \n+class CTransaction;\n+class XOnlyPubKey;\n+\n // DoS prevention: limit cache size to 32MiB (over 1000000 entries on 64-bit\n // systems). Due to how we count cache size, actual memory usage is slightly\n // more (~32.25 MiB)\n static constexpr size_t DEFAULT_MAX_SIG_CACHE_BYTES{32 << 20};\n \n class CPubKey;\n \n+/**\n+ * Valid signature cache, to avoid doing expensive ECDSA signature checking\n+ * twice for every transaction (once when accepted into memory pool, and\n+ * again when accepted into the block chain)\n+ */\n+class CSignatureCache\n+{\n+private:\n+    //! Entries are SHA256(nonce || 'E' or 'S' || 31 zero bytes || signature hash || public key || signature):\n+    CSHA256 m_salted_hasher_ecdsa;\n+    CSHA256 m_salted_hasher_schnorr;\n+    typedef CuckooCache::cache<uint256, SignatureCacheHasher> map_type;\n+    map_type setValid;\n+    std::shared_mutex cs_sigcache;\n+\n+public:\n+    CSignatureCache();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657457261",
      "id" : 1657457261,
      "in_reply_to_id" : 1657370573,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iyspt",
      "original_commit_id" : "201b29e468f621a1fb055060920231ef46192414",
      "original_line" : 49,
      "original_position" : 44,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : null,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657457261/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657457261",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657671482"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657671482"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: \\*ducks\\* it seems like now would be the perfect time to rename this to `SignatureCache`?",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T18:56:32Z",
      "diff_hunk" : "@@ -6,32 +6,66 @@\n #ifndef BITCOIN_SCRIPT_SIGCACHE_H\n #define BITCOIN_SCRIPT_SIGCACHE_H\n \n+#include <consensus/amount.h>\n+#include <crypto/sha256.h>\n+#include <cuckoocache.h>\n #include <script/interpreter.h>\n #include <span.h>\n+#include <uint256.h>\n #include <util/hasher.h>\n \n-#include <optional>\n+#include <cstddef>\n+#include <shared_mutex>\n #include <vector>\n \n+class CTransaction;\n+class XOnlyPubKey;\n+\n // DoS prevention: limit cache size to 32MiB (over 1000000 entries on 64-bit\n // systems). Due to how we count cache size, actual memory usage is slightly\n // more (~32.25 MiB)\n static constexpr size_t DEFAULT_MAX_SIG_CACHE_BYTES{32 << 20};\n \n class CPubKey;\n \n+/**\n+ * Valid signature cache, to avoid doing expensive ECDSA signature checking\n+ * twice for every transaction (once when accepted into memory pool, and\n+ * again when accepted into the block chain)\n+ */\n+class CSignatureCache",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657671482",
      "id" : 1657671482,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585izg86",
      "original_commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "original_line" : 36,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/script/sigcache.h",
      "position" : 32,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657671482/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657671482",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657682792"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657682792"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: any reason this isn't initialized where it's used?",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-27T19:05:15Z",
      "diff_hunk" : "@@ -58,6 +58,7 @@ BOOST_FIXTURE_TEST_SUITE(script_p2sh_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(sign)\n {\n+    CSignatureCache signature_cache{DEFAULT_MAX_SIG_CACHE_BYTES / 2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657682792",
      "id" : 1657682792,
      "line" : 61,
      "node_id" : "PRRC_kwDOABII585izjto",
      "original_commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "original_line" : 61,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/script_p2sh_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 2128509733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657682792/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-27T19:33:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1657682792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1658405291"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658405291"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch, this is indeed wrong.",
      "commit_id" : "974934b3c23ce7f34ef46f3dfc13468cd46f4b8a",
      "created_at" : "2024-06-28T09:16:23Z",
      "diff_hunk" : "@@ -618,7 +618,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-test=<option>\", \"Pass a test-only option. Options include : \" + Join(TEST_OPTIONS_DOC, \", \") + \".\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-capturemessages\", \"Capture all P2P messages to disk\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n     argsman.AddArg(\"-mocktime=<n>\", \"Replace actual time with \" + UNIX_EPOCH_TIME + \" (default: 0)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n-    argsman.AddArg(\"-maxsigcachesize=<n>\", strprintf(\"Limit sum of signature cache and script execution cache sizes to <n> MiB (default: %u)\", DEFAULT_MAX_SIG_CACHE_BYTES >> 20), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);\n+    argsman.AddArg(\"-maxsigcachesize=<n>\", strprintf(\"Limit sum of signature cache and script execution cache sizes to <n> MiB (default: %u). Will clamp to %u MiB if exceeded.\", DEFAULT_MAX_SIG_CACHE_BYTES >> 20, std::numeric_limits<uint32_t>::max() >> 20), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1658405291",
      "id" : 1658405291,
      "in_reply_to_id" : 1646473144,
      "line" : 618,
      "node_id" : "PRRC_kwDOABII585i2UGr",
      "original_commit_id" : "f1dad94b9d51db6dc7702e51f943c24a17222b1a",
      "original_line" : 618,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 29,
      "pull_request_review_id" : 2147457321,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658405291/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-28T09:16:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658405291",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1658468860"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658468860"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Does this even need to be a fresh random value every time? Couldn't it just be any nothing up my sleeve number?",
      "commit_id" : "475c57ba482abd8675d0d3ccde98452808be5536",
      "created_at" : "2024-06-28T10:11:59Z",
      "diff_hunk" : "@@ -2095,17 +2095,15 @@ bool CScriptCheck::operator()() {\n     return VerifyScript(scriptSig, m_tx_out.scriptPubKey, witness, nFlags, CachingTransactionSignatureChecker(ptxTo, nIn, m_tx_out.nValue, cacheStore, *txdata), &error);\n }\n \n-static CSHA256 g_scriptExecutionCacheHasher;\n-\n ValidationCache::ValidationCache(size_t script_execution_cache_bytes)\n {\n     // Setup the salted hasher\n     uint256 nonce = GetRandHash();\n     // We want the nonce to be 64 bytes long to force the hasher to process\n     // this chunk, which makes later hash computations more efficient. We\n     // just write our 32-byte entropy twice to fill the 64 bytes.\n-    g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\n-    g_scriptExecutionCacheHasher.Write(nonce.begin(), 32);\n+    m_script_execution_cache_hasher.Write(nonce.begin(), 32);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1658468860",
      "id" : 1658468860,
      "in_reply_to_id" : 1657337310,
      "line" : 2106,
      "node_id" : "PRRC_kwDOABII585i2jn8",
      "original_commit_id" : "a4fc935bf9a707098385a520714317277f3d1ffd",
      "original_line" : 2106,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 90,
      "pull_request_review_id" : 2147560985,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658468860/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-28T10:11:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1658468860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you for the reviews @stickies-v and @theuni!\r\n\r\nUpdated 974934b3c23ce7f34ef46f3dfc13468cd46f4b8a -> 475c57ba482abd8675d0d3ccde98452808be5536 ([noGlobalScriptCache_7](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_7) -> [noGlobalScriptCache_8](https://github.com/TheCharlatan/bitcoin/tree/noGlobalScriptCache_8), [compare](https://github.com/TheCharlatan/bitcoin/compare/noGlobalScriptCache_7..noGlobalScriptCache_8))\r\n\r\n* Addressed @theuni's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657322116), removed unneeded using declaration.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646473144), removed incorrect description of cache size clamping behavior.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646343915), removed unneeded `optional` include.\r\n* Addressed @theuni's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657330024), marking getter for `m_script_execution_cache_hasher` as `const`.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1646478869), fixing docstring typo for the script execution cache hasher.\r\n* Addressed @theuni's and @stickies-v's [comments](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657457261), removing the copy constructor of the `SignatureCache` class. Also removed the move constructor, since I don't see a good reason why that should be kept around either.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657671482), renaming `CSignatureCache` to `SignatureCache`.\r\n* Addressed @stickies-v's [comment](https://github.com/bitcoin/bitcoin/pull/30141#discussion_r1657682792), moving `signature_cache` initialization closer to where it is used in `script_p2sh_tests.cpp`.",
      "created_at" : "2024-06-28T11:37:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30141#issuecomment-2196705221",
      "id" : 2196705221,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
      "node_id" : "IC_kwDOABII586C7w_F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2196705221/reactions"
      },
      "updated_at" : "2024-06-28T11:52:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2196705221",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   }
]
