[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/26567#pullrequestreview-1283898604) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28246](https://github.com/bitcoin/bitcoin/pull/28246) (wallet: Use CTxDestination in CRecipient instead of just scriptPubKey by achow101)\n* [#28244](https://github.com/bitcoin/bitcoin/pull/28244) (Break up script/standard.{h/cpp} by achow101)\n* [#28122](https://github.com/bitcoin/bitcoin/pull/28122) (Silent Payments: Implement BIP352 by josibake)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n* [#27255](https://github.com/bitcoin/bitcoin/pull/27255) (MiniTapscript: port Miniscript to Tapscript by darosior)\n* [#26728](https://github.com/bitcoin/bitcoin/pull/26728) (wallet: Have the wallet store the key for automatically generated descriptors by achow101)\n* [#25907](https://github.com/bitcoin/bitcoin/pull/25907) (wallet: rpc to add automatically generated descriptors by achow101)\n* [#25273](https://github.com/bitcoin/bitcoin/pull/25273) (wallet: Pass through transaction locktime and preset input sequences and scripts to CreateTransaction by achow101)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n* [#22341](https://github.com/bitcoin/bitcoin/pull/22341) (rpc: add getxpub by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2022-11-24T17:15:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1326701282",
      "id" : 1326701282,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585PE9ri",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326701282/reactions"
      },
      "updated_at" : "2023-08-11T09:19:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1326701282",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a commit to accurately compute the serialized size of the witness stack size, cleanup the commits a bit, and add the newly introduced methods in the descriptors to the `descriptor_parse` fuzz target. This is now ready for review.",
      "created_at" : "2022-11-25T10:49:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1327318921",
      "id" : 1327318921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585PHUeJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327318921/reactions"
      },
      "updated_at" : "2022-11-25T10:49:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1327318921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1032600553"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032600553"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since we want the maximum size, we should probably account for the sighash byte and make it `65` instead.",
      "commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "created_at" : "2022-11-25T16:48:08Z",
      "diff_hunk" : "@@ -931,6 +1058,20 @@ class TRDescriptor final : public DescriptorImpl\n     }\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // FIXME: We assume keypath spend, which can lead to very large underestimations.\n+        return 1 + 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1032600553",
      "id" : 1032600553,
      "line" : 1066,
      "node_id" : "PRRC_kwDOABII5849jDvp",
      "original_commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "original_line" : 1066,
      "original_position" : 217,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 217,
      "pull_request_review_id" : 1194648201,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032600553/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2022-12-17T00:05:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1032600553",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2022-12-05T18:09:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1337878696",
      "id" : 1337878696,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585Pvmio",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337878696/reactions"
      },
      "updated_at" : "2022-12-05T18:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1337878696",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096374791"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096374791"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8b0aeb534edce08366176275d5577c1e309eb6f \"descriptor: introduce a method to get the satisfaction size\"\r\n\r\nThis is backwards, should be 32 for `m_xonly`.\r\n\r\n```suggestion\r\n    std::optional<int64_t> ScriptSize() const override { return 1 + (m_xonly ? 32 : 33) + 1; }\r\n```",
      "commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "created_at" : "2023-02-03T23:21:05Z",
      "diff_hunk" : "@@ -740,6 +755,17 @@ class PKDescriptor final : public DescriptorImpl\n public:\n     PKDescriptor(std::unique_ptr<PubkeyProvider> prov, bool xonly = false) : DescriptorImpl(Vector(std::move(prov)), \"pk\"), m_xonly(xonly) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + (m_xonly ? 33 : 32) + 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096374791",
      "id" : 1096374791,
      "line" : 761,
      "node_id" : "PRRC_kwDOABII585BWVoH",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 759,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 41,
      "pull_request_review_id" : 1283898604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096374791/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-03T23:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096374791",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096376718"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096376718"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8b0aeb534edce08366176275d5577c1e309eb6f \"descriptor: introduce a method to get the satisfaction size\"\r\n\r\nThis is backwards, should be 64 for `m_xonly`.\r\n\r\n```suggestion\r\n        return 1 + (m_xonly ? 64 : ecdsa_sig_size);\r\n```",
      "commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "created_at" : "2023-02-03T23:23:37Z",
      "diff_hunk" : "@@ -740,6 +755,17 @@ class PKDescriptor final : public DescriptorImpl\n public:\n     PKDescriptor(std::unique_ptr<PubkeyProvider> prov, bool xonly = false) : DescriptorImpl(Vector(std::move(prov)), \"pk\"), m_xonly(xonly) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + (m_xonly ? 33 : 32) + 1; }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        const auto ecdsa_sig_size = use_max_sig ? 72 : 71;\n+        return 1 + (m_xonly ? ecdsa_sig_size : 64);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096376718",
      "id" : 1096376718,
      "line" : 765,
      "node_id" : "PRRC_kwDOABII585BWWGO",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 763,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 45,
      "pull_request_review_id" : 1283898604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096376718/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-03T23:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096376718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096378066"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378066"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8b0aeb534edce08366176275d5577c1e309eb6f \"descriptor: introduce a method to get the satisfaction size\"\r\n\r\nWe could have an uncompressed pubkey, so we should get the size from the `PubkeyProvider`.",
      "commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "created_at" : "2023-02-03T23:26:27Z",
      "diff_hunk" : "@@ -756,6 +782,17 @@ class PKHDescriptor final : public DescriptorImpl\n     PKHDescriptor(std::unique_ptr<PubkeyProvider> prov) : DescriptorImpl(Vector(std::move(prov)), \"pkh\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::LEGACY; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 1 + 20 + 1 + 1; }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        const auto sig_size = use_max_sig ? 72 : 71;\n+        return 1 + sig_size + 1 + 33;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096378066",
      "id" : 1096378066,
      "line" : 794,
      "node_id" : "PRRC_kwDOABII585BWWbS",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 790,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 63,
      "pull_request_review_id" : 1283898604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378066/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-03T23:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378066",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096378894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378894"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In c8b0aeb534edce08366176275d5577c1e309eb6f \"descriptor: introduce a method to get the satisfaction size\"\r\n\r\nSame uncompressed pubkey issue as above.",
      "commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "created_at" : "2023-02-03T23:28:17Z",
      "diff_hunk" : "@@ -816,6 +864,20 @@ class MultisigDescriptor final : public DescriptorImpl\n public:\n     MultisigDescriptor(int threshold, std::vector<std::unique_ptr<PubkeyProvider>> providers, bool sorted = false) : DescriptorImpl(std::move(providers), sorted ? \"sortedmulti\" : \"multi\"), m_threshold(threshold), m_sorted(sorted) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override {\n+        const auto n_keys = m_pubkey_args.size();\n+        return 1 + BuildScript(n_keys).size() + BuildScript(m_threshold).size() + 34 * n_keys;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096378894",
      "id" : 1096378894,
      "line" : 878,
      "node_id" : "PRRC_kwDOABII585BWWoO",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 870,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 97,
      "pull_request_review_id" : 1283898604,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378894/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-03T23:59:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096378894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096741149"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096741149"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Woops. Thanks.",
      "commit_id" : "967795cee4ae9594d1abc6d2ec085dac8c5bf460",
      "created_at" : "2023-02-05T17:07:21Z",
      "diff_hunk" : "@@ -740,6 +755,17 @@ class PKDescriptor final : public DescriptorImpl\n public:\n     PKDescriptor(std::unique_ptr<PubkeyProvider> prov, bool xonly = false) : DescriptorImpl(Vector(std::move(prov)), \"pk\"), m_xonly(xonly) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + (m_xonly ? 33 : 32) + 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096741149",
      "id" : 1096741149,
      "in_reply_to_id" : 1096374791,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BXvEd",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 759,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1284299898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096741149/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-05T17:07:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096741149",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096743640"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096743640"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah good catch! Done, thanks.",
      "commit_id" : "967795cee4ae9594d1abc6d2ec085dac8c5bf460",
      "created_at" : "2023-02-05T17:14:06Z",
      "diff_hunk" : "@@ -756,6 +782,17 @@ class PKHDescriptor final : public DescriptorImpl\n     PKHDescriptor(std::unique_ptr<PubkeyProvider> prov) : DescriptorImpl(Vector(std::move(prov)), \"pkh\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::LEGACY; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 1 + 20 + 1 + 1; }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        const auto sig_size = use_max_sig ? 72 : 71;\n+        return 1 + sig_size + 1 + 33;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096743640",
      "id" : 1096743640,
      "in_reply_to_id" : 1096378066,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BXvrY",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 790,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1284302740,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096743640/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-05T17:14:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096743640",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096763645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096763645"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "967795cee4ae9594d1abc6d2ec085dac8c5bf460",
      "created_at" : "2023-02-05T17:45:33Z",
      "diff_hunk" : "@@ -931,6 +1058,20 @@ class TRDescriptor final : public DescriptorImpl\n     }\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // FIXME: We assume keypath spend, which can lead to very large underestimations.\n+        return 1 + 64;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1096763645",
      "id" : 1096763645,
      "in_reply_to_id" : 1032600553,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585BX0j9",
      "original_commit_id" : "052edf8aa48030679aed36dc47937ce459995590",
      "original_line" : 1066,
      "original_position" : 217,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1284319122,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096763645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-02-05T17:45:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1096763645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review. Addressed your comments and rebased on master.",
      "created_at" : "2023-02-05T17:56:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1418201630",
      "id" : 1418201630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585UiAoe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1418201630/reactions"
      },
      "updated_at" : "2023-02-05T17:56:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1418201630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1100365109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1100365109"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 896a560abef52f41dbc12e3fedcd86ab4a657b06 \"wallet: use descriptor satisfaction size to estimate inputs size\"\r\n\r\nI'm not sure if this is actually correct. I think there are some situations where this would return the wrong descriptor.\r\n\r\nConsider a watchonly wallet where the user has imported an `addr()`. When creating a transaction, that user has provided the full `wpkh()` for that `addr()` on the command line. In this scenario, I believe `GetSolvingProvider` would return a `SigningProvider`, but it wouldn't contain anything. This would then result in `InferDescriptor` making us an `addr()` that cannot be used to retrieve the input weight.\r\n\r\nI think this could be solved by combining the retrieved solving provider with the external provider and doing a single `InferDescriptor`. This would also help in cases where the imported descriptor contains incomplete information, e.g. once we can have `tr()` with partial branches.",
      "commit_id" : "967795cee4ae9594d1abc6d2ec085dac8c5bf460",
      "created_at" : "2023-02-08T16:11:07Z",
      "diff_hunk" : "@@ -46,17 +90,65 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    if (const auto provider = wallet->GetSolvingProvider(script_pubkey)) {\n+        return InferDescriptor(script_pubkey, *provider);\n+    }\n+    if (coin_control) {\n+        return InferDescriptor(script_pubkey, coin_control->m_external_provider);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1100365109",
      "id" : 1100365109,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585Blj01",
      "original_commit_id" : "896a560abef52f41dbc12e3fedcd86ab4a657b06",
      "original_line" : 102,
      "original_position" : 77,
      "original_start_line" : 97,
      "path" : "src/wallet/spend.cpp",
      "position" : 77,
      "pull_request_review_id" : 1289523983,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1100365109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 98,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-08T16:11:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1100365109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1103646477"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103646477"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm good point. Unfortunately this is a bit clumsy for the `LegacyScriptPubKeyMan`: since it's not a `FlatSigningProvider` it involves copying all its data in order to merge both providers. I've pushed the change in a separate commit to be squashed if it's not too unreasonable. What do you think?",
      "commit_id" : "67fb46140429a6f5281486d6f0476ec43153bd47",
      "created_at" : "2023-02-11T15:34:48Z",
      "diff_hunk" : "@@ -46,17 +90,65 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    if (const auto provider = wallet->GetSolvingProvider(script_pubkey)) {\n+        return InferDescriptor(script_pubkey, *provider);\n+    }\n+    if (coin_control) {\n+        return InferDescriptor(script_pubkey, coin_control->m_external_provider);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1103646477",
      "id" : 1103646477,
      "in_reply_to_id" : 1100365109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ByE8N",
      "original_commit_id" : "896a560abef52f41dbc12e3fedcd86ab4a657b06",
      "original_line" : 102,
      "original_position" : 77,
      "original_start_line" : 97,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1294561908,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103646477/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-11T15:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1103646477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-16T11:10:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1432920309",
      "id" : 1432920309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585VaKD1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1432920309/reactions"
      },
      "updated_at" : "2023-02-16T11:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1432920309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1117183645"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117183645"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> What do you think?\r\n\r\n@achow101 followup thoughts here?",
      "commit_id" : "67fb46140429a6f5281486d6f0476ec43153bd47",
      "created_at" : "2023-02-24T15:26:15Z",
      "diff_hunk" : "@@ -46,17 +90,65 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    if (const auto provider = wallet->GetSolvingProvider(script_pubkey)) {\n+        return InferDescriptor(script_pubkey, *provider);\n+    }\n+    if (coin_control) {\n+        return InferDescriptor(script_pubkey, coin_control->m_external_provider);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1117183645",
      "id" : 1117183645,
      "in_reply_to_id" : 1100365109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Clt6d",
      "original_commit_id" : "896a560abef52f41dbc12e3fedcd86ab4a657b06",
      "original_line" : 102,
      "original_position" : 77,
      "original_start_line" : 97,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1313728509,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117183645/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "updated_at" : "2023-02-24T15:26:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1117183645",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1180304523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180304523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Pushed a much cleaner version of this: introducing a `MultiSigningProvider` to wrap around both the wallet and external providers. Still as a commit on top, let me know what you think @achow101.",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-04-28T11:39:38Z",
      "diff_hunk" : "@@ -46,17 +90,65 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    if (const auto provider = wallet->GetSolvingProvider(script_pubkey)) {\n+        return InferDescriptor(script_pubkey, *provider);\n+    }\n+    if (coin_control) {\n+        return InferDescriptor(script_pubkey, coin_control->m_external_provider);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1180304523",
      "id" : 1180304523,
      "in_reply_to_id" : 1100365109,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GWgSL",
      "original_commit_id" : "896a560abef52f41dbc12e3fedcd86ab4a657b06",
      "original_line" : 108,
      "original_position" : 77,
      "original_start_line" : 97,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1405780958,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180304523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-04-28T11:39:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180304523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, and added Miniscript support since signing support was merged.",
      "created_at" : "2023-04-29T21:10:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1528873153",
      "id" : 1528873153,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585bIMDB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528873153/reactions"
      },
      "updated_at" : "2023-04-29T21:10:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1528873153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-03T16:59:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1533390913",
      "id" : 1533390913,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585bZbBB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1533390913/reactions"
      },
      "updated_at" : "2023-05-03T16:59:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1533390913",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1184204984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184204984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 9e8df2de1750b823492c18a924fefbd7d474819e \"descriptor: introduce a method to get the satisfaction size\"\r\n\r\nIs `MultiADescriptor` supposed to be missing a `MaxSatisfactionWeight`?",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-05-03T20:08:28Z",
      "diff_hunk" : "@@ -843,6 +907,15 @@ class MultiADescriptor final : public DescriptorImpl\n public:\n     MultiADescriptor(int threshold, std::vector<std::unique_ptr<PubkeyProvider>> providers, bool sorted = false) : DescriptorImpl(std::move(providers), sorted ? \"sortedmulti_a\" : \"multi_a\"), m_threshold(threshold), m_sorted(sorted) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override {\n+        const auto n_keys = m_pubkey_args.size();\n+        return (1 + 32 + 1) * n_keys + BuildScript(m_threshold).size() + 1;\n+    }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        return (1 + 65) * m_threshold + (m_pubkey_args.size() - m_threshold);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1184204984",
      "id" : 1184204984,
      "line" : 938,
      "node_id" : "PRRC_kwDOABII585GlYi4",
      "original_commit_id" : "9e8df2de1750b823492c18a924fefbd7d474819e",
      "original_line" : 938,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 135,
      "pull_request_review_id" : 1411720143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184204984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T20:10:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1184204984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1232007618"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232007618"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes. It would never be used as `MaxSatisfactionWeight` is only called on top-level descriptors.",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-06-16T09:22:07Z",
      "diff_hunk" : "@@ -843,6 +907,15 @@ class MultiADescriptor final : public DescriptorImpl\n public:\n     MultiADescriptor(int threshold, std::vector<std::unique_ptr<PubkeyProvider>> providers, bool sorted = false) : DescriptorImpl(std::move(providers), sorted ? \"sortedmulti_a\" : \"multi_a\"), m_threshold(threshold), m_sorted(sorted) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override {\n+        const auto n_keys = m_pubkey_args.size();\n+        return (1 + 32 + 1) * n_keys + BuildScript(m_threshold).size() + 1;\n+    }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        return (1 + 65) * m_threshold + (m_pubkey_args.size() - m_threshold);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1232007618",
      "id" : 1232007618,
      "in_reply_to_id" : 1184204984,
      "line" : 938,
      "node_id" : "PRRC_kwDOABII585JbvHC",
      "original_commit_id" : "9e8df2de1750b823492c18a924fefbd7d474819e",
      "original_line" : 938,
      "original_position" : 125,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 135,
      "pull_request_review_id" : 1483078333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232007618/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-16T09:22:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1232007618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased, added more test coverage (we must be able to estimate the satisfaction size for any solvable top-level descriptor), properly integrated the `MultiSigningProvider` and removed the `MaxSatisfactionWeight` for `MiniscriptDescriptor` (which would never be called as they are never top-level).",
      "created_at" : "2023-06-16T09:54:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1594424792",
      "id" : 1594424792,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585fCP3Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1594424792/reactions"
      },
      "updated_at" : "2023-06-16T09:54:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1594424792",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1240225981"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240225981"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 3e3521bf956c4387abe4b6ce12ce55224a9e97ba \"miniscript: introduce a helper to get the maximum witness size\"\r\n\r\nI don't quite follow why `subs[0]` needs an additional `+ 1` that `subs[1]` doesn't have. AFAICT, `subs[0]` just has a `1` in the witness, while `subs[1]` has a `0`, and both should be the same size.",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-06-23T19:24:21Z",
      "diff_hunk" : "@@ -846,6 +857,56 @@ struct Node {\n         assert(false);\n     }\n \n+    internal::WitnessSize CalcWitnessSize() const {\n+        switch (fragment) {\n+            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_1:\n+            case Fragment::OLDER:\n+            case Fragment::AFTER: return {0, {}};\n+            case Fragment::PK_K: return {1 + 72, 1};\n+            case Fragment::PK_H: return {1 + 72 + 1 + 33, 1 + 1 + 33};\n+            case Fragment::SHA256:\n+            case Fragment::RIPEMD160:\n+            case Fragment::HASH256:\n+            case Fragment::HASH160: return {1 + 32, {}};\n+            case Fragment::ANDOR: {\n+                const auto sat{(subs[0]->ws.sat + subs[1]->ws.sat) | (subs[0]->ws.dsat + subs[2]->ws.sat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[2]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::AND_V: return {subs[0]->ws.sat + subs[1]->ws.sat, {}};\n+            case Fragment::AND_B: return {subs[0]->ws.sat + subs[1]->ws.sat, subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_B: {\n+                const auto sat{(subs[0]->ws.dsat + subs[1]->ws.sat) | (subs[0]->ws.sat + subs[1]->ws.dsat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[1]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::OR_C: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), {}};\n+            case Fragment::OR_D: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_I: return {(subs[0]->ws.sat + 1 + 1) | (subs[1]->ws.sat + 1), (subs[0]->ws.dsat + 1 + 1) | (subs[1]->ws.dsat + 1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1240225981",
      "id" : 1240225981,
      "line" : 886,
      "node_id" : "PRRC_kwDOABII585J7Fi9",
      "original_commit_id" : "3e3521bf956c4387abe4b6ce12ce55224a9e97ba",
      "original_line" : 886,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 55,
      "pull_request_review_id" : 1495781351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240225981/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T19:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240225981",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1240233314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240233314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This wasn't changed?",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-06-23T19:31:47Z",
      "diff_hunk" : "@@ -816,6 +864,20 @@ class MultisigDescriptor final : public DescriptorImpl\n public:\n     MultisigDescriptor(int threshold, std::vector<std::unique_ptr<PubkeyProvider>> providers, bool sorted = false) : DescriptorImpl(std::move(providers), sorted ? \"sortedmulti\" : \"multi\"), m_threshold(threshold), m_sorted(sorted) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override {\n+        const auto n_keys = m_pubkey_args.size();\n+        return 1 + BuildScript(n_keys).size() + BuildScript(m_threshold).size() + 34 * n_keys;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1240233314",
      "id" : 1240233314,
      "in_reply_to_id" : 1096378894,
      "line" : 892,
      "node_id" : "PRRC_kwDOABII585J7HVi",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 892,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 107,
      "pull_request_review_id" : 1495781351,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240233314/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T19:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1240233314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243598951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243598951"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because serializing a `1` as a witness stack element needs to specify a 1-byte long element and then the value of this byte (serialized `0x0101`) whereas encoding a `0` is simply the empty witness (serialized `0x00`).",
      "commit_id" : "9c57a61e7d333bc52e1643d04cf35fa4fda06c2e",
      "created_at" : "2023-06-27T11:43:01Z",
      "diff_hunk" : "@@ -846,6 +857,56 @@ struct Node {\n         assert(false);\n     }\n \n+    internal::WitnessSize CalcWitnessSize() const {\n+        switch (fragment) {\n+            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_1:\n+            case Fragment::OLDER:\n+            case Fragment::AFTER: return {0, {}};\n+            case Fragment::PK_K: return {1 + 72, 1};\n+            case Fragment::PK_H: return {1 + 72 + 1 + 33, 1 + 1 + 33};\n+            case Fragment::SHA256:\n+            case Fragment::RIPEMD160:\n+            case Fragment::HASH256:\n+            case Fragment::HASH160: return {1 + 32, {}};\n+            case Fragment::ANDOR: {\n+                const auto sat{(subs[0]->ws.sat + subs[1]->ws.sat) | (subs[0]->ws.dsat + subs[2]->ws.sat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[2]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::AND_V: return {subs[0]->ws.sat + subs[1]->ws.sat, {}};\n+            case Fragment::AND_B: return {subs[0]->ws.sat + subs[1]->ws.sat, subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_B: {\n+                const auto sat{(subs[0]->ws.dsat + subs[1]->ws.sat) | (subs[0]->ws.sat + subs[1]->ws.dsat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[1]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::OR_C: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), {}};\n+            case Fragment::OR_D: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_I: return {(subs[0]->ws.sat + 1 + 1) | (subs[1]->ws.sat + 1), (subs[0]->ws.dsat + 1 + 1) | (subs[1]->ws.dsat + 1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243598951",
      "id" : 1243598951,
      "in_reply_to_id" : 1240225981,
      "line" : 886,
      "node_id" : "PRRC_kwDOABII585KH9Bn",
      "original_commit_id" : "3e3521bf956c4387abe4b6ce12ce55224a9e97ba",
      "original_line" : 886,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 55,
      "pull_request_review_id" : 1500646225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243598951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-27T11:43:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243598951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243851964"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243851964"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops. Done now.",
      "commit_id" : "f577372b92b797fe0bc642990d631635d1ae7b51",
      "created_at" : "2023-06-27T14:30:43Z",
      "diff_hunk" : "@@ -816,6 +864,20 @@ class MultisigDescriptor final : public DescriptorImpl\n public:\n     MultisigDescriptor(int threshold, std::vector<std::unique_ptr<PubkeyProvider>> providers, bool sorted = false) : DescriptorImpl(std::move(providers), sorted ? \"sortedmulti\" : \"multi\"), m_threshold(threshold), m_sorted(sorted) {}\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override {\n+        const auto n_keys = m_pubkey_args.size();\n+        return 1 + BuildScript(n_keys).size() + BuildScript(m_threshold).size() + 34 * n_keys;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243851964",
      "id" : 1243851964,
      "in_reply_to_id" : 1096378894,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KI6y8",
      "original_commit_id" : "c8b0aeb534edce08366176275d5577c1e309eb6f",
      "original_line" : 892,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1501045919,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243851964/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-27T14:30:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243851964",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243894028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243894028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I thought `1` was `OP_1`?",
      "commit_id" : "f577372b92b797fe0bc642990d631635d1ae7b51",
      "created_at" : "2023-06-27T14:55:06Z",
      "diff_hunk" : "@@ -846,6 +857,56 @@ struct Node {\n         assert(false);\n     }\n \n+    internal::WitnessSize CalcWitnessSize() const {\n+        switch (fragment) {\n+            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_1:\n+            case Fragment::OLDER:\n+            case Fragment::AFTER: return {0, {}};\n+            case Fragment::PK_K: return {1 + 72, 1};\n+            case Fragment::PK_H: return {1 + 72 + 1 + 33, 1 + 1 + 33};\n+            case Fragment::SHA256:\n+            case Fragment::RIPEMD160:\n+            case Fragment::HASH256:\n+            case Fragment::HASH160: return {1 + 32, {}};\n+            case Fragment::ANDOR: {\n+                const auto sat{(subs[0]->ws.sat + subs[1]->ws.sat) | (subs[0]->ws.dsat + subs[2]->ws.sat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[2]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::AND_V: return {subs[0]->ws.sat + subs[1]->ws.sat, {}};\n+            case Fragment::AND_B: return {subs[0]->ws.sat + subs[1]->ws.sat, subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_B: {\n+                const auto sat{(subs[0]->ws.dsat + subs[1]->ws.sat) | (subs[0]->ws.sat + subs[1]->ws.dsat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[1]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::OR_C: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), {}};\n+            case Fragment::OR_D: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_I: return {(subs[0]->ws.sat + 1 + 1) | (subs[1]->ws.sat + 1), (subs[0]->ws.dsat + 1 + 1) | (subs[1]->ws.dsat + 1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243894028",
      "id" : 1243894028,
      "in_reply_to_id" : 1240225981,
      "line" : 886,
      "node_id" : "PRRC_kwDOABII585KJFEM",
      "original_commit_id" : "3e3521bf956c4387abe4b6ce12ce55224a9e97ba",
      "original_line" : 886,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 55,
      "pull_request_review_id" : 1501125885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243894028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-27T14:55:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243894028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243896823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243896823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Not in witnesses. :)",
      "commit_id" : "f577372b92b797fe0bc642990d631635d1ae7b51",
      "created_at" : "2023-06-27T14:56:43Z",
      "diff_hunk" : "@@ -846,6 +857,56 @@ struct Node {\n         assert(false);\n     }\n \n+    internal::WitnessSize CalcWitnessSize() const {\n+        switch (fragment) {\n+            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_1:\n+            case Fragment::OLDER:\n+            case Fragment::AFTER: return {0, {}};\n+            case Fragment::PK_K: return {1 + 72, 1};\n+            case Fragment::PK_H: return {1 + 72 + 1 + 33, 1 + 1 + 33};\n+            case Fragment::SHA256:\n+            case Fragment::RIPEMD160:\n+            case Fragment::HASH256:\n+            case Fragment::HASH160: return {1 + 32, {}};\n+            case Fragment::ANDOR: {\n+                const auto sat{(subs[0]->ws.sat + subs[1]->ws.sat) | (subs[0]->ws.dsat + subs[2]->ws.sat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[2]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::AND_V: return {subs[0]->ws.sat + subs[1]->ws.sat, {}};\n+            case Fragment::AND_B: return {subs[0]->ws.sat + subs[1]->ws.sat, subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_B: {\n+                const auto sat{(subs[0]->ws.dsat + subs[1]->ws.sat) | (subs[0]->ws.sat + subs[1]->ws.dsat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[1]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::OR_C: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), {}};\n+            case Fragment::OR_D: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_I: return {(subs[0]->ws.sat + 1 + 1) | (subs[1]->ws.sat + 1), (subs[0]->ws.dsat + 1 + 1) | (subs[1]->ws.dsat + 1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243896823",
      "id" : 1243896823,
      "in_reply_to_id" : 1240225981,
      "line" : 886,
      "node_id" : "PRRC_kwDOABII585KJFv3",
      "original_commit_id" : "3e3521bf956c4387abe4b6ce12ce55224a9e97ba",
      "original_line" : 886,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 55,
      "pull_request_review_id" : 1501131295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243896823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-27T14:56:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243896823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243922086"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243922086"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh right, duh.",
      "commit_id" : "f577372b92b797fe0bc642990d631635d1ae7b51",
      "created_at" : "2023-06-27T15:11:25Z",
      "diff_hunk" : "@@ -846,6 +857,56 @@ struct Node {\n         assert(false);\n     }\n \n+    internal::WitnessSize CalcWitnessSize() const {\n+        switch (fragment) {\n+            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_1:\n+            case Fragment::OLDER:\n+            case Fragment::AFTER: return {0, {}};\n+            case Fragment::PK_K: return {1 + 72, 1};\n+            case Fragment::PK_H: return {1 + 72 + 1 + 33, 1 + 1 + 33};\n+            case Fragment::SHA256:\n+            case Fragment::RIPEMD160:\n+            case Fragment::HASH256:\n+            case Fragment::HASH160: return {1 + 32, {}};\n+            case Fragment::ANDOR: {\n+                const auto sat{(subs[0]->ws.sat + subs[1]->ws.sat) | (subs[0]->ws.dsat + subs[2]->ws.sat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[2]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::AND_V: return {subs[0]->ws.sat + subs[1]->ws.sat, {}};\n+            case Fragment::AND_B: return {subs[0]->ws.sat + subs[1]->ws.sat, subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_B: {\n+                const auto sat{(subs[0]->ws.dsat + subs[1]->ws.sat) | (subs[0]->ws.sat + subs[1]->ws.dsat)};\n+                const auto dsat{subs[0]->ws.dsat + subs[1]->ws.dsat};\n+                return {sat, dsat};\n+            }\n+            case Fragment::OR_C: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), {}};\n+            case Fragment::OR_D: return {subs[0]->ws.sat | (subs[0]->ws.dsat + subs[1]->ws.sat), subs[0]->ws.dsat + subs[1]->ws.dsat};\n+            case Fragment::OR_I: return {(subs[0]->ws.sat + 1 + 1) | (subs[1]->ws.sat + 1), (subs[0]->ws.dsat + 1 + 1) | (subs[1]->ws.dsat + 1)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1243922086",
      "id" : 1243922086,
      "in_reply_to_id" : 1240225981,
      "line" : 886,
      "node_id" : "PRRC_kwDOABII585KJL6m",
      "original_commit_id" : "3e3521bf956c4387abe4b6ce12ce55224a9e97ba",
      "original_line" : 886,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 55,
      "pull_request_review_id" : 1501179923,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243922086/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-27T15:11:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243922086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-04T03:10:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1619403708",
      "id" : 1619403708,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585ghiO8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619403708/reactions"
      },
      "updated_at" : "2023-07-04T03:10:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619403708",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.",
      "created_at" : "2023-07-19T12:20:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1641982667",
      "id" : 1641982667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585h3qrL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1641982667/reactions"
      },
      "updated_at" : "2023-07-19T12:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1641982667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1269467464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269467464"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is not true if the Miniscript descriptor was parsed from Script. I'll update this.",
      "commit_id" : "b690e52a0ed7c7929bb3257b0ad8c287c36b4214",
      "created_at" : "2023-07-20T13:32:39Z",
      "diff_hunk" : "@@ -1040,6 +1156,14 @@ class MiniscriptDescriptor final : public DescriptorImpl\n \n     bool IsSolvable() const override { return true; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return m_node->ScriptSize(); }\n+\n+    std::optional<int64_t> MaxSatSize(bool) const override {\n+        // We only ever parse satisfiable Miniscripts. Also note for Miniscript we always assume\n+        // high-R ECDSA signatures.\n+        return CHECK_NONFATAL(m_node->GetWitnessSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1269467464",
      "id" : 1269467464,
      "line" : 1192,
      "node_id" : "PRRC_kwDOABII585LqolI",
      "original_commit_id" : "037835f084cbe175a9d1240d14ef0370f90d5467",
      "original_line" : 1165,
      "original_position" : 221,
      "original_start_line" : 1163,
      "path" : "src/script/descriptor.cpp",
      "position" : 248,
      "pull_request_review_id" : 1539278235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269467464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1190,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-20T13:32:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269467464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1269784399"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269784399"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ecdee0c3f802c6308c358a5ee501d2e031c8dcf2 \"miniscript: make GetStackSize independent of P2WSH context\"\r\n\r\nThe comment above this function is outdated.",
      "commit_id" : "b690e52a0ed7c7929bb3257b0ad8c287c36b4214",
      "created_at" : "2023-07-20T17:48:54Z",
      "diff_hunk" : "@@ -1152,12 +1152,12 @@ struct Node {\n      * the script push. */\n     std::optional<uint32_t> GetStackSize() const {\n         if (!ss.sat.valid) return {};\n-        return ss.sat.value + 1;\n+        return ss.sat.value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1269784399",
      "id" : 1269784399,
      "line" : 1216,
      "node_id" : "PRRC_kwDOABII585Lr19P",
      "original_commit_id" : "ecdee0c3f802c6308c358a5ee501d2e031c8dcf2",
      "original_line" : 1155,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 87,
      "pull_request_review_id" : 1539788684,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269784399/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-20T17:52:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1269784399",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1270423929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270423929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Updated the comment.",
      "commit_id" : "1da0eca7350432cf66d611e7bbac3894fe9c1d19",
      "created_at" : "2023-07-21T08:57:42Z",
      "diff_hunk" : "@@ -1152,12 +1152,12 @@ struct Node {\n      * the script push. */\n     std::optional<uint32_t> GetStackSize() const {\n         if (!ss.sat.valid) return {};\n-        return ss.sat.value + 1;\n+        return ss.sat.value;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1270423929",
      "id" : 1270423929,
      "in_reply_to_id" : 1269784399,
      "line" : 1216,
      "node_id" : "PRRC_kwDOABII585LuSF5",
      "original_commit_id" : "ecdee0c3f802c6308c358a5ee501d2e031c8dcf2",
      "original_line" : 1155,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 93,
      "pull_request_review_id" : 1540760832,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270423929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-21T08:57:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270423929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1270444558"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270444558"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "1da0eca7350432cf66d611e7bbac3894fe9c1d19",
      "created_at" : "2023-07-21T09:17:57Z",
      "diff_hunk" : "@@ -1040,6 +1156,14 @@ class MiniscriptDescriptor final : public DescriptorImpl\n \n     bool IsSolvable() const override { return true; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return m_node->ScriptSize(); }\n+\n+    std::optional<int64_t> MaxSatSize(bool) const override {\n+        // We only ever parse satisfiable Miniscripts. Also note for Miniscript we always assume\n+        // high-R ECDSA signatures.\n+        return CHECK_NONFATAL(m_node->GetWitnessSize());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1270444558",
      "id" : 1270444558,
      "in_reply_to_id" : 1269467464,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585LuXIO",
      "original_commit_id" : "037835f084cbe175a9d1240d14ef0370f90d5467",
      "original_line" : 1192,
      "original_position" : 221,
      "original_start_line" : 1163,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1540793653,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270444558/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-21T09:17:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1270444558",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-27T18:20:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1654173231",
      "id" : 1654173231,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585imK4v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1654173231/reactions"
      },
      "updated_at" : "2023-07-27T18:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1654173231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #27888.",
      "created_at" : "2023-07-31T22:32:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1659280674",
      "id" : 1659280674,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585i5p0i",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659280674/reactions"
      },
      "updated_at" : "2023-07-31T22:32:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659280674",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased after #28244.",
      "created_at" : "2023-08-18T12:40:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#issuecomment-1683861802",
      "id" : 1683861802,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26567",
      "node_id" : "IC_kwDOABII585kXbEq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1683861802/reactions"
      },
      "updated_at" : "2023-08-18T12:40:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1683861802",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304757022"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757022"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In a7db3f0503626c3671482720b22fedef7cd9e23c \"miniscript: introduce a helper to get the maximum witness size\"\r\n\r\nnit: These comments should be changed in the previous commit.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:13:15Z",
      "diff_hunk" : "@@ -1148,8 +1209,8 @@ struct Node {\n         return true;\n     }\n \n-    /** Return the maximum number of stack elements needed to satisfy this script non-malleably, including\n-     * the script push. */\n+    /** Return the maximum number of stack elements needed to satisfy this script non-malleably.\n+     * This does not account for the P2WSH script push. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304757022",
      "id" : 1304757022,
      "line" : 1213,
      "node_id" : "PRRC_kwDOABII585NxQMe",
      "original_commit_id" : "a7db3f0503626c3671482720b22fedef7cd9e23c",
      "original_line" : 1213,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 89,
      "pull_request_review_id" : 1594285891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757022/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757022",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304757419"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757419"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 310a7382454be01262b3fb2b089372a71a8b4482 \"wallet: use descriptor satisfaction size to estimate inputs size\"\r\n\r\nnit: Could just return the result of `MaxInputWeight` directly.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:13:40Z",
      "diff_hunk" : "@@ -50,15 +96,67 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), wallet->CanGrindR(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    MultiSigningProvider providers;\n+    for (const auto spkman: wallet->GetScriptPubKeyMans(script_pubkey)) {\n+        providers.AddProvider(spkman->GetSolvingProvider(script_pubkey));\n+    }\n+    if (coin_control) {\n+        providers.AddProvider(std::make_unique<FlatSigningProvider>(coin_control->m_external_provider));\n+    }\n+    return InferDescriptor(script_pubkey, providers);\n+}\n+\n+/** Infer the maximum size of this input after it will be signed. */\n+static std::optional<int64_t> GetSignedTxinWeight(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                  const CTxIn& txin, const CTxOut& txo, const bool tx_is_segwit,\n+                                                  const bool can_grind_r)\n+{\n+    // If weight was provided, use that.\n+    if (coin_control && coin_control->HasInputWeight(txin.prevout)) {\n+        return coin_control->GetInputWeight(txin.prevout);\n+    }\n+\n+    // Otherwise, use the maximum satisfaction size provided by the descriptor.\n+    std::unique_ptr<Descriptor> desc{GetDescriptor(wallet, coin_control, txo.scriptPubKey)};\n+    if (desc) {\n+        if (const auto weight = MaxInputWeight(*desc, {txin}, coin_control, tx_is_segwit, can_grind_r)) return *weight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304757419",
      "id" : 1304757419,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NxQSr",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 126,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1594285891,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757419/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:20:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304757419",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304764381"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304764381"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would a test to verify that the descriptor's string length matches `ScriptSize()` make sense?",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:20:33Z",
      "diff_hunk" : "@@ -150,6 +150,13 @@ void DoCheck(std::string prv, std::string pub, const std::string& norm_pub, int\n     parse_pub = Parse(pub, keys_pub, error);\n     BOOST_CHECK_MESSAGE(parse_pub, error);\n \n+    // We must be able to estimate the max satisfaction size for any solvable descriptor top descriptor (but combo).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304764381",
      "id" : 1304764381,
      "line" : 153,
      "node_id" : "PRRC_kwDOABII585NxR_d",
      "original_commit_id" : "07f457bb4de83c979f50932ded70ff124cab3ac7",
      "original_line" : 153,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1594299862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304764381/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304764381",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304766439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304766439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Here too, test that `ScriptSize()` equals the actually generated script's size?",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:22:54Z",
      "diff_hunk" : "@@ -132,6 +132,13 @@ static void TestDescriptor(const Descriptor& desc, FlatSigningProvider& sig_prov\n     if (!out_scripts.empty()) {\n         assert(InferDescriptor(out_scripts.back(), sig_provider));\n     }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304766439",
      "id" : 1304766439,
      "line" : 134,
      "node_id" : "PRRC_kwDOABII585NxSfn",
      "original_commit_id" : "07f457bb4de83c979f50932ded70ff124cab3ac7",
      "original_line" : 134,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/descriptor_parse.cpp",
      "position" : 13,
      "pull_request_review_id" : 1594299862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304766439/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304766439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304776539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304776539"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit typo: spend -> spends",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:33:14Z",
      "diff_hunk" : "@@ -50,15 +96,67 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), wallet->CanGrindR(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    MultiSigningProvider providers;\n+    for (const auto spkman: wallet->GetScriptPubKeyMans(script_pubkey)) {\n+        providers.AddProvider(spkman->GetSolvingProvider(script_pubkey));\n+    }\n+    if (coin_control) {\n+        providers.AddProvider(std::make_unique<FlatSigningProvider>(coin_control->m_external_provider));\n+    }\n+    return InferDescriptor(script_pubkey, providers);\n+}\n+\n+/** Infer the maximum size of this input after it will be signed. */\n+static std::optional<int64_t> GetSignedTxinWeight(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                  const CTxIn& txin, const CTxOut& txo, const bool tx_is_segwit,\n+                                                  const bool can_grind_r)\n+{\n+    // If weight was provided, use that.\n+    if (coin_control && coin_control->HasInputWeight(txin.prevout)) {\n+        return coin_control->GetInputWeight(txin.prevout);\n+    }\n+\n+    // Otherwise, use the maximum satisfaction size provided by the descriptor.\n+    std::unique_ptr<Descriptor> desc{GetDescriptor(wallet, coin_control, txo.scriptPubKey)};\n+    if (desc) {\n+        if (const auto weight = MaxInputWeight(*desc, {txin}, coin_control, tx_is_segwit, can_grind_r)) return *weight;\n+    }\n+\n+    return {};\n+}\n+\n // txouts needs to be in the order of tx.vin\n TxSize CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, const CCoinControl* coin_control)\n {\n-    CMutableTransaction txNew(tx);\n-    if (!wallet->DummySignTx(txNew, txouts, coin_control)) return TxSize{-1, -1};\n-    CTransaction ctx(txNew);\n-    int64_t vsize = GetVirtualTransactionSize(ctx);\n-    int64_t weight = GetTransactionWeight(ctx);\n-    return TxSize{vsize, weight};\n+    // nVersion + nLockTime + input count + output count\n+    int64_t weight = (4 + 4 + GetSizeOfCompactSize(tx.vin.size()) + GetSizeOfCompactSize(tx.vout.size())) * WITNESS_SCALE_FACTOR;\n+    // Whether any input spend a witness program. Necessary to run before the next loop over the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304776539",
      "id" : 1304776539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NxU9b",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 137,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1594299862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304776539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304776539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304783520"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304783520"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is this `can_grind_r && UseMaxSig(txin, coin_control)` condition correct? The first operand sounds like something causing low-r, while the second sounds like something causing high-r.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:40:14Z",
      "diff_hunk" : "@@ -34,14 +34,60 @@ using interfaces::FoundBlock;\n namespace wallet {\n static constexpr size_t OUTPUT_GROUP_MAX_ENTRIES{100};\n \n+/** Whether the descriptor represents, directly or not, a witness program. */\n+static bool IsSegwit(const Descriptor& desc) {\n+    if (const auto typ = desc.GetOutputType()) return *typ != OutputType::LEGACY;\n+    return false;\n+}\n+\n+/** Whether to assume ECDSA signatures' will be high-r. */\n+static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin_control) {\n+    // Use max sig if watch only inputs were used or if this particular input is an external input\n+    // to ensure a sufficient fee is attained for the requested feerate.\n+    return coin_control && (coin_control->fAllowWatchOnly || (txin && coin_control->IsExternalSelected(txin->prevout)));\n+}\n+\n+/** Get the size of an input (in witness units) once it's signed.\n+ *\n+ * @param desc The output script descriptor of the coin spent by this input.\n+ * @param txin Optionally the txin to estimate the size of. Used to determine the size of ECDSA signatures.\n+ * @param coin_control Information about the context to determine the size of ECDSA signatures.\n+ * @param tx_is_segwit Whether the transaction has at least a single input spending a segwit coin.\n+ * @param can_grind_r Whether the signer will be able to grind the R of the signature.\n+ */\n+static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\n+                                             const CCoinControl* coin_control, const bool tx_is_segwit,\n+                                             const bool can_grind_r) {\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(can_grind_r && UseMaxSig(txin, coin_control))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304783520",
      "id" : 1304783520,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NxWqg",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 61,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1594299862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304783520/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304783520",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304787630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304787630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Does the 1 here come from push of the subscript? If so, should it not use the push size of the subscript size?",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-24T19:45:04Z",
      "diff_hunk" : "@@ -905,6 +1016,26 @@ class WSHDescriptor final : public DescriptorImpl\n     WSHDescriptor(std::unique_ptr<DescriptorImpl> desc) : DescriptorImpl({}, std::move(desc), \"wsh\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        if (const auto sat_size = m_subdescriptor_args[0]->MaxSatSize(use_max_sig)) {\n+            if (const auto subscript_size = m_subdescriptor_args[0]->ScriptSize()) {\n+                return 1 + *subscript_size + *sat_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1304787630",
      "id" : 1304787630,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NxXqu",
      "original_commit_id" : "932556c87f939ffcdf1d591075d4c54bbd9bcaea",
      "original_line" : 1025,
      "original_position" : 202,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1594299862,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304787630/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-24T19:45:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304787630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499784"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499784"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:40:41Z",
      "diff_hunk" : "@@ -1148,8 +1209,8 @@ struct Node {\n         return true;\n     }\n \n-    /** Return the maximum number of stack elements needed to satisfy this script non-malleably, including\n-     * the script push. */\n+    /** Return the maximum number of stack elements needed to satisfy this script non-malleably.\n+     * This does not account for the P2WSH script push. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499784",
      "id" : 1305499784,
      "in_reply_to_id" : 1304757022,
      "line" : 1213,
      "node_id" : "PRRC_kwDOABII585N0FiI",
      "original_commit_id" : "a7db3f0503626c3671482720b22fedef7cd9e23c",
      "original_line" : 1213,
      "original_position" : 89,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 89,
      "pull_request_review_id" : 1595437040,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499784/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:40:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499784",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499836"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499836"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:40:44Z",
      "diff_hunk" : "@@ -50,15 +96,67 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), wallet->CanGrindR(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    MultiSigningProvider providers;\n+    for (const auto spkman: wallet->GetScriptPubKeyMans(script_pubkey)) {\n+        providers.AddProvider(spkman->GetSolvingProvider(script_pubkey));\n+    }\n+    if (coin_control) {\n+        providers.AddProvider(std::make_unique<FlatSigningProvider>(coin_control->m_external_provider));\n+    }\n+    return InferDescriptor(script_pubkey, providers);\n+}\n+\n+/** Infer the maximum size of this input after it will be signed. */\n+static std::optional<int64_t> GetSignedTxinWeight(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                  const CTxIn& txin, const CTxOut& txo, const bool tx_is_segwit,\n+                                                  const bool can_grind_r)\n+{\n+    // If weight was provided, use that.\n+    if (coin_control && coin_control->HasInputWeight(txin.prevout)) {\n+        return coin_control->GetInputWeight(txin.prevout);\n+    }\n+\n+    // Otherwise, use the maximum satisfaction size provided by the descriptor.\n+    std::unique_ptr<Descriptor> desc{GetDescriptor(wallet, coin_control, txo.scriptPubKey)};\n+    if (desc) {\n+        if (const auto weight = MaxInputWeight(*desc, {txin}, coin_control, tx_is_segwit, can_grind_r)) return *weight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499836",
      "id" : 1305499836,
      "in_reply_to_id" : 1304757419,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585N0Fi8",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 126,
      "original_position" : 97,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1595437116,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499836/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:40:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499836",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499922"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499922"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good call, done.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:40:50Z",
      "diff_hunk" : "@@ -150,6 +150,13 @@ void DoCheck(std::string prv, std::string pub, const std::string& norm_pub, int\n     parse_pub = Parse(pub, keys_pub, error);\n     BOOST_CHECK_MESSAGE(parse_pub, error);\n \n+    // We must be able to estimate the max satisfaction size for any solvable descriptor top descriptor (but combo).",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499922",
      "id" : 1305499922,
      "in_reply_to_id" : 1304764381,
      "line" : 153,
      "node_id" : "PRRC_kwDOABII585N0FkS",
      "original_commit_id" : "07f457bb4de83c979f50932ded70ff124cab3ac7",
      "original_line" : 153,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 4,
      "pull_request_review_id" : 1595437243,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499922/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:40:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499922",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499971"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499971"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:40:54Z",
      "diff_hunk" : "@@ -132,6 +132,13 @@ static void TestDescriptor(const Descriptor& desc, FlatSigningProvider& sig_prov\n     if (!out_scripts.empty()) {\n         assert(InferDescriptor(out_scripts.back(), sig_provider));\n     }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305499971",
      "id" : 1305499971,
      "in_reply_to_id" : 1304766439,
      "line" : 134,
      "node_id" : "PRRC_kwDOABII585N0FlD",
      "original_commit_id" : "07f457bb4de83c979f50932ded70ff124cab3ac7",
      "original_line" : 134,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/descriptor_parse.cpp",
      "position" : 13,
      "pull_request_review_id" : 1595437322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499971/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:40:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305499971",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305500019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:40:58Z",
      "diff_hunk" : "@@ -50,15 +96,67 @@ int CalculateMaximumSignedInputSize(const CTxOut& txout, const CWallet* wallet,\n     return CalculateMaximumSignedInputSize(txout, COutPoint(), provider.get(), wallet->CanGrindR(), coin_control);\n }\n \n+/** Infer a descriptor for the given output script. */\n+static std::unique_ptr<Descriptor> GetDescriptor(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                 const CScript script_pubkey)\n+{\n+    MultiSigningProvider providers;\n+    for (const auto spkman: wallet->GetScriptPubKeyMans(script_pubkey)) {\n+        providers.AddProvider(spkman->GetSolvingProvider(script_pubkey));\n+    }\n+    if (coin_control) {\n+        providers.AddProvider(std::make_unique<FlatSigningProvider>(coin_control->m_external_provider));\n+    }\n+    return InferDescriptor(script_pubkey, providers);\n+}\n+\n+/** Infer the maximum size of this input after it will be signed. */\n+static std::optional<int64_t> GetSignedTxinWeight(const CWallet* wallet, const CCoinControl* coin_control,\n+                                                  const CTxIn& txin, const CTxOut& txo, const bool tx_is_segwit,\n+                                                  const bool can_grind_r)\n+{\n+    // If weight was provided, use that.\n+    if (coin_control && coin_control->HasInputWeight(txin.prevout)) {\n+        return coin_control->GetInputWeight(txin.prevout);\n+    }\n+\n+    // Otherwise, use the maximum satisfaction size provided by the descriptor.\n+    std::unique_ptr<Descriptor> desc{GetDescriptor(wallet, coin_control, txo.scriptPubKey)};\n+    if (desc) {\n+        if (const auto weight = MaxInputWeight(*desc, {txin}, coin_control, tx_is_segwit, can_grind_r)) return *weight;\n+    }\n+\n+    return {};\n+}\n+\n // txouts needs to be in the order of tx.vin\n TxSize CalculateMaximumSignedTxSize(const CTransaction &tx, const CWallet *wallet, const std::vector<CTxOut>& txouts, const CCoinControl* coin_control)\n {\n-    CMutableTransaction txNew(tx);\n-    if (!wallet->DummySignTx(txNew, txouts, coin_control)) return TxSize{-1, -1};\n-    CTransaction ctx(txNew);\n-    int64_t vsize = GetVirtualTransactionSize(ctx);\n-    int64_t weight = GetTransactionWeight(ctx);\n-    return TxSize{vsize, weight};\n+    // nVersion + nLockTime + input count + output count\n+    int64_t weight = (4 + 4 + GetSizeOfCompactSize(tx.vin.size()) + GetSizeOfCompactSize(tx.vout.size())) * WITNESS_SCALE_FACTOR;\n+    // Whether any input spend a witness program. Necessary to run before the next loop over the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305500019",
      "id" : 1305500019,
      "in_reply_to_id" : 1304776539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585N0Flz",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 137,
      "original_position" : 114,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1595437399,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500019/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:40:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305500176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch, fixed. I was a bit concerned that this wouldn't make any test fail, but it's simply because those use wallets without external signer (so `can_grind_r` is always `true`). Actually getting the condition backward:\r\n```patch\r\ndiff --git a/src/wallet/spend.cpp b/src/wallet/spend.cpp\r\nindex 750b6c100b..45f225b18f 100644\r\n--- a/src/wallet/spend.cpp\r\n+++ b/src/wallet/spend.cpp\r\n@@ -58,7 +58,7 @@ static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin\r\n static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\r\n                                              const CCoinControl* coin_control, const bool tx_is_segwit,\r\n                                              const bool can_grind_r) {\r\n-    if (const auto sat_weight = desc.MaxSatisfactionWeight(!can_grind_r || UseMaxSig(txin, coin_control))) {\r\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(can_grind_r && !UseMaxSig(txin, coin_control))) {\r\n         if (const auto elems_count = desc.MaxSatisfactionElems()) {\r\n             const bool is_segwit = IsSegwit(desc);\r\n             // Account for the size of the scriptsig and the number of elements on the witness stack. Note\r\n```\r\n would make the tests for this feature fail.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:41:08Z",
      "diff_hunk" : "@@ -34,14 +34,60 @@ using interfaces::FoundBlock;\n namespace wallet {\n static constexpr size_t OUTPUT_GROUP_MAX_ENTRIES{100};\n \n+/** Whether the descriptor represents, directly or not, a witness program. */\n+static bool IsSegwit(const Descriptor& desc) {\n+    if (const auto typ = desc.GetOutputType()) return *typ != OutputType::LEGACY;\n+    return false;\n+}\n+\n+/** Whether to assume ECDSA signatures' will be high-r. */\n+static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin_control) {\n+    // Use max sig if watch only inputs were used or if this particular input is an external input\n+    // to ensure a sufficient fee is attained for the requested feerate.\n+    return coin_control && (coin_control->fAllowWatchOnly || (txin && coin_control->IsExternalSelected(txin->prevout)));\n+}\n+\n+/** Get the size of an input (in witness units) once it's signed.\n+ *\n+ * @param desc The output script descriptor of the coin spent by this input.\n+ * @param txin Optionally the txin to estimate the size of. Used to determine the size of ECDSA signatures.\n+ * @param coin_control Information about the context to determine the size of ECDSA signatures.\n+ * @param tx_is_segwit Whether the transaction has at least a single input spending a segwit coin.\n+ * @param can_grind_r Whether the signer will be able to grind the R of the signature.\n+ */\n+static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\n+                                             const CCoinControl* coin_control, const bool tx_is_segwit,\n+                                             const bool can_grind_r) {\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(can_grind_r && UseMaxSig(txin, coin_control))) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305500176",
      "id" : 1305500176,
      "in_reply_to_id" : 1304783520,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585N0FoQ",
      "original_commit_id" : "310a7382454be01262b3fb2b089372a71a8b4482",
      "original_line" : 61,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : null,
      "pull_request_review_id" : 1595437643,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:41:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305500176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305501071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305501071"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, done. This one slipped through my adapting this to consider Miniscript descriptors.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-25T10:42:14Z",
      "diff_hunk" : "@@ -905,6 +1016,26 @@ class WSHDescriptor final : public DescriptorImpl\n     WSHDescriptor(std::unique_ptr<DescriptorImpl> desc) : DescriptorImpl({}, std::move(desc), \"wsh\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatSize(bool use_max_sig) const override {\n+        if (const auto sat_size = m_subdescriptor_args[0]->MaxSatSize(use_max_sig)) {\n+            if (const auto subscript_size = m_subdescriptor_args[0]->ScriptSize()) {\n+                return 1 + *subscript_size + *sat_size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1305501071",
      "id" : 1305501071,
      "in_reply_to_id" : 1304787630,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585N0F2P",
      "original_commit_id" : "932556c87f939ffcdf1d591075d4c54bbd9bcaea",
      "original_line" : 1025,
      "original_position" : 202,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1595439101,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305501071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-25T10:42:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305501071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307444298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we assume SIGHASH_DEFAULT? If so, `1 + 64` I think.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T13:42:42Z",
      "diff_hunk" : "@@ -958,6 +1067,13 @@ class TRDescriptor final : public DescriptorImpl\n     }\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // FIXME: We assume keypath spend, which can lead to very large underestimations.\n+        return 1 + 65;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307444298",
      "id" : 1307444298,
      "line" : 1097,
      "node_id" : "PRRC_kwDOABII585N7gRK",
      "original_commit_id" : "fa7c46b503f0b69630f55dc43021d2099e3515ba",
      "original_line" : 1075,
      "original_position" : 206,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 228,
      "pull_request_review_id" : 1598326754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307444661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444661"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Here too, if `SIGHASH_DEFAULT`, `1 + 64`?",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T13:43:01Z",
      "diff_hunk" : "@@ -1059,6 +1182,13 @@ class RawTRDescriptor final : public DescriptorImpl\n     RawTRDescriptor(std::unique_ptr<PubkeyProvider> output_key) : DescriptorImpl(Vector(std::move(output_key)), \"rawtr\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // We can't know whether there is a script path, so assume key path spend.\n+        return 1 + 65;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307444661",
      "id" : 1307444661,
      "line" : 1221,
      "node_id" : "PRRC_kwDOABII585N7gW1",
      "original_commit_id" : "fa7c46b503f0b69630f55dc43021d2099e3515ba",
      "original_line" : 1190,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 265,
      "pull_request_review_id" : 1598326754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307444661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307461843"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307461843"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Without #24114, should we worry that this may miss cases like a P2PKH for which we don't have the full public key, in legacy wallets? We're technically able to estimate the input size for a spend of those, but (for now) can't infer a better descriptor than `addr`. ",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T13:56:29Z",
      "diff_hunk" : "@@ -34,14 +34,60 @@ using interfaces::FoundBlock;\n namespace wallet {\n static constexpr size_t OUTPUT_GROUP_MAX_ENTRIES{100};\n \n+/** Whether the descriptor represents, directly or not, a witness program. */\n+static bool IsSegwit(const Descriptor& desc) {\n+    if (const auto typ = desc.GetOutputType()) return *typ != OutputType::LEGACY;\n+    return false;\n+}\n+\n+/** Whether to assume ECDSA signatures' will be high-r. */\n+static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin_control) {\n+    // Use max sig if watch only inputs were used or if this particular input is an external input\n+    // to ensure a sufficient fee is attained for the requested feerate.\n+    return coin_control && (coin_control->fAllowWatchOnly || (txin && coin_control->IsExternalSelected(txin->prevout)));\n+}\n+\n+/** Get the size of an input (in witness units) once it's signed.\n+ *\n+ * @param desc The output script descriptor of the coin spent by this input.\n+ * @param txin Optionally the txin to estimate the size of. Used to determine the size of ECDSA signatures.\n+ * @param coin_control Information about the context to determine the size of ECDSA signatures.\n+ * @param tx_is_segwit Whether the transaction has at least a single input spending a segwit coin.\n+ * @param can_grind_r Whether the signer will be able to grind the R of the signature.\n+ */\n+static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\n+                                             const CCoinControl* coin_control, const bool tx_is_segwit,\n+                                             const bool can_grind_r) {\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(!can_grind_r || UseMaxSig(txin, coin_control))) {\n+        const bool is_segwit = IsSegwit(desc);\n+        // Account for the size of the scriptsig and the number of elements on the witness stack. Note\n+        // that if any input in the transaction is spending a witness program, we need to specify the\n+        // witness stack size for every input regardless of whether it is segwit itself.\n+        // NOTE: this also works in case of mixed scriptsig-and-witness such as in p2sh-wrapped segwit v0\n+        // outputs. In this case the size of the scriptsig length will always be one (since the redeemScript\n+        // is always a push of the witness program in this case, which is smaller than 253 bytes).\n+        const int64_t scriptsig_len = is_segwit ? 1 : GetSizeOfCompactSize(*sat_weight / WITNESS_SCALE_FACTOR);\n+        // FIXME: use the real number of stack elements instead of the \"1\" placeholder.\n+        const int64_t witstack_len = is_segwit ? GetSizeOfCompactSize(1) : (tx_is_segwit ? 1 : 0);\n+        // previous txid + previous vout + sequence + scriptsig len + witstack size + scriptsig or witness\n+        // NOTE: sat_weight already accounts for the witness discount accordingly.\n+        return (32 + 4 + 4 + scriptsig_len) * WITNESS_SCALE_FACTOR + witstack_len + *sat_weight;\n+    }\n+\n+    return {};\n+}\n+\n int CalculateMaximumSignedInputSize(const CTxOut& txout, const COutPoint outpoint, const SigningProvider* provider, bool can_grind_r, const CCoinControl* coin_control)\n {\n-    CMutableTransaction txn;\n-    txn.vin.push_back(CTxIn(outpoint));\n-    if (!provider || !DummySignInput(*provider, txn.vin[0], txout, can_grind_r, coin_control)) {\n-        return -1;\n+    if (!provider) return -1;\n+\n+    if (const auto desc = InferDescriptor(txout.scriptPubKey, *provider)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307461843",
      "id" : 1307461843,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII585N7kjT",
      "original_commit_id" : "9b7ec393b82ca9d7ada77d06e0835df0386a8b85",
      "original_line" : 84,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 56,
      "pull_request_review_id" : 1598326754,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307461843/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:00:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307461843",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307475630"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307475630"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Since this is estimating the maximum, i figured we shouldn't assume SIGHASH_DEFAULT. Do you think we should?",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T14:07:17Z",
      "diff_hunk" : "@@ -958,6 +1067,13 @@ class TRDescriptor final : public DescriptorImpl\n     }\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // FIXME: We assume keypath spend, which can lead to very large underestimations.\n+        return 1 + 65;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307475630",
      "id" : 1307475630,
      "in_reply_to_id" : 1307444298,
      "line" : 1097,
      "node_id" : "PRRC_kwDOABII585N7n6u",
      "original_commit_id" : "fa7c46b503f0b69630f55dc43021d2099e3515ba",
      "original_line" : 1075,
      "original_position" : 206,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 228,
      "pull_request_review_id" : 1598375842,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307475630/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:07:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307475630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307483129"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307483129"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, that makes sense. It'd be nice if there was a way to pass down information about whether sighash_default signing is possible, but there is lower hanging fruit (like not always assuming key path spending...).",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T14:13:15Z",
      "diff_hunk" : "@@ -958,6 +1067,13 @@ class TRDescriptor final : public DescriptorImpl\n     }\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // FIXME: We assume keypath spend, which can lead to very large underestimations.\n+        return 1 + 65;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307483129",
      "id" : 1307483129,
      "in_reply_to_id" : 1307444298,
      "line" : 1097,
      "node_id" : "PRRC_kwDOABII585N7pv5",
      "original_commit_id" : "fa7c46b503f0b69630f55dc43021d2099e3515ba",
      "original_line" : 1075,
      "original_position" : 206,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 228,
      "pull_request_review_id" : 1598387489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307483129/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307483129",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307492449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307492449"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This wouldn't miss any case that were handled previously as far as i can tell. `DummySignInput` would previously return `false` on a P2PKH for which we don't know the public key. However there may be ways to improve upon the current situation, for instance we could set `MaxInputWeight` for an `addr()`/`raw()` descriptor that represents a P2(W)PKH, since we know it? But i'd prefer to first get this switch to using descriptors done with no regression and leave improvements for a follow-up, if reviewers don't mind.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T14:20:16Z",
      "diff_hunk" : "@@ -34,14 +34,60 @@ using interfaces::FoundBlock;\n namespace wallet {\n static constexpr size_t OUTPUT_GROUP_MAX_ENTRIES{100};\n \n+/** Whether the descriptor represents, directly or not, a witness program. */\n+static bool IsSegwit(const Descriptor& desc) {\n+    if (const auto typ = desc.GetOutputType()) return *typ != OutputType::LEGACY;\n+    return false;\n+}\n+\n+/** Whether to assume ECDSA signatures' will be high-r. */\n+static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin_control) {\n+    // Use max sig if watch only inputs were used or if this particular input is an external input\n+    // to ensure a sufficient fee is attained for the requested feerate.\n+    return coin_control && (coin_control->fAllowWatchOnly || (txin && coin_control->IsExternalSelected(txin->prevout)));\n+}\n+\n+/** Get the size of an input (in witness units) once it's signed.\n+ *\n+ * @param desc The output script descriptor of the coin spent by this input.\n+ * @param txin Optionally the txin to estimate the size of. Used to determine the size of ECDSA signatures.\n+ * @param coin_control Information about the context to determine the size of ECDSA signatures.\n+ * @param tx_is_segwit Whether the transaction has at least a single input spending a segwit coin.\n+ * @param can_grind_r Whether the signer will be able to grind the R of the signature.\n+ */\n+static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\n+                                             const CCoinControl* coin_control, const bool tx_is_segwit,\n+                                             const bool can_grind_r) {\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(!can_grind_r || UseMaxSig(txin, coin_control))) {\n+        const bool is_segwit = IsSegwit(desc);\n+        // Account for the size of the scriptsig and the number of elements on the witness stack. Note\n+        // that if any input in the transaction is spending a witness program, we need to specify the\n+        // witness stack size for every input regardless of whether it is segwit itself.\n+        // NOTE: this also works in case of mixed scriptsig-and-witness such as in p2sh-wrapped segwit v0\n+        // outputs. In this case the size of the scriptsig length will always be one (since the redeemScript\n+        // is always a push of the witness program in this case, which is smaller than 253 bytes).\n+        const int64_t scriptsig_len = is_segwit ? 1 : GetSizeOfCompactSize(*sat_weight / WITNESS_SCALE_FACTOR);\n+        // FIXME: use the real number of stack elements instead of the \"1\" placeholder.\n+        const int64_t witstack_len = is_segwit ? GetSizeOfCompactSize(1) : (tx_is_segwit ? 1 : 0);\n+        // previous txid + previous vout + sequence + scriptsig len + witstack size + scriptsig or witness\n+        // NOTE: sat_weight already accounts for the witness discount accordingly.\n+        return (32 + 4 + 4 + scriptsig_len) * WITNESS_SCALE_FACTOR + witstack_len + *sat_weight;\n+    }\n+\n+    return {};\n+}\n+\n int CalculateMaximumSignedInputSize(const CTxOut& txout, const COutPoint outpoint, const SigningProvider* provider, bool can_grind_r, const CCoinControl* coin_control)\n {\n-    CMutableTransaction txn;\n-    txn.vin.push_back(CTxIn(outpoint));\n-    if (!provider || !DummySignInput(*provider, txn.vin[0], txout, can_grind_r, coin_control)) {\n-        return -1;\n+    if (!provider) return -1;\n+\n+    if (const auto desc = InferDescriptor(txout.scriptPubKey, *provider)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307492449",
      "id" : 1307492449,
      "in_reply_to_id" : 1307461843,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII585N7sBh",
      "original_commit_id" : "9b7ec393b82ca9d7ada77d06e0835df0386a8b85",
      "original_line" : 84,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 56,
      "pull_request_review_id" : 1598401761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307492449/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:20:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307492449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307493924"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307493924"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Resolving for the same reason as https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307483129.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T14:21:13Z",
      "diff_hunk" : "@@ -1059,6 +1182,13 @@ class RawTRDescriptor final : public DescriptorImpl\n     RawTRDescriptor(std::unique_ptr<PubkeyProvider> output_key) : DescriptorImpl(Vector(std::move(output_key)), \"rawtr\") {}\n     std::optional<OutputType> GetOutputType() const override { return OutputType::BECH32M; }\n     bool IsSingleType() const final { return true; }\n+\n+    std::optional<int64_t> ScriptSize() const override { return 1 + 1 + 32; }\n+\n+    std::optional<int64_t> MaxSatisfactionWeight(bool) const override {\n+        // We can't know whether there is a script path, so assume key path spend.\n+        return 1 + 65;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307493924",
      "id" : 1307493924,
      "in_reply_to_id" : 1307444661,
      "line" : 1221,
      "node_id" : "PRRC_kwDOABII585N7sYk",
      "original_commit_id" : "fa7c46b503f0b69630f55dc43021d2099e3515ba",
      "original_line" : 1190,
      "original_position" : 234,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 265,
      "pull_request_review_id" : 1598403852,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307493924/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:21:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307493924",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307497512"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307497512"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good point, I guess the observation is that right now, the satisfaction size estimation already only works for anything which can be represented as a (non addr/raw) descriptor, so doing through an inferred descriptor shouldn't cause any regression. Making it work for more things can only improve the situation.",
      "commit_id" : "10546a569c6c96a5ec1b9708abf9ff5c8644f669",
      "created_at" : "2023-08-28T14:24:00Z",
      "diff_hunk" : "@@ -34,14 +34,60 @@ using interfaces::FoundBlock;\n namespace wallet {\n static constexpr size_t OUTPUT_GROUP_MAX_ENTRIES{100};\n \n+/** Whether the descriptor represents, directly or not, a witness program. */\n+static bool IsSegwit(const Descriptor& desc) {\n+    if (const auto typ = desc.GetOutputType()) return *typ != OutputType::LEGACY;\n+    return false;\n+}\n+\n+/** Whether to assume ECDSA signatures' will be high-r. */\n+static bool UseMaxSig(const std::optional<CTxIn>& txin, const CCoinControl* coin_control) {\n+    // Use max sig if watch only inputs were used or if this particular input is an external input\n+    // to ensure a sufficient fee is attained for the requested feerate.\n+    return coin_control && (coin_control->fAllowWatchOnly || (txin && coin_control->IsExternalSelected(txin->prevout)));\n+}\n+\n+/** Get the size of an input (in witness units) once it's signed.\n+ *\n+ * @param desc The output script descriptor of the coin spent by this input.\n+ * @param txin Optionally the txin to estimate the size of. Used to determine the size of ECDSA signatures.\n+ * @param coin_control Information about the context to determine the size of ECDSA signatures.\n+ * @param tx_is_segwit Whether the transaction has at least a single input spending a segwit coin.\n+ * @param can_grind_r Whether the signer will be able to grind the R of the signature.\n+ */\n+static std::optional<int64_t> MaxInputWeight(const Descriptor& desc, const std::optional<CTxIn>& txin,\n+                                             const CCoinControl* coin_control, const bool tx_is_segwit,\n+                                             const bool can_grind_r) {\n+    if (const auto sat_weight = desc.MaxSatisfactionWeight(!can_grind_r || UseMaxSig(txin, coin_control))) {\n+        const bool is_segwit = IsSegwit(desc);\n+        // Account for the size of the scriptsig and the number of elements on the witness stack. Note\n+        // that if any input in the transaction is spending a witness program, we need to specify the\n+        // witness stack size for every input regardless of whether it is segwit itself.\n+        // NOTE: this also works in case of mixed scriptsig-and-witness such as in p2sh-wrapped segwit v0\n+        // outputs. In this case the size of the scriptsig length will always be one (since the redeemScript\n+        // is always a push of the witness program in this case, which is smaller than 253 bytes).\n+        const int64_t scriptsig_len = is_segwit ? 1 : GetSizeOfCompactSize(*sat_weight / WITNESS_SCALE_FACTOR);\n+        // FIXME: use the real number of stack elements instead of the \"1\" placeholder.\n+        const int64_t witstack_len = is_segwit ? GetSizeOfCompactSize(1) : (tx_is_segwit ? 1 : 0);\n+        // previous txid + previous vout + sequence + scriptsig len + witstack size + scriptsig or witness\n+        // NOTE: sat_weight already accounts for the witness discount accordingly.\n+        return (32 + 4 + 4 + scriptsig_len) * WITNESS_SCALE_FACTOR + witstack_len + *sat_weight;\n+    }\n+\n+    return {};\n+}\n+\n int CalculateMaximumSignedInputSize(const CTxOut& txout, const COutPoint outpoint, const SigningProvider* provider, bool can_grind_r, const CCoinControl* coin_control)\n {\n-    CMutableTransaction txn;\n-    txn.vin.push_back(CTxIn(outpoint));\n-    if (!provider || !DummySignInput(*provider, txn.vin[0], txout, can_grind_r, coin_control)) {\n-        return -1;\n+    if (!provider) return -1;\n+\n+    if (const auto desc = InferDescriptor(txout.scriptPubKey, *provider)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26567#discussion_r1307497512",
      "id" : 1307497512,
      "in_reply_to_id" : 1307461843,
      "line" : 85,
      "node_id" : "PRRC_kwDOABII585N7tQo",
      "original_commit_id" : "9b7ec393b82ca9d7ada77d06e0835df0386a8b85",
      "original_line" : 84,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/wallet/spend.cpp",
      "position" : 56,
      "pull_request_review_id" : 1598410154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26567",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307497512/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-28T14:24:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307497512",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
