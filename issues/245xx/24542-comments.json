[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think I've seen the same thing; but mostly for me it just looks like \"bitcoind has a bunch of memory in swap and it takes a while to deallocate when shutting down\" so I haven't been able to get any insight into what's actually going on. I think the same memory leak may show up in liquid/elements, but with higher severity (due to the higher block rate)\r\n\r\nEDIT: maybe worth noting that the \"takes a while to deallocate\" occurs after `Shutdown()` has finished",
      "created_at" : "2022-03-15T09:06:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1067730799",
      "id" : 1067730799,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII584_pEdv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067730799/reactions"
      },
      "updated_at" : "2022-03-15T13:28:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067730799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe `valgrind --tool=massif bitcoind` could help here?",
      "created_at" : "2022-03-15T09:20:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1067744040",
      "id" : 1067744040,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII584_pHso",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067744040/reactions"
      },
      "updated_at" : "2022-03-15T09:20:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1067744040",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I went to check on my node today expecting higher RAM usage than before, but it was actually down to 1.9 GB. Puzzled, I checked and it looks like the node actually shutdown 2 days ago (and systemd restarted it automatically). Looking at the logs, there are tons of these `BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications`. Here's what my logs look like.\r\n\r\n```\r\n2022-03-13T04:48:01Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T04:48:01Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T04:53:05Z UpdateTip: new best=00000000000000000009e50a3c45c26a64cfe507b5abee9432460ed3d85c6855 height=727101 version=0x20200000 log2_work=93.398160 tx=717198865 date='2022-03-13T04:51:03Z' progress=1.000000 cache=32.2MiB(147906txo)\r\n2022-03-13T04:53:05Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T04:53:05Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T04:54:48Z UpdateTip: new best=000000000000000000058b74712cac983dd446c6b2c5e078db9975c6638e86fd height=727102 version=0x20000000 log2_work=93.398173 tx=717199047 date='2022-03-13T04:52:40Z' progress=1.000000 cache=32.3MiB(148339txo)\r\n2022-03-13T04:54:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T04:54:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z UpdateTip: new best=0000000000000000000516fd3c3ecfb22e47ba8ed8c29163602230aee526d147 height=727103 version=0x20200000 log2_work=93.398186 tx=717199511 date='2022-03-13T04:57:22Z' progress=0.999999 cache=32.5MiB(150501txo)\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:03:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:10:59Z UpdateTip: new best=00000000000000000009554288443c39f85f3e531e9e60c48db2d01a22585b81 height=727104 version=0x2000e004 log2_work=93.398199 tx=717200040 date='2022-03-13T05:02:51Z' progress=0.999998 cache=32.8MiB(152399txo)\r\n2022-03-13T05:10:59Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:10:59Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:14Z UpdateTip: new best=0000000000000000000358f170fd5d78721254c9f3cad519155d36eaef8c1c63 height=727105 version=0x20004000 log2_work=93.398212 tx=717200804 date='2022-03-13T05:10:56Z' progress=0.999998 cache=33.4MiB(157443txo)\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:15Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:19:41Z UpdateTip: new best=00000000000000000002bc5d2f34d9bb7c92d2e2c6f2a578ed704f7498cf4d53 height=727106 version=0x3fffe000 log2_work=93.398226 tx=717200853 date='2022-03-13T05:12:02Z' progress=0.999998 cache=33.4MiB(157649txo)\r\n2022-03-13T05:19:42Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:22:21Z UpdateTip: new best=0000000000000000000066ff7813973ee5068a0ff061f42901360871086a5025 height=727107 version=0x3fffe000 log2_work=93.398239 tx=717201297 date='2022-03-13T05:16:01Z' progress=0.999999 cache=33.6MiB(158708txo)\r\n2022-03-13T05:22:22Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:22:22Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:47Z UpdateTip: new best=000000000000000000025ce8ab1c48e53f8cb2d5000807cf45ec18e543773f84 height=727108 version=0x2cbd0000 log2_work=93.398252 tx=717202203 date='2022-03-13T05:24:43Z' progress=0.999999 cache=33.9MiB(161187txo)\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:31:49Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z UpdateTip: new best=00000000000000000003be53d87aaf7489dc53d3c36fc36ea7b42d541a19c45f height=727109 version=0x22c18000 log2_work=93.398265 tx=717202876 date='2022-03-13T05:31:32Z' progress=0.999999 cache=34.1MiB(163020txo)\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:23Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:37:41Z UpdateTip: new best=00000000000000000005464d4bd8530348a5b08eb2362f0f621213ca04873852 height=727110 version=0x27ffe004 log2_work=93.398278 tx=717202909 date='2022-03-13T05:31:53Z' progress=0.999999 cache=34.1MiB(163122txo)\r\n2022-03-13T05:37:42Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:41:20Z UpdateTip: new best=000000000000000000045ec5d2b3999a4336dd48724fed813ae8682868bf94b6 height=727111 version=0x20c00000 log2_work=93.398291 tx=717203383 date='2022-03-13T05:36:18Z' progress=0.999999 cache=34.3MiB(164597txo)\r\n2022-03-13T05:41:21Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:41:21Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:41:21Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:41:25Z New outbound peer connected: version: 70015, blocks=727111, peer=656929 (outbound-full-relay)\r\n2022-03-13T05:41:48Z New outbound peer connected: version: 70016, blocks=727111, peer=657055 (outbound-full-relay)\r\n2022-03-13T05:42:44Z New outbound peer connected: version: 70016, blocks=727111, peer=657066 (outbound-full-relay)\r\n2022-03-13T05:58:47Z UpdateTip: new best=00000000000000000008ec489c496cca28028dfe29fec7c1cbf3c43dc7156312 height=727112 version=0x20c00004 log2_work=93.398304 tx=717204079 date='2022-03-13T05:42:48Z' progress=0.999997 cache=34.6MiB(167004txo)\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:47Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:58:48Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T05:59:30Z New outbound peer connected: version: 70016, blocks=727112, peer=657227 (outbound-full-relay)\r\n2022-03-13T06:00:03Z New outbound peer connected: version: 70016, blocks=727112, peer=657238 (outbound-full-relay)\r\n2022-03-13T06:00:05Z New outbound peer connected: version: 70016, blocks=727112, peer=657239 (outbound-full-relay)\r\n2022-03-13T06:00:13Z New outbound peer connected: version: 70015, blocks=727112, peer=657240 (outbound-full-relay)\r\n2022-03-13T06:08:20Z New outbound peer connected: version: 70016, blocks=727112, peer=657341 (outbound-full-relay)\r\n2022-03-13T06:41:11Z UpdateTip: new best=00000000000000000005fda11e6f284235a2c2cfcf74303e9610a40b5e489664 height=727113 version=0x345ca000 log2_work=93.398317 tx=717206214 da\r\nte='2022-03-13T06:16:35Z' progress=0.999995 cache=36.0MiB(178695txo)\r\n2022-03-13T06:41:25Z Potential stale tip detected, will try using extra outbound peer (last tip update: 2549 seconds ago)\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:25Z BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications\r\n2022-03-13T06:41:26Z New outbound peer connected: version: 70015, blocks=727116, peer=657444 (outbound-full-relay)\r\n2022-03-13T06:41:47Z New outbound peer connected: version: 70016, blocks=727116, peer=657578 (outbound-full-relay)\r\n2022-03-13T06:41:47Z New outbound peer connected: version: 70016, blocks=727116, peer=657579 (outbound-full-relay)\r\n2022-03-13T06:42:04Z New outbound peer connected: version: 70015, blocks=727116, peer=657584 (outbound-full-relay)\r\n2022-03-13T06:42:25Z New outbound peer connected: version: 70015, blocks=727117, peer=657591 (outbound-full-relay)\r\n2022-03-13T06:42:41Z New outbound peer connected: version: 70016, blocks=727117, peer=657596 (outbound-full-relay)\r\n2022-03-13T06:43:00Z New outbound peer connected: version: 70015, blocks=727117, peer=657598 (outbound-full-relay)\r\n2022-03-13T06:43:04Z New outbound peer connected: version: 70016, blocks=727117, peer=657599 (outbound-full-relay)\r\n2022-03-13T06:43:40Z New outbound peer connected: version: 70016, blocks=727117, peer=657607 (outbound-full-relay)\r\n2022-03-13T06:44:36Z New outbound peer connected: version: 70016, blocks=727117, peer=657614 (outbound-full-relay)\r\n2022-03-13T06:44:37Z New outbound peer connected: version: 70016, blocks=727117, peer=657615 (outbound-full-relay)\r\n2022-03-13T06:44:38Z New outbound peer connected: version: 70015, blocks=727117, peer=657616 (outbound-full-relay)\r\n2022-03-13T06:45:07Z New outbound peer connected: version: 70016, blocks=727117, peer=657618 (block-relay-only)\r\n2022-03-13T06:45:43Z New outbound peer connected: version: 70015, blocks=727117, peer=657630 (outbound-full-relay)\r\n```\r\n\r\nThat's the last log message before it switches to startup logs. Looks like peers started dropping my node, I'm guessing because it was unresponsive, and so it was making a lot of outbound connections, and looks like block syncing crawled to a stop.\r\n\r\nI'll try to keep tabs on things and keep this issue updated if I see anything else interesting.\r\n",
      "created_at" : "2022-03-15T21:31:38Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1068492667",
      "id" : 1068492667,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII584_r-d7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068492667/reactions"
      },
      "updated_at" : "2022-03-15T21:31:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068492667",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Looking at the logs, there are tons of these `BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications`.\r\n\r\nThese are likely caused by multiple parallel `getrawtransaction` RPC calls (probably from the lnd node) - if the txindex is enabled but hasn't managed to process the newest block yet (as a result of a general slowness / unresponsiveness due to memory shortage), it will log this message.\r\nSo I think that these are probably not the cause of the memory problem, but appear as a result of it.",
      "created_at" : "2022-03-15T23:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1068552785",
      "id" : 1068552785,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII584_sNJR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068552785/reactions"
      },
      "updated_at" : "2022-03-15T23:14:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068552785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> These are likely caused by multiple parallel `getrawtransaction` RPC calls (probably from the lnd node) - if the txindex is enabled but hasn't managed to process the newest block yet (as a result of a general slowness / unresponsiveness due to memory shortage), it will log this message. So I think that these are probably not the cause of the memory problem, but appear as a result of it.\r\n\r\nThanks, iirc when I tried making rpc calls via `bitcoin-cli` one of the last times this happened the command would hang while I saw that `BlockUntilSyncedToCurrentChain`, so that makes sense.",
      "created_at" : "2022-03-15T23:27:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1068560597",
      "id" : 1068560597,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII584_sPDV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068560597/reactions"
      },
      "updated_at" : "2022-03-15T23:27:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1068560597",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi facing similar issue. I'm running an rpc node. My memory usage grows beyond 36GB. I only see this problem when setting `rpcthreads` parameter. Without `rpcthreads` the usage doesn't grow beyond 4 GB.\r\n\r\nDid you figure out why the leak?",
      "created_at" : "2023-05-04T06:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1534133728",
      "id" : 1534133728,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bcQXg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1534133728/reactions"
      },
      "updated_at" : "2023-05-04T06:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1534133728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11365900?v=4",
         "events_url" : "https://api.github.com/users/cshintov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cshintov/followers",
         "following_url" : "https://api.github.com/users/cshintov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cshintov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cshintov",
         "id" : 11365900,
         "login" : "cshintov",
         "node_id" : "MDQ6VXNlcjExMzY1OTAw",
         "organizations_url" : "https://api.github.com/users/cshintov/orgs",
         "received_events_url" : "https://api.github.com/users/cshintov/received_events",
         "repos_url" : "https://api.github.com/users/cshintov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cshintov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cshintov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cshintov"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Hi facing similar issue. I'm running an rpc node.\r\n\r\nAlso 22.0? Which value of `rpcthreads` are you using?",
      "created_at" : "2023-05-04T16:51:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535074436",
      "id" : 1535074436,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bf2CE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535074436/reactions"
      },
      "updated_at" : "2023-05-04T16:51:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535074436",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "FYI, I am now using v24.0.1 with `rpcthreads=64` as mentioned above, and I still see this issue although it still appears to be slow and unpredictable. I just checked and bitcoind is currently using close to 4 GB RAM, which is a lot higher than it would be if I'd restarted the node within the past few hours or even days.\r\n\r\nI increased the `rpcthreads` setting to make sure bitcoind plays nice with lnd, but I don't expect that I actually need it that high. I can switch to the default `rpcthreads` value and see if this issue goes away, I'll report back later.",
      "created_at" : "2023-05-04T17:12:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535121219",
      "id" : 1535121219,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bgBdD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535121219/reactions"
      },
      "updated_at" : "2023-05-04T17:12:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535121219",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks @sangaman. Additionally, do you have any estimates on how many rpcs you are making per time to the node?",
      "created_at" : "2023-05-04T17:16:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535130495",
      "id" : 1535130495,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bgDt_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535130495/reactions"
      },
      "updated_at" : "2023-05-04T17:16:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535130495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm I'm not exactly sure. This bitcoind node is primarily used to serve an lnd node as well as an electrum server and mempool.space block explorer, although the latter two get very light usage aside from staying in sync with the chain. If you think it'd be helpful I can try to turn on debug logs and see how many rpc calls are made over a certain period of time.",
      "created_at" : "2023-05-04T17:20:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535138024",
      "id" : 1535138024,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bgFjo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535138024/reactions"
      },
      "updated_at" : "2023-05-04T17:20:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535138024",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "  I'm running `24.0.1` and I tried with various `rpcthreads` values `50, 100, 150`. \r\n  \r\n  I could solve the issue by setting the below env var.\r\n  \r\n  By default, since glibc 2.10, the C library will create up to two heap\r\n  arenas per core. This is known to cause excessive memory usage in some\r\n  scenarios. To avoid this we have to set\r\n\r\n   ```MALLOC_ARENA_MAX=1```\r\n\r\n  without this the usage grows beyond 36GB, with this it stays under 2GB\r\n  normally.\r\n\r\n  ref: https://github.com/bitcoin/bitcoin/blob/master/doc/reduce-\r\n  memory.md#linux-specific",
      "created_at" : "2023-05-04T18:00:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535190060",
      "id" : 1535190060,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bgSQs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535190060/reactions"
      },
      "updated_at" : "2023-05-04T18:00:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535190060",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11365900?v=4",
         "events_url" : "https://api.github.com/users/cshintov/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cshintov/followers",
         "following_url" : "https://api.github.com/users/cshintov/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cshintov/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cshintov",
         "id" : 11365900,
         "login" : "cshintov",
         "node_id" : "MDQ6VXNlcjExMzY1OTAw",
         "organizations_url" : "https://api.github.com/users/cshintov/orgs",
         "received_events_url" : "https://api.github.com/users/cshintov/received_events",
         "repos_url" : "https://api.github.com/users/cshintov/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cshintov/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cshintov/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cshintov"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you @cshintov ! I'll try this env var out and see if it solves my issue without having to change my config.",
      "created_at" : "2023-05-04T19:18:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1535282807",
      "id" : 1535282807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585bgo53",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535282807/reactions"
      },
      "updated_at" : "2023-05-04T19:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1535282807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "So far my results with `MALLOC_ARENA_MAX=1` seem to be good, I've been comfortably under 2GB RAM every time I've checked. I added it as an env var in my systemd configuration which I copied and modified from the one in this repo, I figure it ought to have that env var as well. I'll open a PR to add it.",
      "created_at" : "2023-05-12T14:06:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1545805593",
      "id" : 1545805593,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585cIx8Z",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545805593/reactions"
      },
      "updated_at" : "2023-05-12T14:06:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545805593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I think setting this to 1 will give significantly worse performance for most users though? \n\nSeems like it would be better to add it to the documentation if anything...",
      "created_at" : "2023-05-12T14:24:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1545830080",
      "id" : 1545830080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585cI37A",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545830080/reactions"
      },
      "updated_at" : "2023-05-12T14:24:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545830080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Seems like it would be better to add it to the documentation if anything...\r\n\r\nIt is in the documentation already at https://github.com/bitcoin/bitcoin/blob/master/doc/reduce-memory.md.\r\n\r\n> I think setting this to 1 will give significantly worse performance for most users though?\r\n\r\nPer the documentation above that wouldn't be the case although I can't say for sure. I certainly didn't notice any decreased performance when setting this env var.\r\n\r\n> The behavior was introduced to increase CPU locality of allocated memory and performance with concurrent allocation, so this setting could in theory reduce performance. However, in Bitcoin Core very little parallel allocation happens, so the impact is expected to be small or absent.",
      "created_at" : "2023-05-12T15:18:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1545911064",
      "id" : 1545911064,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII585cJLsY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545911064/reactions"
      },
      "updated_at" : "2023-05-12T15:20:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545911064",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
         "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sangaman/followers",
         "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sangaman",
         "id" : 3440835,
         "login" : "sangaman",
         "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
         "organizations_url" : "https://api.github.com/users/sangaman/orgs",
         "received_events_url" : "https://api.github.com/users/sangaman/received_events",
         "repos_url" : "https://api.github.com/users/sangaman/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sangaman"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Is this still a problem with v26.0 (or later)?",
      "created_at" : "2024-04-10T15:13:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2047825796",
      "id" : 2047825796,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5856D1eE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2047825796/reactions"
      },
      "updated_at" : "2024-04-10T15:13:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2047825796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Not sure what can be done here. It would be good to use a tool to debug this, e.g. https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-1067744040, if it still happens.",
      "created_at" : "2024-05-08T10:14:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2100240679",
      "id" : 2100240679,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859LyEn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2100240679/reactions"
      },
      "updated_at" : "2024-05-08T10:14:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2100240679",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "OK, I think I have pretty much identified the root cause here.\r\n\r\nCalling [`blockToJSON`](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rest.cpp#L340) on a maximum-sized block allocates 70-80MB on the heap during runtime.\r\n\r\nThere is then an additional 15-20MB allocated for `strJSON`.\r\n\r\nAfter these allocations are made they then seem to be re-used when possible in the future, so long as subsequent blocks are small enough to fit. This totals up to the ~100MB RSS increase observed sometimes when getting blocks via REST.\r\n\r\nIn the event that blocks are fetched in series in increasing sizes, repeated allocations (of increasing sizes) may be made, causing even higher apparent resource usage.\r\n\r\nThe cause seems to be two-fold:\r\n\r\n1. `UniValue`'s are not a particularly compact representation (can't do _that_ much about this, except perhaps we could write to string directly for this method.)\r\n2. The `UniValue` [created inside `blockToJSON`](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L170) is ~40MB worst-case, but it is then _copied_ into a [second `UniValue`](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L196), doubling the required heap size.\r\n\r\nIt appears that this has been investgated [previously](https://github.com/bitcoin/bitcoin/pull/20999) (see also [here](https://github.com/jgarzik/univalue/pull/79)) in search of better speed, but having a move semantic for UniValue would also shave off half of this function's allocation requirement.\r\n\nThanks @stickies-v for helping me investigate",
      "created_at" : "2024-05-10T15:09:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2104779556",
      "id" : 2104779556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859dGMk",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2104779556/reactions"
      },
      "updated_at" : "2024-05-10T15:12:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2104779556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> but it is then copied into a [second UniValue](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L196), doubling the required heap size.\r\n\r\nAnd if I understand correctly, it is then copied _again_ [here](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/univalue/lib/univalue.cpp#L134) since `UniValue` doesn't have a move constructor. So improving UniValue move semantics seems to make sense here indeed.",
      "created_at" : "2024-05-10T16:04:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2104860540",
      "id" : 2104860540,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859dZ98",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2104860540/reactions"
      },
      "updated_at" : "2024-05-10T16:04:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2104860540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Discovered another attempt to avoid copies from @maflcko https://github.com/bitcoin/bitcoin/pull/25429 while researching further.\r\n\r\nRef my previous test in #30052, I have a branch with some improvements (heavily \"insipred\" by @martinus 's commit https://github.com/jgarzik/univalue/pull/79/commits/e9109e2a04b47472fe45a9cae3c6b41c245a6db9) which limit allocations to about 60-70MB: \r\n\r\n![image](https://github.com/bitcoin/bitcoin/assets/6606587/a64de24a-bd03-4195-abe0-bf2c677e1641)\r\n\r\nThis is about what I'd expect to be the minimum size based on the allocation for the JSON string, and the UniValue Object.",
      "created_at" : "2024-05-10T19:50:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2105183958",
      "id" : 2105183958,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859eo7W",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2105183958/reactions"
      },
      "updated_at" : "2024-05-10T19:50:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2105183958",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> And if I understand correctly, it is then copied _again_ [here](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/univalue/lib/univalue.cpp#L134) since `UniValue` doesn't have a move constructor. So improving UniValue move semantics seems to make sense here indeed.\r\n\r\nCan you explain this? It has a move constructor, at least the following compiles for me:\r\n\r\n```diff\r\ndiff --git a/src/univalue/lib/univalue.cpp b/src/univalue/lib/univalue.cpp\r\nindex 656d2e8203..b3a33f36ac 100644\r\n--- a/src/univalue/lib/univalue.cpp\r\n+++ b/src/univalue/lib/univalue.cpp\r\n@@ -125,6 +125,7 @@ void UniValue::pushKVEnd(std::string key, UniValue val)\r\n \r\n void UniValue::pushKV(std::string key, UniValue val)\r\n {\r\n+static_assert(std::is_move_constructible_v<UniValue>);\r\n     checkType(VOBJ);\r\n \r\n     size_t idx;\r\n```\r\n\r\n\r\n\r\n> The `UniValue` [created inside `blockToJSON`](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L170) is ~40MB worst-case, but it is then _copied_ into a [second `UniValue`](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L196), doubling the required heap size.\r\n\r\nI presume this can be fixed by adding a `std::move`, but I haven't tested it.",
      "created_at" : "2024-05-13T11:44:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2107357612",
      "id" : 2107357612,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859m7ms",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107357612/reactions"
      },
      "updated_at" : "2024-05-13T11:44:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107357612",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : ">The UniValue [created inside blockToJSON](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L170) is ~40MB worst-case, but it is then copied into a [second UniValue](https://github.com/bitcoin/bitcoin/blob/98dd4e712efaa2b77cb168426756879c6405c3f4/src/rpc/blockchain.cpp#L196), doubling the required heap size.\r\n\r\nI  had a PR somewhere where I removed the copy constructor and made it mandatory to call a `.copy()`. Then you'd get a compile error wherever a copy happens, and then can either use `std::move` or really use `.copy()` if a copy is needed. \r\n\r\nThat's nice because the compiler finds all problems automatically, but requires to touch quite a lot of places.",
      "created_at" : "2024-05-13T12:34:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2107457736",
      "id" : 2107457736,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859nUDI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107457736/reactions"
      },
      "updated_at" : "2024-05-13T12:34:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107457736",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/14386?v=4",
         "events_url" : "https://api.github.com/users/martinus/events{/privacy}",
         "followers_url" : "https://api.github.com/users/martinus/followers",
         "following_url" : "https://api.github.com/users/martinus/following{/other_user}",
         "gists_url" : "https://api.github.com/users/martinus/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/martinus",
         "id" : 14386,
         "login" : "martinus",
         "node_id" : "MDQ6VXNlcjE0Mzg2",
         "organizations_url" : "https://api.github.com/users/martinus/orgs",
         "received_events_url" : "https://api.github.com/users/martinus/received_events",
         "repos_url" : "https://api.github.com/users/martinus/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/martinus/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/martinus/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/martinus"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you explain this? It has a move constructor, ...\r\n\r\nI think you are correct here, the compiler implicitly generates move-contructors which are enough to fix this issue, if combined with appropriate `std::move`. I did not think that was the case, but I was using a non-reproducible test. I made my test reproducible and tested:\r\n\r\n1. v27.0\r\n2. addition of `std::move` only\r\n3. addition of `std::move` + excplicit move constructor(s)\r\n4. addition of `std::move` + excplicit move constructor(s) + LD_PRELOAD=mimalloc (just for my own interest)\r\n\r\n![rest-comparison](https://github.com/bitcoin/bitcoin/assets/6606587/84bbe0d9-01fa-4dbb-b990-b7dd23f2a5f8)\r\n\r\nThe test script requests every block from (0 - 844,000) % 5,000, and measures the RSS after each call.",
      "created_at" : "2024-05-13T13:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2107609517",
      "id" : 2107609517,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859n5Gt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107609517/reactions"
      },
      "updated_at" : "2024-05-13T13:39:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107609517",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> either use `std::move` or really use `.copy()` if a copy is needed.\r\n\r\nStyle-wise I found it a bit unfortunate, because it forces code to either specify `move` or `copy` explicitly. (There is some beauty to rust, in that it implicitly moves)",
      "created_at" : "2024-05-13T13:46:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2107624153",
      "id" : 2107624153,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859n8rZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107624153/reactions"
      },
      "updated_at" : "2024-05-13T13:46:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107624153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I had a PR somewhere where I removed the copy constructor and made it mandatory to call a `.copy()`. Then you'd get a compile error wherever a copy happens, and then can either use `std::move` or really use `.copy()` if a copy is needed.\r\n\r\nDon't do that. You'll break guaranteed copy elision, which requires the compiler to skip the construction of a temporary object in certain expressions and statements but can only happen if an accessible copy constructor exists (even though it is not called). By deleting the copy constructor, you are denying all opportunities for copy elision and are forcing the compiler always to construct temporaries and to move from them subsequently.",
      "created_at" : "2024-05-13T17:12:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542#issuecomment-2108281855",
      "id" : 2108281855,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
      "node_id" : "IC_kwDOABII5859qdP_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2108281855/reactions"
      },
      "updated_at" : "2024-05-13T17:12:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2108281855",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/797782?v=4",
         "events_url" : "https://api.github.com/users/whitslack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/whitslack/followers",
         "following_url" : "https://api.github.com/users/whitslack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/whitslack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/whitslack",
         "id" : 797782,
         "login" : "whitslack",
         "node_id" : "MDQ6VXNlcjc5Nzc4Mg==",
         "organizations_url" : "https://api.github.com/users/whitslack/orgs",
         "received_events_url" : "https://api.github.com/users/whitslack/received_events",
         "repos_url" : "https://api.github.com/users/whitslack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/whitslack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/whitslack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/whitslack"
      }
   }
]
