{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "I've been noticing gradually increasing memory usage bitcoin core v22.0.  I've been running this node for a couple of years with the same hardware and general setup and have only noticed this in the past few months, around the time I upgraded to v22, which makes me suspect it may be related.\r\n\r\nI'm seeing bitcoind memory usage slowly climb over weeks/months of uptime. Right now it's at 3.4 GB memory usage and as I recall I've seen it over 5 GB before in an incident where it caused the machine to run out of RAM, which is when I first noticed this. If I restart bitcoind, RAM usage goes back to a normal level and stays there for a while.\r\n\r\nI do recall seeing a lot of `BlockUntilSyncedToCurrentChain: txindex is catching up on block notifications` messages in the logs when RAM usage was over 5GB and my node was barely responsive to RPC calls, but I'm not sure if this has anything to do with the issue.\r\n\r\nI'm using `dbcache=1024` which would explain some of the RAM usage but not all of it.\r\n\r\nOther config settings that may be relevant:\r\n\r\n```\r\ntxindex=1\r\npeerblockfilters=1\r\nblockfilterindex=1\r\n\r\nmaxconnections=100\r\n\r\nrpcthreads=64\r\nrpcworkqueue=256\r\nrpcservertimeout=120\r\n\r\nzmqpubrawblockhwm=100000\r\nzmqpubrawtxhwm=100000\r\n```\r\n\r\nOtherwise, I'm using this node to run an lnd node (with zmq block/tx notifications) and electrumx server. There's a medium-sized watch-only wallet that's loaded. There's also a small script I run with `blocknotify`.\r\n\r\nThis is all running on an RPI4 with 8GB RAM, using raspbian buster w/ the OS and block indexes on an SSD.\r\n\r\nI'd be interested if others have seen anything similar out of their nodes or if perhaps this RAM usage is normal given how I'm using it, but I am pretty sure this wasn't happening a year ago with similar usage patterns.",
   "closed_at" : "2024-05-13T20:16:01Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
      "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
      "followers_url" : "https://api.github.com/users/ryanofsky/followers",
      "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/ryanofsky",
      "id" : 7133040,
      "login" : "ryanofsky",
      "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
      "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
      "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
      "repos_url" : "https://api.github.com/users/ryanofsky/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/ryanofsky"
   },
   "comments" : 25,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542/comments",
   "created_at" : "2022-03-12T16:25:45Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/24542",
   "id" : 1167332581,
   "labels" : [
      {
         "color" : "981023",
         "default" : false,
         "description" : null,
         "id" : 326918230,
         "name" : "Resource usage",
         "node_id" : "MDU6TGFiZWwzMjY5MTgyMzA=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Resource%20usage"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII585FlBTl",
   "number" : 24542,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 1,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 1,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : "completed",
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542/timeline",
   "title" : "Slow memory leak in v22.0?",
   "updated_at" : "2024-05-13T20:16:01Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/24542",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3440835?v=4",
      "events_url" : "https://api.github.com/users/sangaman/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sangaman/followers",
      "following_url" : "https://api.github.com/users/sangaman/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sangaman/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sangaman",
      "id" : 3440835,
      "login" : "sangaman",
      "node_id" : "MDQ6VXNlcjM0NDA4MzU=",
      "organizations_url" : "https://api.github.com/users/sangaman/orgs",
      "received_events_url" : "https://api.github.com/users/sangaman/received_events",
      "repos_url" : "https://api.github.com/users/sangaman/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sangaman/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sangaman/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sangaman"
   }
}
