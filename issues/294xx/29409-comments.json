[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29409).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-02-08T13:54:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#issuecomment-1934172101",
      "id" : 1934172101,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29409",
      "node_id" : "IC_kwDOABII585zSR_F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934172101/reactions"
      },
      "updated_at" : "2024-02-08T13:54:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1934172101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503377237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237"
         }
      },
      "author_association" : "NONE",
      "body" : "Nit: compiles with `value.has_value()` here, which is clearer than `operator bool()`. But maybe you were intending to support types which don't have `.has_value()`?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-26T22:12:50Z",
      "diff_hunk" : "@@ -103,6 +197,65 @@ decltype(auto) CustomReadField(TypeList<UniValue>, Priority<1>, InvokeContext& i\n         value.read(std::string_view{data.begin(), data.size()});\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize\n+//! UniValue::type_error exceptions as text strings.\n+template <typename Value, typename Output>\n+void CustomBuildField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                      Value&& value, Output&& output)\n+{\n+    BuildField(TypeList<std::string>(), invoke_context, output, std::string(value.what()));\n+}\n+\n+template <typename Input, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<UniValue::type_error>, Priority<1>, InvokeContext& invoke_context,\n+                               Input&& input, ReadDest&& read_dest)\n+{\n+    read_dest.construct(ReadField(TypeList<std::string>(), invoke_context, input, mp::ReadDestTemp<std::string>()));\n+}\n+\n+//! Overload CustomBuildField and CustomReadField to serialize util::Result\n+//! return values as common.capnp Result and ResultVoid structs\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<util::Result<LocalType>>, Priority<1>, InvokeContext& invoke_context, Value&& value,\n+                      Output&& output)\n+{\n+    auto result = output.init();\n+    if (value) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503377237",
      "id" : 1503377237,
      "line" : 224,
      "node_id" : "PRRC_kwDOABII585Zm7dV",
      "original_commit_id" : "eeb441ae7c12b5dafadd1c7315e5435731b3da6c",
      "original_line" : 224,
      "original_position" : 174,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 174,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503377237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503832875"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875"
         }
      },
      "author_association" : "NONE",
      "body" : "Builds fine without `#include <any>` using `g++` on Linux?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-27T08:33:47Z",
      "diff_hunk" : "@@ -0,0 +1,82 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+#define BITCOIN_IPC_CAPNP_CHAIN_TYPES_H\n+\n+#include <ipc/capnp/chain.capnp.proxy.h>\n+#include <ipc/capnp/common.capnp.proxy-types.h>\n+#include <ipc/capnp/handler.capnp.proxy-types.h>\n+#include <interfaces/chain.h>\n+#include <policy/fees.h>\n+#include <rpc/server.h>\n+\n+#include <any>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1503832875",
      "id" : 1503832875,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII585Zoqsr",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 15,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/ipc/capnp/chain-types.h",
      "position" : 15,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1503832875",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1505998416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416"
         }
      },
      "author_association" : "NONE",
      "body" : "Should this say ...\"vector\\<unsigned char\\> *and* GCSFilter::ElementSet set elements.\"?",
      "commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "created_at" : "2024-02-28T13:51:28Z",
      "diff_hunk" : "@@ -256,6 +256,146 @@ decltype(auto) CustomReadField(TypeList<util::Result<LocalType>>, Priority<1>, I\n         }\n     });\n }\n+\n+//! Overload CustomBuildField and CustomReadField to serialize other types of\n+//! objects that have CustomBuildMessage and CustomReadMessage overloads.\n+//! Defining BuildMessage and ReadMessage overloads is simpler than defining\n+//! BuildField and ReadField overloads because these overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+template <typename LocalType, typename Value, typename Output>\n+void CustomBuildField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Value&& value, Output&& output,\n+                      decltype(CustomBuildMessage(invoke_context, value, std::move(output.get())))* enable = nullptr)\n+{\n+    CustomBuildMessage(invoke_context, value, std::move(output.init()));\n+}\n+\n+template <typename LocalType, typename Reader, typename ReadDest>\n+decltype(auto) CustomReadField(TypeList<LocalType>, Priority<2>, InvokeContext& invoke_context, Reader&& reader,\n+                               ReadDest&& read_dest,\n+                               decltype(CustomReadMessage(invoke_context, reader.get(),\n+                                                          std::declval<LocalType&>()))* enable = nullptr)\n+{\n+    return read_dest.update([&](auto& value) { CustomReadMessage(invoke_context, reader.get(), value); });\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::get method if it has one,\n+//! otherwise return capnp::Void.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeGet(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::get(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeGet(...)\n+{\n+    return {};\n+}\n+\n+//! Helper for CustomPassField below. Call Accessor::init method if it has one,\n+//! otherwise do nothing.\n+template <typename Accessor, typename Message>\n+decltype(auto) MaybeInit(Message&& message, decltype(Accessor::get(message))* enable = nullptr)\n+{\n+    return Accessor::init(message);\n+}\n+\n+template <typename Accessor>\n+::capnp::Void MaybeInit(...)\n+{\n+    return {};\n+}\n+\n+//! Overload CustomPassField to serialize types of objects that have\n+//! CustomPassMessage overloads. Defining PassMessage overloads is simpler than\n+//! defining PassField overloads, because PassMessage overloads can be normal\n+//! functions instead of template functions, and defined in a .cpp file instead\n+//! of a header.\n+//!\n+//! Defining a PassField or PassMessage overload is useful for input/output\n+//! parameters. If an overload is not defined these parameters will just be\n+//! deserialized on the server side with ReadField into a temporary variable,\n+//! then the server method will be called passing the temporary variable as a\n+//! parameter, then the temporary variable will be serialized and sent back to\n+//! the client with BuildField. But if a PassField or PassMessage overload is\n+//! defined, the overload is called with a callback to invoke and pass\n+//! parameters to the server side function, and run arbitrary code before and\n+//! after invoking the function.\n+template <typename Accessor, typename... LocalTypes, typename ServerContext, typename Fn, typename... Args>\n+auto CustomPassField(TypeList<LocalTypes...>, ServerContext& server_context, Fn&& fn, Args&&... args)\n+    -> decltype(CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                                  MaybeGet<Accessor>(server_context.call_context.getResults()), nullptr))\n+{\n+    CustomPassMessage(server_context, MaybeGet<Accessor>(server_context.call_context.getParams()),\n+                      MaybeInit<Accessor>(server_context.call_context.getResults()),\n+                      [&](LocalTypes... param) { fn.invoke(server_context, std::forward<Args>(args)..., param...); });\n+}\n+\n+//! Generic ::capnp::Data field builder for any class that a Span can be\n+//! constructed from, particularly BaseHash and base_blob classes and\n+//! subclasses. It's also used to serialize vector<unsigned char>\n+//! GCSFilter::ElementSet set elements.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29409#discussion_r1505998416",
      "id" : 1505998416,
      "line" : 338,
      "node_id" : "PRRC_kwDOABII585Zw7ZQ",
      "original_commit_id" : "2fd10424c04397e50c6683a82db8a0bb68e0f6cc",
      "original_line" : 338,
      "original_position" : 83,
      "original_start_line" : 337,
      "path" : "src/ipc/capnp/common-types.h",
      "position" : 83,
      "pull_request_review_id" : 1901881088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29409",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 337,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-02-28T13:56:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1505998416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/581308?v=4",
         "events_url" : "https://api.github.com/users/cbergqvist/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cbergqvist/followers",
         "following_url" : "https://api.github.com/users/cbergqvist/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cbergqvist/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cbergqvist",
         "id" : 581308,
         "login" : "cbergqvist",
         "node_id" : "MDQ6VXNlcjU4MTMwOA==",
         "organizations_url" : "https://api.github.com/users/cbergqvist/orgs",
         "received_events_url" : "https://api.github.com/users/cbergqvist/received_events",
         "repos_url" : "https://api.github.com/users/cbergqvist/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cbergqvist/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cbergqvist/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cbergqvist"
      }
   }
]
