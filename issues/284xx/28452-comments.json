[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theuni](https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714446097), [hebasto](https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714485096) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#bitcoin-core/gui/754](https://github.com/bitcoin-core/gui/pull/754) (Add BIP324 \"Transport\" label to peer details by hebasto)\n* [#28331](https://github.com/bitcoin/bitcoin/pull/28331) (BIP324 integration by sipa)\n* [#27596](https://github.com/bitcoin/bitcoin/pull/27596) (assumeutxo (2) by jamesob)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-09-11T18:16:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714365556",
      "id" : 1714365556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mLyR0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714365556/reactions"
      },
      "updated_at" : "2023-09-12T17:15:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714365556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK on the msgs, but do we really want to release all mem all the time for the others? Without the shrinks, we essentially keep a high-water mark for memory where future allocations are unnecessary. \r\n\r\nI poked quickly at `m_send_buffer` for in `MarkBytesSent` for example, and it seems like that means constant reallocation now, no?",
      "created_at" : "2023-09-11T19:18:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714446097",
      "id" : 1714446097,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMF8R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714446097/reactions"
      },
      "updated_at" : "2023-09-11T19:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714446097",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/417043?v=4",
         "events_url" : "https://api.github.com/users/theuni/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theuni/followers",
         "following_url" : "https://api.github.com/users/theuni/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theuni/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theuni",
         "id" : 417043,
         "login" : "theuni",
         "node_id" : "MDQ6VXNlcjQxNzA0Mw==",
         "organizations_url" : "https://api.github.com/users/theuni/orgs",
         "received_events_url" : "https://api.github.com/users/theuni/received_events",
         "repos_url" : "https://api.github.com/users/theuni/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theuni/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theuni/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theuni"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@theuni For `m_send_buffer`, `m_recv_buffer`, and `m_recv_decode_buffer` it's not unreasonable to e.g. permit a certain lingering memory usage. E.g. if the capacity is under 64 KiB, don't wipe.\r\n\r\nI considered that before, but wasn't sure it'd be worth the discussion. We're already doing several allocations per P2P message already in various places, some of which will require more refactoring to get rid of, so one more or less probably doesn't matter that much.\r\n\r\nFor this PR, I wanted to just make it do what it was intending to do already.",
      "created_at" : "2023-09-11T19:25:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714454815",
      "id" : 1714454815,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMIEf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714454815/reactions"
      },
      "updated_at" : "2023-09-11T19:26:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714454815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK.\r\n\r\nI'm curious, does this change have an observable effect on peak memory usage?",
      "created_at" : "2023-09-11T19:50:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714485096",
      "id" : 1714485096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMPdo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714485096/reactions"
      },
      "updated_at" : "2023-09-11T19:50:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714485096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hebasto Not right now, as V2Transport isn't hooked up to anything. But once it is, without this PR, after sending a 4 MB message you'd permanently keep 4 MB allocated for that connection (and similarly for the receive side).",
      "created_at" : "2023-09-11T20:01:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714498159",
      "id" : 1714498159,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMSpv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714498159/reactions"
      },
      "updated_at" : "2023-09-11T20:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714498159",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "FWIW, [`shrink_to_fit`](https://en.cppreference.com/w/cpp/container/vector/shrink_to_fit):\r\n> ... is a non-binding request to reduce [`capacity()`](https://en.cppreference.com/w/cpp/container/vector/capacity) to [`size()`](https://en.cppreference.com/w/cpp/container/vector/size). It _depends on_ the implementation whether the request is fulfilled.",
      "created_at" : "2023-09-11T20:03:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714500955",
      "id" : 1714500955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMTVb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714500955/reactions"
      },
      "updated_at" : "2023-09-11T20:03:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714500955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@hebasto I'm aware. But it appears to work better in practice than `v = std::vector<T>{};`.\r\n\r\nI guess we could also use the combination, `v = std::vector<T>{}; v.shrink_to_fit();`.\r\n\r\n`v.swap(std::vector<T>{});` is also an option, possibly followed by `v.shrink_to_fit();`.",
      "created_at" : "2023-09-11T20:03:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714501580",
      "id" : 1714501580,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMTfM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714501580/reactions"
      },
      "updated_at" : "2023-09-11T20:06:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714501580",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `v.swap(std::vector<T>{});` is also an option, possibly followed by `v.shrink_to_fit();`.\r\n\r\nI was thinking just about the same :)",
      "created_at" : "2023-09-11T20:09:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1714508595",
      "id" : 1714508595,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mMVMz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714508595/reactions"
      },
      "updated_at" : "2023-09-11T20:11:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714508595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322479781"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322479781"
         }
      },
      "author_association" : "MEMBER",
      "body" : "On clang, from CI:\r\n\r\n```\r\ntest/net_tests.cpp(1554): error: in \"net_tests/vector_release_test\": check v2.capacity() == 0 has failed\r\ntest/net_tests.cpp(1572): error: in \"net_tests/vector_release_test\": check v6.capacity() == 0 has failed\r\n```\r\n\r\n(But only with depends DEBUG=1 enabled)\r\n\r\n\r\nclang godbolt: https://godbolt.org/z/eYq7Kooz7\r\ngcc godbolt: https://godbolt.org/z/e688xb4vM\r\n",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T06:21:11Z",
      "diff_hunk" : "@@ -1541,4 +1541,43 @@ BOOST_AUTO_TEST_CASE(v2transport_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(vector_release_test)\n+{\n+    std::vector<uint8_t> v1 = {1, 2, 3};\n+    std::vector<uint8_t>{}.swap(v1);\n+    v1.shrink_to_fit();\n+    BOOST_CHECK(v1.capacity() == 0);\n+\n+    std::vector<uint8_t> v2 = {1, 2, 3};\n+    v2 = std::vector<uint8_t>{};\n+    v2.shrink_to_fit();\n+    BOOST_CHECK(v2.capacity() == 0);\n+\n+    std::vector<uint8_t> v3 = {1, 2, 3};\n+    v3.clear();\n+    v3.shrink_to_fit();\n+    BOOST_CHECK(v3.capacity() == 0);\n+\n+    std::vector<uint8_t> v4 = {1, 2, 3};\n+    v4 = {};\n+    v4.shrink_to_fit();\n+    BOOST_CHECK(v4.capacity() == 0);\n+\n+    std::vector<uint8_t> v5 = {1, 2, 3};\n+    std::vector<uint8_t>{}.swap(v5);\n+    BOOST_CHECK(v5.capacity() == 0);\n+\n+    std::vector<uint8_t> v6 = {1, 2, 3};\n+    v6 = std::vector<uint8_t>{};\n+    BOOST_CHECK(v6.capacity() == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322479781",
      "id" : 1322479781,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O03Cl",
      "original_commit_id" : "9a92fda90ee854fd49be40ab462f1029d4a6cdd6",
      "original_line" : 1572,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1621373312,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322479781/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T08:58:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322479781",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322483223"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322483223"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n    ClearShrink(m_header_commitments);\r\n```\r\n\r\nnit: I wonder if there should be a clang-tidy-plugin rule to catch these and whether there should be a util method to do the stuff. This would make it easier to adjust the approach if it needs to be.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T06:25:01Z",
      "diff_hunk" : "@@ -51,9 +51,11 @@ HeadersSyncState::HeadersSyncState(NodeId id, const Consensus::Params& consensus\n void HeadersSyncState::Finalize()\n {\n     Assume(m_download_state != State::FINAL);\n-    m_header_commitments = {};\n+    m_header_commitments.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322483223",
      "id" : 1322483223,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O034X",
      "original_commit_id" : "9a92fda90ee854fd49be40ab462f1029d4a6cdd6",
      "original_line" : 54,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/headerssync.cpp",
      "position" : null,
      "pull_request_review_id" : 1621378491,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322483223/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T06:25:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322483223",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322939799"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322939799"
         }
      },
      "author_association" : "MEMBER",
      "body" : "So bizarre, but that served as a good test for which methods work and don't work.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T12:07:45Z",
      "diff_hunk" : "@@ -1541,4 +1541,43 @@ BOOST_AUTO_TEST_CASE(v2transport_test)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(vector_release_test)\n+{\n+    std::vector<uint8_t> v1 = {1, 2, 3};\n+    std::vector<uint8_t>{}.swap(v1);\n+    v1.shrink_to_fit();\n+    BOOST_CHECK(v1.capacity() == 0);\n+\n+    std::vector<uint8_t> v2 = {1, 2, 3};\n+    v2 = std::vector<uint8_t>{};\n+    v2.shrink_to_fit();\n+    BOOST_CHECK(v2.capacity() == 0);\n+\n+    std::vector<uint8_t> v3 = {1, 2, 3};\n+    v3.clear();\n+    v3.shrink_to_fit();\n+    BOOST_CHECK(v3.capacity() == 0);\n+\n+    std::vector<uint8_t> v4 = {1, 2, 3};\n+    v4 = {};\n+    v4.shrink_to_fit();\n+    BOOST_CHECK(v4.capacity() == 0);\n+\n+    std::vector<uint8_t> v5 = {1, 2, 3};\n+    std::vector<uint8_t>{}.swap(v5);\n+    BOOST_CHECK(v5.capacity() == 0);\n+\n+    std::vector<uint8_t> v6 = {1, 2, 3};\n+    v6 = std::vector<uint8_t>{};\n+    BOOST_CHECK(v6.capacity() == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322939799",
      "id" : 1322939799,
      "in_reply_to_id" : 1322479781,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O2nWX",
      "original_commit_id" : "9a92fda90ee854fd49be40ab462f1029d4a6cdd6",
      "original_line" : 1572,
      "original_position" : 32,
      "original_start_line" : null,
      "path" : "src/test/net_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1622089745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322939799/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T12:07:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322939799",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322940505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322940505"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've added a `ClearShrink(V& v)` to `util/vector.h`, and used that everywhere. I've also added a unit test for it.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T12:08:26Z",
      "diff_hunk" : "@@ -51,9 +51,11 @@ HeadersSyncState::HeadersSyncState(NodeId id, const Consensus::Params& consensus\n void HeadersSyncState::Finalize()\n {\n     Assume(m_download_state != State::FINAL);\n-    m_header_commitments = {};\n+    m_header_commitments.clear();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322940505",
      "id" : 1322940505,
      "in_reply_to_id" : 1322483223,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O2nhZ",
      "original_commit_id" : "9a92fda90ee854fd49be40ab462f1029d4a6cdd6",
      "original_line" : 54,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/headerssync.cpp",
      "position" : null,
      "pull_request_review_id" : 1622090916,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322940505/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T12:08:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322940505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322953705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322953705"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \r\n```suggestion\r\n    BOOST_CHECK_EQUAL(v.capacity(), 0);\r\n```\r\n?",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T12:20:14Z",
      "diff_hunk" : "@@ -1791,4 +1791,13 @@ BOOST_AUTO_TEST_CASE(util_WriteBinaryFile)\n     BOOST_CHECK(valid);\n     BOOST_CHECK_EQUAL(actual_text, expected_text);\n }\n+\n+BOOST_AUTO_TEST_CASE(clearshrink_test)\n+{\n+    std::vector<uint8_t> v = {1, 2, 3};\n+    ClearShrink(v);\n+    BOOST_CHECK(v.empty());\n+    BOOST_CHECK(v.capacity() == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1322953705",
      "id" : 1322953705,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O2qvp",
      "original_commit_id" : "8332d52211360c2c76eb9a17110606a67d048bdf",
      "original_line" : 1800,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/test/util_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1622111898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322953705/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T12:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322953705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1323590385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323590385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-12T21:19:58Z",
      "diff_hunk" : "@@ -1791,4 +1791,13 @@ BOOST_AUTO_TEST_CASE(util_WriteBinaryFile)\n     BOOST_CHECK(valid);\n     BOOST_CHECK_EQUAL(actual_text, expected_text);\n }\n+\n+BOOST_AUTO_TEST_CASE(clearshrink_test)\n+{\n+    std::vector<uint8_t> v = {1, 2, 3};\n+    ClearShrink(v);\n+    BOOST_CHECK(v.empty());\n+    BOOST_CHECK(v.capacity() == 0);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1323590385",
      "id" : 1323590385,
      "in_reply_to_id" : 1322953705,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O5GLx",
      "original_commit_id" : "8332d52211360c2c76eb9a17110606a67d048bdf",
      "original_line" : 1800,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/test/util_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1623171348,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323590385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T21:19:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323590385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Replace those with `v.clear(); v.shrink_to_fit();`.\r\n\r\nPR description needs updating?",
      "created_at" : "2023-09-13T06:11:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#issuecomment-1717004979",
      "id" : 1717004979,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
      "node_id" : "IC_kwDOABII585mV2qz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717004979/reactions"
      },
      "updated_at" : "2023-09-13T06:11:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1717004979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324321101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324321101"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure if we want to use this for vectors only, but from the docs it seems like it? If so, perhaps worthwhile enforcing that on compile time?\r\n```suggestion\r\ninline void ClearShrink(std::vector<V>& v) noexcept\r\n```",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T10:39:07Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324321101",
      "id" : 1324321101,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585O74lN",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 54,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : 6,
      "pull_request_review_id" : 1624237587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324321101/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T10:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324321101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324323609"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324323609"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Given its specialization, would adding a test on `std::vector<bool>` be worthwhile?",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T10:41:29Z",
      "diff_hunk" : "@@ -1791,4 +1791,13 @@ BOOST_AUTO_TEST_CASE(util_WriteBinaryFile)\n     BOOST_CHECK(valid);\n     BOOST_CHECK_EQUAL(actual_text, expected_text);\n }\n+\n+BOOST_AUTO_TEST_CASE(clearshrink_test)\n+{\n+    std::vector<uint8_t> v = {1, 2, 3};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324323609",
      "id" : 1324323609,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O75MZ",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 1797,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/util_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1624237587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324323609/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T10:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324323609",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324334266"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324334266"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "grammar nit: consistent verb forms\r\n\r\n```suggestion\r\n    // There are various ways to clear a vector and release its memory:\r\n```",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T10:52:02Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept\n+{\n+    // There are various ways to clear a vector and releasing its memory:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324334266",
      "id" : 1324334266,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O77y6",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 56,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : null,
      "pull_request_review_id" : 1624237587,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324334266/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T10:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324334266",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324340944"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324340944"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`shrink_to_fit` exists only on vectors, so I think this is already enforced? Also, why is there a need to enforce it? Finally, your suggestion would require the caller to specify the type `V` for every call, which seems suboptimal.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T10:58:09Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324340944",
      "id" : 1324340944,
      "in_reply_to_id" : 1324321101,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585O79bQ",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 54,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : 6,
      "pull_request_review_id" : 1624267834,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324340944/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T10:58:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324340944",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324347497"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324347497"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note that the code isn't using `v.shrink_to_fit();` anymore, but `V{}.swap(v);`. \r\n\r\nAlso, both of those formulas also work on `std::deque`, and the call sites in `HeadersSyncState::Finalize` actually use it for that. Sadly, `std::deque` has no `capacity()`, so you can't actually test if it has the desired effect.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T11:04:38Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324347497",
      "id" : 1324347497,
      "in_reply_to_id" : 1324321101,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585O7_Bp",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 54,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : 6,
      "pull_request_review_id" : 1624278191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324347497/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T11:04:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324347497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324363788"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363788"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T11:20:53Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept\n+{\n+    // There are various ways to clear a vector and releasing its memory:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324363788",
      "id" : 1324363788,
      "in_reply_to_id" : 1324334266,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O8DAM",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 56,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : null,
      "pull_request_review_id" : 1624303652,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363788/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T11:20:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363788",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324363890"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363890"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T11:20:59Z",
      "diff_hunk" : "@@ -1791,4 +1791,13 @@ BOOST_AUTO_TEST_CASE(util_WriteBinaryFile)\n     BOOST_CHECK(valid);\n     BOOST_CHECK_EQUAL(actual_text, expected_text);\n }\n+\n+BOOST_AUTO_TEST_CASE(clearshrink_test)\n+{\n+    std::vector<uint8_t> v = {1, 2, 3};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324363890",
      "id" : 1324363890,
      "in_reply_to_id" : 1324323609,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585O8DBy",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 1797,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/test/util_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1624303800,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363890/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T11:20:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324363890",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324364480"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324364480"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I've clarified in the comment that the function also works on `std::deque`, and added a test for it (though not the capacity test part).",
      "commit_id" : "3fcd7fc7ff563bdc0e2bba66b4cbe72d898c876e",
      "created_at" : "2023-09-13T11:21:34Z",
      "diff_hunk" : "@@ -49,4 +49,22 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+/** Clear a vector and release its allocated memory. */\n+template<typename V>\n+inline void ClearShrink(V& v) noexcept",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28452#discussion_r1324364480",
      "id" : 1324364480,
      "in_reply_to_id" : 1324321101,
      "line" : 54,
      "node_id" : "PRRC_kwDOABII585O8DLA",
      "original_commit_id" : "43627af0848dbabde34209ce07690553fcf94054",
      "original_line" : 54,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/util/vector.h",
      "position" : 6,
      "pull_request_review_id" : 1624304745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324364480/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-13T11:21:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1324364480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   }
]
