[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28400](https://github.com/bitcoin/bitcoin/pull/28400) (Make provably unsignable standard P2PK and P2MS outpoints unspendable. by russeree)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-09-05T03:02:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1705881353",
      "id" : 1705881353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28408",
      "node_id" : "IC_kwDOABII585lra8J",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705881353/reactions"
      },
      "updated_at" : "2023-09-06T19:47:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705881353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Maybe I'm doing something wrong but it will seem that my node no longer receives any txs with this update if `datacarrier=0`\r\n\r\n```\r\n2023-09-07T12:23:39Z Imported mempool transactions from disk: 0 succeeded, 1516 failed, 0 expired, 0 already there, 0 waiting for initial broadcast",
      "created_at" : "2023-09-07T12:35:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1710076571",
      "id" : 1710076571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28408",
      "node_id" : "IC_kwDOABII585l7bKb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710076571/reactions"
      },
      "updated_at" : "2023-09-22T10:46:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710076571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/74937347?v=4",
         "events_url" : "https://api.github.com/users/Retropex/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Retropex/followers",
         "following_url" : "https://api.github.com/users/Retropex/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Retropex/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Retropex",
         "id" : 74937347,
         "login" : "Retropex",
         "node_id" : "MDQ6VXNlcjc0OTM3MzQ3",
         "organizations_url" : "https://api.github.com/users/Retropex/orgs",
         "received_events_url" : "https://api.github.com/users/Retropex/received_events",
         "repos_url" : "https://api.github.com/users/Retropex/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Retropex/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Retropex/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Retropex"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332033451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332033451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    if (m_pool.m_max_datacarrier_bytes && DatacarrierBytes(tx, m_view) > *m_pool.m_max_datacarrier_bytes) {\r\n```\r\nThis fixes the problem mentioned in https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1710076571 (which I can reproduce), and is necessary because `m_pool.m_max_datacarrier_bytes` is type `std::optional<unsigned int>`. If the configuration includes `datacarrier=0` this variable is `nullopt`. It's surprising to me that without this suggestion (comparing an `int32_t` to an unset `std::optional<unsigned int>` for greater-than), the test succeeds (which deems the transaction to be invalid, so the mempool stays completely empty).\r\n\r\nThis suggestion also requires changing the return type of `DatacarrierBytes()` from `int32_t` to `uint32_t` (I think an unsigned type makes more sense anyway).\r\n\r\nNote that this change does not cause the mempool to accept data-carrying transactions (as it might appear) if `datacarrier=0` because they're filtered out by the call to `IsStandardTx()` earlier in this function.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-20T18:33:45Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332033451",
      "id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PZTer",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1636274701,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332033451/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T18:33:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332033451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332609963"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332609963"
         }
      },
      "author_association" : "NONE",
      "body" : "It worked all transactions are no longer purged at startup, however even with `datacarrier=0`, inscriptions still appear in my mempool(I don't know if it still works for inscriptions of more than 80 bytes).\r\n\r\nWe can see it [here](https://orangepill.ovh/fr/block/00000000000000000002561e1e9e110add7e63f716c3b460499d7b1445f93d1f), as my node refuses the inscriptions they are supposed to appear in blue however we see that many of them have still passed. \r\n\r\nThat said, it seems to work if instead of using `datacarrier=0` we use `datacarriersize=0`.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-21T07:35:23Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332609963",
      "id" : 1332609963,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PbgOr",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1637122956,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332609963/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T09:15:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332609963",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/74937347?v=4",
         "events_url" : "https://api.github.com/users/Retropex/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Retropex/followers",
         "following_url" : "https://api.github.com/users/Retropex/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Retropex/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Retropex",
         "id" : 74937347,
         "login" : "Retropex",
         "node_id" : "MDQ6VXNlcjc0OTM3MzQ3",
         "organizations_url" : "https://api.github.com/users/Retropex/orgs",
         "received_events_url" : "https://api.github.com/users/Retropex/received_events",
         "repos_url" : "https://api.github.com/users/Retropex/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Retropex/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Retropex/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Retropex"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs the tests fixed, if still relevant. Otherwise, could move to draft for now?",
      "created_at" : "2023-09-21T11:03:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1729343497",
      "id" : 1729343497,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28408",
      "node_id" : "IC_kwDOABII585nE7AJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729343497/reactions"
      },
      "updated_at" : "2023-09-21T11:03:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729343497",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332912845"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332912845"
         }
      },
      "author_association" : "NONE",
      "body" : "But a code correction is needed in order datacarriersize=0 to behave as expected. \r\n\r\n```suggestion\r\n    if (DatacarrierBytes(tx, m_view) > *m_pool.m_max_datacarrier_bytes) {\r\n```\r\n[https://github.com/luke-jr/bitcoin/pull/10/commits/669cdb01e75c432501f096e752a0342caf08d4a0](url)",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-21T11:33:54Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332912845",
      "id" : 1332912845,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PcqLN",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1637600426,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332912845/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T11:36:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1332912845",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> Needs the tests fixed\r\n\r\nDo you have any suggestions to fix this?",
      "created_at" : "2023-09-21T11:58:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1729425813",
      "id" : 1729425813,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28408",
      "node_id" : "IC_kwDOABII585nFPGV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729425813/reactions"
      },
      "updated_at" : "2023-09-21T11:58:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729425813",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/74937347?v=4",
         "events_url" : "https://api.github.com/users/Retropex/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Retropex/followers",
         "following_url" : "https://api.github.com/users/Retropex/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Retropex/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Retropex",
         "id" : 74937347,
         "login" : "Retropex",
         "node_id" : "MDQ6VXNlcjc0OTM3MzQ3",
         "organizations_url" : "https://api.github.com/users/Retropex/orgs",
         "received_events_url" : "https://api.github.com/users/Retropex/received_events",
         "repos_url" : "https://api.github.com/users/Retropex/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Retropex/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Retropex/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Retropex"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334218099"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334218099"
         }
      },
      "author_association" : "NONE",
      "body" : "`datacarriersize=0` works as expected with @LarryRuane's suggestions.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-22T10:49:28Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334218099",
      "id" : 1334218099,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585Pho1z",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1639712460,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334218099/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-22T10:49:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334218099",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/74937347?v=4",
         "events_url" : "https://api.github.com/users/Retropex/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Retropex/followers",
         "following_url" : "https://api.github.com/users/Retropex/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Retropex/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Retropex",
         "id" : 74937347,
         "login" : "Retropex",
         "node_id" : "MDQ6VXNlcjc0OTM3MzQ3",
         "organizations_url" : "https://api.github.com/users/Retropex/orgs",
         "received_events_url" : "https://api.github.com/users/Retropex/received_events",
         "repos_url" : "https://api.github.com/users/Retropex/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Retropex/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Retropex/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Retropex"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334435950"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334435950"
         }
      },
      "author_association" : "NONE",
      "body" : "Also with this #https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1332912845 suggestion?",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-22T14:09:52Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334435950",
      "id" : 1334435950,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PieBu",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1640044949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334435950/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-22T14:09:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334435950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334583383"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334583383"
         }
      },
      "author_association" : "NONE",
      "body" : "I don't know, I haven't tested your suggestions.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-22T16:13:00Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334583383",
      "id" : 1334583383,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PjCBX",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1640275259,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334583383/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-22T16:13:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334583383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/74937347?v=4",
         "events_url" : "https://api.github.com/users/Retropex/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Retropex/followers",
         "following_url" : "https://api.github.com/users/Retropex/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Retropex/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Retropex",
         "id" : 74937347,
         "login" : "Retropex",
         "node_id" : "MDQ6VXNlcjc0OTM3MzQ3",
         "organizations_url" : "https://api.github.com/users/Retropex/orgs",
         "received_events_url" : "https://api.github.com/users/Retropex/received_events",
         "repos_url" : "https://api.github.com/users/Retropex/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Retropex/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Retropex/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Retropex"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334814239"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334814239"
         }
      },
      "author_association" : "NONE",
      "body" : "> m_pool.m_max_datacarrier_bytes &&\r\n\r\n@LarryRuane: why is that condition necessary? It provides always a pointer different than NULL, right? It is always interpreted as âTrueâ by the âIfâ conditional expression.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-22T21:01:48Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1334814239",
      "id" : 1334814239,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585Pj6Yf",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1640638552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334814239/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-22T21:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1334814239",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@MarcoFalke @glozow \r\nI've written some unit tests, will push to a branch and suggest it here.",
      "created_at" : "2023-09-23T16:04:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#issuecomment-1732349833",
      "id" : 1732349833,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28408",
      "node_id" : "IC_kwDOABII585nQY-J",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1732349833/reactions"
      },
      "updated_at" : "2023-09-23T16:04:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1732349833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335180878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335180878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It's necessary because `m_pool.m_max_datacarrier_bytes` isn't a pointer, it's a `std::optional`. It may be unset (it will be if the config includes `-datacarrier=0`), so it must be tested in this way (or we could call `m_pool.m_max_datacarrier_bytes.has_value()`, which would have the same effect) before attempting to access the contained value (which is what the `*` does).",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T13:51:25Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335180878",
      "id" : 1335180878,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PlT5O",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1641053256,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335180878/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T13:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335180878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335203572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, to show that this isn't a bool\r\n```suggestion\r\n        if (inside_noop > 0) {\r\n```",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T15:24:28Z",
      "diff_hunk" : "@@ -283,6 +287,93 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n+size_t CScript::DatacarrierBytes() const\n+{\n+    if (IsUnspendable()) {\n+        return size();\n+    }\n+\n+    size_t counted{0};\n+    opcodetype opcode, last_opcode{OP_INVALIDOPCODE};\n+    std::vector<unsigned char> push_data;\n+    unsigned int inside_noop{0};\n+    CScript::const_iterator opcode_it = begin(), data_began = begin();\n+    for (CScript::const_iterator it = begin(); it < end(); last_opcode = opcode) {\n+        opcode_it = it;\n+        if (!GetOp(it, opcode, push_data)) {\n+            // Invalid scripts are necessarily all data\n+            return size();\n+        }\n+\n+        // Match OP_FALSE OP_IF\n+        if (inside_noop) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335203572",
      "id" : 1335203572,
      "line" : 309,
      "node_id" : "PRRC_kwDOABII585PlZb0",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 309,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : 38,
      "pull_request_review_id" : 1641078573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T15:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335203691"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203691"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Confirming the `+ 1`, that counts the `OP_FALSE`.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T15:25:31Z",
      "diff_hunk" : "@@ -283,6 +287,93 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n+size_t CScript::DatacarrierBytes() const\n+{\n+    if (IsUnspendable()) {\n+        return size();\n+    }\n+\n+    size_t counted{0};\n+    opcodetype opcode, last_opcode{OP_INVALIDOPCODE};\n+    std::vector<unsigned char> push_data;\n+    unsigned int inside_noop{0};\n+    CScript::const_iterator opcode_it = begin(), data_began = begin();\n+    for (CScript::const_iterator it = begin(); it < end(); last_opcode = opcode) {\n+        opcode_it = it;\n+        if (!GetOp(it, opcode, push_data)) {\n+            // Invalid scripts are necessarily all data\n+            return size();\n+        }\n+\n+        // Match OP_FALSE OP_IF\n+        if (inside_noop) {\n+            switch (opcode) {\n+            case OP_IF: case OP_NOTIF:\n+                ++inside_noop;\n+                break;\n+            case OP_ENDIF:\n+                if (0 == --inside_noop) {\n+                    counted += it - data_began + 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335203691",
      "id" : 1335203691,
      "line" : 316,
      "node_id" : "PRRC_kwDOABII585PlZdr",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 316,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/script/script.cpp",
      "position" : 45,
      "pull_request_review_id" : 1641078573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203691/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T15:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335203691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335204063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204063"
         }
      },
      "author_association" : "NONE",
      "body" : "@LarryRuane: You are right about: m_pool.m_max_datacarrier_bytes isn't a pointer, it's a std::optional.\r\n\r\nTwo user parameters are in play:\r\n-**datacarrier** and\r\n-**datacarriersize**\r\n\r\nFollowing code extract determine the behavior: \r\n\r\n`    if (argsman.GetBoolArg(\"-datacarrier\", DEFAULT_ACCEPT_DATACARRIER)) {\r\n        mempool_opts.max_datacarrier_bytes = argsman.GetIntArg(\"-datacarriersize\", MAX_OP_RETURN_RELAY);\r\n    } else {\r\n        mempool_opts.max_datacarrier_bytes = std::nullopt;\r\n    }`\r\n\r\nIn case **-datacarrier=0**, then your proposal will **not** work as intended since max_datacarrier_bytes will be std::nullopt and the conditional:\r\n`if (m_pool.m_max_datacarrier_bytes && DatacarrierBytes(tx, m_view) > *m_pool.m_max_datacarrier_bytes)`\r\nis not fulfilled.\r\n\r\nFor that reason here a suggested code change:\r\n\r\n```suggestion\r\n    if (!m_pool.m_max_datacarrier_bytes || (DatacarrierBytes(tx, m_view) > *m_pool.m_max_datacarrier_bytes)) {\r\n```",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T15:28:11Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335204063",
      "id" : 1335204063,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PlZjf",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1641078979,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T15:28:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335204579"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204579"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm confused about this. If `p2sh` is false, won't we be counting bytes from the previous transaction's scriptPubKey (output)?",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T15:32:48Z",
      "diff_hunk" : "@@ -283,6 +287,93 @@ bool CScript::HasValidOps() const\n     return true;\n }\n \n+size_t CScript::DatacarrierBytes() const\n+{\n+    if (IsUnspendable()) {\n+        return size();\n+    }\n+\n+    size_t counted{0};\n+    opcodetype opcode, last_opcode{OP_INVALIDOPCODE};\n+    std::vector<unsigned char> push_data;\n+    unsigned int inside_noop{0};\n+    CScript::const_iterator opcode_it = begin(), data_began = begin();\n+    for (CScript::const_iterator it = begin(); it < end(); last_opcode = opcode) {\n+        opcode_it = it;\n+        if (!GetOp(it, opcode, push_data)) {\n+            // Invalid scripts are necessarily all data\n+            return size();\n+        }\n+\n+        // Match OP_FALSE OP_IF\n+        if (inside_noop) {\n+            switch (opcode) {\n+            case OP_IF: case OP_NOTIF:\n+                ++inside_noop;\n+                break;\n+            case OP_ENDIF:\n+                if (0 == --inside_noop) {\n+                    counted += it - data_began + 1;\n+                }\n+                break;\n+            default: /* do nothing */;\n+            }\n+        } else if (opcode == OP_IF && last_opcode == OP_FALSE) {\n+            inside_noop = 1;\n+            data_began = opcode_it;\n+        // Match <data> OP_DROP\n+        } else if (opcode <= OP_PUSHDATA4) {\n+            data_began = opcode_it;\n+        } else if (opcode == OP_DROP && last_opcode <= OP_PUSHDATA4) {\n+            counted += it - data_began;\n+        }\n+    }\n+    return counted;\n+}\n+\n+std::pair<CScript, unsigned int> GetScriptForTransactionInput(CScript prevScript, const CTxIn& txin)\n+{\n+    bool p2sh = false;\n+    if (prevScript.IsPayToScriptHash()) {\n+        std::vector <std::vector<unsigned char> > stack;\n+        if (!EvalScript(stack, txin.scriptSig, SCRIPT_VERIFY_NONE, BaseSignatureChecker(), SigVersion::BASE)) {\n+            return std::make_pair(CScript(), 0);\n+        }\n+        if (stack.empty()) {\n+            return std::make_pair(CScript(), 0);\n+        }\n+        prevScript = CScript(stack.back().begin(), stack.back().end());\n+        p2sh = true;\n+    }\n+\n+    int witnessversion = 0;\n+    std::vector<unsigned char> witnessprogram;\n+\n+    if (!prevScript.IsWitnessProgram(witnessversion, witnessprogram)) {\n+        return std::make_pair(prevScript, WITNESS_SCALE_FACTOR);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335204579",
      "id" : 1335204579,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII585PlZrj",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 354,
      "original_position" : 83,
      "original_start_line" : 352,
      "path" : "src/script/script.cpp",
      "position" : 83,
      "pull_request_review_id" : 1641078573,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204579/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 352,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-24T15:40:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335204579",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335207265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "No, if you do this (and the config includes `-datacarrier=0`), then _all_ transactions are rejected. (Try it, you'll see that `bitcoin-cli getmempoolinfo` shows size and bytes are zero.) We don't want that, we want all data-carrying transactions to be rejected, but non-data carrying should not be rejected.",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T15:57:04Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335207265",
      "id" : 1335207265,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PlaVh",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1641081992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T15:57:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8321330?v=4",
         "events_url" : "https://api.github.com/users/LarryRuane/events{/privacy}",
         "followers_url" : "https://api.github.com/users/LarryRuane/followers",
         "following_url" : "https://api.github.com/users/LarryRuane/following{/other_user}",
         "gists_url" : "https://api.github.com/users/LarryRuane/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/LarryRuane",
         "id" : 8321330,
         "login" : "LarryRuane",
         "node_id" : "MDQ6VXNlcjgzMjEzMzA=",
         "organizations_url" : "https://api.github.com/users/LarryRuane/orgs",
         "received_events_url" : "https://api.github.com/users/LarryRuane/received_events",
         "repos_url" : "https://api.github.com/users/LarryRuane/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/LarryRuane/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/LarryRuane/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/LarryRuane"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335207798"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207798"
         }
      },
      "author_association" : "NONE",
      "body" : "Yes. You are right again!",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T16:01:47Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335207798",
      "id" : 1335207798,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585Plad2",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1641082548,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207798/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T16:01:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335207798",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335210011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335210011"
         }
      },
      "author_association" : "NONE",
      "body" : "What is the intended use case for:\r\n-datacarriers=0?\r\n\r\nIt seems to be:\r\n-datacarrier=1\r\n-datacarriersize=0\r\nIf the new policy rule should reject any data-carrying transaction, right?",
      "commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "created_at" : "2023-09-24T16:06:51Z",
      "diff_hunk" : "@@ -812,6 +812,10 @@ bool MemPoolAccept::PreChecks(ATMPArgs& args, Workspace& ws)\n         return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\n     }\n \n+    if (DatacarrierBytes(tx, m_view) > m_pool.m_max_datacarrier_bytes) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28408#discussion_r1335210011",
      "id" : 1335210011,
      "in_reply_to_id" : 1332033451,
      "line" : 815,
      "node_id" : "PRRC_kwDOABII585PlbAb",
      "original_commit_id" : "c49ed98678a3e94b87b6416e0a2bc8b4e1e2c2b6",
      "original_line" : 815,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : 4,
      "pull_request_review_id" : 1641086108,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28408",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335210011/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-24T16:08:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1335210011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/125733092?v=4",
         "events_url" : "https://api.github.com/users/ChrisMartl/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ChrisMartl/followers",
         "following_url" : "https://api.github.com/users/ChrisMartl/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ChrisMartl/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ChrisMartl",
         "id" : 125733092,
         "login" : "ChrisMartl",
         "node_id" : "U_kgDOB36I5A",
         "organizations_url" : "https://api.github.com/users/ChrisMartl/orgs",
         "received_events_url" : "https://api.github.com/users/ChrisMartl/received_events",
         "repos_url" : "https://api.github.com/users/ChrisMartl/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ChrisMartl/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ChrisMartl/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ChrisMartl"
      }
   }
]
