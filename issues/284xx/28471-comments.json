[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ariard](https://github.com/bitcoin/bitcoin/pull/28471#pullrequestreview-1637654128), [glozow](https://github.com/bitcoin/bitcoin/pull/28471#pullrequestreview-1638153858), [achow101](https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1729861086) |\n| Concept ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1727530471) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
      "created_at" : "2023-09-13T17:34:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1718044144",
      "id" : 1718044144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585mZ0Xw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1718044144/reactions"
      },
      "updated_at" : "2023-09-21T15:54:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1718044144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325590380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be simpler / easier to understand if we just said there's a maximum weight `MAX_PACKAGE_WEIGHT=404000`?",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:38:38Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KB` total size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325590380",
      "id" : 1325590380,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585PAuds",
      "original_commit_id" : "45b71639aee09bea75f521ebc86be9698ef655b7",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 5,
      "pull_request_review_id" : 1626338420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T08:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325595634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs test coverage, maybe in test/functional/mempool_sigoplimit.py? Or a unit test for `CheckPackageLimits`?",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:42:20Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325595634",
      "id" : 1325595634,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII585PAvvy",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 166,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1626349423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T08:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325620063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps include a note in the e4640da4bcacb513c7b602ff3127f65963c3bba4 commit message that you're specifically trying to catch when total package *sigop-adjusted* vsize. Might be helpful to a future git-blamer who may think this code is redundant with the other package size checks.",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:58:41Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325620063",
      "id" : 1325620063,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585PA1tf",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 1,
      "pull_request_review_id" : 1626396875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-09-14T08:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you add tests for the bug fixes?",
      "created_at" : "2023-09-14T10:59:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1719231937",
      "id" : 1719231937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585meWXB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719231937/reactions"
      },
      "updated_at" : "2023-09-14T10:59:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719231937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you add tests for the bug fixes?\r\n\r\nAdded.",
      "created_at" : "2023-09-14T20:34:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1720109700",
      "id" : 1720109700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585mhsqE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720109700/reactions"
      },
      "updated_at" : "2023-09-14T20:34:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720109700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added in mempool_sigoplimit.py since this change threads through a few layers",
      "commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "created_at" : "2023-09-14T20:34:54Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488688",
      "id" : 1326488688,
      "in_reply_to_id" : 1325595634,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII585PEJxw",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 166,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1627711659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T20:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "did MAX_PACKAGE_KWEIGHT=404",
      "commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "created_at" : "2023-09-14T20:35:07Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KB` total size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488898",
      "id" : 1326488898,
      "in_reply_to_id" : 1325590380,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PEJ1C",
      "original_commit_id" : "45b71639aee09bea75f521ebc86be9698ef655b7",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1627711950,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T20:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326489211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T20:35:27Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326489211",
      "id" : 1326489211,
      "in_reply_to_id" : 1325620063,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585PEJ57",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 1,
      "pull_request_review_id" : 1627712498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-09-14T20:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327038069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "86eb12aec1110dcf506846d1dbe4dc58b8254612\r\n\r\nMight it be better to not define a `MAX_PACKAGE_SIZE` and just do weight instead? I'd be worried about rounding errors as they can add up as we round for each transaction's `GetVirtualTransactionSize()`.\r\n\r\nI suggest just doing a `MAX_PACKAGE_WEIGHT_KWU` and changing packages.cpp to sum `GetTransactionWeight` instead.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:21:42Z",
      "diff_hunk" : "@@ -15,8 +15,11 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n+/** Default maximum total weight of transactions in a package in KWu and (non-virtual) KB\n+    to allow for context-less checks. */\n+static constexpr uint32_t MAX_PACKAGE_KWEIGHT = 404;\n+static constexpr uint32_t MAX_PACKAGE_SIZE{MAX_PACKAGE_KWEIGHT / WITNESS_SCALE_FACTOR};\n+static_assert(MAX_PACKAGE_SIZE == 101);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327038069",
      "id" : 1327038069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGP51",
      "original_commit_id" : "86eb12aec1110dcf506846d1dbe4dc58b8254612",
      "original_line" : 22,
      "original_position" : 10,
      "original_start_line" : 21,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327061651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\n\r\nWorth checking + explaining the numbers?\r\n```suggestion\r\n        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\r\n        assert parent_individual_testres[\"allowed\"]\r\n        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\r\n        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:43:06Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327061651",
      "id" : 1327061651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGVqT",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 165,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327063987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\nmaybe use the actual weight getter instead\r\n```suggestion\r\n        assert_greater_than(2000, tx_parent.get_weight() + tx_child.get_weight())\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:45:24Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+\n+        # Transactions are tiny in weight\n+        assert_greater_than(500, len(tx_parent.serialize()) + len(tx_child.serialize()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327063987",
      "id" : 1327063987,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGWOz",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 173,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327068385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\n\r\nAdd comment explaining why the error message is different between testmempoolaccept and submitpackage\r\n```suggestion\r\n        # When we actually try to submit, the parent makes it into the mempool, but the child would exceed ancestor vsize limits\r\n       assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\r\n       assert tx_parent.rehash() in self.nodes[0].getrawmempool()\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:49:40Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327068385",
      "id" : 1327068385,
      "line" : 175,
      "node_id" : "PRRC_kwDOABII585PGXTh",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 175,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 68,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327086508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e\r\n\r\nWhy is this in `CalculateAncestorsAndCheckLimits` instead of `CheckPackageLimits`? Would be faster to check this before calculating `staged_ancestors`.\r\n\r\nAlso I wonder if this could be a confusing error string due to how we're checking. e.g. descendant limit < ancestor limit, so a child-with-24-parents package hits \"too many descendants\" even if everyone has a descendant count of 1 or 2.\r\n\r\nPerhaps more clear is \"package count exceeds ancestor count limit,\" \"package vsize exceeds ancestor count limit,\" etc.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T10:07:03Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (entry_count > static_cast<uint64_t>(limits.ancestor_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many ancestors in package %u [limit: %u]\", entry_count, limits.ancestor_count))};\n+    } else if (entry_count > static_cast<uint64_t>(limits.descendant_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many descendants in package %u [limit: %u]\", entry_count, limits.descendant_count))};\n+    } else if (entry_size > limits.ancestor_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds ancestor size limit %u [limit: %u]\", entry_size, limits.ancestor_size_vbytes))};\n+    } else if (entry_size > limits.descendant_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds descendant size limit for tx %u [limit: %u]\", entry_size, limits.descendant_size_vbytes))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327086508",
      "id" : 1327086508,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGbus",
      "original_commit_id" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : 169,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:26Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288224",
      "id" : 1327288224,
      "in_reply_to_id" : 1327068385,
      "line" : 175,
      "node_id" : "PRRC_kwDOABII585PHM-g",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 175,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 68,
      "pull_request_review_id" : 1628954787,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:30Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+\n+        # Transactions are tiny in weight\n+        assert_greater_than(500, len(tx_parent.serialize()) + len(tx_child.serialize()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288287",
      "id" : 1327288287,
      "in_reply_to_id" : 1327063987,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHM_f",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 173,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628954898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:34Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288376",
      "id" : 1327288376,
      "in_reply_to_id" : 1327061651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHNA4",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 165,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628955021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:37Z",
      "diff_hunk" : "@@ -15,8 +15,11 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n+/** Default maximum total weight of transactions in a package in KWu and (non-virtual) KB\n+    to allow for context-less checks. */\n+static constexpr uint32_t MAX_PACKAGE_KWEIGHT = 404;\n+static constexpr uint32_t MAX_PACKAGE_SIZE{MAX_PACKAGE_KWEIGHT / WITNESS_SCALE_FACTOR};\n+static_assert(MAX_PACKAGE_SIZE == 101);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288442",
      "id" : 1327288442,
      "in_reply_to_id" : 1327038069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHNB6",
      "original_commit_id" : "86eb12aec1110dcf506846d1dbe4dc58b8254612",
      "original_line" : 22,
      "original_position" : 10,
      "original_start_line" : 21,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628955130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327291876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 0774c39e86ca52b747ace02f367617f4d6d88305\r\n\r\ntotal weight",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:29:29Z",
      "diff_hunk" : "@@ -47,7 +48,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total (non-virtual) size cannot exceed MAX_PACKAGE_KWU / WITNESS_SCALE_FACTOR.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327291876",
      "id" : 1327291876,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHN3k",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 51,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628960489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327293199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 0774c39e86ca52b747ace02f367617f4d6d88305\r\n\r\nshould this be checking against `MAX_PACKAGE_KWU`?",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:30:36Z",
      "diff_hunk" : "@@ -122,7 +122,7 @@ BOOST_FIXTURE_TEST_CASE(package_validation_tests, TestChain100Setup)\n \n     // A single, giant transaction submitted through ProcessNewPackage fails on single tx policy.\n     CTransactionRef giant_ptx = create_placeholder_tx(999, 999);\n-    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > MAX_PACKAGE_SIZE * 1000);\n+    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327293199",
      "id" : 1327293199,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII585PHOMP",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 125,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 25,
      "pull_request_review_id" : 1628960489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327297684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> fails on single tx policy\r\n\r\nit's a single tx test check, not a package limit check? :shrug: ",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:33:54Z",
      "diff_hunk" : "@@ -122,7 +122,7 @@ BOOST_FIXTURE_TEST_CASE(package_validation_tests, TestChain100Setup)\n \n     // A single, giant transaction submitted through ProcessNewPackage fails on single tx policy.\n     CTransactionRef giant_ptx = create_placeholder_tx(999, 999);\n-    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > MAX_PACKAGE_SIZE * 1000);\n+    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327297684",
      "id" : 1327297684,
      "in_reply_to_id" : 1327293199,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII585PHPSU",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 125,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 25,
      "pull_request_review_id" : 1628969173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327305214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pushed cleanups",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:40:09Z",
      "diff_hunk" : "@@ -47,7 +48,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total (non-virtual) size cannot exceed MAX_PACKAGE_KWU / WITNESS_SCALE_FACTOR.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327305214",
      "id" : 1327305214,
      "in_reply_to_id" : 1327291876,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHRH-",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 51,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628981564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327317351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "66f6868c4331d3c289221441130e6c1fb61bc60c\r\n\r\nthis says `MAX_PACKAGE_WEIGHT_KWU` but the variable is named `MAX_PACKAGE_KWU`",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:49:44Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_WEIGHT_KWU=404` total weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327317351",
      "id" : 1327317351,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHUFn",
      "original_commit_id" : "66f6868c4331d3c289221441130e6c1fb61bc60c",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629000702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327323660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:54:50Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (entry_count > static_cast<uint64_t>(limits.ancestor_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many ancestors in package %u [limit: %u]\", entry_count, limits.ancestor_count))};\n+    } else if (entry_count > static_cast<uint64_t>(limits.descendant_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many descendants in package %u [limit: %u]\", entry_count, limits.descendant_count))};\n+    } else if (entry_size > limits.ancestor_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds ancestor size limit %u [limit: %u]\", entry_size, limits.ancestor_size_vbytes))};\n+    } else if (entry_size > limits.descendant_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds descendant size limit for tx %u [limit: %u]\", entry_size, limits.descendant_size_vbytes))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327323660",
      "id" : 1327323660,
      "in_reply_to_id" : 1327086508,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHVoM",
      "original_commit_id" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : 169,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1629010475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327327092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:57:44Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_WEIGHT_KWU=404` total weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327327092",
      "id" : 1327327092,
      "in_reply_to_id" : 1327317351,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHWd0",
      "original_commit_id" : "66f6868c4331d3c289221441130e6c1fb61bc60c",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629015991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:57:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Could we get a review from maybe @luke-jr or @ariard?",
      "created_at" : "2023-09-15T13:59:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1721330494",
      "id" : 1721330494,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585mmWs-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1721330494/reactions"
      },
      "updated_at" : "2023-09-15T13:59:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1721330494",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327365279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah hold on, avoiding rounding is good but it does mean that this limit is effectively a few Wu smaller than the default ancestor size limit. (https://github.com/bitcoin/bitcoin/pull/22097#issuecomment-859901930 and https://github.com/bitcoin/bitcoin/pull/22097#issuecomment-862627568) so this statement is untrue.\r\n\r\nI think having this limit denominated in Wu is good and it should be distinct from the ancestor package limits anyway. But I agree with those comments that maybe it's best to not make this limit more restrictive than normal ancestor limits.\r\n\r\nWe can bake in the rounding so this limit is 404000Wu + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR -1) = 404075Wu.\r\n\r\nAlso I think the primary Rationale (if you could edit this bullet point please) should be \"We want package size to be as small as possible to mitigate DoS via package validation. However, we want to make sure that the limit does not restrict ancestor packages that would be allowed if submitted individually.\"",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-15T14:25:48Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327365279",
      "id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHfyf",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629076299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T14:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327428231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed up as suggested, and fixed some inverted static asserts.\r\n\r\nI thought about calling it 405KWU and calling it a day, but I think that would make code history more difficult, so instead stayed precisely as calculated.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-15T15:05:48Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327428231",
      "id" : 1327428231,
      "in_reply_to_id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHvKH",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629174147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T15:05:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK on replacing `MAX_PACKAGE_SIZE` to `MAX_PACKAGE_WEIGHT` and other changes sounds good to me, will code review more soon.",
      "created_at" : "2023-09-19T17:58:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1726233439",
      "id" : 1726233439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585m5Dtf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726233439/reactions"
      },
      "updated_at" : "2023-09-19T17:58:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726233439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331347144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nSince weight to vsize is rounded up, this limit does not need to move up. The total weight will never be more than `vsize * WITNESS_SCALE_FACTOR`. So 404,000 weight units is the correct conversion here.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:29:05Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331347144",
      "id" : 1331347144,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585PWr7I",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 22,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 11,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, those comments are incorrect. The rounding *does* mean that this weight limit across multiple transactions is different from the ancestor size limits, but it makes the package limits *less* restrictive, not more restrictive. That's totally fine. No change needed, we can just keep 404,000Wu.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:37:25Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357176",
      "id" : 1331357176,
      "in_reply_to_id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PWuX4",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1635204949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nWeight to vsize rounds up, not down.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:37:45Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357593",
      "id" : 1331357593,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII585PWueZ",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 30,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 22,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331358919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nI think these will be wrong with the weight corrected. Converting vsize to weight may overshoot the weight limit even if the actual weight limit is correct. I think the descendant and ancestor size limits will need to be changed to weight as well?",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:38:49Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.\n static_assert(DEFAULT_DESCENDANT_LIMIT >= MAX_PACKAGE_COUNT);\n static_assert(DEFAULT_ANCESTOR_LIMIT >= MAX_PACKAGE_COUNT);\n-static_assert(DEFAULT_ANCESTOR_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n-static_assert(DEFAULT_DESCENDANT_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_DESCENDANT_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331358919",
      "id" : 1331358919,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585PWuzH",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 36,
      "original_position" : 30,
      "original_start_line" : 33,
      "path" : "src/policy/packages.h",
      "position" : 30,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 33,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331385652"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331385652"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 97d53ff4c3ede1d1fdc6d93386f14c230b03b98d \"Add functional test to catch too large vsize packages\"\r\n\r\nCan you add a comment explaining what this test is actually testing for? It's not clear to me why `testmempoolaccept` would behave differently from `submitpackage`, and how observing this difference in behavior is useful in a test.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T10:00:46Z",
      "diff_hunk" : "@@ -133,6 +136,48 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\n+        assert parent_individual_testres[\"allowed\"]\n+        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\n+        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+\n+        # When we actually try to submit, the parent makes it into the mempool, but the child would exceed ancestor vsize limits\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331385652",
      "id" : 1331385652,
      "line" : 175,
      "node_id" : "PRRC_kwDOABII585PW1U0",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 175,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 68,
      "pull_request_review_id" : 1635249883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331385652/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T10:00:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331385652",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331462324"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331462324"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: `MAX_PACKAGE_KWU` doesn't exist anymore",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T11:02:17Z",
      "diff_hunk" : "@@ -47,7 +54,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total weight cannot exceed MAX_PACKAGE_KWU.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331462324",
      "id" : 1331462324,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII585PXIC0",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 57,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 39,
      "pull_request_review_id" : 1635371928,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331462324/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T11:02:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331462324",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-09-20T11:23:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1727530471",
      "id" : 1727530471,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585m-AXn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727530471/reactions"
      },
      "updated_at" : "2023-09-20T11:23:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727530471",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331527769"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331527769"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should say `MAX_PACKAGE_WEIGHT`",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:04:02Z",
      "diff_hunk" : "@@ -47,7 +54,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total weight cannot exceed MAX_PACKAGE_KWU.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331527769",
      "id" : 1331527769,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXYBZ",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 57,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635474133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331527769/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:21:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331527769",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331547605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331547605"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think those new package limits are debatable in themselves. If a node operator is setting lower `limitancestorcount` / `limitdescendantcount` (e.g 12), a reasonable behavior when weâre accepting over-size package (e.g 25 elements) could be to accept the 12th first component of the package.\r\n\r\nI think those new checks are preventing this or at the very least we should document mempool options on the new constraint theyâre bringing on package evaluation from my understanding.",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:21:37Z",
      "diff_hunk" : "@@ -197,13 +197,29 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     const Limits& limits,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(limits.ancestor_count)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331547605",
      "id" : 1331547605,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXc3V",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 207,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1635474133,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331547605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:21:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331547605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:35:02Z",
      "diff_hunk" : "@@ -47,7 +54,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total weight cannot exceed MAX_PACKAGE_KWU.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563638",
      "id" : 1331563638,
      "in_reply_to_id" : 1331462324,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXgx2",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 57,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635531029,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563638/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:35:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:35:06Z",
      "diff_hunk" : "@@ -133,6 +136,48 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\n+        assert parent_individual_testres[\"allowed\"]\n+        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\n+        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+\n+        # When we actually try to submit, the parent makes it into the mempool, but the child would exceed ancestor vsize limits\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563713",
      "id" : 1331563713,
      "in_reply_to_id" : 1331385652,
      "line" : 176,
      "node_id" : "PRRC_kwDOABII585PXgzB",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 176,
      "original_position" : 68,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 69,
      "pull_request_review_id" : 1635531157,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:35:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:35:11Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.\n static_assert(DEFAULT_DESCENDANT_LIMIT >= MAX_PACKAGE_COUNT);\n static_assert(DEFAULT_ANCESTOR_LIMIT >= MAX_PACKAGE_COUNT);\n-static_assert(DEFAULT_ANCESTOR_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n-static_assert(DEFAULT_DESCENDANT_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_DESCENDANT_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563800",
      "id" : 1331563800,
      "in_reply_to_id" : 1331358919,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXg0Y",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 36,
      "original_position" : 30,
      "original_start_line" : 33,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635531307,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:35:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563938"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563938"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:35:17Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331563938",
      "id" : 1331563938,
      "in_reply_to_id" : 1331357593,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXg2i",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 30,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635531534,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563938/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:35:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331563938",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331564028"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331564028"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:35:22Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331564028",
      "id" : 1331564028,
      "in_reply_to_id" : 1331347144,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXg38",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 22,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635531682,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331564028/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:35:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331564028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased on latest master with all suggestions included (will discuss @ariard note)",
      "created_at" : "2023-09-20T12:35:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1727637331",
      "id" : 1727637331,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585m-adT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727637331/reactions"
      },
      "updated_at" : "2023-09-20T12:35:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727637331",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331570329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331570329"
         }
      },
      "author_association" : "MEMBER",
      "body" : "CheckPackageLimits is only called in \"AcceptMultipleTransactions\", in other words, we already will try to submit these first parts when they make economic sense.\r\n\r\nWe should probably do something about the naming of functions at some point to delineate better when they are called, but I'll consider that future work.",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:40:43Z",
      "diff_hunk" : "@@ -197,13 +197,29 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     const Limits& limits,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(limits.ancestor_count)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331570329",
      "id" : 1331570329,
      "in_reply_to_id" : 1331547605,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXiaZ",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 207,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1635541874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331570329/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331570329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331573917"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331573917"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T12:43:44Z",
      "diff_hunk" : "@@ -47,7 +54,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total weight cannot exceed MAX_PACKAGE_KWU.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331573917",
      "id" : 1331573917,
      "in_reply_to_id" : 1331527769,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PXjSd",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 57,
      "original_position" : 39,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1635547694,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331573917/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T12:43:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331573917",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331648608"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331648608"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 5c48501e9f1a3da5307b1bee08396598398311e8: it would be cleaner to move some of this into a `create_multisig_tx` helper to deduplicate the multisig insertion code and make it more difficult to accidentally use a variable from before the tx changes.",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T13:37:33Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331648608",
      "id" : 1331648608,
      "line" : 162,
      "node_id" : "PRRC_kwDOABII585PX1hg",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 162,
      "original_position" : 55,
      "original_start_line" : 146,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 55,
      "pull_request_review_id" : 1635669939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331648608/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 146,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T13:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331648608",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331650015"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331650015"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 5c48501e9f1a3da5307b1bee08396598398311e8: you can also just do this\r\n```suggestion\r\n        tx_parent_utxo[\"txid\"] = tx_parent.rehash()\r\n```",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T13:38:32Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331650015",
      "id" : 1331650015,
      "line" : 152,
      "node_id" : "PRRC_kwDOABII585PX13f",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 152,
      "original_position" : 45,
      "original_start_line" : 151,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 45,
      "pull_request_review_id" : 1635669939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331650015/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 151,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T13:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331650015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331651136"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331651136"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 5c48501e9f1a3da5307b1bee08396598398311e8\r\n\r\n```suggestion\r\n        # here, it would get further in validation and give too-long-mempool-chain error instead.\r\n```",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T13:39:19Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\n+        assert parent_individual_testres[\"allowed\"]\n+        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\n+        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\n+\n+        # But together, it's exceeding limits in the *package* context. If sigops adjusted vsize wasn't being checked\n+        # here, it would get farther in validation and give too-long-mempool-chain error instead.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331651136",
      "id" : 1331651136,
      "line" : 171,
      "node_id" : "PRRC_kwDOABII585PX2JA",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 171,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 64,
      "pull_request_review_id" : 1635669939,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331651136/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T13:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331651136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331678727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331678727"
         }
      },
      "author_association" : "MEMBER",
      "body" : "From my understanding of offline discussions with PR author, those limits will be only considered when the individual transactions are not satisfying the mempool min fee on their own and they serve as an upper bound check on the max number of elements in the transaction.\r\n\r\nYes documentation and naming of functions can be improved in the future.",
      "commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "created_at" : "2023-09-20T13:57:25Z",
      "diff_hunk" : "@@ -197,13 +197,29 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     const Limits& limits,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(limits.ancestor_count)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331678727",
      "id" : 1331678727,
      "in_reply_to_id" : 1331547605,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PX84H",
      "original_commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "original_line" : 207,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1635718067,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331678727/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T13:57:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331678727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331711213"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331711213"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Playing with the boundary values `403â999` or `404â001` doesnât break `package_sanitization_tests` as one could expect.",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T14:19:02Z",
      "diff_hunk" : "@@ -15,18 +15,22 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This must allow a superset of sigops\n+    weighted vsize limited transactions to not disallow transactions we would\n+    have otherwise accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331711213",
      "id" : 1331711213,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585PYEzt",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 22,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 11,
      "pull_request_review_id" : 1635769197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331711213/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331711213",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331714462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331714462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Following diff doesnât sound to break functional test `mempool_sigoplimit.py`.\r\n```\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 324292c055..21571b9e8a 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -205,7 +205,7 @@ bool CTxMemPool::CheckPackageLimits(const Package& package,\r\n     // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\r\n     if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\r\n         errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\r\n-        return false;\r\n+        return true;\r\n     } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\r\n         errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\r\n         return false;\r\n```",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T14:21:08Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331714462",
      "id" : 1331714462,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII585PYFme",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 208,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 12,
      "pull_request_review_id" : 1635769197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331714462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331714462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331721139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331721139"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here\r\n```\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 324292c055..a9d8355aa3 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -208,7 +208,7 @@ bool CTxMemPool::CheckPackageLimits(const Package& package,\r\n         return false;\r\n     } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\r\n         errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\r\n-        return false;\r\n+        return true;\r\n     } else if (total_vsize > m_limits.ancestor_size_vbytes) {\r\n         errString = strprintf(\"package size %u exceeds ancestor size limit [limit: %u]\", total_vsize, m_limits.ancestor_size_vbytes);\r\n         return false;\r\n```",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T14:25:35Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;\n+    } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\n+        errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331721139",
      "id" : 1331721139,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585PYHOz",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 211,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1635769197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331721139/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331721139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331723889"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331723889"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same here\r\n\r\n```\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 324292c055..20456e250c 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -214,7 +214,7 @@ bool CTxMemPool::CheckPackageLimits(const Package& package,\r\n         return false;\r\n     } else if (total_vsize > m_limits.descendant_size_vbytes) {\r\n         errString = strprintf(\"package size %u exceeds descendant size limit [limit: %u]\", total_vsize, m_limits.descendant_size_vbytes);\r\n-        return false;\r\n+        return true;\r\n     }\r\n``` \r\n(Mutating the third check on ancestor size vbytes break the functional test)",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T14:27:20Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;\n+    } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\n+        errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\n+        return false;\n+    } else if (total_vsize > m_limits.ancestor_size_vbytes) {\n+        errString = strprintf(\"package size %u exceeds ancestor size limit [limit: %u]\", total_vsize, m_limits.ancestor_size_vbytes);\n+        return false;\n+    } else if (total_vsize > m_limits.descendant_size_vbytes) {\n+        errString = strprintf(\"package size %u exceeds descendant size limit [limit: %u]\", total_vsize, m_limits.descendant_size_vbytes);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331723889",
      "id" : 1331723889,
      "line" : 217,
      "node_id" : "PRRC_kwDOABII585PYH5x",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 217,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 21,
      "pull_request_review_id" : 1635769197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331723889/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331723889",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331725353"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331725353"
         }
      },
      "author_association" : "MEMBER",
      "body" : "A log info is nice like \r\n\r\n```\r\ndiff --git a/test/functional/mempool_sigoplimit.py b/test/functional/mempool_sigoplimit.py\r\nindex aef4602c16..f94af9da73 100755\r\n--- a/test/functional/mempool_sigoplimit.py\r\n+++ b/test/functional/mempool_sigoplimit.py\r\n@@ -140,6 +140,7 @@ class BytesPerSigOpTest(BitcoinTestFramework):\r\n         # Make a 2-transaction package which fails vbyte checks even though\r\n         # separately they would work.\r\n         self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\r\n+        self.log.info(\"Test sigops package\")\r\n \r\n         _, pubkey = generate_keypair()\r\n         amount_for_bare = 50000\r\n```",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T14:28:18Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331725353",
      "id" : 1331725353,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585PYIQp",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 143,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 36,
      "pull_request_review_id" : 1635769197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331725353/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:28:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331725353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803409"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803409"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:22:23Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\n+        assert parent_individual_testres[\"allowed\"]\n+        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\n+        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\n+\n+        # But together, it's exceeding limits in the *package* context. If sigops adjusted vsize wasn't being checked\n+        # here, it would get farther in validation and give too-long-mempool-chain error instead.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803409",
      "id" : 1331803409,
      "in_reply_to_id" : 1331651136,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYbUR",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 171,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1635918354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803409/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:22:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803504"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803504"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:22:27Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803504",
      "id" : 1331803504,
      "in_reply_to_id" : 1331650015,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYbVw",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 152,
      "original_position" : 45,
      "original_start_line" : 151,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1635918501,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803504/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:22:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803590"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803590"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:22:31Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331803590",
      "id" : 1331803590,
      "in_reply_to_id" : 1331648608,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYbXG",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 162,
      "original_position" : 55,
      "original_start_line" : 146,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1635918645,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803590/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:22:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331803590",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331804025"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331804025"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:22:47Z",
      "diff_hunk" : "@@ -133,6 +136,49 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331804025",
      "id" : 1331804025,
      "in_reply_to_id" : 1331725353,
      "line" : 143,
      "node_id" : "PRRC_kwDOABII585PYbd5",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 143,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 36,
      "pull_request_review_id" : 1635919429,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331804025/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:22:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331804025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331807326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331807326"
         }
      },
      "author_association" : "MEMBER",
      "body" : "should break if you make it significantly larger, I think, since it's making txns that aren't 1 WU. leaving as is for now",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:25:05Z",
      "diff_hunk" : "@@ -15,18 +15,22 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This must allow a superset of sigops\n+    weighted vsize limited transactions to not disallow transactions we would\n+    have otherwise accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331807326",
      "id" : 1331807326,
      "in_reply_to_id" : 1331711213,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585PYcRe",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 22,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 11,
      "pull_request_review_id" : 1635924877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331807326/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:25:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331807326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331820743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "going to reserve for follow-up test writing",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:34:42Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331820743",
      "id" : 1331820743,
      "in_reply_to_id" : 1331714462,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII585PYfjH",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 208,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 12,
      "pull_request_review_id" : 1635948132,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:34:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331820872"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820872"
         }
      },
      "author_association" : "MEMBER",
      "body" : "going to reserve for follow-up test writing",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:34:46Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;\n+    } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\n+        errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331820872",
      "id" : 1331820872,
      "in_reply_to_id" : 1331721139,
      "line" : 211,
      "node_id" : "PRRC_kwDOABII585PYflI",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 211,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 15,
      "pull_request_review_id" : 1635948397,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820872/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:34:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331820872",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331821018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331821018"
         }
      },
      "author_association" : "MEMBER",
      "body" : "going to reserve for follow-up test writing",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-20T15:34:53Z",
      "diff_hunk" : "@@ -197,12 +197,28 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n }\n \n bool CTxMemPool::CheckPackageLimits(const Package& package,\n+                                    const int64_t total_vsize,\n                                     std::string &errString) const\n {\n+    size_t pack_size = package.size();\n+\n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (pack_size > static_cast<uint64_t>(m_limits.ancestor_count)) {\n+        errString = strprintf(\"package count %u exceeds ancestor count limit [limit: %u]\", pack_size, m_limits.ancestor_count);\n+        return false;\n+    } else if (pack_size > static_cast<uint64_t>(m_limits.descendant_count)) {\n+        errString = strprintf(\"package count %u exceeds descendant count limit [limit: %u]\", pack_size, m_limits.descendant_count);\n+        return false;\n+    } else if (total_vsize > m_limits.ancestor_size_vbytes) {\n+        errString = strprintf(\"package size %u exceeds ancestor size limit [limit: %u]\", total_vsize, m_limits.ancestor_size_vbytes);\n+        return false;\n+    } else if (total_vsize > m_limits.descendant_size_vbytes) {\n+        errString = strprintf(\"package size %u exceeds descendant size limit [limit: %u]\", total_vsize, m_limits.descendant_size_vbytes);\n+        return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331821018",
      "id" : 1331821018,
      "in_reply_to_id" : 1331723889,
      "line" : 217,
      "node_id" : "PRRC_kwDOABII585PYfna",
      "original_commit_id" : "5c48501e9f1a3da5307b1bee08396598398311e8",
      "original_line" : 217,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 21,
      "pull_request_review_id" : 1635948756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331821018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:34:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331821018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "seems to be a spurious failure",
      "created_at" : "2023-09-20T17:34:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1728168080",
      "id" : 1728168080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nAcCQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728168080/reactions"
      },
      "updated_at" : "2023-09-20T17:34:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728168080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> seems to be a spurious failure\r\n\r\nYeap. The [failed](https://github.com/bitcoin/bitcoin/actions/runs/6250870524/job/16970695678?pr=28471) job has been restarted.\r\n\r\nThe failure itself is fixed in #28509.",
      "created_at" : "2023-09-20T20:31:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1728385456",
      "id" : 1728385456,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nBRGw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728385456/reactions"
      },
      "updated_at" : "2023-09-20T20:31:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728385456",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/32963518?v=4",
         "events_url" : "https://api.github.com/users/hebasto/events{/privacy}",
         "followers_url" : "https://api.github.com/users/hebasto/followers",
         "following_url" : "https://api.github.com/users/hebasto/following{/other_user}",
         "gists_url" : "https://api.github.com/users/hebasto/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/hebasto",
         "id" : 32963518,
         "login" : "hebasto",
         "node_id" : "MDQ6VXNlcjMyOTYzNTE4",
         "organizations_url" : "https://api.github.com/users/hebasto/orgs",
         "received_events_url" : "https://api.github.com/users/hebasto/received_events",
         "repos_url" : "https://api.github.com/users/hebasto/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/hebasto/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/hebasto"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1333253761"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333253761"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit eb8f58f5e4a249d55338304099e8238896d2316d\r\n\r\n```suggestion\r\n       self.log.info(\"Test a package whose sigop-adjusted vsize hits ancestor size limits\")\r\n```",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-21T15:27:49Z",
      "diff_hunk" : "@@ -133,6 +136,45 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        self.log.info(\"Test a overly-large sigops-vbyte hits package limits\")",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1333253761",
      "id" : 1333253761,
      "line" : 140,
      "node_id" : "PRRC_kwDOABII585Pd9aB",
      "original_commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "original_line" : 140,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 33,
      "pull_request_review_id" : 1638153858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333253761/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T15:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333253761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1333254276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333254276"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit eb8f58f5e4a249d55338304099e8238896d2316d: unused\r\n\r\n```suggestion\r\n       _, tx_child = create_bare_multisig_tx(tx_parent_utxo)\r\n```",
      "commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-21T15:28:14Z",
      "diff_hunk" : "@@ -133,6 +136,45 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        self.log.info(\"Test a overly-large sigops-vbyte hits package limits\")\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        def create_bare_multisig_tx(utxo_to_spend=None):\n+            _, pubkey = generate_keypair()\n+            amount_for_bare = 50000\n+            tx_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"), utxo_to_spend=utxo_to_spend)\n+            tx_utxo = tx_dict[\"new_utxo\"]\n+            tx = tx_dict[\"tx\"]\n+            tx.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+            tx.vout[0].nValue -= amount_for_bare\n+            tx_utxo[\"txid\"] = tx.rehash()\n+            tx_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+            return (tx_utxo, tx)\n+\n+        tx_parent_utxo, tx_parent = create_bare_multisig_tx()\n+        tx_child_utxo, tx_child = create_bare_multisig_tx(tx_parent_utxo)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1333254276",
      "id" : 1333254276,
      "line" : 158,
      "node_id" : "PRRC_kwDOABII585Pd9iE",
      "original_commit_id" : "eb8f58f5e4a249d55338304099e8238896d2316d",
      "original_line" : 158,
      "original_position" : 51,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 51,
      "pull_request_review_id" : 1638153858,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333254276/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T15:28:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333254276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK eb8f58f5e4a249d55338304099e8238896d2316d",
      "created_at" : "2023-09-21T15:54:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1729861086",
      "id" : 1729861086,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nG5Xe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729861086/reactions"
      },
      "updated_at" : "2023-09-21T15:54:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729861086",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "post-merge light ACK eb8f58f5e4a249d55338304099e8238896d2316d. Still need to catchup with the past 2 years of package relay but this makes sense to me.",
      "created_at" : "2023-09-21T16:50:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1729952473",
      "id" : 1729952473,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nHPrZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729952473/reactions"
      },
      "updated_at" : "2023-09-21T16:50:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729952473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT which accounts for additional WU necessary to not exclude default chain limit transactions that would have been accepted individually. Avoids sigops vbyte confusion.\r\n\r\nThis just seems to make the bug harder to fix? How does it account for sigops?",
      "created_at" : "2023-09-22T03:40:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1730758544",
      "id" : 1730758544,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nKUeQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730758544/reactions"
      },
      "updated_at" : "2023-09-22T03:40:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1730758544",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This PR changed the first context-less size check use weight units to make it clear it doesn't check sigops at this stage. As you know (since it's your commit), virtual size adjusted for sigops is later accounted for in `PackageMempoolChecks`:\r\nhttps://github.com/bitcoin/bitcoin/blob/b66f6dcb26906ca8187c7e54735e21168b8101c7/src/validation.cpp#L1302-L1305\r\n\r\nWhat bug are you talking about which is made harder to fix?",
      "created_at" : "2023-09-22T11:14:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1731242723",
      "id" : 1731242723,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585nMKrj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1731242723/reactions"
      },
      "updated_at" : "2023-09-22T11:14:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1731242723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
