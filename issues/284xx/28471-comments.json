[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/28471#pullrequestreview-1626338420) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28472](https://github.com/bitcoin/bitcoin/pull/28472) (Make MemPoolAccept::m_limits const by instagibbs)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-09-13T17:34:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1718044144",
      "id" : 1718044144,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585mZ0Xw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1718044144/reactions"
      },
      "updated_at" : "2023-09-14T19:35:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1718044144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325590380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would it be simpler / easier to understand if we just said there's a maximum weight `MAX_PACKAGE_WEIGHT=404000`?",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:38:38Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KB` total size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325590380",
      "id" : 1325590380,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585PAuds",
      "original_commit_id" : "45b71639aee09bea75f521ebc86be9698ef655b7",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : 5,
      "pull_request_review_id" : 1626338420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T08:40:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325590380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325595634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Needs test coverage, maybe in test/functional/mempool_sigoplimit.py? Or a unit test for `CheckPackageLimits`?",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:42:20Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325595634",
      "id" : 1325595634,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII585PAvvy",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 166,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1626349423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T08:42:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325595634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325620063"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Perhaps include a note in the e4640da4bcacb513c7b602ff3127f65963c3bba4 commit message that you're specifically trying to catch when total package *sigop-adjusted* vsize. Might be helpful to a future git-blamer who may think this code is redundant with the other package size checks.",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T08:58:41Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1325620063",
      "id" : 1325620063,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585PA1tf",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 1,
      "pull_request_review_id" : 1626396875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-09-14T08:58:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1325620063",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Can you add tests for the bug fixes?",
      "created_at" : "2023-09-14T10:59:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1719231937",
      "id" : 1719231937,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585meWXB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719231937/reactions"
      },
      "updated_at" : "2023-09-14T10:59:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1719231937",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Can you add tests for the bug fixes?\r\n\r\nAdded.",
      "created_at" : "2023-09-14T20:34:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#issuecomment-1720109700",
      "id" : 1720109700,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28471",
      "node_id" : "IC_kwDOABII585mhsqE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720109700/reactions"
      },
      "updated_at" : "2023-09-14T20:34:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720109700",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488688"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added in mempool_sigoplimit.py since this change threads through a few layers",
      "commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "created_at" : "2023-09-14T20:34:54Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488688",
      "id" : 1326488688,
      "in_reply_to_id" : 1325595634,
      "line" : 166,
      "node_id" : "PRRC_kwDOABII585PEJxw",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 166,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 4,
      "pull_request_review_id" : 1627711659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T20:34:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488688",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488898"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898"
         }
      },
      "author_association" : "MEMBER",
      "body" : "did MAX_PACKAGE_KWEIGHT=404",
      "commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "created_at" : "2023-09-14T20:35:07Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KB` total size",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326488898",
      "id" : 1326488898,
      "in_reply_to_id" : 1325590380,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PEJ1C",
      "original_commit_id" : "45b71639aee09bea75f521ebc86be9698ef655b7",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1627711950,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-14T20:35:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326488898",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326489211"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "created_at" : "2023-09-14T20:35:27Z",
      "diff_hunk" : "",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1326489211",
      "id" : 1326489211,
      "in_reply_to_id" : 1325620063,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585PEJ57",
      "original_commit_id" : "e4640da4bcacb513c7b602ff3127f65963c3bba4",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 1,
      "pull_request_review_id" : 1627712498,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "file",
      "updated_at" : "2023-09-14T20:35:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1326489211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327038069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "86eb12aec1110dcf506846d1dbe4dc58b8254612\r\n\r\nMight it be better to not define a `MAX_PACKAGE_SIZE` and just do weight instead? I'd be worried about rounding errors as they can add up as we round for each transaction's `GetVirtualTransactionSize()`.\r\n\r\nI suggest just doing a `MAX_PACKAGE_WEIGHT_KWU` and changing packages.cpp to sum `GetTransactionWeight` instead.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:21:42Z",
      "diff_hunk" : "@@ -15,8 +15,11 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n+/** Default maximum total weight of transactions in a package in KWu and (non-virtual) KB\n+    to allow for context-less checks. */\n+static constexpr uint32_t MAX_PACKAGE_KWEIGHT = 404;\n+static constexpr uint32_t MAX_PACKAGE_SIZE{MAX_PACKAGE_KWEIGHT / WITNESS_SCALE_FACTOR};\n+static_assert(MAX_PACKAGE_SIZE == 101);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327038069",
      "id" : 1327038069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGP51",
      "original_commit_id" : "86eb12aec1110dcf506846d1dbe4dc58b8254612",
      "original_line" : 22,
      "original_position" : 10,
      "original_start_line" : 21,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327038069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327061651"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\n\r\nWorth checking + explaining the numbers?\r\n```suggestion\r\n        parent_individual_testres = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0]\r\n        assert parent_individual_testres[\"allowed\"]\r\n        # Multisig is counted as MAX_PUBKEYS_PER_MULTISIG = 20 sigops\r\n        assert_equal(parent_individual_testres[\"vsize\"], 5000 * 20)\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:43:06Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327061651",
      "id" : 1327061651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGVqT",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 165,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327061651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327063987"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\nmaybe use the actual weight getter instead\r\n```suggestion\r\n        assert_greater_than(2000, tx_parent.get_weight() + tx_child.get_weight())\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:45:24Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+\n+        # Transactions are tiny in weight\n+        assert_greater_than(500, len(tx_parent.serialize()) + len(tx_child.serialize()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327063987",
      "id" : 1327063987,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGWOz",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 173,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327063987",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327068385"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385"
         }
      },
      "author_association" : "MEMBER",
      "body" : "71930556bc30659e02a88b3a115c0d36dacd9545\r\n\r\nAdd comment explaining why the error message is different between testmempoolaccept and submitpackage\r\n```suggestion\r\n        # When we actually try to submit, the parent makes it into the mempool, but the child would exceed ancestor vsize limits\r\n       assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\r\n       assert tx_parent.rehash() in self.nodes[0].getrawmempool()\r\n```",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T09:49:40Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327068385",
      "id" : 1327068385,
      "line" : 175,
      "node_id" : "PRRC_kwDOABII585PGXTh",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 175,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 68,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327068385",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327086508"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508"
         }
      },
      "author_association" : "MEMBER",
      "body" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e\r\n\r\nWhy is this in `CalculateAncestorsAndCheckLimits` instead of `CheckPackageLimits`? Would be faster to check this before calculating `staged_ancestors`.\r\n\r\nAlso I wonder if this could be a confusing error string due to how we're checking. e.g. descendant limit < ancestor limit, so a child-with-24-parents package hits \"too many descendants\" even if everyone has a descendant count of 1 or 2.\r\n\r\nPerhaps more clear is \"package count exceeds ancestor count limit,\" \"package vsize exceeds ancestor count limit,\" etc.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T10:07:03Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (entry_count > static_cast<uint64_t>(limits.ancestor_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many ancestors in package %u [limit: %u]\", entry_count, limits.ancestor_count))};\n+    } else if (entry_count > static_cast<uint64_t>(limits.descendant_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many descendants in package %u [limit: %u]\", entry_count, limits.descendant_count))};\n+    } else if (entry_size > limits.ancestor_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds ancestor size limit %u [limit: %u]\", entry_size, limits.ancestor_size_vbytes))};\n+    } else if (entry_size > limits.descendant_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds descendant size limit for tx %u [limit: %u]\", entry_size, limits.descendant_size_vbytes))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327086508",
      "id" : 1327086508,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PGbus",
      "original_commit_id" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : 169,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1628558831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T10:10:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327086508",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:26Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288224",
      "id" : 1327288224,
      "in_reply_to_id" : 1327068385,
      "line" : 175,
      "node_id" : "PRRC_kwDOABII585PHM-g",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 175,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : 68,
      "pull_request_review_id" : 1628954787,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:30Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]\n+\n+        # But together, it's exceeding limits\n+        packet_test = self.nodes[0].testmempoolaccept([tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+        assert_equal([x[\"package-error\"] for x in packet_test], [\"package-mempool-limits\", \"package-mempool-limits\"])\n+        assert_raises_rpc_error(-26, \"too-long-mempool-chain\", self.nodes[0].submitpackage, [tx_parent.serialize().hex(), tx_child.serialize().hex()])\n+\n+        # Transactions are tiny in weight\n+        assert_greater_than(500, len(tx_parent.serialize()) + len(tx_child.serialize()))",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288287",
      "id" : 1327288287,
      "in_reply_to_id" : 1327063987,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHM_f",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 173,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628954898,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:34Z",
      "diff_hunk" : "@@ -133,6 +136,42 @@ def test_sigops_limit(self, bytes_per_sigop, num_sigops):\n         assert_equal(entry_parent['descendantcount'], 2)\n         assert_equal(entry_parent['descendantsize'], parent_tx.get_vsize() + sigop_equivalent_vsize)\n \n+    def test_sigops_package(self):\n+        # Make a 2-transaction package which fails vbyte checks even though\n+        # separately they would work.\n+        self.restart_node(0, extra_args=[\"-bytespersigop=5000\"] + self.extra_args[0])\n+\n+        _, pubkey = generate_keypair()\n+        amount_for_bare = 50000\n+        tx_parent_dict = self.wallet.create_self_transfer(fee=Decimal(\"3\"))\n+        tx_parent_utxo = tx_parent_dict[\"new_utxo\"]\n+        tx_parent = tx_parent_dict[\"tx\"]\n+        tx_parent.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_parent.vout[0].nValue -= amount_for_bare\n+        tx_parent.calc_sha256()\n+        tx_parent_utxo[\"txid\"] = tx_parent.hash\n+        tx_parent_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        tx_child_dict = self.wallet.create_self_transfer(utxo_to_spend=tx_parent_utxo, fee=Decimal(\"3\"))\n+        tx_child_utxo = tx_child_dict[\"new_utxo\"]\n+        tx_child = tx_child_dict[\"tx\"]\n+        tx_child.vout.append(CTxOut(amount_for_bare, keys_to_multisig_script([pubkey], k=1)))\n+        tx_child.vout[0].nValue -= amount_for_bare\n+        tx_child.calc_sha256()\n+        tx_child_utxo[\"txid\"] = tx_child.hash\n+        tx_child_utxo[\"value\"] -= Decimal(\"0.00005000\")\n+\n+        # Separately, the parent tx is ok\n+        assert self.nodes[0].testmempoolaccept([tx_parent.serialize().hex()])[0][\"allowed\"]",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288376",
      "id" : 1327288376,
      "in_reply_to_id" : 1327061651,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHNA4",
      "original_commit_id" : "71930556bc30659e02a88b3a115c0d36dacd9545",
      "original_line" : 165,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "test/functional/mempool_sigoplimit.py",
      "position" : null,
      "pull_request_review_id" : 1628955021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288442"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done.",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:26:37Z",
      "diff_hunk" : "@@ -15,8 +15,11 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n+/** Default maximum total weight of transactions in a package in KWu and (non-virtual) KB\n+    to allow for context-less checks. */\n+static constexpr uint32_t MAX_PACKAGE_KWEIGHT = 404;\n+static constexpr uint32_t MAX_PACKAGE_SIZE{MAX_PACKAGE_KWEIGHT / WITNESS_SCALE_FACTOR};\n+static_assert(MAX_PACKAGE_SIZE == 101);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327288442",
      "id" : 1327288442,
      "in_reply_to_id" : 1327038069,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHNB6",
      "original_commit_id" : "86eb12aec1110dcf506846d1dbe4dc58b8254612",
      "original_line" : 22,
      "original_position" : 10,
      "original_start_line" : 21,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628955130,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:26:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327288442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327291876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 0774c39e86ca52b747ace02f367617f4d6d88305\r\n\r\ntotal weight",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:29:29Z",
      "diff_hunk" : "@@ -47,7 +48,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total (non-virtual) size cannot exceed MAX_PACKAGE_KWU / WITNESS_SCALE_FACTOR.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327291876",
      "id" : 1327291876,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHN3k",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 51,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628960489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327291876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327293199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit 0774c39e86ca52b747ace02f367617f4d6d88305\r\n\r\nshould this be checking against `MAX_PACKAGE_KWU`?",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:30:36Z",
      "diff_hunk" : "@@ -122,7 +122,7 @@ BOOST_FIXTURE_TEST_CASE(package_validation_tests, TestChain100Setup)\n \n     // A single, giant transaction submitted through ProcessNewPackage fails on single tx policy.\n     CTransactionRef giant_ptx = create_placeholder_tx(999, 999);\n-    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > MAX_PACKAGE_SIZE * 1000);\n+    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327293199",
      "id" : 1327293199,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII585PHOMP",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 125,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 25,
      "pull_request_review_id" : 1628960489,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:32:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327293199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327297684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> fails on single tx policy\r\n\r\nit's a single tx test check, not a package limit check? :shrug: ",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:33:54Z",
      "diff_hunk" : "@@ -122,7 +122,7 @@ BOOST_FIXTURE_TEST_CASE(package_validation_tests, TestChain100Setup)\n \n     // A single, giant transaction submitted through ProcessNewPackage fails on single tx policy.\n     CTransactionRef giant_ptx = create_placeholder_tx(999, 999);\n-    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > MAX_PACKAGE_SIZE * 1000);\n+    BOOST_CHECK(GetVirtualTransactionSize(*giant_ptx) > DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * 1000);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327297684",
      "id" : 1327297684,
      "in_reply_to_id" : 1327293199,
      "line" : 125,
      "node_id" : "PRRC_kwDOABII585PHPSU",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 125,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/txpackage_tests.cpp",
      "position" : 25,
      "pull_request_review_id" : 1628969173,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:33:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327297684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327305214"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214"
         }
      },
      "author_association" : "MEMBER",
      "body" : "pushed cleanups",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:40:09Z",
      "diff_hunk" : "@@ -47,7 +48,7 @@ class PackageValidationState : public ValidationState<PackageValidationResult> {\n \n /** Context-free package policy checks:\n  * 1. The number of transactions cannot exceed MAX_PACKAGE_COUNT.\n- * 2. The total virtual size cannot exceed MAX_PACKAGE_SIZE.\n+ * 2. The total (non-virtual) size cannot exceed MAX_PACKAGE_KWU / WITNESS_SCALE_FACTOR.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327305214",
      "id" : 1327305214,
      "in_reply_to_id" : 1327291876,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHRH-",
      "original_commit_id" : "0774c39e86ca52b747ace02f367617f4d6d88305",
      "original_line" : 51,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : null,
      "pull_request_review_id" : 1628981564,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:40:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327305214",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327317351"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351"
         }
      },
      "author_association" : "MEMBER",
      "body" : "66f6868c4331d3c289221441130e6c1fb61bc60c\r\n\r\nthis says `MAX_PACKAGE_WEIGHT_KWU` but the variable is named `MAX_PACKAGE_KWU`",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:49:44Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_WEIGHT_KWU=404` total weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327317351",
      "id" : 1327317351,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHUFn",
      "original_commit_id" : "66f6868c4331d3c289221441130e6c1fb61bc60c",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629000702,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:56:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327317351",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327323660"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:54:50Z",
      "diff_hunk" : "@@ -163,6 +163,17 @@ util::Result<CTxMemPool::setEntries> CTxMemPool::CalculateAncestorsAndCheckLimit\n     int64_t totalSizeWithAncestors = entry_size;\n     setEntries ancestors;\n \n+    // Package itself is busting mempool limits; should be rejected even if no staged_ancestors exist\n+    if (entry_count > static_cast<uint64_t>(limits.ancestor_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many ancestors in package %u [limit: %u]\", entry_count, limits.ancestor_count))};\n+    } else if (entry_count > static_cast<uint64_t>(limits.descendant_count)) {\n+        return util::Error{Untranslated(strprintf(\"too many descendants in package %u [limit: %u]\", entry_count, limits.descendant_count))};\n+    } else if (entry_size > limits.ancestor_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds ancestor size limit %u [limit: %u]\", entry_size, limits.ancestor_size_vbytes))};\n+    } else if (entry_size > limits.descendant_size_vbytes) {\n+        return util::Error{Untranslated(strprintf(\"exceeds descendant size limit for tx %u [limit: %u]\", entry_size, limits.descendant_size_vbytes))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327323660",
      "id" : 1327323660,
      "in_reply_to_id" : 1327086508,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHVoM",
      "original_commit_id" : "8a8a549a330ef3de99a6a3d7c150a6e2ab5ff11e",
      "original_line" : 174,
      "original_position" : 12,
      "original_start_line" : 169,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1629010475,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:54:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327323660",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327327092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092"
         }
      },
      "author_association" : "MEMBER",
      "body" : "fixed",
      "commit_id" : "09b64e543fdd2e76c32b8afbb0a409bef28d696a",
      "created_at" : "2023-09-15T13:57:44Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_WEIGHT_KWU=404` total weight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327327092",
      "id" : 1327327092,
      "in_reply_to_id" : 1327317351,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHWd0",
      "original_commit_id" : "66f6868c4331d3c289221441130e6c1fb61bc60c",
      "original_line" : 21,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629015991,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T13:57:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327327092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327365279"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah hold on, avoiding rounding is good but it does mean that this limit is effectively a few Wu smaller than the default ancestor size limit. (https://github.com/bitcoin/bitcoin/pull/22097#issuecomment-859901930 and https://github.com/bitcoin/bitcoin/pull/22097#issuecomment-862627568) so this statement is untrue.\r\n\r\nI think having this limit denominated in Wu is good and it should be distinct from the ancestor package limits anyway. But I agree with those comments that maybe it's best to not make this limit more restrictive than normal ancestor limits.\r\n\r\nWe can bake in the rounding so this limit is 404000Wu + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR -1) = 404075Wu.\r\n\r\nAlso I think the primary Rationale (if you could edit this bullet point please) should be \"We want package size to be as small as possible to mitigate DoS via package validation. However, we want to make sure that the limit does not restrict ancestor packages that would be allowed if submitted individually.\"",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-15T14:25:48Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327365279",
      "id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHfyf",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629076299,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T14:34:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327365279",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327428231"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Fixed up as suggested, and fixed some inverted static asserts.\r\n\r\nI thought about calling it 405KWU and calling it a day, but I think that would make code history more difficult, so instead stayed precisely as calculated.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-15T15:05:48Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1327428231",
      "id" : 1327428231,
      "in_reply_to_id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PHvKH",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1629174147,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-15T15:05:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1327428231",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331347144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nSince weight to vsize is rounded up, this limit does not need to move up. The total weight will never be more than `vsize * WITNESS_SCALE_FACTOR`. So 404,000 weight units is the correct conversion here.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:29:05Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331347144",
      "id" : 1331347144,
      "line" : 22,
      "node_id" : "PRRC_kwDOABII585PWr7I",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 22,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 11,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331347144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, those comments are incorrect. The rounding *does* mean that this weight limit across multiple transactions is different from the ancestor size limits, but it makes the package limits *less* restrictive, not more restrictive. That's totally fine. No change needed, we can just keep 404,000Wu.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:37:25Z",
      "diff_hunk" : "@@ -18,7 +18,7 @@ tip or some preceding transaction in the package.\n \n The following rules are enforced for all packages:\n \n-* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_SIZE=101KvB` total size\n+* Packages cannot exceed `MAX_PACKAGE_COUNT=25` count and `MAX_PACKAGE_KWU=404` total weight\n    (#20833)\n \n    - *Rationale*: This is already enforced as mempool ancestor/descendant limits. If",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357176",
      "id" : 1331357176,
      "in_reply_to_id" : 1327365279,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PWuX4",
      "original_commit_id" : "204249bb727e23d9e01ae5c3947c2533e893914e",
      "original_line" : 24,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "doc/policy/packages.md",
      "position" : null,
      "pull_request_review_id" : 1635204949,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:37:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357593"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nWeight to vsize rounds up, not down.",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:37:45Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331357593",
      "id" : 1331357593,
      "line" : 30,
      "node_id" : "PRRC_kwDOABII585PWueZ",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 30,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/policy/packages.h",
      "position" : 22,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331357593",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331358919"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 1f25d0e629820a885a9425d8e0115087f8183cb3 \"Replace MAX_PACKAGE_SIZE with MAX_PACKAGE_WEIGHT to avoid vbyte confusion\"\r\n\r\nI think these will be wrong with the weight corrected. Converting vsize to weight may overshoot the weight limit even if the actual weight limit is correct. I think the descendant and ancestor size limits will need to be changed to weight as well?",
      "commit_id" : "97d53ff4c3ede1d1fdc6d93386f14c230b03b98d",
      "created_at" : "2023-09-20T09:38:49Z",
      "diff_hunk" : "@@ -15,18 +15,25 @@\n \n /** Default maximum number of transactions in a package. */\n static constexpr uint32_t MAX_PACKAGE_COUNT{25};\n-/** Default maximum total virtual size of transactions in a package in KvB. */\n-static constexpr uint32_t MAX_PACKAGE_SIZE{101};\n-static_assert(MAX_PACKAGE_SIZE * WITNESS_SCALE_FACTOR * 1000 >= MAX_STANDARD_TX_WEIGHT);\n+/** Default maximum total weight of transactions in a package in weight\n+    to allow for context-less checks. This includes room for weight to vsize rounding error\n+    for all included package transactions to not block transactions that would have all\n+    been accepted individually. */\n+static constexpr uint32_t MAX_PACKAGE_WEIGHT = 404'000 +  MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1);\n+static_assert(MAX_PACKAGE_WEIGHT == 404'075);\n+static_assert(MAX_PACKAGE_WEIGHT >= MAX_STANDARD_TX_WEIGHT);\n \n-// If a package is submitted, it must be within the mempool's ancestor/descendant limits. Since a\n-// submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n+// If a package is to be evaluated, it must be at least as large as the mempool's ancestor/descendant limits,\n+// otherwise transactions that would be individually accepted may be rejected in a package erroneously.\n+// Since a submitted package must be child-with-unconfirmed-parents (all of the transactions are an ancestor\n // of the child), package limits are ultimately bounded by mempool package limits. Ensure that the\n-// defaults reflect this constraint.\n+// defaults reflect this constraint, including weight to vbyte rounding down.\n static_assert(DEFAULT_DESCENDANT_LIMIT >= MAX_PACKAGE_COUNT);\n static_assert(DEFAULT_ANCESTOR_LIMIT >= MAX_PACKAGE_COUNT);\n-static_assert(DEFAULT_ANCESTOR_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n-static_assert(DEFAULT_DESCENDANT_SIZE_LIMIT_KVB >= MAX_PACKAGE_SIZE);\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_ANCESTOR_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));\n+static_assert(MAX_PACKAGE_WEIGHT >=\n+    DEFAULT_DESCENDANT_SIZE_LIMIT_KVB * WITNESS_SCALE_FACTOR * 1000 + MAX_PACKAGE_COUNT * (WITNESS_SCALE_FACTOR - 1));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28471#discussion_r1331358919",
      "id" : 1331358919,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585PWuzH",
      "original_commit_id" : "1f25d0e629820a885a9425d8e0115087f8183cb3",
      "original_line" : 36,
      "original_position" : 30,
      "original_start_line" : 33,
      "path" : "src/policy/packages.h",
      "position" : 30,
      "pull_request_review_id" : 1635188756,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28471",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 33,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T09:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331358919",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   }
]
