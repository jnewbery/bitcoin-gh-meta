[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29623).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991345405) |\n| Stale ACK | [alfonsoromanz](https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991824028), [dergoegge](https://github.com/bitcoin/bitcoin/pull/29623#pullrequestreview-1943595639), [sipa](https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2004415109), [vasild](https://github.com/bitcoin/bitcoin/pull/29623#pullrequestreview-1951424515) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29494](https://github.com/bitcoin/bitcoin/pull/29494) (build: Assume HAVE_CONFIG_H, Add IWYU pragma keep to bitcoin-config.h includes by maflcko)\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n* [#29346](https://github.com/bitcoin/bitcoin/pull/29346) (Stratum v2 Noise Protocol by Sjors)\n* [#27052](https://github.com/bitcoin/bitcoin/pull/27052) (test: rpc: add last block announcement time to getpeerinfo result by LarryRuane)\n* [#26966](https://github.com/bitcoin/bitcoin/pull/26966) (index: blockfilter initial sync speedup, parallelize process by furszy)\n* [#15218](https://github.com/bitcoin/bitcoin/pull/15218) (validation: sync chainstate to disk after syncing to tip by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-03-11T18:18:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1989137776",
      "id" : 1989137776,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852j9Vw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989137776/reactions"
      },
      "updated_at" : "2024-03-21T19:14:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989137776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/22527379458</sub>",
      "created_at" : "2024-03-11T18:26:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1989159135",
      "id" : 1989159135,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852kCjf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989159135/reactions"
      },
      "updated_at" : "2024-03-11T18:26:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989159135",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\nThanks for picking this up!",
      "created_at" : "2024-03-12T10:10:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991258113",
      "id" : 1991258113,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852sDAB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991258113/reactions"
      },
      "updated_at" : "2024-03-12T10:10:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991258113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2024-03-12T10:46:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991345405",
      "id" : 1991345405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852sYT9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991345405/reactions"
      },
      "updated_at" : "2024-03-12T10:46:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991345405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521434495"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521434495"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could you add a fuzz test for `TimeOffsets` to replace the timedata one?",
      "commit_id" : "59e7dbdd332fd63e5a21b833a7a439f748c76f2f",
      "created_at" : "2024-03-12T13:07:20Z",
      "diff_hunk" : "@@ -1,31 +0,0 @@\n-// Copyright (c) 2020-2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521434495",
      "id" : 1521434495,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585arz9_",
      "original_commit_id" : "55b476b015d3a79ec5ea176247d2a70163cd034b",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timedata.cpp",
      "position" : 1,
      "pull_request_review_id" : 1931011543,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521434495/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T13:07:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521434495",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521538653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521538653"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Can do, but given how simple the interface is I think it wouldn't be anything more than the below (untested)? Could e.g. add the `.Size()` method back but adding it just for fuzzing might not be ideal?\r\n\r\n<details>\r\n<summary>git diff on 55b476b015</summary>\r\n\r\n```diff\r\ndiff --git a/src/Makefile.test.include b/src/Makefile.test.include\r\nindex c77056f29c..c20b531032 100644\r\n--- a/src/Makefile.test.include\r\n+++ b/src/Makefile.test.include\r\n@@ -381,6 +381,7 @@ test_fuzz_fuzz_SOURCES = \\\r\n  test/fuzz/string.cpp \\\r\n  test/fuzz/strprintf.cpp \\\r\n  test/fuzz/system.cpp \\\r\n+ test/fuzz/timeoffsets.cpp \\\r\n  test/fuzz/torcontrol.cpp \\\r\n  test/fuzz/transaction.cpp \\\r\n  test/fuzz/tx_in.cpp \\\r\ndiff --git a/src/test/fuzz/timeoffsets.cpp b/src/test/fuzz/timeoffsets.cpp\r\nnew file mode 100644\r\nindex 0000000000..f0d2a8f739\r\n--- /dev/null\r\n+++ b/src/test/fuzz/timeoffsets.cpp\r\n@@ -0,0 +1,22 @@\r\n+// Copyright (c) 2020-present The Bitcoin Core developers\r\n+// Distributed under the MIT software license, see the accompanying\r\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n+\r\n+#include <test/fuzz/FuzzedDataProvider.h>\r\n+#include <test/fuzz/fuzz.h>\r\n+#include <test/fuzz/util.h>\r\n+#include <node/timeoffsets.h>\r\n+\r\n+#include <chrono>\r\n+\r\n+\r\n+FUZZ_TARGET(timeoffsets)\r\n+{\r\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\r\n+    TimeOffsets offsets{};\r\n+    while (fuzzed_data_provider.remaining_bytes() > 0) {\r\n+        (void)offsets.Median();\r\n+        offsets.Add(std::chrono::seconds{fuzzed_data_provider.ConsumeIntegral<int64_t>()});\r\n+        offsets.WarnIfOutOfSync();\r\n+    }\r\n+}\r\n\r\n```\r\n</details>\r\n",
      "commit_id" : "59e7dbdd332fd63e5a21b833a7a439f748c76f2f",
      "created_at" : "2024-03-12T14:09:21Z",
      "diff_hunk" : "@@ -1,31 +0,0 @@\n-// Copyright (c) 2020-2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521538653",
      "id" : 1521538653,
      "in_reply_to_id" : 1521434495,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585asNZd",
      "original_commit_id" : "55b476b015d3a79ec5ea176247d2a70163cd034b",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timedata.cpp",
      "position" : 1,
      "pull_request_review_id" : 1931182887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521538653/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T14:09:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521538653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to:\r\n- address a [thread safety analysis issue](https://github.com/bitcoin/bitcoin/pull/29623/checks?check_run_id=22527737631) by annotating `WarnIfOutOfSync()` with a `EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)` \r\n- fix [failing functional test](https://github.com/bitcoin/bitcoin/pull/29623/checks?check_run_id=22527737628) by resetting node_miner's mocktime before connecting to the next outbound\r\n- rebase to latest master to fix native macos job",
      "created_at" : "2024-03-12T14:09:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991741743",
      "id" : 1991741743,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852t5Ev",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991741743/reactions"
      },
      "updated_at" : "2024-03-12T14:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991741743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521564417"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521564417"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> but given how simple the interface is I think it wouldn't be anything more than the below\r\n\r\nThat's good enough. We just want the code to be under test, in case we have change it in the future.",
      "commit_id" : "59e7dbdd332fd63e5a21b833a7a439f748c76f2f",
      "created_at" : "2024-03-12T14:24:19Z",
      "diff_hunk" : "@@ -1,31 +0,0 @@\n-// Copyright (c) 2020-2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521564417",
      "id" : 1521564417,
      "in_reply_to_id" : 1521434495,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585asTsB",
      "original_commit_id" : "55b476b015d3a79ec5ea176247d2a70163cd034b",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timedata.cpp",
      "position" : 1,
      "pull_request_review_id" : 1931224627,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521564417/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T14:24:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521564417",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Code review ACK 55b476b015d3a79ec5ea176247d2a70163cd034b\r\n\r\nI also:\r\n- Ran the unit test, which is passing\r\n- Ran the functional test, which is passing\r\n- Verified that the peer window now shows the offset of each peer.\r\n\r\n<img width=\"300\" alt=\"Screenshot 2024-03-12 at 11 36 48\" src=\"https://github.com/bitcoin/bitcoin/assets/19962151/7cd58278-085c-4047-b43f-e71b538096f3\">\r\n<img width=\"303\" alt=\"Screenshot 2024-03-12 at 11 37 20\" src=\"https://github.com/bitcoin/bitcoin/assets/19962151/84801775-c730-4f03-bbd2-87571124a73d\">\r\n<img width=\"250\" alt=\"Screenshot 2024-03-12 at 11 06 07\" src=\"https://github.com/bitcoin/bitcoin/assets/19962151/32f3256e-fb57-4b69-af4b-97ecdfee9017\">\r\n ",
      "created_at" : "2024-03-12T14:46:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1991824028",
      "id" : 1991824028,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852uNKc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991824028/reactions"
      },
      "updated_at" : "2024-03-12T14:46:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991824028",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19962151?v=4",
         "events_url" : "https://api.github.com/users/alfonsoromanz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/alfonsoromanz/followers",
         "following_url" : "https://api.github.com/users/alfonsoromanz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/alfonsoromanz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/alfonsoromanz",
         "id" : 19962151,
         "login" : "alfonsoromanz",
         "node_id" : "MDQ6VXNlcjE5OTYyMTUx",
         "organizations_url" : "https://api.github.com/users/alfonsoromanz/orgs",
         "received_events_url" : "https://api.github.com/users/alfonsoromanz/received_events",
         "repos_url" : "https://api.github.com/users/alfonsoromanz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/alfonsoromanz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/alfonsoromanz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/alfonsoromanz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521798433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521798433"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done. I was a bit worried `WarnIfOutOfSync()` outputting to stderr would mess with the fuzzer (as [here](https://github.com/bitcoin/bitcoin/pull/29623/commits/48cc160d70e4d918f5e2e5440b0ab5891499f5cf)), but running it locally seems to work fine so far, not sure if the appropriate paths have been hit already though.\r\n\r\nResolving for now.",
      "commit_id" : "59e7dbdd332fd63e5a21b833a7a439f748c76f2f",
      "created_at" : "2024-03-12T16:39:25Z",
      "diff_hunk" : "@@ -1,31 +0,0 @@\n-// Copyright (c) 2020-2021 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521798433",
      "id" : 1521798433,
      "in_reply_to_id" : 1521434495,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585atM0h",
      "original_commit_id" : "55b476b015d3a79ec5ea176247d2a70163cd034b",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timedata.cpp",
      "position" : 1,
      "pull_request_review_id" : 1931607697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521798433/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-12T16:39:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1521798433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force pushed to:\r\n- remove dependency on C++20's `std::ranges::sort` which is [not yet supported](https://github.com/bitcoin/bitcoin/pull/29623/checks?check_run_id=22558502170) by the `no wallet, libbitcoinkernel` ci task\r\n- add `timeoffsets` fuzz target as per [review comment](https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1521434495)\r\n- improve includes and copyright headers\r\n\r\n> Verified that the peer window now shows the offset of each peer.\r\n\r\nFYI this is not new functionality, you should see the same behaviour on `master`.",
      "created_at" : "2024-03-12T16:43:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1992103130",
      "id" : 1992103130,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5852vRTa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992103130/reactions"
      },
      "updated_at" : "2024-03-12T16:49:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992103130",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, I love simplifications or refactors that are net removing code (+213 â363).",
      "created_at" : "2024-03-13T08:02:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-1993768211",
      "id" : 1993768211,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII58521n0T",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1993768211/reactions"
      },
      "updated_at" : "2024-03-13T08:02:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1993768211",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Previously, we would only calculate the time offset from the first 199 outbound peers that we connected to. This limitation is now removed, and we have a proper rolling calculation. I've reduced the set to 50 outbound peers, which seems plenty.\r\nPreviously, we would automatically use the network-adjusted time if the difference was < 70 mins, and warn the user if the difference was larger than that. Since there is no longer any automated time adjustment, I've changed the warning threshold to 20 minutes (which is an arbitrary number).\r\n\r\non the 2 value selections (50 outbound peers):\r\n- 50 sounds reasonable, to be fair best would be to add timestamp in `m_outbound_time_offsets` from `FEELER` connection, itâs an outbound connection type per se. shuffling things more at the AS-level.\r\n- 20 min, i can suggest to pick up 10 min to match average interval-block-time of ~10 min",
      "created_at" : "2024-03-16T17:14:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2002051915",
      "id" : 2002051915,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5853VONL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002051915/reactions"
      },
      "updated_at" : "2024-03-16T17:14:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002051915",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23310655?v=4",
         "events_url" : "https://api.github.com/users/ariard/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ariard/followers",
         "following_url" : "https://api.github.com/users/ariard/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ariard/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ariard",
         "id" : 23310655,
         "login" : "ariard",
         "node_id" : "MDQ6VXNlcjIzMzEwNjU1",
         "organizations_url" : "https://api.github.com/users/ariard/orgs",
         "received_events_url" : "https://api.github.com/users/ariard/received_events",
         "repos_url" : "https://api.github.com/users/ariard/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ariard/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ariard/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ariard"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK 5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "created_at" : "2024-03-17T16:52:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2002537033",
      "id" : 2002537033,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5853XEpJ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002537033/reactions"
      },
      "updated_at" : "2024-03-17T16:52:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002537033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528024055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024055"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`count` isn't type-safe. If the type were to change, the RPC result would silently change as well. It may be better to use a casting tick counter `Ticks<>`.",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:03:08Z",
      "diff_hunk" : "@@ -239,7 +238,7 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytessent\", stats.nSendBytes);\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", count_seconds(stats.m_connected));\n-        obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n+        obj.pushKV(\"timeoffset\", statestats.time_offset.count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528024055",
      "id" : 1528024055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bE8v3",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 241,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1942197813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528024823"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024823"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Same",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:03:44Z",
      "diff_hunk" : "@@ -679,9 +678,10 @@ static RPCHelpMan getnetworkinfo()\n         obj.pushKV(\"localservicesnames\", GetServicesNames(services));\n     }\n     if (node.peerman) {\n-        obj.pushKV(\"localrelay\", !node.peerman->IgnoresIncomingTxs());\n+        auto peerman_info{node.peerman->GetInfo()};\n+        obj.pushKV(\"localrelay\", !peerman_info.ignores_incoming_txs);\n+        obj.pushKV(\"timeoffset\", peerman_info.median_outbound_time_offset.count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528024823",
      "id" : 1528024823,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bE873",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 683,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1942197813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024823/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528024823",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528025910"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528025910"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(See also the line below)",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:04:34Z",
      "diff_hunk" : "@@ -239,7 +238,7 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytessent\", stats.nSendBytes);\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", count_seconds(stats.m_connected));\n-        obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n+        obj.pushKV(\"timeoffset\", statestats.time_offset.count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528025910",
      "id" : 1528025910,
      "in_reply_to_id" : 1528024055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bE9M2",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 241,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1942197813,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528025910/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528025910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528068942"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528068942"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The debug log should not log translated messages, but the original ones",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:34:59Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return {0s};\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.translated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528068942",
      "id" : 1528068942,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bFHtO",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942256562,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528068942/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:34:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528068942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528069606"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528069606"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: \r\n```suggestion\r\n    if (m_offsets.size() < 5) return 0s;\r\n```",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:35:28Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return {0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528069606",
      "id" : 1528069606,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bFH3m",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942257420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528069606/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528069606",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528075169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528075169"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it is fine to keep calling the target `timedata`, to avoid deleting a fuzz input folder and adding a fuzz input folder, with similar data.",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:39:30Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+\n+#include <chrono>\n+\n+\n+FUZZ_TARGET(timeoffsets)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528075169",
      "id" : 1528075169,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bFJOh",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942257420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528075169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528075169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528076376"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528076376"
         }
      },
      "author_association" : "MEMBER",
      "body" : "in fuzz tests, you'll have to use LIMITED_WHILE. Otherwise, the fuzz target will never terminate, if the fuzz input is unlimited in length.",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T08:40:16Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+\n+#include <chrono>\n+\n+\n+FUZZ_TARGET(timeoffsets)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+    TimeOffsets offsets{};\n+    while (fuzzed_data_provider.remaining_bytes() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528076376",
      "id" : 1528076376,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bFJhY",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942257420,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528076376/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T08:41:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528076376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528391847"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528391847"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good point, I've replaced all new usage of `count()` with `Ticks<std::chrono::seconds>`, thanks. ",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T11:43:53Z",
      "diff_hunk" : "@@ -239,7 +238,7 @@ static RPCHelpMan getpeerinfo()\n         obj.pushKV(\"bytessent\", stats.nSendBytes);\n         obj.pushKV(\"bytesrecv\", stats.nRecvBytes);\n         obj.pushKV(\"conntime\", count_seconds(stats.m_connected));\n-        obj.pushKV(\"timeoffset\", stats.nTimeOffset);\n+        obj.pushKV(\"timeoffset\", statestats.time_offset.count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528391847",
      "id" : 1528391847,
      "in_reply_to_id" : 1528024055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGWin",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 241,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528391847/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528391847",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528405153"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528405153"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, now using `LIMITED_WHILE(..., 4'000)` to keep the same number of iterations as the max in the previous fuzz test.",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T11:54:32Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+\n+#include <chrono>\n+\n+\n+FUZZ_TARGET(timeoffsets)\n+{\n+    FuzzedDataProvider fuzzed_data_provider(buffer.data(), buffer.size());\n+    TimeOffsets offsets{};\n+    while (fuzzed_data_provider.remaining_bytes() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528405153",
      "id" : 1528405153,
      "in_reply_to_id" : 1528076376,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGZyh",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 17,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528405153/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528405153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528408296"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408296"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, changed",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T11:56:56Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return {0s};\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.translated);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528408296",
      "id" : 1528408296,
      "in_reply_to_id" : 1528068942,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGajo",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 48,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408296/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408296",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528408431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408431"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, changed",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T11:57:04Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return {0s};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528408431",
      "id" : 1528408431,
      "in_reply_to_id" : 1528069606,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGalv",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 33,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408431/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528408431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528426601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528426601"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done.",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T12:10:39Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+\n+#include <chrono>\n+\n+\n+FUZZ_TARGET(timeoffsets)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528426601",
      "id" : 1528426601,
      "in_reply_to_id" : 1528075169,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGfBp",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528426601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528426601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528427747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528427747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "64c8fee28ede245a1bfe0e8fb64c0bcdb587585e",
      "created_at" : "2024-03-18T12:11:34Z",
      "diff_hunk" : "@@ -679,9 +678,10 @@ static RPCHelpMan getnetworkinfo()\n         obj.pushKV(\"localservicesnames\", GetServicesNames(services));\n     }\n     if (node.peerman) {\n-        obj.pushKV(\"localrelay\", !node.peerman->IgnoresIncomingTxs());\n+        auto peerman_info{node.peerman->GetInfo()};\n+        obj.pushKV(\"localrelay\", !peerman_info.ignores_incoming_txs);\n+        obj.pushKV(\"timeoffset\", peerman_info.median_outbound_time_offset.count());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528427747",
      "id" : 1528427747,
      "in_reply_to_id" : 1528024823,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bGfTj",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 683,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1942726434,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528427747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T12:24:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528427747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Force-pushed to revert the [fuzz harness name change](https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528075169), because for a couple of commits, we now have two harnesses with the same name - until the old one is removed in `Remove timedata` commit. I've [opened a PR](https://github.com/bitcoin-core/qa-assets/pull/178) in `qa-assets` to rename the input folder (thx dergoegge for the suggestion).",
      "created_at" : "2024-03-18T14:00:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2004000023",
      "id" : 2004000023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5853cp0X",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2004000023/reactions"
      },
      "updated_at" : "2024-03-18T17:39:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2004000023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528623473"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528623473"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "[Reverted back to `timeoffsets`](https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2004000023)",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-18T14:01:09Z",
      "diff_hunk" : "@@ -0,0 +1,22 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+\n+#include <chrono>\n+\n+\n+FUZZ_TARGET(timeoffsets)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1528623473",
      "id" : 1528623473,
      "in_reply_to_id" : 1528075169,
      "line" : 13,
      "node_id" : "PRRC_kwDOABII585bHPFx",
      "original_commit_id" : "5c8e71cb2b827586efd052a87ccc463c99387fcf",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : 13,
      "pull_request_review_id" : 1943170577,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528623473/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-18T14:01:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1528623473",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "utACK a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-18T16:40:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2004415109",
      "id" : 2004415109,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5853ePKF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2004415109/reactions"
      },
      "updated_at" : "2024-03-18T16:40:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2004415109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530164745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530164745"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It would be more useful to print the offset and the threshold.",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T11:14:19Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530164745",
      "id" : 1530164745,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585bNHYJ",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 47,
      "pull_request_review_id" : 1945882168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530164745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T17:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530164745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530170447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This way the warning will be printed just once in the lifetime of the process. If the user does something in an attempt to resolve the issue, how would they know that the issue is resolved? Usually if a message is logged every, e.g. 10 minutes (to avoid flooding the log), the disappearance of the message is an indication that the problem is resolved.\r\n\r\nIs there a way for the user to see the median network time, as perceived by his node? If yes, then they can manually compare.\r\n\r\nAlso, the time offset issue is one that can come and go as time passes. Imagine a `bitcoind` running for 1 month. It had issues with the time soon after it was started which the operator has resolved. 1 month later the issues resurface - there is no warning or indication about it?\r\n\r\nMaybe replace that `bool` with a timestamp of the last log and print the error message if the last log was e.g. 10 minutes ago?",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T11:19:12Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>\n+\n+class TimeOffsets\n+{\n+private:\n+    static constexpr size_t N{50};\n+    //! Minimum difference between system and network time for a warning to be raised.\n+    static constexpr std::chrono::minutes m_warn_threshold{10};\n+    mutable std::atomic<bool> m_warning_emitted{false};  // Avoid flooding the user with warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530170447",
      "id" : 1530170447,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585bNIxP",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : 21,
      "pull_request_review_id" : 1945882168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-19T17:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530170447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530801883"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530801883"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Once `g_timeoffset_warning` is set to `true` it will never be set back to `false` and this will warning will persist even after the problem is resolved?",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T17:27:16Z",
      "diff_hunk" : "@@ -56,6 +62,11 @@ bilingual_str GetWarnings(bool verbose)\n         warnings_verbose.emplace_back(warnings_concise);\n     }\n \n+    if (g_timeoffset_warning) {\n+        warnings_concise = _(\"Your computer's date and time appear out of sync with the network, this may lead to consensus failure. Please ensure it is correct.\");\n+        warnings_verbose.emplace_back(warnings_concise);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530801883",
      "id" : 1530801883,
      "line" : 68,
      "node_id" : "PRRC_kwDOABII585bPi7b",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 68,
      "original_position" : 27,
      "original_start_line" : 65,
      "path" : "src/warnings.cpp",
      "position" : 27,
      "pull_request_review_id" : 1945882168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530801883/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 65,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T17:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530801883",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530818676"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530818676"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could squash commits:\r\n587349072f `[net processing] Use TimeOffsets to warn when node is out of sync`\r\nd790e776ca `[test] reset miner mocktime in maxtipage to prevent time offset warning`\r\n",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T17:37:15Z",
      "diff_hunk" : "@@ -43,6 +43,10 @@ def test_maxtipage(self, maxtipage, set_parameter=True, test_deltas=True):\n         self.generate(node_miner, 1)\n         assert_equal(node_ibd.getblockchaininfo()['initialblockdownload'], False)\n \n+        # reset time to system time so we don't have a time offset with the ibd node the next\n+        # time we connect to it, ensuring TimeOffsets::WarnIfOutOfSync() doesn't output to stderr\n+        node_miner.setmocktime(0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530818676",
      "id" : 1530818676,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII585bPnB0",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/feature_maxtipage.py",
      "position" : 6,
      "pull_request_review_id" : 1945882168,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530818676/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-19T17:42:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530818676",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530832723"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530832723"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/pull/4526#issuecomment-49115517\r\nI wonder what those \"attacks\" are? @gmaxwell ",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T17:47:39Z",
      "diff_hunk" : "@@ -1,116 +0,0 @@\n-// Copyright (c) 2014-2022 The Bitcoin Core developers\n-// Distributed under the MIT software license, see the accompanying\n-// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n-\n-#if defined(HAVE_CONFIG_H)\n-#include <config/bitcoin-config.h>\n-#endif\n-\n-#include <timedata.h>\n-\n-#include <common/args.h>\n-#include <logging.h>\n-#include <netaddress.h>\n-#include <node/interface_ui.h>\n-#include <sync.h>\n-#include <tinyformat.h>\n-#include <util/translation.h>\n-#include <warnings.h>\n-\n-static GlobalMutex g_timeoffset_mutex;\n-static int64_t nTimeOffset GUARDED_BY(g_timeoffset_mutex) = 0;\n-\n-/**\n- * \"Never go to sea with two chronometers; take one or three.\"\n- * Our three time sources are:\n- *  - System clock\n- *  - Median of other nodes clocks\n- *  - The user (asking the user to fix the system clock if the first two disagree)\n- */\n-int64_t GetTimeOffset()\n-{\n-    LOCK(g_timeoffset_mutex);\n-    return nTimeOffset;\n-}\n-\n-#define BITCOIN_TIMEDATA_MAX_SAMPLES 200\n-\n-static std::set<CNetAddr> g_sources;\n-static CMedianFilter<int64_t> g_time_offsets{BITCOIN_TIMEDATA_MAX_SAMPLES, 0};\n-static bool g_warning_emitted;\n-\n-void AddTimeData(const CNetAddr& ip, int64_t nOffsetSample)\n-{\n-    LOCK(g_timeoffset_mutex);\n-    // Ignore duplicates\n-    if (g_sources.size() == BITCOIN_TIMEDATA_MAX_SAMPLES)\n-        return;\n-    if (!g_sources.insert(ip).second)\n-        return;\n-\n-    // Add data\n-    g_time_offsets.input(nOffsetSample);\n-    LogPrint(BCLog::NET, \"added time data, samples %d, offset %+d (%+d minutes)\\n\", g_time_offsets.size(), nOffsetSample, nOffsetSample / 60);\n-\n-    // There is a known issue here (see issue #4521):\n-    //\n-    // - The structure g_time_offsets contains up to 200 elements, after which\n-    // any new element added to it will not increase its size, replacing the\n-    // oldest element.\n-    //\n-    // - The condition to update nTimeOffset includes checking whether the\n-    // number of elements in g_time_offsets is odd, which will never happen after\n-    // there are 200 elements.\n-    //\n-    // But in this case the 'bug' is protective against some attacks, and may\n-    // actually explain why we've never seen attacks which manipulate the\n-    // clock offset.\n-    //\n-    // So we should hold off on fixing this and clean it up as part of\n-    // a timing cleanup that strengthens it in a number of other ways.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1530832723",
      "id" : 1530832723,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII585bPqdT",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 70,
      "original_position" : 70,
      "original_start_line" : 55,
      "path" : "src/timedata.cpp",
      "position" : 70,
      "pull_request_review_id" : 1946972313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530832723/reactions"
      },
      "side" : "LEFT",
      "start_line" : 55,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T17:47:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1530832723",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531234359"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234359"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "For GUI and RPC warnings, this PR pretty much preserves the current behaviour: GUI messagebox gets shown only once (until restarted), and the RPC will keep firing forever (on master, it will be reset when another `SetMiscWarning()` is called, but in practice I don't think that really happens frequently).\r\n\r\nFor the debug log, however, this PR quite significantly improves things by\r\n1) doing an actual rolling calculation, which means that if clocks start drifting, the user will eventually still get a warning, whereas on master the time adjustment system completely stops after the first 199 outbound handshakes\r\n2) producing repeated log warnings (one for every outbound handshake) for as long _and only for as long_ as the median time offset exceeds the threshold.\r\n\r\nWhile I agree that for GUI & RPC things should be improved, this PR is no regression, and I'd rather it be done in a separate PR. Avoiding flooding seems less trivial to me than adding a simple timer: having a GUI message popup every 10 minutes is quite annoying if someone decides to flood the network with nodes with wrong clocks.\r\n\r\n> Is there a way for the user to see the median network time, as perceived by his node?\r\n\r\nyes, through `getnetworkinfo` a user can see the median offset\r\n\r\n> 1 month later the issues resurface - there is no warning or indication about it?\r\n\r\nthere will be warning logs every time we handshake with an outbound peer and the median timeoffset exceeds the threshold",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T23:08:41Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>\n+\n+class TimeOffsets\n+{\n+private:\n+    static constexpr size_t N{50};\n+    //! Minimum difference between system and network time for a warning to be raised.\n+    static constexpr std::chrono::minutes m_warn_threshold{10};\n+    mutable std::atomic<bool> m_warning_emitted{false};  // Avoid flooding the user with warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531234359",
      "id" : 1531234359,
      "in_reply_to_id" : 1530170447,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585bRMg3",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : 21,
      "pull_request_review_id" : 1947571374,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234359/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-19T23:08:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234359",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531234992"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234992"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Correct, as is roughly the current behaviour, as per https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531234359",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T23:09:49Z",
      "diff_hunk" : "@@ -56,6 +62,11 @@ bilingual_str GetWarnings(bool verbose)\n         warnings_verbose.emplace_back(warnings_concise);\n     }\n \n+    if (g_timeoffset_warning) {\n+        warnings_concise = _(\"Your computer's date and time appear out of sync with the network, this may lead to consensus failure. Please ensure it is correct.\");\n+        warnings_verbose.emplace_back(warnings_concise);\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531234992",
      "id" : 1531234992,
      "in_reply_to_id" : 1530801883,
      "line" : 68,
      "node_id" : "PRRC_kwDOABII585bRMqw",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 68,
      "original_position" : 27,
      "original_start_line" : 65,
      "path" : "src/warnings.cpp",
      "position" : 27,
      "pull_request_review_id" : 1947572252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234992/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 65,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T23:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531234992",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531235380"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235380"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't know myself, but I'd argue it's probably not relevant anymore as consensus dependencies on network-adjusted time have been removed",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T23:10:31Z",
      "diff_hunk" : "@@ -1,116 +0,0 @@\n-// Copyright (c) 2014-2022 The Bitcoin Core developers\n-// Distributed under the MIT software license, see the accompanying\n-// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n-\n-#if defined(HAVE_CONFIG_H)\n-#include <config/bitcoin-config.h>\n-#endif\n-\n-#include <timedata.h>\n-\n-#include <common/args.h>\n-#include <logging.h>\n-#include <netaddress.h>\n-#include <node/interface_ui.h>\n-#include <sync.h>\n-#include <tinyformat.h>\n-#include <util/translation.h>\n-#include <warnings.h>\n-\n-static GlobalMutex g_timeoffset_mutex;\n-static int64_t nTimeOffset GUARDED_BY(g_timeoffset_mutex) = 0;\n-\n-/**\n- * \"Never go to sea with two chronometers; take one or three.\"\n- * Our three time sources are:\n- *  - System clock\n- *  - Median of other nodes clocks\n- *  - The user (asking the user to fix the system clock if the first two disagree)\n- */\n-int64_t GetTimeOffset()\n-{\n-    LOCK(g_timeoffset_mutex);\n-    return nTimeOffset;\n-}\n-\n-#define BITCOIN_TIMEDATA_MAX_SAMPLES 200\n-\n-static std::set<CNetAddr> g_sources;\n-static CMedianFilter<int64_t> g_time_offsets{BITCOIN_TIMEDATA_MAX_SAMPLES, 0};\n-static bool g_warning_emitted;\n-\n-void AddTimeData(const CNetAddr& ip, int64_t nOffsetSample)\n-{\n-    LOCK(g_timeoffset_mutex);\n-    // Ignore duplicates\n-    if (g_sources.size() == BITCOIN_TIMEDATA_MAX_SAMPLES)\n-        return;\n-    if (!g_sources.insert(ip).second)\n-        return;\n-\n-    // Add data\n-    g_time_offsets.input(nOffsetSample);\n-    LogPrint(BCLog::NET, \"added time data, samples %d, offset %+d (%+d minutes)\\n\", g_time_offsets.size(), nOffsetSample, nOffsetSample / 60);\n-\n-    // There is a known issue here (see issue #4521):\n-    //\n-    // - The structure g_time_offsets contains up to 200 elements, after which\n-    // any new element added to it will not increase its size, replacing the\n-    // oldest element.\n-    //\n-    // - The condition to update nTimeOffset includes checking whether the\n-    // number of elements in g_time_offsets is odd, which will never happen after\n-    // there are 200 elements.\n-    //\n-    // But in this case the 'bug' is protective against some attacks, and may\n-    // actually explain why we've never seen attacks which manipulate the\n-    // clock offset.\n-    //\n-    // So we should hold off on fixing this and clean it up as part of\n-    // a timing cleanup that strengthens it in a number of other ways.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531235380",
      "id" : 1531235380,
      "in_reply_to_id" : 1530832723,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII585bRMw0",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 70,
      "original_position" : 70,
      "original_start_line" : 55,
      "path" : "src/timedata.cpp",
      "position" : 70,
      "pull_request_review_id" : 1947572802,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235380/reactions"
      },
      "side" : "LEFT",
      "start_line" : 55,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-03-19T23:10:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235380",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531235768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't immediately see what practical benefit it would offer to the user (but I'm happy to add it if I need to re-touch (or in follow-up)",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-19T23:11:12Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1531235768",
      "id" : 1531235768,
      "in_reply_to_id" : 1530164745,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585bRM24",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 47,
      "pull_request_review_id" : 1947573322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-20T16:46:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1531235768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1532435284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532435284"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Right, it dawned on me that previously we would assume the network's time, ie \"adjust\" our time according to the network and this has been removed, so \"the network\" can no longer mess with our clock. Sorry for the noise.",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-20T16:38:06Z",
      "diff_hunk" : "@@ -1,116 +0,0 @@\n-// Copyright (c) 2014-2022 The Bitcoin Core developers\n-// Distributed under the MIT software license, see the accompanying\n-// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n-\n-#if defined(HAVE_CONFIG_H)\n-#include <config/bitcoin-config.h>\n-#endif\n-\n-#include <timedata.h>\n-\n-#include <common/args.h>\n-#include <logging.h>\n-#include <netaddress.h>\n-#include <node/interface_ui.h>\n-#include <sync.h>\n-#include <tinyformat.h>\n-#include <util/translation.h>\n-#include <warnings.h>\n-\n-static GlobalMutex g_timeoffset_mutex;\n-static int64_t nTimeOffset GUARDED_BY(g_timeoffset_mutex) = 0;\n-\n-/**\n- * \"Never go to sea with two chronometers; take one or three.\"\n- * Our three time sources are:\n- *  - System clock\n- *  - Median of other nodes clocks\n- *  - The user (asking the user to fix the system clock if the first two disagree)\n- */\n-int64_t GetTimeOffset()\n-{\n-    LOCK(g_timeoffset_mutex);\n-    return nTimeOffset;\n-}\n-\n-#define BITCOIN_TIMEDATA_MAX_SAMPLES 200\n-\n-static std::set<CNetAddr> g_sources;\n-static CMedianFilter<int64_t> g_time_offsets{BITCOIN_TIMEDATA_MAX_SAMPLES, 0};\n-static bool g_warning_emitted;\n-\n-void AddTimeData(const CNetAddr& ip, int64_t nOffsetSample)\n-{\n-    LOCK(g_timeoffset_mutex);\n-    // Ignore duplicates\n-    if (g_sources.size() == BITCOIN_TIMEDATA_MAX_SAMPLES)\n-        return;\n-    if (!g_sources.insert(ip).second)\n-        return;\n-\n-    // Add data\n-    g_time_offsets.input(nOffsetSample);\n-    LogPrint(BCLog::NET, \"added time data, samples %d, offset %+d (%+d minutes)\\n\", g_time_offsets.size(), nOffsetSample, nOffsetSample / 60);\n-\n-    // There is a known issue here (see issue #4521):\n-    //\n-    // - The structure g_time_offsets contains up to 200 elements, after which\n-    // any new element added to it will not increase its size, replacing the\n-    // oldest element.\n-    //\n-    // - The condition to update nTimeOffset includes checking whether the\n-    // number of elements in g_time_offsets is odd, which will never happen after\n-    // there are 200 elements.\n-    //\n-    // But in this case the 'bug' is protective against some attacks, and may\n-    // actually explain why we've never seen attacks which manipulate the\n-    // clock offset.\n-    //\n-    // So we should hold off on fixing this and clean it up as part of\n-    // a timing cleanup that strengthens it in a number of other ways.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1532435284",
      "id" : 1532435284,
      "in_reply_to_id" : 1530832723,
      "line" : 70,
      "node_id" : "PRRC_kwDOABII585bVxtU",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 70,
      "original_position" : 70,
      "original_start_line" : 55,
      "path" : "src/timedata.cpp",
      "position" : 70,
      "pull_request_review_id" : 1949459384,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532435284/reactions"
      },
      "side" : "LEFT",
      "start_line" : 55,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-03-20T16:38:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532435284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1532450956"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532450956"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "See https://github.com/stickies-v/bitcoin/commit/0146553aaab53b6092bb54e0b2c71282fef44787 for a potential implementation on turning {GUI, RPC} warnings off again when the offsets fall within the threshold again. Happy to open a follow-up PR with this if you like the approach, I think this PR is too close to merge to overhaul it again as per my previous comment, what do you think?",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-20T16:45:38Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>\n+\n+class TimeOffsets\n+{\n+private:\n+    static constexpr size_t N{50};\n+    //! Minimum difference between system and network time for a warning to be raised.\n+    static constexpr std::chrono::minutes m_warn_threshold{10};\n+    mutable std::atomic<bool> m_warning_emitted{false};  // Avoid flooding the user with warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1532450956",
      "id" : 1532450956,
      "in_reply_to_id" : 1530170447,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585bV1iM",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : 21,
      "pull_request_review_id" : 1949484941,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532450956/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-20T16:45:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1532450956",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1533496726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533496726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"Your computer's clock is 765 seconds behind the network. The difference is more than 600 seconds and this may lead to a consensus failure. Please ensure your computer's clock is correct.\"",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-21T09:21:02Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1533496726",
      "id" : 1533496726,
      "in_reply_to_id" : 1530164745,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585bZ02W",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 47,
      "pull_request_review_id" : 1951384235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533496726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-21T09:21:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533496726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1533509979"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533509979"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> what do you think?\r\n\r\nI agree.\r\n\r\nI would be happy to review that commit if you PR it. Early suggestion:\r\n\r\n```diff\r\n-     m_warning_emitted.value() - now > m_warning_wait\r\n+     now - m_warning_emitted.value() > m_warning_wait\r\n```",
      "commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "created_at" : "2024-03-21T09:30:22Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>\n+\n+class TimeOffsets\n+{\n+private:\n+    static constexpr size_t N{50};\n+    //! Minimum difference between system and network time for a warning to be raised.\n+    static constexpr std::chrono::minutes m_warn_threshold{10};\n+    mutable std::atomic<bool> m_warning_emitted{false};  // Avoid flooding the user with warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1533509979",
      "id" : 1533509979,
      "in_reply_to_id" : 1530170447,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585bZ4Fb",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : 21,
      "pull_request_review_id" : 1951421086,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533509979/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-21T09:30:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1533509979",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "While [working on the fuzz inputs](https://github.com/bitcoin-core/qa-assets/pull/178#issuecomment-2012479018), I noticed that the memory usage for this new `timeoffsets` harness is unusually high. Doing one more small force-push to patch the fuzz and unit test to:\r\n- disable logging in the fuzz test, which was causing the memory leak (thanks @dergoegge)\r\n- use `noui.h` to prevent the GUI from flooding the fuzz and unit test with (expected) warnings\r\n\r\nIt's a pretty small test-only diff, so I'm hoping reviewers can give this a quick re-review? Thank you!\r\n\r\n`git range-diff a42d9b5041cdc522e8a4b81944e45b7f30458c26...3dfdb22c1da687bd86e3325ec02c7b38e15895b4`",
      "created_at" : "2024-03-21T19:19:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2013414886",
      "id" : 2013414886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5854AkXm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013414886/reactions"
      },
      "updated_at" : "2024-03-21T19:19:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013414886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Maybe there should be an assertion failure in the fuzz tests, if log messages have been written to the buffer, but logging is still disabled when the program exits?",
      "created_at" : "2024-03-21T19:22:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2013423329",
      "id" : 2013423329,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5854Ambh",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013423329/reactions"
      },
      "updated_at" : "2024-03-21T19:22:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013423329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed to draft until I've resolved the merge conflict with #29279 which relies on setmocktime",
      "created_at" : "2024-03-21T20:05:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#issuecomment-2013607897",
      "id" : 2013607897,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29623",
      "node_id" : "IC_kwDOABII5854BTfZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013607897/reactions"
      },
      "updated_at" : "2024-03-21T20:05:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013607897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535332514"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535332514"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 9f2904b621cc945005570fc6e94832d73d36d92b: `<cstddef>`",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T09:59:14Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535332514",
      "id" : 1535332514,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bg1Ci",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : null,
      "pull_request_review_id" : 1954401947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535332514/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535332514",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535374706"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535374706"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Consider this ^ while retouching. I think it is more useful because it tells the user how wrong is the clock and what are the expectations of Bitcoin Core. Otherwise (to the user) it is not clear whether Bitcoin Core is too picky and whether this is about +/- 1 second or something like that. Referring the user to the `getnetworkinfo` RPC may also be useful.",
      "commit_id" : "3dfdb22c1da687bd86e3325ec02c7b38e15895b4",
      "created_at" : "2024-03-22T10:32:58Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535374706",
      "id" : 1535374706,
      "in_reply_to_id" : 1530164745,
      "line" : 47,
      "node_id" : "PRRC_kwDOABII585bg_Vy",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 47,
      "pull_request_review_id" : 1954467885,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535374706/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 46,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-22T10:32:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535374706",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535383140"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535383140"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 9f2904b621cc945005570fc6e94832d73d36d92b:  This may keep printing the warning, even if the user adjusted the clock, because the offsets are not discarded when the clock changes.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T10:40:01Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535383140",
      "id" : 1535383140,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII585bhBZk",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 63,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 63,
      "pull_request_review_id" : 1954401947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535383140/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535383140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535386795"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535386795"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in https://github.com/bitcoin/bitcoin/commit/9f2904b621cc945005570fc6e94832d73d36d92b: Any reason to duplicate the message in two translation units? Why not pass it from here into this function?",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T10:43:16Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.original);\n+\n+    if (!m_warning_emitted) {\n+        m_warning_emitted = true;\n+        SetMedianTimeOffsetWarning();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535386795",
      "id" : 1535386795,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bhCSr",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1954401947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535386795/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535386795",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535401675"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535401675"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in https://github.com/bitcoin/bitcoin/commit/9f2904b621cc945005570fc6e94832d73d36d92b: You are also removing the debug log that logged the time offset. Is it intentional?",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T10:56:59Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535401675",
      "id" : 1535401675,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585bhF7L",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 23,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 23,
      "pull_request_review_id" : 1954401947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535401675/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535401675",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535408725"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535408725"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in e5c3b2807921caa6f2717fa84915cb02b1f4d9fb: Not that it matters, but the commit itself is broken, because `GetTimeOffset` in the rpc will now always be zero in this commit. The next commit fixes it.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T11:03:44Z",
      "diff_hunk" : "@@ -3625,8 +3624,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         if (!pfrom.IsInboundConn()) {\n             // Don't use timedata samples from inbound peers to make it\n             // harder for others to tamper with our adjusted time.\n-            AddTimeData(pfrom.addr, Ticks<std::chrono::seconds>(peer->m_time_offset.load()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535408725",
      "id" : 1535408725,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bhHpV",
      "original_commit_id" : "e5c3b2807921caa6f2717fa84915cb02b1f4d9fb",
      "original_line" : 3628,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1954401947,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535408725/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:10:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535408725",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535417573"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535417573"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think it would be fine to globally set this in MakeNoLogFileContext, or all tests, or should there ever be a case where one would want stuff printed to stderr in tests instead of to the test log?",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T11:12:40Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <noui.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+\n+#include <chrono>\n+\n+void initialize_timeoffsets()\n+{\n+    static const auto testing_setup = MakeNoLogFileContext<>(ChainType::MAIN);\n+    noui_test_redirect();  // prevent the TimeOffsets::WarnIfOutOfSync() GUI MessageBoxes from flooding the log",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535417573",
      "id" : 1535417573,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585bhJzl",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 18,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : 18,
      "pull_request_review_id" : 1954539581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535417573/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:12:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535417573",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535424851"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535424851"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> I think it is more useful because it tells the user how wrong is the clock\r\n\r\nNot sure. Just because it is the median does not mean that it is an accurate representation of the current time. For example, the time offsets could all be widely different numbers larger than the warning threshold. Or, it could be an outdated number, because the median is calculated based on samples from random points in the past.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T11:20:00Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535424851",
      "id" : 1535424851,
      "in_reply_to_id" : 1530164745,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bhLlT",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1954551761,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535424851/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:20:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535424851",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535430433"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535430433"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit in 0b372c0ab3c800e70bd81fc647742f1d50953188: Could use the type-safe `NodeClock/NodeSeconds`, which is identical to `GetTime`?\r\n\r\n```cpp\r\npeer->m_time_offset = NodeSeconds{std::chrono::seconds{nTime}} - Now<NodeSeconds>();",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T11:26:06Z",
      "diff_hunk" : "@@ -3610,11 +3610,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                   peer->m_starting_height, addrMe.ToStringAddrPort(), fRelay, pfrom.GetId(),\n                   remoteAddr, (mapped_as ? strprintf(\", mapped_as=%d\", mapped_as) : \"\"));\n \n-        peer->m_time_offset = nTime - GetTime();\n+        peer->m_time_offset = std::chrono::seconds{nTime - GetTime()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535430433",
      "id" : 1535430433,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bhM8h",
      "original_commit_id" : "0b372c0ab3c800e70bd81fc647742f1d50953188",
      "original_line" : 3613,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1954561288,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535430433/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T11:37:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535430433",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535813414"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535813414"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T15:56:54Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535813414",
      "id" : 1535813414,
      "in_reply_to_id" : 1535332514,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585biqcm",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 13,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535813414/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535813414",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535848511"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535848511"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't think about it much, have re-added a debug log line.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T16:22:04Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535848511",
      "id" : 1535848511,
      "in_reply_to_id" : 1535401675,
      "line" : 23,
      "node_id" : "PRRC_kwDOABII585bizA_",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 23,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 23,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535848511/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535848511",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535926994"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535926994"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, updated.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T17:15:41Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.original);\n+\n+    if (!m_warning_emitted) {\n+        m_warning_emitted = true;\n+        SetMedianTimeOffsetWarning();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535926994",
      "id" : 1535926994,
      "in_reply_to_id" : 1535386795,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bjGLS",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 52,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535926994/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535926994",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535938911"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535938911"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Neat, updated thanks",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T17:23:45Z",
      "diff_hunk" : "@@ -3610,11 +3610,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                   peer->m_starting_height, addrMe.ToStringAddrPort(), fRelay, pfrom.GetId(),\n                   remoteAddr, (mapped_as ? strprintf(\", mapped_as=%d\", mapped_as) : \"\"));\n \n-        peer->m_time_offset = nTime - GetTime();\n+        peer->m_time_offset = std::chrono::seconds{nTime - GetTime()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535938911",
      "id" : 1535938911,
      "in_reply_to_id" : 1535430433,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bjJFf",
      "original_commit_id" : "0b372c0ab3c800e70bd81fc647742f1d50953188",
      "original_line" : 3613,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535938911/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535938911",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535995235"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535995235"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I agree that the specific numbers don't matter too much here. The main goal is to have the user double check, and correct their settings if necessary, which should be obvious very quickly. I've updated the help message to reinforce that, and also to give context on when the message will disappear:\r\n\r\n```c++\r\n    bilingual_str msg{strprintf(_(\r\n        \"Your computer's date and time appears to be more than %d minutes out of sync with the network, \"\r\n        \"this may lead to consensus failure. After you've corrected your settings, this message \"\r\n        \"should no longer appear when you restart your node. Without a restart, it should stop showing \"\r\n        \"automatically after you've connected to a sufficient number of new outbound peers, which may \"\r\n        \"take some time.\"\r\n    ), Ticks<std::chrono::minutes>(m_warn_threshold))};\r\n```\r\n\r\nIt's quite a long message, but it should only very rarely pop up, and when it does, we really want the user to address it ASAP, so I suppose that's fair.\r\n\r\nI hope this works for both of you?",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T18:05:07Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1535995235",
      "id" : 1535995235,
      "in_reply_to_id" : 1530164745,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bjW1j",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 47,
      "original_position" : 47,
      "original_start_line" : 46,
      "path" : "src/node/timeoffsets.cpp",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535995235/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1535995235",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536019268"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019268"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Squashed",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T18:27:28Z",
      "diff_hunk" : "@@ -43,6 +43,10 @@ def test_maxtipage(self, maxtipage, set_parameter=True, test_deltas=True):\n         self.generate(node_miner, 1)\n         assert_equal(node_ibd.getblockchaininfo()['initialblockdownload'], False)\n \n+        # reset time to system time so we don't have a time offset with the ibd node the next\n+        # time we connect to it, ensuring TimeOffsets::WarnIfOutOfSync() doesn't output to stderr\n+        node_miner.setmocktime(0)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536019268",
      "id" : 1536019268,
      "in_reply_to_id" : 1530818676,
      "line" : 48,
      "node_id" : "PRRC_kwDOABII585bjctE",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 48,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/feature_maxtipage.py",
      "position" : 6,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019268/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019268",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536019771"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019771"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ah, right. I've squashed the commit so it's no longer relevant.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T18:27:55Z",
      "diff_hunk" : "@@ -3625,8 +3624,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         if (!pfrom.IsInboundConn()) {\n             // Don't use timedata samples from inbound peers to make it\n             // harder for others to tamper with our adjusted time.\n-            AddTimeData(pfrom.addr, Ticks<std::chrono::seconds>(peer->m_time_offset.load()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536019771",
      "id" : 1536019771,
      "in_reply_to_id" : 1535408725,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bjc07",
      "original_commit_id" : "e5c3b2807921caa6f2717fa84915cb02b1f4d9fb",
      "original_line" : 3628,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019771/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536019771",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536093822"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536093822"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Seems sensible, but given that `MakeNoLogFileContext` is used in quite a few other places I'd rather keep that for a separate pull",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T19:30:05Z",
      "diff_hunk" : "@@ -0,0 +1,29 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/timeoffsets.h>\n+#include <noui.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+\n+#include <chrono>\n+\n+void initialize_timeoffsets()\n+{\n+    static const auto testing_setup = MakeNoLogFileContext<>(ChainType::MAIN);\n+    noui_test_redirect();  // prevent the TimeOffsets::WarnIfOutOfSync() GUI MessageBoxes from flooding the log",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536093822",
      "id" : 1536093822,
      "in_reply_to_id" : 1535417573,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585bju5-",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 18,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/test/fuzz/timeoffsets.cpp",
      "position" : 18,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536093822/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536093822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536222982"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536222982"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The latest force-push now also includes proper GUI and RPC warning behaviour. RPC warnings are now only shown when the median exceeds the threshold. GUI warnings are shown whenever the node falls out of sync, but max once per 60 minutes. I think this should fully address your comment? Thanks!",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T21:05:55Z",
      "diff_hunk" : "@@ -0,0 +1,39 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_TIMEOFFSETS_H\n+#define BITCOIN_NODE_TIMEOFFSETS_H\n+\n+#include <sync.h>\n+\n+#include <atomic>\n+#include <chrono>\n+#include <deque>\n+#include <stddef.h>\n+\n+class TimeOffsets\n+{\n+private:\n+    static constexpr size_t N{50};\n+    //! Minimum difference between system and network time for a warning to be raised.\n+    static constexpr std::chrono::minutes m_warn_threshold{10};\n+    mutable std::atomic<bool> m_warning_emitted{false};  // Avoid flooding the user with warnings.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536222982",
      "id" : 1536222982,
      "in_reply_to_id" : 1530170447,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bkOcG",
      "original_commit_id" : "a42d9b5041cdc522e8a4b81944e45b7f30458c26",
      "original_line" : 21,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.h",
      "position" : null,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536222982/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536222982",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536225506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536225506"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The log message has been updated to highlight that the message may persist for a while, thanks.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-22T21:09:03Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1536225506",
      "id" : 1536225506,
      "in_reply_to_id" : 1535383140,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII585bkPDi",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 63,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 63,
      "pull_request_review_id" : 1955178305,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536225506/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-22T22:39:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1536225506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1544783265"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1544783265"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Grepping in my node's log for how frequent outbound connections are made - it would take about 1.5 days to make 200 new outbound connections. Since this is about the median, I guess 101 new connections after fixing the clock will be enough for us to stop the warning. That is like 20ish hours. Quite long. Can we do better?\r\n\r\nCurrently we only save the difference between our time and the peer's time at the start of the connection and we have no clue that this difference has changed due to our clock being adjusted/corrected. If we save the value of the system_clock and steady_clock at the start of the connection, in addition to the peer's offset, at a later time we can deduce that our clock has been adjusted and add that diff/adjustment to the peer's offset to immediately figure out that \"now our clock is in sync with that peer's clock\".\r\n\r\nSo, instead of `peer_offset`, it would be a matter of using the following instead:\r\n`peer_offset + steady_clock_diff - system_clock_diff`, assuming:\r\n`steady_clock_diff = steady_clock_now - steady_clock_when_connected`\r\n`system_clock_diff = system_clock_now - system_clock_when_connected`.\r\n\r\nExample:\r\n---\r\nLets say our clock is wrong, 15 minutes ahead. When we connect to a peer at `17:00:00` our time they send us a time that is 15 minutes ago and we save:\r\n`peer_offset = -15min`,\r\n`system_clock_when_connected = 17:00:00`,\r\n`steady_clock_when_connected = 1000` (some obscure value [seconds]).\r\nOne hour later, our clock has been fixed/corrected, by moving it 15 min backwards (or stopping to move for 15 min). So,\r\n`system_clock_now = 17:45:00`,\r\n`steady_clock_now = 4600` (the obscure value 1000 plus 3600 because 1 hour has passed).\r\nAnd then:\r\n`steady_clock_diff = 4600 - 1000 = 60 min`\r\n`system_clock_diff = 17:45:00 - 17:00:00 = 45 min`\r\nThe difference between those is 15 minutes and adding that to `peer_offset` gives us offset 0, meaning that now our clock is in sync with the peer's clock.",
      "commit_id" : "2ef71c73582be554e565ada3f8a6ca77c2cd79f1",
      "created_at" : "2024-03-29T18:55:43Z",
      "diff_hunk" : "@@ -0,0 +1,57 @@\n+// Copyright (c) 2024-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <logging.h>\n+#include <node/interface_ui.h>\n+#include <node/timeoffsets.h>\n+#include <sync.h>\n+#include <util/translation.h>\n+#include <warnings.h>\n+\n+#include <algorithm>\n+#include <chrono>\n+#include <deque>\n+\n+using namespace std::chrono_literals;\n+\n+void TimeOffsets::Add(std::chrono::seconds offset)\n+{\n+    LOCK(m_mutex);\n+\n+    if (m_offsets.size() >= N) {\n+        m_offsets.pop_front();\n+    }\n+    m_offsets.push_back(offset);\n+}\n+\n+std::chrono::seconds TimeOffsets::Median() const\n+{\n+    LOCK(m_mutex);\n+\n+    // Only calculate the median if we have 5 or more offsets\n+    if (m_offsets.size() < 5) return 0s;\n+\n+    auto sorted_copy = m_offsets;\n+    std::sort(sorted_copy.begin(), sorted_copy.end());\n+    return sorted_copy[m_offsets.size() / 2];  // approximate median is good enough, keep it simple\n+}\n+\n+bool TimeOffsets::WarnIfOutOfSync() const\n+{\n+    // when median == std::numeric_limits<int64_t>::min(), calling std::chrono::abs is UB\n+    auto median{std::max(Median(), std::chrono::seconds(std::numeric_limits<int64_t>::min() + 1))};\n+    if (std::chrono::abs(median) <= m_warn_threshold) return false;\n+\n+    bilingual_str msg{_(\"Your computer's date and time appear out of sync with the network, \"\n+                        \"this may lead to consensus failure. Please ensure it is correct.\")};\n+    LogWarning(\"%s\\n\", msg.original);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29623#discussion_r1544783265",
      "id" : 1544783265,
      "in_reply_to_id" : 1535383140,
      "line" : 63,
      "node_id" : "PRRC_kwDOABII585cE4Wh",
      "original_commit_id" : "9f2904b621cc945005570fc6e94832d73d36d92b",
      "original_line" : 63,
      "original_position" : 48,
      "original_start_line" : null,
      "path" : "src/node/timeoffsets.cpp",
      "position" : 63,
      "pull_request_review_id" : 1969386851,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29623",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1544783265/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-29T18:55:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1544783265",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   }
]
