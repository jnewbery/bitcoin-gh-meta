[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29668).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/29668#pullrequestreview-1958325955) |\n| Stale ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/29668#pullrequestreview-1949117498) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2024-03-17T16:42:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#issuecomment-2002534384",
      "id" : 2002534384,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29668",
      "node_id" : "IC_kwDOABII5853XD_w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002534384/reactions"
      },
      "updated_at" : "2024-03-27T17:01:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002534384",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537942918"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537942918"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I find `has_undo` more to the point\r\n```suggestion\r\nconst CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool has_undo)\r\n```",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:14:30Z",
      "diff_hunk" : "@@ -595,12 +595,16 @@ bool BlockManager::IsBlockPruned(const CBlockIndex& block)\n     return m_have_pruned && !(block.nStatus & BLOCK_HAVE_DATA) && (block.nTx > 0);\n }\n \n-const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block)\n+const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool check_undo)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537942918",
      "id" : 1537942918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bqyWG",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 598,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537942918/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T20:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537942918",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537955721"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537955721"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: I think highlighting that this is a mask improves readability\r\n```suggestion\r\n    uint32_t status_mask{BLOCK_HAVE_DATA};\r\n```",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:24:51Z",
      "diff_hunk" : "@@ -595,12 +595,16 @@ bool BlockManager::IsBlockPruned(const CBlockIndex& block)\n     return m_have_pruned && !(block.nStatus & BLOCK_HAVE_DATA) && (block.nTx > 0);\n }\n \n-const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block)\n+const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool check_undo)\n {\n     AssertLockHeld(::cs_main);\n+    uint32_t check_status{BLOCK_HAVE_DATA};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537955721",
      "id" : 1537955721,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bq1eJ",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 601,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537955721/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T10:39:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537955721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537962499"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537962499"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: also, perhaps good to add a type `static_assert` here to ensure this doesn't silently introduce bugs when `nStatus` changes type?\r\n\r\n```\r\nstatic_assert(std::is_same<decltype(check_status), decltype(last_block->nStatus)>::value);\r\n\r\n```",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:29:45Z",
      "diff_hunk" : "@@ -595,12 +595,16 @@ bool BlockManager::IsBlockPruned(const CBlockIndex& block)\n     return m_have_pruned && !(block.nStatus & BLOCK_HAVE_DATA) && (block.nTx > 0);\n }\n \n-const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block)\n+const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool check_undo)\n {\n     AssertLockHeld(::cs_main);\n+    uint32_t check_status{BLOCK_HAVE_DATA};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537962499",
      "id" : 1537962499,
      "in_reply_to_id" : 1537955721,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bq3ID",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 601,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537962499/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T20:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537962499",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537973016"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537973016"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: unnecessary `const`\r\n```suggestion\r\n    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, bool check_undo=false) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n```",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:35:03Z",
      "diff_hunk" : "@@ -337,8 +337,8 @@ class BlockManager\n \n     //! Find the first stored ancestor of start_block immediately after the last\n     //! pruned ancestor. Return value will never be null. Caller is responsible\n-    //! for ensuring that start_block has data is not pruned.\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    //! for ensuring that start_block has data.\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, const bool check_undo=false) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537973016",
      "id" : 1537973016,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bq5sY",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 341,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.h",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537973016/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T20:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537973016",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537985109"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537985109"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: also, would be nice to update the docs for the `check_undo` param, and include the exception made for genesis block so new callers are made aware to look out for that?",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:42:49Z",
      "diff_hunk" : "@@ -337,8 +337,8 @@ class BlockManager\n \n     //! Find the first stored ancestor of start_block immediately after the last\n     //! pruned ancestor. Return value will never be null. Caller is responsible\n-    //! for ensuring that start_block has data is not pruned.\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    //! for ensuring that start_block has data.\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, const bool check_undo=false) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537985109",
      "id" : 1537985109,
      "in_reply_to_id" : 1537973016,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bq8pV",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 341,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.h",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537985109/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T20:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537985109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537989270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537989270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit (+ a few lines down)\r\n```suggestion\r\n    return block.nStatus & BLOCK_HAVE_MASK ? active_chainstate.m_blockman.GetFirstStoredBlock(block, /*last_block=*/nullptr, /*check_undo=*/true)->nHeight - 1 : block.nHeight;\r\n```",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-25T17:45:26Z",
      "diff_hunk" : "@@ -835,7 +836,7 @@ static RPCHelpMan pruneblockchain()\n \n     PruneBlockFilesManual(active_chainstate, height);\n     const CBlockIndex& block{*CHECK_NONFATAL(active_chain.Tip())};\n-    return block.nStatus & BLOCK_HAVE_DATA ? active_chainstate.m_blockman.GetFirstStoredBlock(block)->nHeight - 1 : block.nHeight;\n+    return block.nStatus & BLOCK_HAVE_MASK ? active_chainstate.m_blockman.GetFirstStoredBlock(block, nullptr, true)->nHeight - 1 : block.nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1537989270",
      "id" : 1537989270,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bq9qW",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 839,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1958325955,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537989270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-25T20:12:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1537989270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@stickies-v thanks for the feedback! I don't have strong feelings between the approaches but I agree yours is more flexible and maybe a bit more expressive, so I applied that. I also addressed the rest of the feedback and added some more detail to the docs.",
      "created_at" : "2024-03-27T17:03:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#issuecomment-2023324076",
      "id" : 2023324076,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29668",
      "node_id" : "IC_kwDOABII5854mXms",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2023324076/reactions"
      },
      "updated_at" : "2024-03-27T17:03:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2023324076",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505540"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505540"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-27T17:03:31Z",
      "diff_hunk" : "@@ -835,7 +836,7 @@ static RPCHelpMan pruneblockchain()\n \n     PruneBlockFilesManual(active_chainstate, height);\n     const CBlockIndex& block{*CHECK_NONFATAL(active_chain.Tip())};\n-    return block.nStatus & BLOCK_HAVE_DATA ? active_chainstate.m_blockman.GetFirstStoredBlock(block)->nHeight - 1 : block.nHeight;\n+    return block.nStatus & BLOCK_HAVE_MASK ? active_chainstate.m_blockman.GetFirstStoredBlock(block, nullptr, true)->nHeight - 1 : block.nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505540",
      "id" : 1541505540,
      "in_reply_to_id" : 1537989270,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b4YIE",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 839,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1963955472,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505540/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T17:03:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505540",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505629"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505629"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-27T17:03:34Z",
      "diff_hunk" : "@@ -337,8 +337,8 @@ class BlockManager\n \n     //! Find the first stored ancestor of start_block immediately after the last\n     //! pruned ancestor. Return value will never be null. Caller is responsible\n-    //! for ensuring that start_block has data is not pruned.\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    //! for ensuring that start_block has data.\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, const bool check_undo=false) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505629",
      "id" : 1541505629,
      "in_reply_to_id" : 1537973016,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b4YJd",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 341,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.h",
      "position" : null,
      "pull_request_review_id" : 1963955617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505629/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T17:03:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505629",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505765"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505765"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not needed due to approach change",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-27T17:03:40Z",
      "diff_hunk" : "@@ -595,12 +595,16 @@ bool BlockManager::IsBlockPruned(const CBlockIndex& block)\n     return m_have_pruned && !(block.nStatus & BLOCK_HAVE_DATA) && (block.nTx > 0);\n }\n \n-const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block)\n+const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool check_undo)\n {\n     AssertLockHeld(::cs_main);\n+    uint32_t check_status{BLOCK_HAVE_DATA};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505765",
      "id" : 1541505765,
      "in_reply_to_id" : 1537955721,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b4YLl",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 601,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 1963955807,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505765/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T17:03:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505765",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Not needed due to approach change",
      "commit_id" : "bc36604a0b02cd71979028e3f43de48da88f97de",
      "created_at" : "2024-03-27T17:03:44Z",
      "diff_hunk" : "@@ -595,12 +595,16 @@ bool BlockManager::IsBlockPruned(const CBlockIndex& block)\n     return m_have_pruned && !(block.nStatus & BLOCK_HAVE_DATA) && (block.nTx > 0);\n }\n \n-const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block)\n+const CBlockIndex* BlockManager::GetFirstStoredBlock(const CBlockIndex& upper_block, const CBlockIndex* lower_block, const bool check_undo)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1541505876",
      "id" : 1541505876,
      "in_reply_to_id" : 1537942918,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b4YNU",
      "original_commit_id" : "296243c3153e996d1626b8eabc8f8bce845ce3ad",
      "original_line" : 598,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.cpp",
      "position" : null,
      "pull_request_review_id" : 1963955981,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T17:03:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541505876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23163769501</sub>",
      "created_at" : "2024-03-28T01:49:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#issuecomment-2024255644",
      "id" : 2024255644,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29668",
      "node_id" : "IC_kwDOABII5854p7Cc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2024255644/reactions"
      },
      "updated_at" : "2024-03-28T01:49:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2024255644",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> q: doesn't this mean that if we generate a chain, prune half of it, then fetch the pruned blocks through `getblockfrompeer`, any fresh indexes sync will throw a different init error after this changes? (`StartIndexBackgroundSync()` should fail at `CheckBlockDataAvailability()` now).\r\n> \r\n> If this is correct, it would be nice to introduce a test presenting the behavior change.\r\n\r\nGood question but no, `CheckBlockDataAvailability()` does not change the default mask (`HAVE_DATA`), so it shouldn't change behavior there for now. But your question made me realize that we should check for undo data for some indices because they need it. I have implemented that in a follow-up here: #29770 and I also implemented the test there that shows the behavior change you had in mind I think.",
      "created_at" : "2024-03-30T22:57:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#issuecomment-2028489071",
      "id" : 2028489071,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29668",
      "node_id" : "IC_kwDOABII58546Elv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2028489071/reactions"
      },
      "updated_at" : "2024-03-30T22:57:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2028489071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545671827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545671827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    return block.nStatus & has_undo ? active_chainstate.m_blockman.GetFirstStoredBlock(block, /*lower_block=*/nullptr, /*status_mask=*/has_undo)->nHeight - 1 : block.nHeight;\r\n```",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-03-31T13:35:54Z",
      "diff_hunk" : "@@ -835,7 +836,8 @@ static RPCHelpMan pruneblockchain()\n \n     PruneBlockFilesManual(active_chainstate, height);\n     const CBlockIndex& block{*CHECK_NONFATAL(active_chain.Tip())};\n-    return block.nStatus & BLOCK_HAVE_DATA ? active_chainstate.m_blockman.GetFirstStoredBlock(block)->nHeight - 1 : block.nHeight;\n+    const uint32_t has_undo{BLOCK_HAVE_DATA | BLOCK_HAVE_UNDO};\n+    return block.nStatus & BLOCK_HAVE_MASK ? active_chainstate.m_blockman.GetFirstStoredBlock(block, /*lower_block=*/nullptr, /*status_mask=*/has_undo)->nHeight - 1 : block.nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545671827",
      "id" : 1545671827,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585cIRST",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 840,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1970253804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545671827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-31T22:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545671827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545672055"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545672055"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This should check for `has_undo` too",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-03-31T13:36:34Z",
      "diff_hunk" : "@@ -1289,7 +1291,8 @@ RPCHelpMan getblockchaininfo()\n     obj.pushKV(\"pruned\", chainman.m_blockman.IsPruneMode());\n     if (chainman.m_blockman.IsPruneMode()) {\n         bool has_tip_data = tip.nStatus & BLOCK_HAVE_DATA;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545672055",
      "id" : 1545672055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585cIRV3",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 1293,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1970253804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545672055/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-31T22:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545672055",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545690307"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545690307"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Also, it seems like we can just use `BLOCK_HAVE_MASK          =   BLOCK_HAVE_DATA | BLOCK_HAVE_UNDO,`",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-03-31T14:13:13Z",
      "diff_hunk" : "@@ -1289,7 +1291,8 @@ RPCHelpMan getblockchaininfo()\n     obj.pushKV(\"pruned\", chainman.m_blockman.IsPruneMode());\n     if (chainman.m_blockman.IsPruneMode()) {\n         bool has_tip_data = tip.nStatus & BLOCK_HAVE_DATA;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545690307",
      "id" : 1545690307,
      "in_reply_to_id" : 1545672055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585cIVzD",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 1293,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1970253804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545690307/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-31T22:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545690307",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545720878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545720878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: it's called `upper_block` in the implementation, which I think is a better name too (cfr `lower_block`)\r\n```suggestion\r\n    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, uint32_t status_mask=BLOCK_HAVE_DATA) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\r\n```",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-03-31T15:35:19Z",
      "diff_hunk" : "@@ -336,9 +336,12 @@ class BlockManager\n     bool CheckBlockDataAvailability(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex& lower_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n     //! Find the first stored ancestor of start_block immediately after the last\n-    //! pruned ancestor. Return value will never be null. Caller is responsible\n-    //! for ensuring that start_block has data is not pruned.\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    //! ancestor that does not match the status mask. Return value will never be\n+    //! null. Caller is responsible for ensuring that start_block has the status\n+    //! mask data. If the whole chain matched the status mask the genesis block\n+    //! will be returned regardless of it's status match because, for example,\n+    //! it can not have undo data by nature.\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, uint32_t status_mask=BLOCK_HAVE_DATA) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1545720878",
      "id" : 1545720878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585cIdQu",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 344,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.h",
      "position" : null,
      "pull_request_review_id" : 1970253804,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545720878/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-31T22:14:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1545720878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-04-28T19:28:29Z",
      "diff_hunk" : "@@ -336,9 +336,12 @@ class BlockManager\n     bool CheckBlockDataAvailability(const CBlockIndex& upper_block LIFETIMEBOUND, const CBlockIndex& lower_block LIFETIMEBOUND) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n     //! Find the first stored ancestor of start_block immediately after the last\n-    //! pruned ancestor. Return value will never be null. Caller is responsible\n-    //! for ensuring that start_block has data is not pruned.\n-    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+    //! ancestor that does not match the status mask. Return value will never be\n+    //! null. Caller is responsible for ensuring that start_block has the status\n+    //! mask data. If the whole chain matched the status mask the genesis block\n+    //! will be returned regardless of it's status match because, for example,\n+    //! it can not have undo data by nature.\n+    const CBlockIndex* GetFirstStoredBlock(const CBlockIndex& start_block LIFETIMEBOUND, const CBlockIndex* lower_block=nullptr, uint32_t status_mask=BLOCK_HAVE_DATA) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311337",
      "id" : 1582311337,
      "in_reply_to_id" : 1545720878,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585eUCep",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 344,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/node/blockstorage.h",
      "position" : null,
      "pull_request_review_id" : 2027256874,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-28T19:28:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311605"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done, I liked that `BLOCK_HAVE_DATA | BLOCK_HAVE_UNDO` is more expressive because we don't use `BLOCK_HAVE_MASK` much I feel like people would need to look it up more, but I have just added a comment instead now.",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-04-28T19:28:35Z",
      "diff_hunk" : "@@ -1289,7 +1291,8 @@ RPCHelpMan getblockchaininfo()\n     obj.pushKV(\"pruned\", chainman.m_blockman.IsPruneMode());\n     if (chainman.m_blockman.IsPruneMode()) {\n         bool has_tip_data = tip.nStatus & BLOCK_HAVE_DATA;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311605",
      "id" : 1582311605,
      "in_reply_to_id" : 1545672055,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585eUCi1",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 1293,
      "original_position" : 21,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2027257309,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-28T19:28:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311745"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "c77e84744a7bcd1609ab86969d2705f1dd116fa3",
      "created_at" : "2024-04-28T19:28:40Z",
      "diff_hunk" : "@@ -835,7 +836,8 @@ static RPCHelpMan pruneblockchain()\n \n     PruneBlockFilesManual(active_chainstate, height);\n     const CBlockIndex& block{*CHECK_NONFATAL(active_chain.Tip())};\n-    return block.nStatus & BLOCK_HAVE_DATA ? active_chainstate.m_blockman.GetFirstStoredBlock(block)->nHeight - 1 : block.nHeight;\n+    const uint32_t has_undo{BLOCK_HAVE_DATA | BLOCK_HAVE_UNDO};\n+    return block.nStatus & BLOCK_HAVE_MASK ? active_chainstate.m_blockman.GetFirstStoredBlock(block, /*lower_block=*/nullptr, /*status_mask=*/has_undo)->nHeight - 1 : block.nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#discussion_r1582311745",
      "id" : 1582311745,
      "in_reply_to_id" : 1545671827,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585eUClB",
      "original_commit_id" : "23ac56177df6888f9ede370092f26b1cf6bebf26",
      "original_line" : 840,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2027257574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29668",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-28T19:28:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1582311745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@stickies-v Thank you, I mostly took your suggestions with some minor tweaks and made you co-author of the refactoring commit. I was a bit torn about letting the caller handle the Genesis block issue but since this was actually the previous behavior I guess it's better to not change it if you like it the way it is. I have adapted `GetPruneHeight` to return `std::optional` which I found a good fit and avoids the `-1` return value. And I think the change in `init.cpp` isn't needed here (yet). But I think we will need it in #29770 later.",
      "created_at" : "2024-04-28T19:34:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29668#issuecomment-2081618206",
      "id" : 2081618206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29668",
      "node_id" : "IC_kwDOABII5858Evke",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2081618206/reactions"
      },
      "updated_at" : "2024-04-28T19:34:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2081618206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   }
]
