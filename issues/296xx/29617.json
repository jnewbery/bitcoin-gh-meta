{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "### Ensure snapshot loading fails for coins exceeding base height\r\n\r\n**Objective**: This test verifies that snapshot loading is correctly rejected for coins with a height greater than the base height.\r\n\r\n**Update**:\r\n- Added `test_invalid_snapshot_wrong_coin_code` to `feature_assumeutxo.py`.\r\n- The test artificially sets a coin's height above 299 in a snapshot and checks for load failure.\r\n- Edit: Added a test case for outputs whose amounts surpass the MAX_MONEY supply limit.\r\n\r\nThis implementation addresses the request for enhancing `assumeutxo` testing as outlined in issue #28648\r\n\r\n---\r\n\r\n**Edit: This is an explanation on how I arrive at content values: b\"\\x84\\x58\" and b\"\\xCA\\xD2\\x8F\\x5A\"** \r\n\r\nYou can use this tool to decode the utxo snapshot https://github.com/jrakibi/utxo-live\r\nHereâs an overview of how itâs done:\r\nThe serialization format for a UTXO in the snapshot is as follows:\r\n1. Transaction ID (txid) - 32 bytes\r\n2. Output Index (outnum)- 4 bytes\r\n3. VARINT (code) - A varible-length integer encoding the height and whether the transaction is a coinbase. The format of this VARINT is (height << 1) | coinbase_flag.\r\n4. VARINT (amount_v) - A variable-length integer that represents a compressed format of the output amount (in satoshis).\r\n\r\nFor the test cases mentioned:\r\n* **`b\"\\x84\\x58\"`** - This value corresponds to a VARINT representing the height and coinbase flag. Once we decode this code, we can extract the height and coinbase using `height = code_decoded >> 1` and `coinbase = code_decoded & 0x01`. In our case, with code_decoded = 728, it results in `height = 364` and `coinbase = 0`.\r\n* **`b\"\\xCA\\xD2\\x8F\\x5A\"`** - This byte sequence represents a compressed amount value. The decompression function takes this value and translates it into a full amount in satoshis. In our case, the decompression of this amount translates to a number larger than the maximum allowed value of coins (21 million BTC)\r\n",
   "closed_at" : "2024-05-02T20:45:55Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 10,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617/comments",
   "created_at" : "2024-03-11T03:00:51Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29617",
   "id" : 2178121326,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585pMHJW",
   "number" : 29617,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29617.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29617",
      "merged_at" : "2024-05-02T20:45:55Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29617.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29617"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617/timeline",
   "title" : "test: Validate UTXO snapshot with coin height > base height & amount > MAX_MONEY supply",
   "updated_at" : "2024-05-02T20:45:55Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29617",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/19940301?v=4",
      "events_url" : "https://api.github.com/users/jrakibi/events{/privacy}",
      "followers_url" : "https://api.github.com/users/jrakibi/followers",
      "following_url" : "https://api.github.com/users/jrakibi/following{/other_user}",
      "gists_url" : "https://api.github.com/users/jrakibi/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/jrakibi",
      "id" : 19940301,
      "login" : "jrakibi",
      "node_id" : "MDQ6VXNlcjE5OTQwMzAx",
      "organizations_url" : "https://api.github.com/users/jrakibi/orgs",
      "received_events_url" : "https://api.github.com/users/jrakibi/received_events",
      "repos_url" : "https://api.github.com/users/jrakibi/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/jrakibi/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/jrakibi/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/jrakibi"
   }
}
