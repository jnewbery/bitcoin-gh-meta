[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1516160146), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1548029271), [ajtowns](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1548859239), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1657983184), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1557235174) |\n| Concept ACK | [ghost](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1461538006), [0xB10C](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1465197246), [brunoerg](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1351139049), [kristapsk](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611260025) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28189](https://github.com/bitcoin/bitcoin/pull/28189) (p2p: diversity network outbounds follow-ups by amitiuttarwar)\n* [#27912](https://github.com/bitcoin/bitcoin/pull/27912) (net: disconnect inside AttemptToEvictConnection by willcl-ark)\n* [#27509](https://github.com/bitcoin/bitcoin/pull/27509) (Relay own transactions only via short-lived Tor or I2P connections by vasild)\n* [#26114](https://github.com/bitcoin/bitcoin/pull/26114) (net: Make AddrFetch connections to fixed seeds by mzumsande)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-06T19:46:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1456856496",
      "id" : 1456856496,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585W1d2w",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456856496/reactions"
      },
      "updated_at" : "2023-08-01T15:23:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456856496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "We have 3 open questions that we are interested in hearing feedback from reviewers. We have considered many potential interactions and have laid out a couple specific ones along with tradeoffs of different approaches.\r\n\r\n### IBD \r\nThe first is regarding the interactions between this patch & IBD. Peers on privacy network might be slower than clearnet peers (eg. Tor or I2P). Our current proposal does not have any special case logic for disabling the network prioritization during IBD. \r\n\r\nThis could mean that our overall IBD speed is reduced by not having the fastest peers possible. The network peers could also be intermittently disconnected for stalling & get the node into a loop where it, for example, disconnects a Tor peer, connects to an IPV4 peer, re-adds a Tor peer and then keeps repeating. Finally, there could be interactions with the slow peers causing delays in the response time of the faster peers based on the specifics of our IBD logic. One solution is to just disable the network-specific outbound logic during IBD.\r\n\r\nOn the other hand, a node can get slow peers by random chance anyways. Whether randomly connecting to altnet peers or because a clearnet peer just happens to be slow. If they are slow, but not slow enough to be evicted due to the stalling limit, that will already have a significant impact on the IBD rate. The issues and potential solutions with improving IBD can be seen as tangential to this proposal, and we could favor not adding custom workarounds that serve as a bandaid to mask the root cause. Enabling alternative networks during IBD is already known to slow down the sync dramatically, and we can just add a warning in the documentation to help users become more aware. \r\n\r\n### Peers protected from eviction \r\nThis patch adds eviction protection for special network peers, but it only gets triggered when we have an extra outbound-full-relay peer (aka 9). This occurs when we detect a stale tip or because we added another special network peer. In these situations weâd want to ensure that we have at least one non-protected peer that can be disconnected so the node can return to the steady state of 8 full-relay outbound peers. \r\n\r\nCurrently, we protect 4 peers via `m_chain_sync.m_protect`, which are the first peers that send us headers corresponding to our best chain. This means 4 peers could be protected with this logic, and 3 more peers being protected by their network. If we added support for two more alternative networks, a user activating all networks could run into a problem where they have 9 protected peers in these circumstances, and unable to return to the steady state of 8 full-relay outbound peers. \r\n\r\nSince it would require adding support for at least one more network to run into this issue, we have not addressed it in this patch. There are multiple viable mitigation strategies: One option is to reduce the number of peers we protect with the headers logic (via `m_protect`). Another is to limit the network-specific logic to 2 random networks or such. \r\n\r\n### Network peer protection \r\nA potential concern of this patch is that the logic that protects network peers from eviction could be âover-protectiveâ. For example, keeping a Tor connection only because it is the only Tor connection, not because itâs providing us meaningful data.\r\n\r\nAny concerns around this are completely bounded by the fact that the protection logic is limited to when we have an _extra_ peer, either through stale tip detection or through the new temporary connections for network specific peers. \r\n\r\nHowever, if there is still concern, @ajtowns had an interesting idea to increase our likelihood of adding a 2nd peer from alternate networks. We could update the stale tip logic to choose the network of the extra outbound differently. Right now, the network odds reflect the proportions represented in `AddrMan`. Instead, we could amend the logic to select based on the proportion of networks we are connected to. This would increase our likelihood of connecting to the network, because, for example, youâre more likely to have â I2P peers than â of your addrman be I2P addresses. \r\n\r\nIncreasing the chances of connecting to a privacy network in that context has two benefits: \r\nIt serves the original intention of the stale top logic to be a last-ditch effort against a perceived eclipse attack. Overtaking multiple networks increases the cost of attack, so this is theoretically a more useful attempt than clearnet.\r\nFor this proposed patch, it would mean the node is more likely to add another peer from the alternate network, so the node is more able to replace a âbadâ network peer with hopefully a better one. This would be effective since the stale tip logic tends to run a couple times a day. \r\n\r\nThis could be treated as a separate chunk of work to be evaluated in a follow-up, or it could be incorporated into this PR if reviewers believe it could help mitigate concerns about edge case possibilities.  ",
      "created_at" : "2023-03-06T19:53:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1456867760",
      "id" : 1456867760,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585W1gmw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456867760/reactions"
      },
      "updated_at" : "2023-06-05T19:52:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1456867760",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK.\r\n\r\nThis was somewhere on my TODO, thanks for picking it up!\r\n\r\n> The automatic connections to alternate networks is done defensively, by first filling all outbound slots with random addresses (as in the status quo) and then adding additional peers from reachable networks the node is currently not connected to. This approach ensures that outbound slots are not left unfilled while attempting to connect to a network that may be unavailable due to a technical issue or misconfiguration that bitcoind cannot detect.\r\n\r\nHmm, this is maybe ok. Another approach would be to try to open to e.g. Tor while still having < 8 outbound connections. To counter the issue of staying with < 8 connections and not being able to open to Tor because e.g. the Tor proxy is broken, then we could give up after a few attempts and then fall back to the old way of filling with random (aka IPv4 ;-)) addresses. If we overshoot the 8 connections (like described above), then for some time we will have more, until eviction kicks in. How much time is that exactly? If that is short then it would be sub-optimal to open a IPv4 connection and drop it shortly after in cases where Tor connectivity is working smoothly. If it is long then we have practically increased the limit of 8 which will cause more traffic.\r\n\r\n> In the above, the clearnet networks IPv4 and IPv6 are counted as one network because diversification between these doesn't make sense and is impossible in some network environments.\r\n\r\nWhy it doesn't make sense? I think it is an extra effort to obtain IPv4 addresses if one has IPv6 addresses and the other way around. Why impossible in some network environments? After all you know if you are going to attempt to connect to `5.6.7.8` or `2030:c0fe:...`.\r\n\r\n> Manual connections are also taken into account: If a user already establishes manual connections to a trusted peer from a network, there is no longer a need to make extra efforts\r\n\r\n+1\r\n\r\n> IBD\r\n\r\nI think there is no need to add special logic during IBD (e.g. disable this PR during IBD). Clearnet peers can also be slow and non-clearnet peers may be fast-enough. IBD should be able to handle slow/fast peers already without special hand-holding.\r\n\r\n> Peers protected from eviction\r\n\r\nI think we don't need to worry about this now because even if we treat IPv4 and IPv6 as separate networks and all 4 from `m_protected` are from one network (e.g. IPv4), then we have 4 more slots for IPv6, Tor, I2P, CJDNS. If we implement more networks, maybe by that time we will have increased the default 8 or I would suggest to then start disconnecting from `m_protected`.\r\n\r\n> Network peer protection\r\n> A potential concern of this patch is that the logic that protects network peers from eviction could be âover-protectiveâ. For example, keeping a Tor connection only because it is the only Tor connection, not because itâs providing us meaningful data.\r\n\r\nI don't see it as \"over-protective\". Can we not have some metric of whether a peer is \"providing us a meaningful data\"? I am ok to deal with this in a followup.\r\n\r\n----\r\n\r\nTaking a step back, the root problem here is that addrman has many IPv4 addresses and few I2P ones (for example). If it would have equal number of addresses from each network, then this problem would not exist because then picking up a random one would have a 1/5 chance of selecting any network (thus there would not be any bias towards IPv4). Would it be simpler and solve the problem equally well if we only change addrman internally to return an address from any given network with a 1/5 chance? Then no need to change the eviction logic or the `ThreadOpenConnections` logic. And no need to _guarantee_ explicitly in the code that at least one connection exists to each network. It will happen by itself most of the time.",
      "created_at" : "2023-03-07T11:36:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1458015010",
      "id" : 1458015010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585W54si",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458015010/reactions"
      },
      "updated_at" : "2023-03-07T11:36:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458015010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think that scenario would already be problematic ... and then we wouldn't have a peer to evict.\r\n\r\n\"... then start disconnecting from `m_protected`\"\r\n\r\n> the math\r\n\r\nI think it goes like this: (with 5 networks) the chance of not selecting IPv4 for the first peer is `4/5`, for the first and second peer is `(4/5)^2`. The chance of not selecting IPv4 in all `8` choices is `p=(4/5)^8`. So, the chance of not selecting IPv4 or not selecting IPv6 is `2*p`. The chance of not selecting IPv4, or IPv6 or Tor or I2P or CJDNS is `5*p`. In other words, the chance of not being connected to at least one network is `5*p`, and thus the chance of being connected to all networks is `1-5*p`, or `16%` (`60%` for 4 nets, `88%` for 3 nets, `99%` for 2 nets and `100%` for 1 net).\r\n\r\nI think this is enough to ditch the idea of random-chance `Select()`. Also, maybe it would not be so much more simpler than this PR.\r\n\r\n_offtopic:_\r\n\r\n> One interesting idea for possible follow-ups would be optional logic that ties certain behavior to networks (e.g. broadcasting wallet transactions only to peers from anonymity networks).\r\n\r\nYes, please! :) To take this one step further, it would be even better to create a temporary connection(s) to Tor/I2P, broadcast our transaction(s) and close the connection(s) (with I2P transient address). This way, if we broadcast another tx after e.g. 1 hour the recipient will not be able to conclude that both transactions come from the same origin.\r\n\r\n> In order for that to work, it would be good to have stronger guarantee that we are actually connected to these networks.\r\n\r\nWould not be needed with temporary tx-broadcast connections.",
      "created_at" : "2023-03-08T09:29:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1459853005",
      "id" : 1459853005,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XA5bN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1459853005/reactions"
      },
      "updated_at" : "2023-03-08T09:29:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1459853005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I think it goes like this: (...)\r\n> \r\n> I think this is enough to ditch the idea of random-chance `Select()`. Also, maybe it would not be so much more simpler than this PR.\r\n\r\nI agree with that conclusion, but I think you can't just add the probabilities like that. I think the correct formula is \r\n$$p={k! S(n,k) \\over k^n}$$\r\nwhere k is the number of networks, $n=8$ the number of outbounds and $S(n,k)$ the Stirling number of the second kind, see  [here](https://stats.stackexchange.com/questions/30483/probability-of-selecting-each-item-at-least-once-when-sampling-with-replacement) for an explanation - the resulting `32.256%` for all 5 networks agrees very well with my simulation results.\r\n(sorry, this is getting offtopic, and I'll stop now - will address your other open comments soon, unless amiti is first) ",
      "created_at" : "2023-03-08T23:43:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1461041818",
      "id" : 1461041818,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XFbqa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1461041818/reactions"
      },
      "updated_at" : "2023-03-09T01:48:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1461041818",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK ",
      "created_at" : "2023-03-09T08:17:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1461538006",
      "id" : 1461538006,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XHUzW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1461538006/reactions"
      },
      "updated_at" : "2023-03-09T08:17:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1461538006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/94559964?v=4",
         "events_url" : "https://api.github.com/users/1440000bytes/events{/privacy}",
         "followers_url" : "https://api.github.com/users/1440000bytes/followers",
         "following_url" : "https://api.github.com/users/1440000bytes/following{/other_user}",
         "gists_url" : "https://api.github.com/users/1440000bytes/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/1440000bytes",
         "id" : 94559964,
         "login" : "1440000bytes",
         "node_id" : "U_kgDOBaLe3A",
         "organizations_url" : "https://api.github.com/users/1440000bytes/orgs",
         "received_events_url" : "https://api.github.com/users/1440000bytes/received_events",
         "repos_url" : "https://api.github.com/users/1440000bytes/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/1440000bytes/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/1440000bytes/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/1440000bytes"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK: I think, having network diversity in outbound connections is helpful and improves partition resistance.\r\n\r\n>> In the above, the clearnet networks IPv4 and IPv6 are counted as one network because diversification between these doesn't make sense and is impossible in some network environments.\r\n>\r\n> Why it doesn't make sense? I think it is an extra effort to obtain IPv4 addresses if one has IPv6 addresses and the other way around. Why impossible in some network environments? After all you know if you are going to attempt to connect to 5.6.7.8 or 2030:c0fe:....\r\n\r\nI also not sure if I agree with counting IPv4 and IPv6 as one network and I think this could need a bit more reasoning. Is it because they are both clearnet? Is it a workaround to don't have 8 protected peers if all networks are enabled (which we'd also face when adding another network like yggdrasil as you mentioned)?\r\n\r\nI had the feeling that protecting only one IPv4 or IPv6 could, for example, reduce the number of inbound connections IPv6-only nodes get. However, I'm not sure if that's really the case (I need to think about this more).",
      "created_at" : "2023-03-12T13:17:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1465197246",
      "id" : 1465197246,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XVSK-",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1465197246/reactions"
      },
      "updated_at" : "2023-03-12T13:17:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1465197246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19157360?v=4",
         "events_url" : "https://api.github.com/users/0xB10C/events{/privacy}",
         "followers_url" : "https://api.github.com/users/0xB10C/followers",
         "following_url" : "https://api.github.com/users/0xB10C/following{/other_user}",
         "gists_url" : "https://api.github.com/users/0xB10C/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/0xB10C",
         "id" : 19157360,
         "login" : "0xB10C",
         "node_id" : "MDQ6VXNlcjE5MTU3MzYw",
         "organizations_url" : "https://api.github.com/users/0xB10C/orgs",
         "received_events_url" : "https://api.github.com/users/0xB10C/received_events",
         "repos_url" : "https://api.github.com/users/0xB10C/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/0xB10C/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/0xB10C"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Hmm, this is maybe ok. Another approach would be to try to open to e.g. Tor while still having < 8 outbound connections. To counter the issue of staying with < 8 connections and not being able to open to Tor because e.g. the Tor proxy is broken, then we could give up after a few attempts and then fall back to the old way of filling with random (aka IPv4 ;-)) addresses. If we overshoot the 8 connections (like described above), then for some time we will have more, until eviction kicks in. How much time is that exactly? If that is short then it would be sub-optimal to open a IPv4 connection and drop it shortly after in cases where Tor connectivity is working smoothly. If it is long then we have practically increased the limit of 8 which will cause more traffic.\r\n\r\n\r\nWe thought about this, of course, because it's the most straightforward approach. However, don't like it as much as the approach here for several reasons:\r\n- it requires introducing an arbitrary waiting time, during which we might have less outbound connections, especially if this would happen for multiple networks at the same time.\r\n- having too few outbound connections is a a potential security risk for the node and slows down important processes such as IBD, the only downsides of having an extra outbound connection is to have a bit of extra traffic, plus temporarily requiring more inbound capacity from the network.\r\n- churning through a few short-lived extra connections has several unrelated benefits, we do it voluntarily anyway (feeler connections), so I'd think it's no big deal.\r\n- the conditions which precluded us from connecting to a network might correct over time (maybe we had a lot of bad addresses in our addrman in the beginning; maybe some technical problem). Just trying a couple of times right after startup, and then giving up wouldn't be ideal in this scenario. \r\n\r\nI guess it boils down to that in general, I think temporarily having more outbound connections than our target is preferable to temporarily having less connections.",
      "created_at" : "2023-03-13T19:57:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1466870416",
      "id" : 1466870416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XbqqQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1466870416/reactions"
      },
      "updated_at" : "2023-03-13T19:57:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1466870416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Why it doesn't make sense? I think it is an extra effort to obtain IPv4 addresses if one has IPv6 addresses and the other way around. Why impossible in some network environments? After all you know if you are going to attempt to connect to 5.6.7.8 or 2030:c0fe:....\r\n> \r\n> I also not sure if I agree with counting IPv4 and IPv6 as one network and I think this could need a bit more reasoning. Is it because they are both clearnet? Is it a workaround to don't have 8 protected peers if all networks are enabled (which we'd also face when adding another network like yggdrasil as you mentioned)?\r\n\r\nI think our reasoning was:\r\n1) They are both clearnet, so it's a bit unclear to me if there is much of a benefit in diversification here. Though maybe there is an extra effort for a potential eclipse attacker to cover both IPv4 and IPv6?\r\n2) IPv4-only network setups exist, I've experienced it more than once that I would be within a network of some organization and could only connect to IPv4 peers, but bitcoind wasn't able to detect that so I'd see regular attempts to make connection to IPv6 peers which all failed immediately.\r\n\r\nSo basically, we saw no clear upsides, and some downsides, and that's why we decided to add it.\r\nBut I'm not insistent on this if people think that there is enough benefit in having connections to both IPv4 and IPv6 peers - it would also make the code cleaner if we didn't have to apply this exception in multiple places.\r\n\r\nIt had nothing to do with the number of 8 protected peers. I'm sure we could find other solutions around that edge case problem, e.g. adding logic to just not try an extra outbound in the first place when we could get into a position where we don't have an unprotected peer to evict, or softening the protection during eviction as vasild suggested.",
      "created_at" : "2023-03-13T19:59:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1466872077",
      "id" : 1466872077,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XbrEN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1466872077/reactions"
      },
      "updated_at" : "2023-03-13T20:00:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1466872077",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure it has any influence on this pr, but did you consider doing something similar for block-relay-only peers?\r\n\r\nSomething like: connect to one generic block-relay-only peer, plus an additional block-relay-only peer for every network we support? I think that should only improve things, including during IBD. It wouldn't do anything to improve tx propagation of course, so wouldn't make this PR redundant.",
      "created_at" : "2023-03-15T05:27:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1469360153",
      "id" : 1469360153,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585XlKgZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1469360153/reactions"
      },
      "updated_at" : "2023-03-15T05:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1469360153",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thank you everyone for the thoughtful feedback! some questions & responses -\r\n\r\n### RE: logic to initially overshoot number of connections\r\n@vasild \r\n> If we overshoot the 8 connections (like described above), then for some time we will have more, until eviction kicks in. How much time is that exactly? If that is short then it would be sub-optimal to open a IPv4 connection and drop it shortly after in cases where Tor connectivity is working smoothly. If it is long then we have practically increased the limit of 8 which will cause more traffic.\r\n\r\nSince we already have short-lived connections through feelers, rotating extra block relay only connections, and stale tip detection, can you clarify the disadvantage of adding another? Especially since we wouldnât expect this new mechanism to occur frequently, does it seem acceptable or intrinsically different somehow? \r\n\r\n### RE: ipv4 vs ipv6\r\n@vasild: Are you suggesting that treating them as separate networks increases the cost of attack? Does the delta in energy required from the attacker feel meaningful? \r\n\r\n@0xB10C\r\n> I had the feeling that protecting only one IPv4 or IPv6 could, for example, reduce the number of inbound connections IPv6-only nodes get. However, Iâm not sure if thatâs really the case (I need to think about this more).\r\n\r\nHm interesting. \r\nOur current baseline is that we have no protections based on network. \r\nBy introducing network protections, we would expect the number of inbounds for IPV4 and IPV6 to drop compared to the current conditions. \r\nItâs likely that conflating the two networks would impact the distribution between them, but would that be problematic? \r\n\r\n### Future improvements\r\nAgreed these are orthogonal to the current proposal, but are very interesting ideas worth further exploration! \r\n\t- temporary tx broadcast connections\r\n\t- block-relay-only connections per network ",
      "created_at" : "2023-03-19T20:29:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1475388292",
      "id" : 1475388292,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585X8KOE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1475388292/reactions"
      },
      "updated_at" : "2023-03-19T20:30:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1475388292",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Something like: connect to one generic block-relay-only peer, plus an additional block-relay-only peer for every network we support? I think that should only improve things, including during IBD. It wouldn't do anything to improve tx propagation of course, so wouldn't make this PR redundant.\r\n\r\nAlso, should we have (at least) one anchor per network instead of only two \"generic\" ones? ",
      "created_at" : "2023-03-21T20:40:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1478551323",
      "id" : 1478551323,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585YIOcb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1478551323/reactions"
      },
      "updated_at" : "2023-03-21T20:49:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1478551323",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "added a commit that increases fuzz coverage for select by network\r\n\r\n@brunoerg \r\n> Also, should we have (at least) one anchor per network instead of only two \"generic\" ones?\r\n\r\nyeah, def think it's worth considering in relation to increasing block-relay-peers. @mzumsande & I have started brainstorming & plan to open an issue once we formulate some initial ideas. in the meanwhile, feel free to reach out directly if you're interested in discussing further :) ",
      "created_at" : "2023-03-24T00:00:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1482065109",
      "id" : 1482065109,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585YVoTV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1482065109/reactions"
      },
      "updated_at" : "2023-03-24T00:00:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1482065109",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > If we overshoot the 8 connections (like described above), then for some time we will have more, until eviction kicks in. How much time is that exactly? If that is short then it would be sub-optimal to open a IPv4 connection and drop it shortly after in cases where Tor connectivity is working smoothly. If it is long then we have practically increased the limit of 8 which will cause more traffic.\r\n> \r\n> Since we already have short-lived connections through feelers, rotating extra block relay only connections, and stale tip detection, can you clarify the disadvantage of adding another? Especially since we wouldnât expect this new mechanism to occur frequently, does it seem acceptable or intrinsically different somehow?\r\n\r\nYou did not answer my question \"How much time is that exactly?\" but your reply seems to imply an answer \"short\", correct me if I misunderstand. The disadvantage of doing that is \"it would be sub-optimal to open a IPv4 connection and drop it shortly after in cases where Tor connectivity is working smoothly\".\r\n\r\n> @vasild: Are you suggesting that treating them as separate networks increases the cost of attack?\r\n\r\nYes.\r\n\r\n> Does the delta in energy required from the attacker feel meaningful?\r\n\r\nThat question is a bit vague. I guess \"yes\" for some values of \"meaningful\".",
      "created_at" : "2023-04-07T09:10:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1500100974",
      "id" : 1500100974,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585Zablu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500100974/reactions"
      },
      "updated_at" : "2023-04-07T09:10:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500100974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "this PR is ready for review! \r\n\r\ndid a couple of clean-up steps: \r\n* removed the fuzz commit since coverage is now handled in #27549 \r\n* rebased on master\r\n* updated the OP to reflect current status ",
      "created_at" : "2023-05-24T20:16:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1561872278",
      "id" : 1561872278,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dGEeW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561872278/reactions"
      },
      "updated_at" : "2023-05-24T20:16:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561872278",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/4751246913961984?logs=ci#L2724:\r\n```bash\r\ntest/denialofservice_tests.cpp(134): Entering test case \"stale_tip_peer_management\"\r\ntest/denialofservice_tests.cpp(212): error: in \"denialofservice_tests/stale_tip_peer_management\": check vNodes[i]->fDisconnect == false has failed\r\ntest/denialofservice_tests.cpp(214): error: in \"denialofservice_tests/stale_tip_peer_management\": check vNodes[max_outbound_full_relay - 2]->fDisconnect == true has failed\r\ntest/denialofservice_tests.cpp(134): Leaving test case \"stale_tip_peer_management\"; testing time: 7571us\r\n```",
      "created_at" : "2023-05-25T09:26:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1562580491",
      "id" : 1562580491,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dIxYL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562580491/reactions"
      },
      "updated_at" : "2023-05-25T09:26:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1562580491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> https://cirrus-ci.com/task/4751246913961984?logs=ci#L2724:\r\n> \r\n> ```shell\r\n> test/denialofservice_tests.cpp(134): Entering test case \"stale_tip_peer_management\"\r\n> test/denialofservice_tests.cpp(212): error: in \"denialofservice_tests/stale_tip_peer_management\": check vNodes[i]->fDisconnect == false has failed\r\n> test/denialofservice_tests.cpp(214): error: in \"denialofservice_tests/stale_tip_peer_management\": check vNodes[max_outbound_full_relay - 2]->fDisconnect == true has failed\r\n> test/denialofservice_tests.cpp(134): Leaving test case \"stale_tip_peer_management\"; testing time: 7571us\r\n> ```\r\n\r\nAh, I think the problem with the test is that `AddRandomOutboundPeer` creates random IPv4 addresses, and sometimes these aren't routable (e.g. protected ranges), so that they are not assigned to `NET_IPV4` but `NET_UNROUTABLE`, which then makes the test fail. This happens intermittently. @amitiuttarwar I haven't looked into solutions yet, but may just try another IPv4 address if this is the case?",
      "created_at" : "2023-05-25T15:34:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1563115012",
      "id" : 1563115012,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dKz4E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563115012/reactions"
      },
      "updated_at" : "2023-05-25T15:34:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563115012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ah, I think the problem with the test is that AddRandomOutboundPeer creates random IPv4 addresses, and sometimes these aren't routable (e.g. protected ranges), so that they are not assigned to NET_IPV4 but NET_UNROUTABLE, which then makes the test fail. This happens intermittently. @amitiuttarwar I haven't looked into solutions yet, but may just try another IPv4 address if this is the case?\r\n\r\nNot sure, I ran the test several times (debugging) and could get the error but didn't get a `NET_UNROUTABLE` address. \r\n\r\n",
      "created_at" : "2023-05-25T19:39:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1563416721",
      "id" : 1563416721,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dL9iR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563416721/reactions"
      },
      "updated_at" : "2023-05-25T19:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563416721",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Ah, I think the problem with the test is that `AddRandomOutboundPeer` creates random IPv4 addresses, and sometimes these aren't routable (e.g. protected ranges), so that they are not assigned to `NET_IPV4` but `NET_UNROUTABLE`, which then makes the test fail.\r\n\r\ngreat find @mzumsande ! I was able to reproduce & observe this behavior, so I added a loop in `AddRandomOutboundPeer` to try again if the selected address is not routable. hopefully this works, I ran the current version >1000 times and didn't see any failures locally. \r\n\r\n@brunoerg - how did you observe if the addrs are routable? note that in the failure situation it's not the onion peer that causes the issue, its a IPv4 peer from the initial setup ",
      "created_at" : "2023-05-27T01:25:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1565134780",
      "id" : 1565134780,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dSg-8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565134780/reactions"
      },
      "updated_at" : "2023-05-27T01:25:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565134780",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1208033507"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208033507"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Instead of pushing the node to `vNodes` and removing it if it's not routable, I think you could do something like:\r\n```cpp\r\nstatic void AddRandomOutboundPeer(NodeId& id, std::vector<CNode*>& vNodes, PeerManager& peerLogic, ConnmanTestMsg& connman, ConnectionType connType, bool onion_peer = false)\r\n{\r\n    CAddress addr;\r\n\r\n    if (onion_peer) {\r\n        auto tor_addr{g_insecure_rand_ctx.randbytes(ADDR_TORV3_SIZE)};\r\n        BOOST_REQUIRE(addr.SetSpecial(OnionToString(tor_addr)));\r\n    }\r\n\r\n    while (!addr.IsRoutable()) {\r\n        addr = CAddress(ip(g_insecure_rand_ctx.randbits(32)), NODE_NONE);\r\n    }\r\n\r\n    vNodes.emplace_back(new CNode{id++,\r\n            /*sock=*/nullptr,\r\n            addr,\r\n            /*nKeyedNetGroupIn=*/0,\r\n            /*nLocalHostNonceIn=*/0,\r\n            CAddress(),\r\n            /*addrNameIn=*/\"\",\r\n            connType,\r\n            /*inbound_onion=*/false});\r\n    CNode &node = *vNodes.back();\r\n\r\n    node.SetCommonVersion(PROTOCOL_VERSION);\r\n    peerLogic.InitializeNode(node, ServiceFlags(NODE_NETWORK | NODE_WITNESS));\r\n    node.fSuccessfullyConnected = true;\r\n    connman.AddTestNode(node);\r\n}\r\n```\r\n\r\n1. You can check if the `addr` is routable directly, no need to do it in `CNode`.\r\n2. Check `onion_peer` before trying to create a routable addr.",
      "commit_id" : "399e3719427ed858a658cc9d7a3f2e6ee6e7ec04",
      "created_at" : "2023-05-27T15:18:09Z",
      "diff_hunk" : "@@ -106,25 +106,41 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n     peerman.FinalizeNode(dummyNode1);\n }\n \n-static void AddRandomOutboundPeer(NodeId& id, std::vector<CNode*>& vNodes, PeerManager& peerLogic, ConnmanTestMsg& connman, ConnectionType connType)\n+static void AddRandomOutboundPeer(NodeId& id, std::vector<CNode*>& vNodes, PeerManager& peerLogic, ConnmanTestMsg& connman, ConnectionType connType, bool onion_peer = false)\n {\n-    CAddress addr(ip(g_insecure_rand_ctx.randbits(32)), NODE_NONE);\n-    vNodes.emplace_back(new CNode{id++,\n-                                  /*sock=*/nullptr,\n-                                  addr,\n-                                  /*nKeyedNetGroupIn=*/0,\n-                                  /*nLocalHostNonceIn=*/0,\n-                                  CAddress(),\n-                                  /*addrNameIn=*/\"\",\n-                                  connType,\n-                                  /*inbound_onion=*/false});\n-    CNode &node = *vNodes.back();\n-    node.SetCommonVersion(PROTOCOL_VERSION);\n-\n-    peerLogic.InitializeNode(node, ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n-    node.fSuccessfullyConnected = true;\n-\n-    connman.AddTestNode(node);\n+    auto routable = false;\n+\n+    while (!routable) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1208033507",
      "id" : 1208033507,
      "line" : 113,
      "node_id" : "PRRC_kwDOABII585IASDj",
      "original_commit_id" : "399e3719427ed858a658cc9d7a3f2e6ee6e7ec04",
      "original_line" : 113,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 26,
      "pull_request_review_id" : 1447428655,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208033507/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-27T15:18:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208033507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1208070951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208070951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "great feedback! that's much cleaner. incorporated in the latest push ",
      "commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "created_at" : "2023-05-27T17:20:42Z",
      "diff_hunk" : "@@ -106,25 +106,41 @@ BOOST_AUTO_TEST_CASE(outbound_slow_chain_eviction)\n     peerman.FinalizeNode(dummyNode1);\n }\n \n-static void AddRandomOutboundPeer(NodeId& id, std::vector<CNode*>& vNodes, PeerManager& peerLogic, ConnmanTestMsg& connman, ConnectionType connType)\n+static void AddRandomOutboundPeer(NodeId& id, std::vector<CNode*>& vNodes, PeerManager& peerLogic, ConnmanTestMsg& connman, ConnectionType connType, bool onion_peer = false)\n {\n-    CAddress addr(ip(g_insecure_rand_ctx.randbits(32)), NODE_NONE);\n-    vNodes.emplace_back(new CNode{id++,\n-                                  /*sock=*/nullptr,\n-                                  addr,\n-                                  /*nKeyedNetGroupIn=*/0,\n-                                  /*nLocalHostNonceIn=*/0,\n-                                  CAddress(),\n-                                  /*addrNameIn=*/\"\",\n-                                  connType,\n-                                  /*inbound_onion=*/false});\n-    CNode &node = *vNodes.back();\n-    node.SetCommonVersion(PROTOCOL_VERSION);\n-\n-    peerLogic.InitializeNode(node, ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n-    node.fSuccessfullyConnected = true;\n-\n-    connman.AddTestNode(node);\n+    auto routable = false;\n+\n+    while (!routable) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1208070951",
      "id" : 1208070951,
      "in_reply_to_id" : 1208033507,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IAbMn",
      "original_commit_id" : "399e3719427ed858a658cc9d7a3f2e6ee6e7ec04",
      "original_line" : 113,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1447487518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208070951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-27T17:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1208070951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1209501764"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209501764"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We want to protect a peer if it's the only one for its network. However, we can run a node supporting just one network. In this case, I suppose that calling `GetFullOutboundAndManualCount` might be unnecessary, we would iterating the whole `m_nodes` with no need.\r\n\r\nIn this case, I think we could have a function like `SupportsMultipleNetworks` to check whether we support more than one network, e.g.:\r\n\r\n```cpp\r\nbool CConnman::SupportsMultipleNetworks() const\r\n{\r\n    int count = 0;\r\n    for (int n = 0; n < NET_MAX; n++) {\r\n        enum Network net = (enum Network)n;\r\n        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\r\n        if (IsReachable(net)) {\r\n            if (net == NET_IPV4) n++;\r\n            count++;\r\n        }\r\n    }\r\n    return count > 0;\r\n}\r\n```\r\n\r\nif so, we can call `GetFullOutboundAndManualCount`:\r\n```cpp\r\nif (m_connman.SupportsMultipleNetworks() && m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;\r\n```",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-05-29T18:27:59Z",
      "diff_hunk" : "@@ -5155,6 +5157,12 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // Protect a peer if it's the only one for its network, counting IPv4 and\n+            // IPv6 as one network.\n+            // Both outbound-full-relay and manual connections are counted for this,\n+            // but not block-relay-only connections because the goal\n+            // is to have at least one tx-relaying connection to each reachable network.\n+            if (m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1209501764",
      "id" : 1209501764,
      "line" : 5165,
      "node_id" : "PRRC_kwDOABII585IF4hE",
      "original_commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "original_line" : 5165,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 18,
      "pull_request_review_id" : 1449778687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209501764/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-30T14:44:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209501764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a suggestion, but I think we could cover `GetFullOutboundAndManualCount` in fuzz.\r\n\r\n```diff\r\ndiff --git a/src/test/fuzz/connman.cpp b/src/test/fuzz/connman.cpp\r\nindex f81658b83..f5867f8b4 100644\r\n--- a/src/test/fuzz/connman.cpp\r\n+++ b/src/test/fuzz/connman.cpp\r\n@@ -128,4 +128,6 @@ FUZZ_TARGET_INIT(connman, initialize_connman)\r\n     (void)connman.GetTotalBytesSent();\r\n     (void)connman.GetTryNewOutboundPeer();\r\n     (void)connman.GetUseAddrmanOutgoing();\r\n+    const Network net{fuzzed_data_provider.PickValueInArray({Network::NET_IPV4, Network::NET_IPV6, Network::NET_INTERNAL, Network::NET_ONION})};\r\n+    (void)connman.GetFullOutboundAndManualCount(net);\r\n }\r\n```",
      "created_at" : "2023-05-29T19:19:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1567445222",
      "id" : 1567445222,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585dbVDm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1567445222/reactions"
      },
      "updated_at" : "2023-05-29T19:19:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1567445222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1209611483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209611483"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In `377e81e2e409470d00e69247d0d9e980773ab73e`, I suppose this verification could be avoided. In `Select`, \r\n`new_only` is false by default and `preferred_net` is optional and it will only have a value when `MaybePickPreferredNetwork`returns true. So, if `preferred_net` doesn't have any value, I suppose that `addrman.Select(false, preferred_net)` and `addrman.Select()` will have the same effect.\r\n\r\n```diff\r\n@@ -1901,15 +1915,7 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\r\n                     std::tie(addr, addr_last_try) = addrman.Select(true);\r\n                 }\r\n             } else {\r\n-                // Not a feeler\r\n-                if (preferred_net.has_value()) {\r\n-                    // pick an extra outbound peer from a preferred network.\r\n-                    // The eviction logic in net_processing makes sure that\r\n-                    //  a peer from another network will be evicted.\r\n-                    std::tie(addr, addr_last_try) = addrman.Select(false, preferred_net);\r\n-                } else {\r\n-                    std::tie(addr, addr_last_try) = addrman.Select();\r\n-                }\r\n+                std::tie(addr, addr_last_try) = addrman.Select(false, preferred_net);\r\n```",
      "commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "created_at" : "2023-05-30T00:51:44Z",
      "diff_hunk" : "@@ -1871,7 +1902,14 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n             } else {\n                 // Not a feeler\n-                std::tie(addr, addr_last_try) = addrman.Select();\n+                if (preferred_net.has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1209611483",
      "id" : 1209611483,
      "line" : 1905,
      "node_id" : "PRRC_kwDOABII585IGTTb",
      "original_commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "original_line" : 1905,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 83,
      "pull_request_review_id" : 1449933790,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209611483/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-30T00:51:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1209611483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/19480819?v=4",
         "events_url" : "https://api.github.com/users/brunoerg/events{/privacy}",
         "followers_url" : "https://api.github.com/users/brunoerg/followers",
         "following_url" : "https://api.github.com/users/brunoerg/following{/other_user}",
         "gists_url" : "https://api.github.com/users/brunoerg/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/brunoerg",
         "id" : 19480819,
         "login" : "brunoerg",
         "node_id" : "MDQ6VXNlcjE5NDgwODE5",
         "organizations_url" : "https://api.github.com/users/brunoerg/orgs",
         "received_events_url" : "https://api.github.com/users/brunoerg/received_events",
         "repos_url" : "https://api.github.com/users/brunoerg/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/brunoerg/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/brunoerg/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/brunoerg"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1218526503"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218526503"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nice simplification! incorporated in latest push",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-05T19:53:50Z",
      "diff_hunk" : "@@ -1871,7 +1902,14 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n             } else {\n                 // Not a feeler\n-                std::tie(addr, addr_last_try) = addrman.Select();\n+                if (preferred_net.has_value()) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1218526503",
      "id" : 1218526503,
      "in_reply_to_id" : 1209611483,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IoT0n",
      "original_commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "original_line" : 1905,
      "original_position" : 64,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1463292868,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218526503/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T19:53:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218526503",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1218543773"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218543773"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah, I see what you're saying - that we can avoid iterating through all peers when we are only running on one network. \r\n\r\nI've implemented a version of your suggestion in https://github.com/amitiuttarwar/bitcoin/commit/1805698096ae29e8dd6ecd1be9348a04f612602c. I changed the function implementation and also invoked from the additional call site in `MaybePickPreferredNetwork`. It seems viable.\r\n\r\nI haven't pushed it here yet because I'm still trying to figure out a slightly cleaner solution. I noticed that we are introducing a lot of functions to `CConnman` that iterate through the networks to check similar-but-slightly-different attributes. `GetReachableEmptyNetworks` already exists, this PR introduces `MaybePickPreferredNetwork`, and now we may also add this function, `SupportsMultipleNetworks`. given that `CConnman` is already quite large & frequently imported, I'm trying to see if there's a way we could consolidate these similar functions together. will report back later this week :) ",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-05T20:10:21Z",
      "diff_hunk" : "@@ -5155,6 +5157,12 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // Protect a peer if it's the only one for its network, counting IPv4 and\n+            // IPv6 as one network.\n+            // Both outbound-full-relay and manual connections are counted for this,\n+            // but not block-relay-only connections because the goal\n+            // is to have at least one tx-relaying connection to each reachable network.\n+            if (m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1218543773",
      "id" : 1218543773,
      "in_reply_to_id" : 1209501764,
      "line" : 5165,
      "node_id" : "PRRC_kwDOABII585IoYCd",
      "original_commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "original_line" : 5165,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 18,
      "pull_request_review_id" : 1463320586,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218543773/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-05T20:10:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218543773",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks for the review @brunoerg ! latest push incorporated fuzz test & `ThreadOpenConnections` simplification. I'm still working on the other feedback (as explained above). \r\n\r\none question about your suggested patch in the fuzz test: \r\n`const Network net{fuzzed_data_provider.PickValueInArray({Network::NET_IPV4, Network::NET_IPV6, Network::NET_INTERNAL, Network::NET_ONION})};`\r\nis there a reason to select from the subset of networks? in the patch I pushed up, I also added the other ones. I saw that  `ConsumeNetAddr` used the same subset, but I am guessing that's because of other challenges in creating network addresses. just wanted to check to see if there's something I'm missing.\r\n\r\n### IPv4 & IPv6 treatment\r\nContext refresher: the open question is whether IPv4 & IPv6 should be bundled together as âclearnetâ or treated as two separate networks. The current proposal opts for the former.\r\n\r\nAfter chatting this through with @mzumsande, we are still leaning towards bundling into a single clearnet. Here is our understanding & rationale. We are curious to hear more feedback from reviewers, and are open to being persuaded that the alternative approach is beneficial through concrete examples.\r\n* We do not see clear value in treating them separately: from our research, it seems that most cloud providers allow users to expose IPv4 or IPv6 addresses with trivial setup. If users are running a node on a different setup, eg. local, they can also use a VPN to expose the opposite. The amount of effort required to obtain the opposite address generally seems minimal, which means diversifying would not meaningfully increase the cost of attack for a malicious entity.\r\n* The potential downside is clear: by default, bitcoind considers both IPv4 & IPv6 to be reachable. However, both Martin & I have experienced running nodes within a network setup such that only connection attempts to IPv4 nodes were successful. A node in this environment running current master will still have failed IPv6 connection attempts. But the problem (aka frequency of failed attempts) would increase in severity if we added this patch with logic that treated IPv4 & IPv6 separately.\r\n* If we wanted to treat these two networks separately and not worsen the rate of failed connections, we would have to add additional logic to prevent infinite periodic attempts (eg. to IPv6 nodes in the previous example). This additional complexity is viable, but does not feel justified given not having a clear value add of separating the two networks.\r\n* Just to clarify, having too many peers be protected from eviction is not a current concern regardless of the approach selected here.\r\n\r\n@vasild, @0xB10C - thoughts?",
      "created_at" : "2023-06-05T20:23:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1577424366",
      "id" : 1577424366,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585eBZXu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577424366/reactions"
      },
      "updated_at" : "2023-06-05T20:23:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577424366",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I am slowly coming back to this PR...\r\n\r\n> we are still leaning towards bundling into a single clearnet ... - thoughts?\r\n\r\nOk :)\r\n\r\n",
      "created_at" : "2023-06-06T11:43:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1578579892",
      "id" : 1578579892,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585eFze0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1578579892/reactions"
      },
      "updated_at" : "2023-06-06T11:43:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1578579892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1219678326"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219678326"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`GetFullOutboundAndManualCount()` will iterate on all nodes, and is called from `ForEachNode()` which iterates on all nodes. This makes it `O(number of nodes ^ 2)`. This will also do a recursive lock on `m_nodes_mutex` and there is an ongoing effort to eradicate recursive locks from the code base.\r\n\r\nSo, what about collecting the stats (a network->count map) just once, before the `ForEachNode()` call?",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-06T13:41:05Z",
      "diff_hunk" : "@@ -5155,6 +5157,12 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // Protect a peer if it's the only one for its network, counting IPv4 and\n+            // IPv6 as one network.\n+            // Both outbound-full-relay and manual connections are counted for this,\n+            // but not block-relay-only connections because the goal\n+            // is to have at least one tx-relaying connection to each reachable network.\n+            if (m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1219678326",
      "id" : 1219678326,
      "line" : 5165,
      "node_id" : "PRRC_kwDOABII585IstB2",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 5165,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 18,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219678326/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1219678326",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221338648"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221338648"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This test seems correct but is a bit obscure as it juggles with `vNodes[max_outbound_full_relay - 2]` and `vNodes.back()`. Here it does not check the value of `vNodes[max_outbound_full_relay - 1]->fDisconnect` (it is supposed to be `true`, left unmodified from the previous test).\r\n\r\nMaybe it would help a bit if:\r\n* before the newly added test snippet set `vNodes[max_outbound_full_relay - 1]->fDisconnect` to `false`, so that all of them are `false` then the new test starts.\r\n* `back()` is not used and `[max_outbound_full_relay + 1]` is used instead (and `[max_outbound_full_relay + 2]` at the end).",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-07T10:23:35Z",
      "diff_hunk" : "@@ -197,6 +207,27 @@ BOOST_AUTO_TEST_CASE(stale_tip_peer_management)\n     BOOST_CHECK(vNodes[max_outbound_full_relay-1]->fDisconnect == true);\n     BOOST_CHECK(vNodes.back()->fDisconnect == false);\n \n+    // Add an onion peer, that will be protected because it is the only one for\n+    // its network, so another peer gets disconnected instead.\n+    SetMockTime(time_init);\n+    AddRandomOutboundPeer(id, vNodes, *peerLogic, *connman, ConnectionType::OUTBOUND_FULL_RELAY, /*onion_peer=*/true);\n+    SetMockTime(time_later);\n+    peerLogic->CheckForStaleTipAndEvictPeers();\n+\n+    for (int i = 0; i < max_outbound_full_relay - 2; ++i) {\n+        BOOST_CHECK(vNodes[i]->fDisconnect == false);\n+    }\n+    BOOST_CHECK(vNodes[max_outbound_full_relay - 2]->fDisconnect == true);\n+    BOOST_CHECK(vNodes.back()->fDisconnect == false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221338648",
      "id" : 1221338648,
      "line" : 221,
      "node_id" : "PRRC_kwDOABII585IzCYY",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 221,
      "original_position" : 37,
      "original_start_line" : 220,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : 37,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221338648/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 220,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221338648",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221348635"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221348635"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The return value and the optional output argument are redundant. Better to return `std::optional` and take no arguments:\r\n\r\n```cpp\r\nstd::optional<Network> MaybePickPreferredNetwork()\r\n```\r\n(would have to be called outside of `else if (...` which I find clearer).\r\n\r\nOr drop the optional:\r\n\r\n```cpp\r\nbool MaybePickPreferredNetwork(Network& network);\r\n```",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-07T10:28:13Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221348635",
      "id" : 1221348635,
      "line" : 1032,
      "node_id" : "PRRC_kwDOABII585IzE0b",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1032,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 37,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221348635/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1028,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221348635",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221384118"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221384118"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`GetFullOutboundAndManualCount(net)` is called for each network and each call iterates all nodes, collecting stats just for the given network, ignoring the others. It can collect all the stats with one iteration (network->count map) and be called just once, before this loop (vs for each netowork).",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-07T10:55:15Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::vector<Network> preferred_networks;\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && GetFullOutboundAndManualCount(net) == 0 && addrman.Size(net) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221384118",
      "id" : 1221384118,
      "line" : 1636,
      "node_id" : "PRRC_kwDOABII585IzNe2",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1636,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 29,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221384118/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221384118",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221406171"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221406171"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "There is no need to collect more than one element in `preferred_networks`, the previous loop can be stopped as soon as a match is found and the shuffling can be done on the order in which networks are iterated (untested):\r\n\r\n```cpp\r\nstd::optional<Network> CConnman::MaybePickPreferredNetwork()\r\n{\r\n    std::array<Network, 5> nets{NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS};\r\n    Shuffle(nets.begin(), nets.end(), FastRandomContext());\r\n    auto peers_per_net = GetFullOutboundAndManualCounts();\r\n    for (const auto net : nets) {\r\n        if (IsReachable(net) && peers_per_net[net] == 0 && addrman.Size(net) != 0) {\r\n            return net;\r\n        }\r\n    }\r\n    return std::nullopt;\r\n}\r\n```",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-07T11:16:04Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::vector<Network> preferred_networks;\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && GetFullOutboundAndManualCount(net) == 0 && addrman.Size(net) != 0) {\n+            preferred_networks.push_back(net);\n+        }\n+    }\n+    if (preferred_networks.size() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221406171",
      "id" : 1221406171,
      "line" : 1640,
      "node_id" : "PRRC_kwDOABII585IzS3b",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1640,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 33,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221406171/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221406171",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221421939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221421939"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The way this is implemented would give clearnet 2x chance of being returned over another network with 0 peers. Is this the intention?\r\n\r\nFor example: let all of IPv4, IPv6 and Tor be reachable and there are 0 peers to each of those networks. Clearnet (IPv4 or IPv6) will be returned in 67% of the cases and Tor in 33%. Should that not be clearnet 50%, Tor 50%?",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-07T11:30:44Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1221421939",
      "id" : 1221421939,
      "line" : 1630,
      "node_id" : "PRRC_kwDOABII585IzWtz",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1630,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1465241616,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221421939/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-07T11:36:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1221421939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> * The potential downside is clear: by default, bitcoind considers both IPv4 & IPv6 to be reachable. However, both Martin & I have experienced running nodes within a network setup such that only connection attempts to IPv4 nodes were successful. A node in this environment running current master will still have failed IPv6 connection attempts. But the problem (aka frequency of failed attempts) would increase in severity if we added this patch with logic that treated IPv4 & IPv6 separately.\r\n\r\nI'm not convinced this is a problem in the first place -- failed connection attempts on networks that don't exist don't seem to impose any significant costs?\r\n\r\nIt seems simpler to me to just treat each network as if it's meaningfully distinct, and try to remain connected to each one if possible. I'm not sure trying to be more clever about that (eg: we want one of ipv4 or ipv6 because those connections are fast; we want new networks like cjdns because otherwise they might be really hard to bootstrap because few outbound connections are made; we want i2p because it's harder to eclipse than tor; etc) actually has much benefit?\r\n\r\nIf we are worried about failed connections for some reason, we could lower the frequency from 1 minute to perhaps 5 minutes. I think the worst case scenario there is when you have all 8 outbounds via one network (ipv4 eg), want to make a connection to another network (eg cjdns), but have all 3 remaining networks (ipv6, tor, i2p) marked as reachable but not actually functioning. Then you've got a 75% chance of `MaybePickPreferredNetwork` wasting your time, and having to wait another interval. That seems to have about a 4x multiplier in the worst case, so you'd only be making the extra net outbound connection perhaps every 20 minutes, instead of every 5 minutes. But for a long-lived node, that's probably not too bad even so. And in the ordinary case where you only perhaps have ipv6 as reachable but not working, it's only a 2x multiplier.",
      "created_at" : "2023-06-08T02:47:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1581806840",
      "id" : 1581806840,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585eSHT4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1581806840/reactions"
      },
      "updated_at" : "2023-06-08T02:47:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1581806840",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222386277"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222386277"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yeah, the reason for this function signature was to enable calling from within the `else if(...)` conditional. pulling it out would mean having to run `MaybePickPreferredNetwork` every time `ThreadOpenConnections` runs, which seems unnecessary?",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-08T02:53:13Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222386277",
      "id" : 1222386277,
      "in_reply_to_id" : 1221348635,
      "line" : 1032,
      "node_id" : "PRRC_kwDOABII585I3CJl",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1032,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 37,
      "pull_request_review_id" : 1468900045,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222386277/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1028,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-08T02:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222386277",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222388434"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222388434"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think the requirement here is only \"try each network with reasonable probability\" -- you want to be connected to all of the networks, so which one comes first doesn't matter very much.\r\n\r\nIf you don't have ipv4 or ipv6 connections but are going through this codepath, then that means you have all your outbounds connected via privacy networks, but haven't chosen to `-onlynet=tor` or similar. So biassing towards clearnet probably makes sense anyway: clearnet connections probably have higher bandwidth/lower latency so will give you blocks/txs quicker, reducing the load on the privacy networks.",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-08T02:55:30Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222388434",
      "id" : 1222388434,
      "in_reply_to_id" : 1221421939,
      "line" : 1630,
      "node_id" : "PRRC_kwDOABII585I3CrS",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1630,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1468903183,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222388434/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T02:55:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222388434",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222985986"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222985986"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "yes, that would be unnecessary",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-08T12:42:52Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1222985986",
      "id" : 1222985986,
      "in_reply_to_id" : 1221348635,
      "line" : 1032,
      "node_id" : "PRRC_kwDOABII585I5UkC",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1032,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 37,
      "pull_request_review_id" : 1469829293,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222985986/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1028,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-08T12:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1222985986",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "On treating IPv4 and IPv6 as one network - I am ok either way. I see the merit in amiti's considerations above, but also on @ajtowns's. One more thing to consider - for an attacker it is not too difficult to get IPv6 connectivity but that is also the case for Tor. I mean it is not too difficult to get Tor connectivity either, but that is still _some_ extra effort.",
      "created_at" : "2023-06-08T12:59:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1582537371",
      "id" : 1582537371,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585eU5qb",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582537371/reactions"
      },
      "updated_at" : "2023-06-08T12:59:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1582537371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1223007090"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223007090"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I am just checking because elsewhere the intention is to treat clearnet as one network and this code does not do that. I do not have a strong opinion either way.",
      "commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "created_at" : "2023-06-08T12:59:48Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1223007090",
      "id" : 1223007090,
      "in_reply_to_id" : 1221421939,
      "line" : 1630,
      "node_id" : "PRRC_kwDOABII585I5Zty",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1630,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 23,
      "pull_request_review_id" : 1469865038,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223007090/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-08T12:59:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223007090",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1223373778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223373778"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "okay, going to resolve this thread. but lmk if you have any other suggestions, it's definitely a bit odd.. ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-08T17:50:20Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1223373778",
      "id" : 1223373778,
      "in_reply_to_id" : 1221348635,
      "line" : 1040,
      "node_id" : "PRRC_kwDOABII585I6zPS",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1040,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 45,
      "pull_request_review_id" : 1470491780,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223373778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1036,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-08T17:50:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223373778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913119"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913119"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "latest push collects stats as a `CConnman` member, so we don't have to worry about iterating through all nodes",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T19:55:02Z",
      "diff_hunk" : "@@ -5155,6 +5157,12 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // Protect a peer if it's the only one for its network, counting IPv4 and\n+            // IPv6 as one network.\n+            // Both outbound-full-relay and manual connections are counted for this,\n+            // but not block-relay-only connections because the goal\n+            // is to have at least one tx-relaying connection to each reachable network.\n+            if (m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913119",
      "id" : 1225913119,
      "in_reply_to_id" : 1219678326,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEfMf",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 5165,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1473810726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913119/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T19:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913119",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913181"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913181"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated to incorporate your suggestions, thanks!",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T19:55:42Z",
      "diff_hunk" : "@@ -197,6 +207,27 @@ BOOST_AUTO_TEST_CASE(stale_tip_peer_management)\n     BOOST_CHECK(vNodes[max_outbound_full_relay-1]->fDisconnect == true);\n     BOOST_CHECK(vNodes.back()->fDisconnect == false);\n \n+    // Add an onion peer, that will be protected because it is the only one for\n+    // its network, so another peer gets disconnected instead.\n+    SetMockTime(time_init);\n+    AddRandomOutboundPeer(id, vNodes, *peerLogic, *connman, ConnectionType::OUTBOUND_FULL_RELAY, /*onion_peer=*/true);\n+    SetMockTime(time_later);\n+    peerLogic->CheckForStaleTipAndEvictPeers();\n+\n+    for (int i = 0; i < max_outbound_full_relay - 2; ++i) {\n+        BOOST_CHECK(vNodes[i]->fDisconnect == false);\n+    }\n+    BOOST_CHECK(vNodes[max_outbound_full_relay - 2]->fDisconnect == true);\n+    BOOST_CHECK(vNodes.back()->fDisconnect == false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913181",
      "id" : 1225913181,
      "in_reply_to_id" : 1221338648,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEfNd",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 221,
      "original_position" : 37,
      "original_start_line" : 220,
      "path" : "src/test/denialofservice_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1473810796,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913181/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-11T19:55:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913181",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913245"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913245"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "moved to member to prevent iterating through all nodes",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T19:56:15Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::vector<Network> preferred_networks;\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && GetFullOutboundAndManualCount(net) == 0 && addrman.Size(net) != 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913245",
      "id" : 1225913245,
      "in_reply_to_id" : 1221384118,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEfOd",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1636,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1473810877,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913245/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T19:56:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913270"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913270"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done, thanks!",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T19:56:23Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::vector<Network> preferred_networks;\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && GetFullOutboundAndManualCount(net) == 0 && addrman.Size(net) != 0) {\n+            preferred_networks.push_back(net);\n+        }\n+    }\n+    if (preferred_networks.size() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913270",
      "id" : 1225913270,
      "in_reply_to_id" : 1221406171,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEfO2",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1640,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1473810893,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913270/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T19:56:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913270",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913626"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "we have now removed any clearnet bundling, so this quirk is no longer relevant ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T19:57:11Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225913626",
      "id" : 1225913626,
      "in_reply_to_id" : 1221421939,
      "line" : 1621,
      "node_id" : "PRRC_kwDOABII585JEfUa",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1621,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 39,
      "pull_request_review_id" : 1473811292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913626/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T19:57:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225913626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225914692"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225914692"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "question: I noticed you used array in your implementation but we were using vector. is there a strong reason for that? ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T20:01:11Z",
      "diff_hunk" : "@@ -1608,6 +1608,43 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+int CConnman::GetFullOutboundAndManualCount(Network net) const\n+{\n+    LOCK(m_nodes_mutex);\n+    int outbound_peers{0};\n+    std::optional<Network> net_alt;\n+    // Treat clearnet (IPv4 and IPv6) as one network\n+    if (net == Network::NET_IPV4) net_alt = Network::NET_IPV6;\n+    if (net == Network::NET_IPV6) net_alt = Network::NET_IPV4;\n+    for (const auto& pnode : m_nodes) {\n+        if (pnode->fSuccessfullyConnected && !pnode->fDisconnect && (pnode->IsFullOutboundConn() || pnode->IsManualConn())) {\n+            auto net_peer{pnode->addr.GetNetwork()};\n+            if (net == net_peer || (net_alt.has_value() && net_alt == net_peer)) {\n+                ++outbound_peers;\n+            }\n+        }\n+    }\n+    return outbound_peers;\n+}\n+\n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::vector<Network> preferred_networks;\n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        if (net == NET_UNROUTABLE || net == NET_INTERNAL) continue;\n+        if (IsReachable(net) && GetFullOutboundAndManualCount(net) == 0 && addrman.Size(net) != 0) {\n+            preferred_networks.push_back(net);\n+        }\n+    }\n+    if (preferred_networks.size() > 0) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225914692",
      "id" : 1225914692,
      "in_reply_to_id" : 1221406171,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEflE",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1640,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1473812674,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225914692/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T20:01:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225914692",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thank you for the reviews @ajtowns & @vasild ð \r\n\r\nsignificant changes with latest push: \r\n* introduce a new member on `CConnman` called `m_network_conn_counts` which is a map from `Network` to an atomic that keeps track of the number of `OUTBOUND_FULL_RELAY` and `MANUAL` connections on the node broken down by network. this means we don't have to iterate through all nodes anymore. \r\n* changed the interval from 1 min to 5 min. \r\n* got rid of any \"clearnet\" bundling, now we treat IPV4 & IPV6 as separate networks, just like any other. \r\n\r\none note: naming is HARD. there's a lot of \"full-outbound-or-manual\" in the code, which is quite a mouthful. I couldn't come up with any good names for the combo, but open to suggestions. I think \"full-tx-outbound\" would be the combined name, but it's confusing since `OUTBOUND_FULL_RELAY` is the name of the automatic connections. Instead of renaming all of `OUTBOUND_FULL_RELAY` to `AUTOMATIC_OUTBOUND_FULL_RELAY` or something, I opted for the mouthful of \"full outbound or manual\". ",
      "created_at" : "2023-06-11T20:03:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1586321519",
      "id" : 1586321519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585ejVhv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1586321519/reactions"
      },
      "updated_at" : "2023-06-11T20:03:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1586321519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225915157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225915157"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated to have a small connman member to keep track of counts. now we don't iterate through all peers anymore :) ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-11T20:04:29Z",
      "diff_hunk" : "@@ -5155,6 +5157,12 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // Protect a peer if it's the only one for its network, counting IPv4 and\n+            // IPv6 as one network.\n+            // Both outbound-full-relay and manual connections are counted for this,\n+            // but not block-relay-only connections because the goal\n+            // is to have at least one tx-relaying connection to each reachable network.\n+            if (m_connman.GetFullOutboundAndManualCount(pnode->addr.GetNetwork()) <= 1) return;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1225915157",
      "id" : 1225915157,
      "in_reply_to_id" : 1209501764,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JEfsV",
      "original_commit_id" : "377e81e2e409470d00e69247d0d9e980773ab73e",
      "original_line" : 5165,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : null,
      "pull_request_review_id" : 1473813096,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225915157/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-11T20:04:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1225915157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1226781222"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226781222"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: This belongs in the first commit, not the second.",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-12T14:37:49Z",
      "diff_hunk" : "@@ -29,7 +29,10 @@ struct ConnmanTestMsg : public CConnman {\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(&node);\n+\n+        if (node.IsManualOrFullOutboundConn()) { m_network_conn_counts[node.ConnectedThroughNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1226781222",
      "id" : 1226781222,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585JHzIm",
      "original_commit_id" : "a5e431daf0af08c4e5e177a9208b87398c9d8669",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/net.h",
      "position" : 5,
      "pull_request_review_id" : 1475101835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226781222/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T15:28:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226781222",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1226797402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226797402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is the use of `ConnectedThroughNetwork()` instead of `addr.GetNetwork()` on purpose?\r\nThe name and the extra logic for inbound onions suggest that it's tailored towards inbound connections, and there is the subtle difference that it calls `addr.GetNetClass()` instead of `addr.GetNetwork()`, which means a different behavior for linked IPV4 addresses.\r\n\r\nI think that in general it would be good to have more consistency between these two functions, which is out of scope for this PR.\r\nBut we should have consistency in what function is called here (the net_processing call to `MultipleManualOrFullOutboundConns` uses  `GetNetwork()`)",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-12T14:48:14Z",
      "diff_hunk" : "@@ -575,6 +575,8 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[pnode->ConnectedThroughNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1226797402",
      "id" : 1226797402,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JH3Fa",
      "original_commit_id" : "d1142f031c7a19a28ad8fdacd6fde110992228c8",
      "original_line" : 578,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1475101835,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226797402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-12T15:28:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1226797402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1230127530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230127530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks, fixed ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-14T20:25:45Z",
      "diff_hunk" : "@@ -29,7 +29,10 @@ struct ConnmanTestMsg : public CConnman {\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(&node);\n+\n+        if (node.IsManualOrFullOutboundConn()) { m_network_conn_counts[node.ConnectedThroughNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1230127530",
      "id" : 1230127530,
      "in_reply_to_id" : 1226781222,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585JUkGq",
      "original_commit_id" : "a5e431daf0af08c4e5e177a9208b87398c9d8669",
      "original_line" : 33,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/test/util/net.h",
      "position" : 5,
      "pull_request_review_id" : 1480240247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230127530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-14T20:25:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230127530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1230129705"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230129705"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch! I didn't realize that difference between `GetNetClass()` and `GetNetwork()`. updated this site to use `GetNetwork()` in the latest push.  ",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-14T20:27:21Z",
      "diff_hunk" : "@@ -575,6 +575,8 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[pnode->ConnectedThroughNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1230129705",
      "id" : 1230129705,
      "in_reply_to_id" : 1226797402,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585JUkop",
      "original_commit_id" : "d1142f031c7a19a28ad8fdacd6fde110992228c8",
      "original_line" : 578,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1480242839,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230129705/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-14T20:27:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230129705",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes. Array does not involve heap allocation - it is simpler and cheaper structure than vector. If the size is known upfront and it is not going to be resized later then array is the obvious choice.",
      "created_at" : "2023-06-15T16:17:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1593364620",
      "id" : 1593364620,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585e-NCM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593364620/reactions"
      },
      "updated_at" : "2023-06-15T16:17:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593364620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "\r\n\r\nOn 11 June 2023 22:03:39 CEST, Amiti Uttarwar ***@***.***> wrote:\r\n>thank you for the reviews @ajtowns & @vasild ð \r\n>\r\n>significant changes with latest push: \r\n>* introduce a new member on `CConnman` called `m_network_conn_counts` which is a map from `Network` to an atomic that keeps track of the number of `OUTBOUND_FULL_RELAY` and `MANUAL` connections on the node broken down by network. this means we don't have to iterate through all nodes anymore. \r\n\r\nI did not look at the code yet, but why should it be atomic? If there could be concurrent access then the map itself needs to be protected, not just the individual values.\r\n\r\n>* changed the interval from 1 min to 5 min. \r\n>* got rid of any \"clearnet\" bundling, now we treat IPV4 & IPV6 as separate networks, just like any other. \r\n>\r\n>one note: naming is HARD. there's a lot of \"full-outbound-or-manual\" in the code, which is quite a mouthful. I couldn't come up with any good names for the combo, but open to suggestions. I think \"full-tx-outbound\" would be the combined name, but it's confusing since `OUTBOUND_FULL_RELAY` is the name of the automatic connections. Instead of renaming all of `OUTBOUND_FULL_RELAY` to `AUTOMATIC_OUTBOUND_FULL_RELAY` or something, I opted for the mouthful of \"full outbound or manual\". \r\n\r\nfull-outbound-or-manual looks ok, it is obvious. full-tx-outbound is obscure, only a select few will know what it means, and even they/we will forget it after 6 months\r\n",
      "created_at" : "2023-06-15T16:29:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1593381237",
      "id" : 1593381237,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585e-RF1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593381237/reactions"
      },
      "updated_at" : "2023-06-15T16:29:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1593381237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239822678"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239822678"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style: remove the braces or put the statement on a new line. From `doc/developer-notes.md`:\r\n\r\n>  - If an `if` only has a single-statement `then`-clause, it can appear\r\n    on the same line as the `if`, without braces.\r\n\r\n(same when decrementing)",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-23T13:30:10Z",
      "diff_hunk" : "@@ -575,6 +578,9 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    // update connection count by network\n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[addrConnect.GetNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239822678",
      "id" : 1239822678,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585J5jFW",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 582,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1495153995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239822678/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T13:51:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239822678",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239824684"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239824684"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might as well use `++` instead `+= 1`:\r\n\r\n```cpp\r\n++m_network_conn_counts[addrConnect.GetNetwork()]\r\n```\r\n\r\n(same when decrementing)",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-23T13:31:56Z",
      "diff_hunk" : "@@ -575,6 +578,9 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    // update connection count by network\n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[addrConnect.GetNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239824684",
      "id" : 1239824684,
      "line" : 582,
      "node_id" : "PRRC_kwDOABII585J5jks",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 582,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1495153995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239824684/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T13:51:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239824684",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239828132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239828132"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This is unnecessary, you can just drop it. The first time `operator[]` is used for a given key a default-initialized value is inserted for that key, which in our case is `0`.",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-23T13:35:16Z",
      "diff_hunk" : "@@ -2360,6 +2404,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         semAddnode = std::make_unique<CSemaphore>(nMaxAddnode);\n     }\n \n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        m_network_conn_counts[net] = 0;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239828132",
      "id" : 1239828132,
      "line" : 2411,
      "node_id" : "PRRC_kwDOABII585J5kak",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 2411,
      "original_position" : 110,
      "original_start_line" : 2407,
      "path" : "src/net.cpp",
      "position" : 110,
      "pull_request_review_id" : 1495153995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239828132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2407,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-23T13:51:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239828132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239840312"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239840312"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This map can be accessed from multiple threads and has to be protected by a mutex. It is too dangerous to assume that it will never be modified. [operator[]](https://en.cppreference.com/w/cpp/container/map/operator_at) which is used later in the code is not `const`. For example, it is not guaranteed that it will not cause some internal reorg of the structure.\r\n\r\n`std::unordered_map` suits better here because we don't need an order and its access and insertion complexity is `O(1)`.\r\n\r\nIf you really like using unprotected structure of atomics, then maybe `std::array` would be ok (but have to index using `Network` which smells bad). Another option - would it be possible to make this map or array `const`?",
      "commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "created_at" : "2023-06-23T13:46:22Z",
      "diff_hunk" : "@@ -1023,6 +1052,9 @@ class CConnman\n     std::chrono::seconds nMaxOutboundCycleStartTime GUARDED_BY(m_total_bytes_sent_mutex) {0};\n     uint64_t nMaxOutboundLimit GUARDED_BY(m_total_bytes_sent_mutex);\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::map<Network, std::atomic<unsigned int>> m_network_conn_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1239840312",
      "id" : 1239840312,
      "line" : 1056,
      "node_id" : "PRRC_kwDOABII585J5nY4",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 1056,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 55,
      "pull_request_review_id" : 1495153995,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239840312/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-23T13:51:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239840312",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241000169"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241000169"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "my latest thinking was to change this data struct to an array, add explicit numeric values to the `Network` enum (for index values) & then protect the array with `m_nodes_mutex` to keep the values consistent between the relevant data structures tracking node data. what do you think of this approach? \r\n\r\n(I had coded it up, but then managed to spill liquid on my laptop which fried it as I was trying to push the changes. still working to get my current setup back to functional to make the changes ð¬)\r\n\r\n> Another option - would it be possible to make this map or array const?\r\n\r\nnot sure I follow. what would it mean for the array to be const? isn't the point to update the values? ð",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-25T02:02:00Z",
      "diff_hunk" : "@@ -1023,6 +1052,9 @@ class CConnman\n     std::chrono::seconds nMaxOutboundCycleStartTime GUARDED_BY(m_total_bytes_sent_mutex) {0};\n     uint64_t nMaxOutboundLimit GUARDED_BY(m_total_bytes_sent_mutex);\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::map<Network, std::atomic<unsigned int>> m_network_conn_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241000169",
      "id" : 1241000169,
      "in_reply_to_id" : 1239840312,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J-Cjp",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 1056,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1496861352,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241000169/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-25T02:02:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241000169",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259654"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259654"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated ",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-25T18:24:52Z",
      "diff_hunk" : "@@ -575,6 +578,9 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    // update connection count by network\n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[addrConnect.GetNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259654",
      "id" : 1241259654,
      "in_reply_to_id" : 1239822678,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J_B6G",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 582,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1497159831,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259654/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-25T18:24:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259892"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259892"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-25T18:26:23Z",
      "diff_hunk" : "@@ -575,6 +578,9 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                              });\n     pnode->AddRef();\n \n+    // update connection count by network\n+    if (pnode->IsManualOrFullOutboundConn()) { m_network_conn_counts[addrConnect.GetNetwork()] += 1; }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259892",
      "id" : 1241259892,
      "in_reply_to_id" : 1239824684,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J_B90",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 582,
      "original_position" : 15,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1497160172,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259892/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-25T18:26:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259892",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259991"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259991"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed to array, so this is no longer relevant ",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-25T18:27:08Z",
      "diff_hunk" : "@@ -2360,6 +2404,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         semAddnode = std::make_unique<CSemaphore>(nMaxAddnode);\n     }\n \n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        m_network_conn_counts[net] = 0;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241259991",
      "id" : 1241259991,
      "in_reply_to_id" : 1239828132,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585J_B_X",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 2411,
      "original_position" : 110,
      "original_start_line" : 2407,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1497160267,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259991/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-25T18:27:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241259991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "main update with latest push: changed the data structure to an array, indexed by the net message types & protected by the `m_nodes_mutex`. thanks for the thoughtful reviews! curious to hear thoughts on this new approach \r\n\r\nalso added a log statement to `ThreadOpenConnections` so we can observe frequency of the network connections in our nodes, and incorporated style review suggestions",
      "created_at" : "2023-06-25T18:32:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1606212309",
      "id" : 1606212309,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585fvNrV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1606212309/reactions"
      },
      "updated_at" : "2023-06-25T18:33:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1606212309",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241361033"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361033"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "here and in `test/util/net.h` - this is still using `ConnectedThroughNetwork` (see previous comment).",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T01:14:17Z",
      "diff_hunk" : "@@ -1135,6 +1135,9 @@ void CConnman::DisconnectNodes()\n                 // close socket and cleanup\n                 pnode->CloseSocketDisconnect();\n \n+                // update connection count by network\n+                if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[pnode->ConnectedThroughNetwork()]--;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241361033",
      "id" : 1241361033,
      "line" : 1142,
      "node_id" : "PRRC_kwDOABII585J_aqJ",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 1139,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1497287640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361033/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T01:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361033",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241361274"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361274"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: unrelated whitespace change",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T01:14:53Z",
      "diff_hunk" : "@@ -1023,6 +1038,7 @@ class CConnman\n     std::chrono::seconds nMaxOutboundCycleStartTime GUARDED_BY(m_total_bytes_sent_mutex) {0};\n     uint64_t nMaxOutboundLimit GUARDED_BY(m_total_bytes_sent_mutex);\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241361274",
      "id" : 1241361274,
      "line" : 1055,
      "node_id" : "PRRC_kwDOABII585J_at6",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 1041,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 54,
      "pull_request_review_id" : 1497287640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361274/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T01:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241361274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241362625"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241362625"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think `addrConnect` can't be used here, because it can be empty if `pszDest` is set (that's why the CI fails too). You could use `pnode->addr` instead, which is set from either `addrConnect` or `pszDest` in `ConnectNode()`!",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T01:19:01Z",
      "diff_hunk" : "@@ -2035,6 +2038,9 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(pnode);\n+\n+        // update connection count by network\n+        if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[addrConnect.GetNetwork()]++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241362625",
      "id" : 1241362625,
      "line" : 2089,
      "node_id" : "PRRC_kwDOABII585J_bDB",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 2043,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 113,
      "pull_request_review_id" : 1497287640,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241362625/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T01:20:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241362625",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241879650"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241879650"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> change this data struct to an array, add explicit numeric values to the Network enum (for index values)\r\n\r\nThat seems unnecessary, it is good to rely as less as possible on the actual values of the `Network` enums. That is - the code better not break if `NET_ONION` is not `3`, for example. Use them just as labels. `std::unordered_map` fits best with that - `std::unordered_map<Network, size_t>` would work even if `NET_*` are changed to be strings!\r\n\r\n> ... protect the array with m_nodes_mutex to keep the values consistent between the relevant data structures tracking node data\r\n\r\nYes, that sounds like a good idea!\r\n\r\n> ... spill liquid on my laptop ...\r\n\r\nOh, good luck recovering! :crossed_fingers: \r\n\r\n> isn't the point to update the values?\r\n\r\nRight, that does not make sense. I was thinking about something like this:\r\n\r\n```cpp\r\n    const std::map<Network, size_t> m{{NET_IPV4, 0}, {NET_IPV6, 0}, ...};\r\n    ++m[NET_IPV4]; // modify only the value, not the map structure, not possible\r\n```",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T09:17:37Z",
      "diff_hunk" : "@@ -1023,6 +1052,9 @@ class CConnman\n     std::chrono::seconds nMaxOutboundCycleStartTime GUARDED_BY(m_total_bytes_sent_mutex) {0};\n     uint64_t nMaxOutboundLimit GUARDED_BY(m_total_bytes_sent_mutex);\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::map<Network, std::atomic<unsigned int>> m_network_conn_counts;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241879650",
      "id" : 1241879650,
      "in_reply_to_id" : 1239840312,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KBZRi",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 1056,
      "original_position" : 55,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1498044167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241879650/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T09:17:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1241879650",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242173358"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242173358"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Hmm, just realized that this is marked as resolved but is not resolved in the code. I am not sure, did you intentionally leave it as it is in the code now or did you forget to drop the optional like I suggested above?",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T13:13:45Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242173358",
      "id" : 1242173358,
      "in_reply_to_id" : 1221348635,
      "line" : 1040,
      "node_id" : "PRRC_kwDOABII585KCg-u",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1040,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 45,
      "pull_request_review_id" : 1498496353,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242173358/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1036,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-26T13:13:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242173358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242180428"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242180428"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "style: use clang-format, this should be:\r\n\r\n```cpp\r\n    bool IsManualOrFullOutboundConn() const \r\n    {\r\n        switch (m_conn_type) {\r\n        case ConnectionType::INBOUND:\r\n...\r\n```",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T13:18:22Z",
      "diff_hunk" : "@@ -465,6 +465,21 @@ class CNode\n         return m_conn_type == ConnectionType::MANUAL;\n     }\n \n+    bool IsManualOrFullOutboundConn() const {\n+        switch (m_conn_type) {\n+            case ConnectionType::INBOUND:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242180428",
      "id" : 1242180428,
      "line" : 470,
      "node_id" : "PRRC_kwDOABII585KCitM",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 470,
      "original_position" : 6,
      "original_start_line" : 468,
      "path" : "src/net.h",
      "position" : 6,
      "pull_request_review_id" : 1498508181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242180428/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 468,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-26T13:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242180428",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242190047"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242190047"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "unrelated whitespace change",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T13:25:17Z",
      "diff_hunk" : "@@ -29,7 +29,10 @@ struct ConnmanTestMsg : public CConnman {\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(&node);\n+\n+        if (node.IsManualOrFullOutboundConn()) m_network_conn_counts[node.ConnectedThroughNetwork()]++;\n     }\n+\n     void ClearTestNodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242190047",
      "id" : 1242190047,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585KClDf",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : 34,
      "path" : "src/test/util/net.h",
      "position" : 8,
      "pull_request_review_id" : 1498508181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242190047/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 34,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-26T13:50:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242190047",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242196931"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242196931"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I suggested `std::array` in another comment as a way to workaround the lack of mutex protection. Now that this is protected by a mutex and no need to tweak or workaround concurrency issues, I think the neatest option is:\r\n\r\n```suggestion\r\n    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);\r\n```\r\n\r\nThe `std::array` usage adds the requirement for sequential values of `NET_*` that are without gaps and start from `0` and have `NET_MAX`. That makes the code more fragile and harder to change in the future.",
      "commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "created_at" : "2023-06-26T13:29:52Z",
      "diff_hunk" : "@@ -1048,6 +1078,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::array<unsigned int, Network::NET_MAX> m_network_conn_counts GUARDED_BY(m_nodes_mutex) = {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242196931",
      "id" : 1242196931,
      "line" : 1082,
      "node_id" : "PRRC_kwDOABII585KCmvD",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 1082,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 63,
      "pull_request_review_id" : 1498508181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242196931/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-26T13:51:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242196931",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242445552"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242445552"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "sorry, I guess I misinterpreted this conversation. let's clarify :) \r\n\r\nyour initial comment had two suggestions \r\n1. remove the out param & return optional instead of bool \r\n2. drop the optional from the out param \r\n\r\nit looks like I focused & responded to the issue with # 1, but overlooked # 2. to restate, I think # 1 would be nice in isolation, but based on the caller, doesn't make the most sense here. \r\n\r\nthat said, # 2 of dropping the optional seems reasonable. the caller is already responsible for checking the return value so the optional isn't adding much value. will update.\r\n\r\nthanks for catching, sorry about that! ",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-26T16:19:12Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242445552",
      "id" : 1242445552,
      "in_reply_to_id" : 1221348635,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KDjbw",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1040,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1498928333,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242445552/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-26T16:19:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1242445552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI failure in feature_proxy.py:\r\n\r\nhttps://cirrus-ci.com/task/4981950109188096?logs=ci#L5325\r\n\r\n```\r\n node0 stderr net.cpp:1142:113: runtime error: unsigned integer overflow: 0 - 1 cannot be represented in type 'value_type' (aka 'unsigned int')\r\n    #0 0x55dbd8047436 in CConnman::DisconnectNodes() src/net.cpp:1142:113\r\n    #1 0x55dbd807d233 in CConnman::ThreadSocketHandler() src/net.cpp:1393:9\r\n    #2 0x55dbd807d233 in CConnman::Start(CScheduler&, CConnman::Options const&)::$_1::operator()() const src/net.cpp:2430:75\r\n    #3 0x55dbd807d233 in void std::__invoke_impl<void, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&>(std::__invoke_other, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:61:14\r\n    #4 0x55dbd807d233 in std::enable_if<is_invocable_r_v<void, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&>, void>::type std::__invoke_r<void, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&>(CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:111:2\r\n    #5 0x55dbd807d233 in std::_Function_handler<void (), CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>::_M_invoke(std::_Any_data const&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_function.h:290:9\r\n    #6 0x55dbd94ac316 in std::function<void ()>::operator()() const /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_function.h:591:9\r\n    #7 0x55dbd94ac316 in util::TraceThread(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>) src/util/thread.cpp:21:9\r\n    #8 0x55dbd807cfc8 in void std::__invoke_impl<void, void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>(std::__invoke_other, void (*&&)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*&&, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:61:14\r\n    #9 0x55dbd807cfc8 in std::__invoke_result<void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>::type std::__invoke<void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>(void (*&&)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*&&, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1&&) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/invoke.h:96:14\r\n    #10 0x55dbd807cfc8 in void std::thread::_Invoker<std::tuple<void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>>::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_thread.h:252:13\r\n    #11 0x55dbd807cfc8 in std::thread::_Invoker<std::tuple<void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>>::operator()() /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_thread.h:259:11\r\n    #12 0x55dbd807cfc8 in std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(std::basic_string_view<char, std::char_traits<char>>, std::function<void ()>), char const*, CConnman::Start(CScheduler&, CConnman::Options const&)::$_1>>>::_M_run() /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../include/c++/12/bits/std_thread.h:210:13\r\n    #13 0x7f22df2e63e2  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xe63e2) (BuildId: 7e8507d31f51627e18fc00bd04ee5a2e01069a96)\r\n    #14 0x7f22dee8f189  (/lib/x86_64-linux-gnu/libc.so.6+0x8f189) (BuildId: bdb8aa3b1b60f9d43e1c70ba98158e05f765efdc)\r\n    #15 0x7f22def1dbcf  (/lib/x86_64-linux-gnu/libc.so.6+0x11dbcf) (BuildId: bdb8aa3b1b60f9d43e1c70ba98158e05f765efdc)\r\nSUMMARY: UndefinedBehaviorSanitizer: unsigned-integer-overflow net.cpp:1142:113 in \r\n",
      "created_at" : "2023-06-28T10:58:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611194968",
      "id" : 1611194968,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gCOJY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611194968/reactions"
      },
      "updated_at" : "2023-06-28T10:58:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611194968",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> ... unsigned integer overflow ...\r\n\r\nMaybe collecting the number of \"full outbound or manual\" connections on the fly was not so bad? I am not objecting pre-collecting and maintaining that number in `CConnman`, just thinking aloud. That looks a bit more tricky and maybe more prone to bugs (like the above). It is also not generic - the \"full outbound or manual\" number is used only in this specific case and unlikely to be used elsewhere in the future. A more generic approach, that could possibly be reused by other code, would be to store the number per connection type and then this specific code would sum the numbers for `OUTBOUND_FULL_RELAY` and `MANUAL`, but that's maybe over-engineering at this point?",
      "created_at" : "2023-06-28T11:39:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611246591",
      "id" : 1611246591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gCav_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611246591/reactions"
      },
      "updated_at" : "2023-06-28T11:39:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611246591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-06-28T11:49:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611260025",
      "id" : 1611260025,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gCeB5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611260025/reactions"
      },
      "updated_at" : "2023-06-28T11:49:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1611260025",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/4500994?v=4",
         "events_url" : "https://api.github.com/users/kristapsk/events{/privacy}",
         "followers_url" : "https://api.github.com/users/kristapsk/followers",
         "following_url" : "https://api.github.com/users/kristapsk/following{/other_user}",
         "gists_url" : "https://api.github.com/users/kristapsk/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/kristapsk",
         "id" : 4500994,
         "login" : "kristapsk",
         "node_id" : "MDQ6VXNlcjQ1MDA5OTQ=",
         "organizations_url" : "https://api.github.com/users/kristapsk/orgs",
         "received_events_url" : "https://api.github.com/users/kristapsk/received_events",
         "repos_url" : "https://api.github.com/users/kristapsk/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/kristapsk/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/kristapsk/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/kristapsk"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248333228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248333228"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "hm, this one was intentional. I edited `AddTestNode` and it was previously missing a whitespace between functions",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:11:28Z",
      "diff_hunk" : "@@ -29,7 +29,10 @@ struct ConnmanTestMsg : public CConnman {\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(&node);\n+\n+        if (node.IsManualOrFullOutboundConn()) m_network_conn_counts[node.ConnectedThroughNetwork()]++;\n     }\n+\n     void ClearTestNodes()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248333228",
      "id" : 1248333228,
      "in_reply_to_id" : 1242190047,
      "line" : 36,
      "node_id" : "PRRC_kwDOABII585KaA2s",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 36,
      "original_position" : 8,
      "original_start_line" : 34,
      "path" : "src/test/util/net.h",
      "position" : 8,
      "pull_request_review_id" : 1507965415,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248333228/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 34,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:11:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248333228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337602"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337602"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "removing the optional from the out param means that the compiler can't guarantee that the value of `network` was set. so `preferred_net` needs a default value, which I set to `NET_UNROUTABLE` and then checked for later in the function. this approach doesn't feel much cleaner to me than the previous of having network be optional, but I don't feel strongly either way. or, is there a better solution I'm not seeing right now?",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:29:02Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337602",
      "id" : 1248337602,
      "in_reply_to_id" : 1221348635,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaB7C",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1040,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1507971350,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337602/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:29:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "changed back to a map, so this is relevant again. removed the explicit initialization due to the default behavior you mentioned. thanks!",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:29:58Z",
      "diff_hunk" : "@@ -2360,6 +2404,11 @@ bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)\n         semAddnode = std::make_unique<CSemaphore>(nMaxAddnode);\n     }\n \n+    for (int n = 0; n < NET_MAX; n++) {\n+        enum Network net = (enum Network)n;\n+        m_network_conn_counts[net] = 0;\n+    }\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337827",
      "id" : 1248337827,
      "in_reply_to_id" : 1239828132,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaB-j",
      "original_commit_id" : "f653a45f4f72dedb53955b89b0290b33cc23cf6d",
      "original_line" : 2411,
      "original_position" : 110,
      "original_start_line" : 2407,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1507971635,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:29:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337990"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337990"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:30:47Z",
      "diff_hunk" : "@@ -1023,6 +1038,7 @@ class CConnman\n     std::chrono::seconds nMaxOutboundCycleStartTime GUARDED_BY(m_total_bytes_sent_mutex) {0};\n     uint64_t nMaxOutboundLimit GUARDED_BY(m_total_bytes_sent_mutex);\n \n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248337990",
      "id" : 1248337990,
      "in_reply_to_id" : 1241361274,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaCBG",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 1041,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1507971905,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337990/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:30:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248337990",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338620"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "thanks! okay, fixed and confirmed that none of the current patch invokes `ConnectedThroughNetwork` anymore :) ",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:33:01Z",
      "diff_hunk" : "@@ -1135,6 +1135,9 @@ void CConnman::DisconnectNodes()\n                 // close socket and cleanup\n                 pnode->CloseSocketDisconnect();\n \n+                // update connection count by network\n+                if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[pnode->ConnectedThroughNetwork()]--;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338620",
      "id" : 1248338620,
      "in_reply_to_id" : 1241361033,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaCK8",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 1139,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1507972522,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:33:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338719"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338719"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah, good catch. updated ",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:33:30Z",
      "diff_hunk" : "@@ -2035,6 +2038,9 @@ void CConnman::OpenNetworkConnection(const CAddress& addrConnect, bool fCountFai\n     {\n         LOCK(m_nodes_mutex);\n         m_nodes.push_back(pnode);\n+\n+        // update connection count by network\n+        if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[addrConnect.GetNetwork()]++;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338719",
      "id" : 1248338719,
      "in_reply_to_id" : 1241362625,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaCMf",
      "original_commit_id" : "c11659b8647552da349e65e6a51af5f1e00b4288",
      "original_line" : 2043,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1507972651,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338719/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:33:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338974"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338974"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated and double checked that clang-format doesn't have any other suggestions for the patch ",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:34:48Z",
      "diff_hunk" : "@@ -465,6 +465,21 @@ class CNode\n         return m_conn_type == ConnectionType::MANUAL;\n     }\n \n+    bool IsManualOrFullOutboundConn() const {\n+        switch (m_conn_type) {\n+            case ConnectionType::INBOUND:",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248338974",
      "id" : 1248338974,
      "in_reply_to_id" : 1242180428,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaCQe",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 470,
      "original_position" : 6,
      "original_start_line" : 468,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1507972996,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338974/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:34:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248338974",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248339085"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248339085"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "ah I see. okay updated :) ",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-06-30T23:35:20Z",
      "diff_hunk" : "@@ -1048,6 +1078,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::array<unsigned int, Network::NET_MAX> m_network_conn_counts GUARDED_BY(m_nodes_mutex) = {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1248339085",
      "id" : 1248339085,
      "in_reply_to_id" : 1242196931,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585KaCSN",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 1082,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1507973154,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248339085/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-30T23:35:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248339085",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "latest push returned to map & addressed review comments\r\n\r\n@vasild \r\nI very much agree with your line of questioning. storing as a data structure definitely has some explicit tradeoffs to counting the number on the fly. neither is a clear winner for me, so I'm fine implementing whatever reviewers prefer. \r\n\r\n> It is also not generic - the \"full outbound or manual\" number is used only in this specific case and unlikely to be used elsewhere in the future. A more generic approach, that could possibly be reused by other code, would be to store the number per connection type and then this specific code would sum the numbers for OUTBOUND_FULL_RELAY and MANUAL, but that's maybe over-engineering at this point?\r\n\r\nyeah, that's exactly the reasoning / conclusion I drew. it wouldn't be too difficult to adapt this data structure in the future, so I think it makes sense to keep it restricted to our use case for now",
      "created_at" : "2023-06-30T23:39:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1615277942",
      "id" : 1615277942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gRy92",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615277942/reactions"
      },
      "updated_at" : "2023-06-30T23:39:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1615277942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253827052"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253827052"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "We already require `NET_*` to go from 0 to NET_MAX with no gaps every time we do `for (int n = 0; n < NET_MAX; ++n)`. It's a standard expectation of enums and it's documented as such in netaddress.h. It's not an added requirement, and doesn't make the code fragile or harder to change...",
      "commit_id" : "7a1c663e3727695a081a735c37819241341f3730",
      "created_at" : "2023-07-06T01:52:29Z",
      "diff_hunk" : "@@ -1048,6 +1078,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::array<unsigned int, Network::NET_MAX> m_network_conn_counts GUARDED_BY(m_nodes_mutex) = {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253827052",
      "id" : 1253827052,
      "in_reply_to_id" : 1242196931,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Ku-Hs",
      "original_commit_id" : "564bf851cccd34e859f23b6e6b00debebba9a3c2",
      "original_line" : 1082,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1515610747,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253827052/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T01:52:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253827052",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253855939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253855939"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "reverted to the original optional arg in the latest push (https://github.com/bitcoin/bitcoin/compare/7a1c663e3727695a081a735c37819241341f3730..1e65aae8068ecf313a7c3b176dfc1326b3b67fbe) - checking for `preferred_net` meant I changed the default behavior. in order to fix that I would have had to add another else statement which seems more confusing than the original implementation, so went back",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-06T02:44:50Z",
      "diff_hunk" : "@@ -1010,6 +1018,19 @@ class CConnman\n      */\n     std::vector<CAddress> GetCurrentBlockRelayOnlyConns() const;\n \n+    /**\n+     * Search for a \"preferred\" network, a reachable network to which we currently\n+     * don't have any outbound connections (outbound-full-relay or manual, counting IPv4\n+     * and IPv6 as one network).\n+     * There needs to be at least one address in AddrMan for a preferred network to\n+     * be picked.\n+     *\n+     * @param[out]    network        Preferred network, if found.\n+     *\n+     * @return           bool        Whether a preferred network was found.\n+     */\n+    bool MaybePickPreferredNetwork(std::optional<Network>& network);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253855939",
      "id" : 1253855939,
      "in_reply_to_id" : 1221348635,
      "line" : 1041,
      "node_id" : "PRRC_kwDOABII585KvFLD",
      "original_commit_id" : "df76eb535bbd215da17cee8e0f480af9e94e9e70",
      "original_line" : 1041,
      "original_position" : 37,
      "original_start_line" : 1028,
      "path" : "src/net.h",
      "position" : 46,
      "pull_request_review_id" : 1515650786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253855939/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1037,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-07-06T02:44:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253855939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "small change to revert the function signature `MaybePickPreferredNetwork` to have network be an optional. can see https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253855939 if you're interested in more detail. ",
      "created_at" : "2023-07-06T02:46:30Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1622876973",
      "id" : 1622876973,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585guyMt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622876973/reactions"
      },
      "updated_at" : "2023-07-06T02:46:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622876973",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "What is (was?) the reason for https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611194968?",
      "created_at" : "2023-07-06T09:42:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1623362830",
      "id" : 1623362830,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gwo0O",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623362830/reactions"
      },
      "updated_at" : "2023-07-06T09:42:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623362830",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254429298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254429298"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could use brace initialization here",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-06T13:17:52Z",
      "diff_hunk" : "@@ -90,6 +90,9 @@ static constexpr std::chrono::seconds MAX_UPLOAD_TIMEFRAME{60 * 60 * 24};\n // A random time period (0 to 1 seconds) is added to feeler connections to prevent synchronization.\n static constexpr auto FEELER_SLEEP_WINDOW{1s};\n \n+/** Frequency to attempt extra connections to reachable networks we're not connected to yet **/\n+static constexpr auto EXTRA_NETWORK_PEER_INTERVAL = 5min;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254429298",
      "id" : 1254429298,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585KxRJy",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1516531774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254429298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T14:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254429298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254495003"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254495003"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The commit message says every ~1min, but this means it will be ~5min via GetExponentialRand I think? This seems to be more in line with timings I have observed during testing, e.g. \r\n\r\n```log\r\n2023-07-05T14:04:26Z [net] Making network specific connection to ipv6_addr:8333\r\n2023-07-05T14:15:16Z [net] Making network specific connection to onion_addr.onion:8333\r\n```",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-06T14:05:41Z",
      "diff_hunk" : "@@ -90,6 +90,9 @@ static constexpr std::chrono::seconds MAX_UPLOAD_TIMEFRAME{60 * 60 * 24};\n // A random time period (0 to 1 seconds) is added to feeler connections to prevent synchronization.\n static constexpr auto FEELER_SLEEP_WINDOW{1s};\n \n+/** Frequency to attempt extra connections to reachable networks we're not connected to yet **/\n+static constexpr auto EXTRA_NETWORK_PEER_INTERVAL = 5min;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254495003",
      "id" : 1254495003,
      "in_reply_to_id" : 1254429298,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585KxhMb",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1516531774,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254495003/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T14:59:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254495003",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> What is (was?) the reason for [#27213 (comment)](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1611194968)?\r\n\r\nThe unsigned integer overflow was caused by https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1241362625 (fixed now!) - the counter wasn't incremented for new `pszDest` connections, but still decremented on disconnection, thus the overflow.",
      "created_at" : "2023-07-06T14:17:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1623767306",
      "id" : 1623767306,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gyLkK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623767306/reactions"
      },
      "updated_at" : "2023-07-06T15:19:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1623767306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254734825"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254734825"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "you're right. the commit message is a relic of the past interval. will update both of these if I retouch the code ",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-06T17:34:04Z",
      "diff_hunk" : "@@ -90,6 +90,9 @@ static constexpr std::chrono::seconds MAX_UPLOAD_TIMEFRAME{60 * 60 * 24};\n // A random time period (0 to 1 seconds) is added to feeler connections to prevent synchronization.\n static constexpr auto FEELER_SLEEP_WINDOW{1s};\n \n+/** Frequency to attempt extra connections to reachable networks we're not connected to yet **/\n+static constexpr auto EXTRA_NETWORK_PEER_INTERVAL = 5min;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254734825",
      "id" : 1254734825,
      "in_reply_to_id" : 1254429298,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585Kybvp",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1517018816,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254734825/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-06T17:34:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1254734825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@willcl-ark thanks for the review! \r\n\r\n> Slight tangent, but also slightly related to the discussion on whether IPV4 and IPV6 should be grouped... I noticed during testing that a majority of my network specific connection attempts were to IPV6 addresses, even though I don't have an IPV6 address and can't make connections to it... This appears to be because all networks are set as [Reachable by default ](https://github.com/bitcoin/bitcoin/blob/c325f0fbae2d6472a78be733d499783f8b69d6b8/src/net.h#L152-L156)unless specifically unset (which is not new to this PR)?\r\n\r\n> This has the effect on this PR that many of the every~5 minute network specific connections are wasted on ipv6 attempts.\r\n\r\ncompletely related, thanks for sharing! this makes sense based on the current implementation. the original proposal had special case logic to prevent this situation, but the direction of review has led to deciding this is an acceptable tradeoff. incase helpful, https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1577424366 provides a recap, https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1581806840 provides context for switching over. ",
      "created_at" : "2023-07-06T17:53:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1624093362",
      "id" : 1624093362,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585gzbKy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624093362/reactions"
      },
      "updated_at" : "2023-07-06T17:53:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624093362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > This has the effect on this PR that many of the every~5 minute network specific connections are wasted on ipv6 attempts.\r\n> \r\n> completely related, thanks for sharing! this makes sense based on the current implementation. the original proposal had special case logic to prevent this situation, but the direction of review has led to deciding this is an acceptable tradeoff. incase helpful, [#27213 (comment)](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1577424366) provides a recap, [#27213 (comment)](https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1581806840) provides context for switching over.\r\n\r\nWell that will teach me not to read all the previous comments fully before reviewing!\r\n\r\nIs there some historical reason why we consider IPV6 to be active, even when it's not? I mean sure, attempting connections is pretty cheap, but still?\r\n\r\n<details>\r\n<summary>It would save a lot of this which is totally useless to me</summary>\r\n\r\n```log\r\n2023-07-06T14:04:26Z [net] Making network specific connection to [2001:569:7605:d700:d88a:94bb:8158:c0bf]:8333\r\n2023-07-06T14:15:16Z [net] Making network specific connection to 7lazlb2a4nfzhpzfjqdhuqmobq6vdeel46owxwmsfxqvjqlkpv4hdxyd.onion:8333\r\n2023-07-06T14:19:13Z [net] Making network specific connection to [2401:e180:8843:7fa:da:90f:6481:f37c]:8333\r\n2023-07-06T14:25:56Z [net] Making network specific connection to [240e:3a1:5c12:a671:9963:442d:8afb:1f66]:8333\r\n2023-07-06T14:32:32Z [net] Making network specific connection to [2607:fb90:8a84:3b5b:877c:b950:e861:ad3f]:8333\r\n2023-07-06T14:32:53Z [net] Making network specific connection to [2604:3d09:a684:6500::b730]:8333\r\n2023-07-06T14:33:40Z [net] Making network specific connection to [2603:90c8:5:ae54::1134]:8333\r\n2023-07-06T14:50:31Z [net] Making network specific connection to [2601:448:c400:1000::ef15]:8333\r\n2023-07-06T14:51:00Z [net] Making network specific connection to [2a02:1810:2f09:6bf0::1000]:8333\r\n2023-07-06T14:55:12Z [net] Making network specific connection to [2601:680:cd80:4560:f014:1dde:a3aa:b6dd]:8333\r\n2023-07-06T14:59:24Z [net] Making network specific connection to [2001:ac8:28:6f::10]:8333\r\n2023-07-06T15:04:21Z [net] Making network specific connection to [2604:3d09:407d:ce00::3e19]:8333\r\n2023-07-06T15:09:44Z [net] Making network specific connection to [2a01:540:c3d9:9700:54e4:647d:63a7:82f0]:8333\r\n2023-07-06T15:11:39Z [net] Making network specific connection to [2001:0:284a:364:3c95:aefb:4345:b866]:8333\r\n2023-07-06T15:19:18Z [net] Making network specific connection to [2001:999:609:d40e::2]:8333\r\n2023-07-06T15:20:20Z [net] Making network specific connection to [2a01:cb04:2c4:c400:585e:f634:ed61:5a1f]:8333\r\n2023-07-06T15:26:01Z [net] Making network specific connection to [2605:59c8:5151:9110:3fc2:81b3:8d94:1823]:8333\r\n2023-07-06T15:26:24Z [net] Making network specific connection to [2a02:8308:8081:f300:3b8:7ec0:2837:1b57]:8333\r\n2023-07-06T15:39:03Z [net] Making network specific connection to [2407:3640:2107:1278::1]:8333\r\n2023-07-06T15:40:57Z [net] Making network specific connection to [2003:dc:5f2c:7b9:7285:c2ff:fe2e:5c7f]:8333\r\n2023-07-06T15:48:09Z [net] Making network specific connection to [2001:0:8ff4:dc96:30be:3e97:3f57:fe7e]:8333\r\n2023-07-06T15:51:41Z [net] Making network specific connection to [2600:381:a504:62c8:cfc:e4a2:8ea:9bc0]:8333\r\n2023-07-06T15:58:41Z [net] Making network specific connection to [2406:da14:335:b603:b5e8:7570:be85:8ea1]:8333\r\n2023-07-06T16:02:54Z [net] Making network specific connection to [2001:1c03:4f03:1700:3c1b:8053:95fd:859b]:8333\r\n2023-07-06T16:04:02Z [net] Making network specific connection to [2001:41d0:a:6b1d::1]:8333\r\n2023-07-06T16:07:31Z [net] Making network specific connection to [2601:240:4b00:262:4434:21e8:7414:bb02]:8333\r\n2023-07-06T16:15:13Z [net] Making network specific connection to [2800:e2:c780:1859:6d64:7105:b90d:3bc9]:8333\r\n2023-07-06T16:17:52Z [net] Making network specific connection to [2001:0:2851:782c:38b3:8887:435d:7379]:8333\r\n2023-07-06T16:23:45Z [net] Making network specific connection to [2a02:a212:a1c1:7800:b9e4:53a7:67ab:b5e3]:8333\r\n2023-07-06T16:31:18Z [net] Making network specific connection to [2603:7000:ac00:750e:1479:7b85:fdc5:a792]:8333\r\n2023-07-06T16:45:07Z [net] Making network specific connection to [2607:fea8:5d20:a300::f770]:8333\r\n2023-07-06T16:50:47Z [net] Making network specific connection to [2a03:4000:f:670::2]:8333\r\n2023-07-06T16:57:45Z [net] Making network specific connection to [2001:1608:1b:f9::1]:17482\r\n2023-07-06T17:04:27Z [net] Making network specific connection to [2601:701:200:b010:6944:55f8:f635:4495]:8333\r\n2023-07-06T17:05:47Z [net] Making network specific connection to [2800:e2:b500:10f:989c:82a9:e249:f6bb]:8333\r\n2023-07-06T17:06:00Z [net] Making network specific connection to [2a03:b0c0:1:e0::6a5:f001]:8333\r\n2023-07-06T17:11:37Z [net] Making network specific connection to [2a0b:6204:20cc:7500:5073:d1cf:bc80:7ed5]:8333\r\n2023-07-06T17:11:42Z [net] Making network specific connection to [2a01:e0a:149:fcb0:7a2b:cbff:fe4d:1828]:8333\r\n2023-07-06T17:14:30Z [net] Making network specific connection to [2001:da8:1002:310:fdba:2f06:f2d7:fd53]:8333\r\n2023-07-06T17:29:31Z [net] Making network specific connection to [2600:100b:a000:1015:8d24:9f00:9926:9a61]:8333\r\n2023-07-06T17:31:11Z [net] Making network specific connection to [2a0d:3344:1b18:10::f43]:8333\r\n2023-07-06T17:37:24Z [net] Making network specific connection to [2607:fb91:83f:862:acd4:4936:c03e:853b]:8333\r\n2023-07-06T17:41:12Z [net] Making network specific connection to [2603:9004:900:af02:95ed:2928:d5ee:8404]:8333\r\n2023-07-06T17:50:08Z [net] Making network specific connection to [2001:41d0:602:3315::]:8333\r\n2023-07-06T18:00:48Z [net] Making network specific connection to [2003:c2:471c:1155:c825:a4e0:d618:ea6f]:8333\r\n2023-07-06T18:03:44Z [net] Making network specific connection to [2603:9000:a707:1f86::157d]:8333\r\n2023-07-06T18:05:15Z [net] Making network specific connection to [2603:7080:9302:9b73::1b91]:8333\r\n2023-07-06T18:19:09Z [net] Making network specific connection to [2a00:23c8:7e01:1a01:922:48dd:5234:3779]:8333\r\n2023-07-06T18:23:51Z [net] Making network specific connection to [2601:206:8383:5930::87d5]:8333\r\n2023-07-06T18:31:28Z [net] Making network specific connection to [2620:9b::191d:d8b7]:8333\r\n2023-07-06T18:34:04Z [net] Making network specific connection to [2001:4c4e:11d1:9f00:fcea:e214:8392:4917]:8333\r\n2023-07-06T18:34:24Z [net] Making network specific connection to [2600:1700:70:5f30:e8e6:306a:8f60:a029]:8333\r\n2023-07-06T18:37:18Z [net] Making network specific connection to [2400:6180:100:d0::7f9:e00e]:8333\r\n2023-07-06T18:44:31Z [net] Making network specific connection to [2a03:b0c0:1:d0::30:f001]:8555\r\n2023-07-06T18:51:54Z [net] Making network specific connection to [2a02:908:821:6160:2daa:a061:5fd1:cb9f]:8333\r\n2023-07-06T19:03:57Z [net] Making network specific connection to [2a02:8388:e5c3:4a80:201:2eff:fe82:b3cc]:8333\r\n2023-07-06T19:04:26Z [net] Making network specific connection to [2600:1700:6184:9200::42]:8333\r\n2023-07-06T19:06:40Z [net] Making network specific connection to [2601:300:4003:dbb0::99cd]:8333\r\n2023-07-06T19:09:08Z [net] Making network specific connection to [2a0d:3344:1b62:6610::9e2]:8333\r\n2023-07-06T19:14:06Z [net] Making network specific connection to [2607:fcd0:ccc0:1d02::b37e]:8333\r\n2023-07-06T19:30:14Z [net] Making network specific connection to [2003:c8:cf22:b98b:d92e:b84a:afb9:ffdd]:8333\r\n2023-07-06T19:33:46Z [net] Making network specific connection to [1342:b5e:d22a:cf7:39e8:bea0:c8ce:b627]:8333\r\n2023-07-06T19:36:21Z [net] Making network specific connection to [2001:8b0:daf:e5be:fe88:ada6:e89:d890]:8333\r\n2023-07-06T19:39:19Z [net] Making network specific connection to [2001:41d0:203:bb0a::]:8333\r\n2023-07-06T19:40:52Z [net] Making network specific connection to [2800:150:13e:7b:99fa:830:c73d:dedd]:8333\r\n2023-07-06T19:44:24Z [net] Making network specific connection to [2603:9000:dd1a:5800:d04c:b91c:c3ec:6c2b]:8333\r\n2023-07-06T19:44:34Z [net] Making network specific connection to [2603:7081:7842:a846::1aa9]:8333\r\n2023-07-06T19:48:04Z [net] Making network specific connection to [2a01:e34:ecae:a390:a0da:f5d:2b1d:9643]:8333\r\n2023-07-06T19:58:38Z [net] Making network specific connection to [2a03:4000:54:fac:a8fb:beff:fe0f:de18]:8333\r\n2023-07-06T20:00:05Z [net] Making network specific connection to [2001:da8:1002:310:1d5b:7d7a:dcd0:e546]:8333\r\n2023-07-06T20:02:28Z [net] Making network specific connection to [2607:fea8:45da:6800::e471]:8333\r\n2023-07-06T20:08:03Z [net] Making network specific connection to [2604:2d80:9f8b:6e00::1001]:8333\r\n2023-07-06T20:09:25Z [net] Making network specific connection to [2600:6c56:6508:c8:815b:578:a8e6:a646]:8333\r\n2023-07-06T20:16:18Z [net] Making network specific connection to [2a02:ce0:1801:d672:1494:98f7:4c2c:6d10]:8333\r\n2023-07-06T20:16:25Z [net] Making network specific connection to [2a01:cb19:8486:b100:e8d6:1cca:99bd:65bc]:8333\r\n2023-07-06T20:22:26Z [net] Making network specific connection to [2a01:e11:100c:70:e531:ed0a:7844:dd36]:8333\r\n2023-07-06T20:25:57Z [net] Making network specific connection to [2604:3d08:a67e:b000::f338]:8333\r\n2023-07-06T20:42:28Z [net] Making network specific connection to [2002:4473:1121:0:527:d5a8:cc33:9b63]:8333\r\n2023-07-06T20:44:22Z [net] Making network specific connection to [2800:2181:5400:ec:7652:b00b:a33c:64be]:8333\r\n2023-07-06T20:46:43Z [net] Making network specific connection to [2a02:a03f:add0:fe00:4c38:d828:5f89:ea5a]:8333\r\n2023-07-06T20:54:47Z [net] Making network specific connection to [2601:647:4000:7690:8a1:af9d:e225:14d1]:8333\r\n2023-07-06T20:57:03Z [net] Making network specific connection to [2806:104e:c:654a:1981:7ddb:d93:87ec]:8333\r\n2023-07-06T21:15:29Z [net] Making network specific connection to [2002:6205:27e:0:1004:c04c:9f00:782e]:8333\r\n2023-07-06T21:15:30Z [net] Making network specific connection to [2a02:2454:9933:ca00::ec73]:8333\r\n2023-07-06T21:19:52Z [net] Making network specific connection to [2001:569:7e07:bd00:10da:ba84:bf02:c293]:8333\r\n2023-07-06T21:20:36Z [net] Making network specific connection to [2a01:4f9:2b:1bde::2]:8333\r\n2023-07-06T21:25:31Z [net] Making network specific connection to [2a0b:f4c2::3]:8333\r\n2023-07-06T21:30:31Z [net] Making network specific connection to [2a01:cb08:8268:9500:88e1:8698:fe3:974e]:8333\r\n2023-07-06T21:31:03Z [net] Making network specific connection to [2001:9e8:f099:2000:79af:765e:7bbe:8c36]:8333\r\n2023-07-06T21:36:56Z [net] Making network specific connection to [2603:7000:4600:500:7da2:6e48:a92b:2765]:8333\r\n2023-07-06T21:47:35Z [net] Making network specific connection to [2a02:587:1a11:1d00:6755:ad79:9339:ff78]:8333\r\n2023-07-06T21:54:13Z [net] Making network specific connection to [2600:4040:7209:2300:5573:7ebe:3622:efde]:8333\r\n2023-07-06T21:56:57Z [net] Making network specific connection to [2003:e6:1725:4000:1844:7011:ba02:3b8a]:8333\r\n2023-07-06T21:59:39Z [net] Making network specific connection to [240e:3b5:3471:fcc1:951c:670d:c4cc:554]:8333\r\n2023-07-06T22:02:29Z [net] Making network specific connection to [2a03:1b20:a:f011::a03e]:54915\r\n2023-07-06T22:05:44Z [net] Making network specific connection to [2600:1700:170:14c0::35]:8333\r\n2023-07-06T22:13:21Z [net] Making network specific connection to [2a01:cb1d:84c0:ec00:2:8284:39b5:bee8]:8333\r\n2023-07-06T22:15:56Z [net] Making network specific connection to [2a01:4f8:1c1c:f22c::1]:8333\r\n2023-07-06T22:19:22Z [net] Making network specific connection to [2001:4dd0:3564:0:9c1c:cc31:9fe8:5505]:8333\r\n2023-07-06T22:35:18Z [net] Making network specific connection to [2605:59c8:2062:9210::98e]:8333\r\n2023-07-06T22:38:43Z [net] Making network specific connection to [2601:983:827f:5850:e5a6:b90a:11b5:e3af]:8333\r\n2023-07-06T22:39:19Z [net] Making network specific connection to [2400:2413:d641:9900:8596:b918:ea3b:ce3c]:8333\r\n2023-07-06T22:43:59Z [net] Making network specific connection to [2402:800:9eb0:3f6c:e0c4:ee35:9e2e:ff10]:8333\r\n2023-07-06T22:44:47Z [net] Making network specific connection to [2001:0:2851:b9f0:4f6:62:8b12:b535]:8333\r\n2023-07-06T22:49:47Z [net] Making network specific connection to [2a01:4f9:2a:32e6::2]:8333\r\n2023-07-06T22:59:26Z [net] Making network specific connection to [2804:56c:c148:c700:cf18:6fee:1521:997f]:8333\r\n2023-07-06T23:03:38Z [net] Making network specific connection to [2405:9800:b960:363a:c067:5ce4:c878:30ac]:8333\r\n2023-07-06T23:34:05Z [net] Making network specific connection to [2600:1700:1d00:5c60:bc36:2c4d:df89:5c36]:8333\r\n2023-07-06T23:38:37Z [net] Making network specific connection to [2400:3b00:20:c:bacb:29ff:feab:8886]:8333\r\n2023-07-06T23:39:01Z [net] Making network specific connection to [2001:5b0:66c0:d888:1c20:581b:5a97:439e]:8333\r\n2023-07-06T23:41:57Z [net] Making network specific connection to [2600:1700:170:14c0::43]:8333\r\n2023-07-06T23:45:45Z [net] Making network specific connection to [2001:ee0:4a3e:46b0:d427:da63:566:6080]:8333\r\n2023-07-06T23:45:53Z [net] Making network specific connection to [2a02:c207:3002:7468::1]:8333\r\n2023-07-06T23:47:50Z [net] Making network specific connection to [2001:1600:10:100::69d]:8333\r\n2023-07-06T23:49:26Z [net] Making network specific connection to [2800:300:6f41:7800::3]:8333\r\n2023-07-06T23:50:03Z [net] Making network specific connection to [2601:983:8280:9f20::4c33]:8333\r\n2023-07-07T00:00:08Z [net] Making network specific connection to [2600:4040:7be8:ee00:ccce:926:661f:d6b8]:8333\r\n2023-07-07T00:02:26Z [net] Making network specific connection to [2a02:810d:a200:149c:4d61:c376:892:7e0c]:8333\r\n2023-07-07T00:07:49Z [net] Making network specific connection to [2a01:4f9:6b:4c2a::2]:8333\r\n2023-07-07T00:25:14Z [net] Making network specific connection to [2003:c6:7719:c900:93c2:2ac8:e62c:19bc]:8333\r\n2023-07-07T00:25:30Z [net] Making network specific connection to [2a01:4f8:200:53af::2]:8333\r\n2023-07-07T00:32:34Z [net] Making network specific connection to [2402:7500:95b:e295:adf0:1280:e14:ff80]:8333\r\n2023-07-07T00:35:50Z [net] Making network specific connection to [2001:9e8:a7ea:c700:899b:709:f9cb:b15]:8333\r\n2023-07-07T00:36:49Z [net] Making network specific connection to [2001:8003:2c32:b900:fd15:5cb8:24a1:38df]:8333\r\n2023-07-07T00:39:59Z [net] Making network specific connection to udvbimwjhkd7j3fwadzefyieppzxkm6abdkwrpo2or4avjhvnvtqk6ad.onion:8333\r\n2023-07-07T00:44:20Z [net] Making network specific connection to [2003:f0:f718:d700:5f82:5c67:394c:1c1a]:8333\r\n2023-07-07T00:45:01Z [net] Making network specific connection to hxmwwegj3lrnu2lpmr5rncuolbxmcq3synvpesvn46seq4hivpoyjeyd.onion:8333\r\n2023-07-07T00:45:43Z [net] Making network specific connection to [2409:8a00:7981:6c00:e0fb:a501:b561:6649]:8333\r\n2023-07-07T00:51:55Z [net] Making network specific connection to [2a03:f680:fe04:2f6d:1110:151c:433b:5c59]:8333\r\n2023-07-07T00:55:23Z [net] Making network specific connection to [2603:8000:6d06:c19d:5ed3:bd68:b176:4432]:8333\r\n2023-07-07T00:59:08Z [net] Making network specific connection to [2600:6c50:6700:f715::1e46]:8333\r\n2023-07-07T01:24:29Z [net] Making network specific connection to [2a09:bac1:3b60:140::16:179]:8333\r\n2023-07-07T01:26:42Z [net] Making network specific connection to [2600:1700:62b3:32b0::21]:8333\r\n2023-07-07T01:44:20Z [net] Making network specific connection to [2603:3001:390a:7dc1:fd7:7457:2c56:8560]:8333\r\n2023-07-07T01:45:34Z [net] Making network specific connection to [2605:ba00:5107:f13d::c9c]:8333\r\n2023-07-07T01:50:02Z [net] Making network specific connection to [2607:fb91:152a:80df:2441:841a:0:ee8]:8333\r\n2023-07-07T01:59:02Z [net] Making network specific connection to [2001:bc8:1201:706:8634:97ff:fe11:bca8]:8333\r\n2023-07-07T02:05:19Z [net] Making network specific connection to [2601:589:4d7e:60a0:8518:dd87:b870:cdac]:8333\r\n2023-07-07T02:12:45Z [net] Making network specific connection to [2605:59c8:3045:f210:d0f6:b7d4:664a:6298]:8333\r\n2023-07-07T02:20:52Z [net] Making network specific connection to [2601:283:4b82:7fc0:e514:7666:4132:dfb4]:8333\r\n2023-07-07T02:30:30Z [net] Making network specific connection to [2407:7000:9892:1000:b1e3:865b:f4bf:96e6]:8333\r\n2023-07-07T02:35:32Z [net] Making network specific connection to [2001:0:284a:364:c6e:fb35:4f86:4d5c]:8333\r\n2023-07-07T02:48:16Z [net] Making network specific connection to [2001:1c00:2004:2000:f93f:417f:40d6:2f98]:8333\r\n2023-07-07T02:52:39Z [net] Making network specific connection to [2001:67c:289c:4::78]:8333\r\n2023-07-07T02:55:13Z [net] Making network specific connection to [2603:6000:b000:d666:3aa4:fa57:321:809a]:8333\r\n2023-07-07T03:04:14Z [net] Making network specific connection to [2607:fb90:9f2a:d9bf:6d4:c4ff:fed2:cfc9]:8333\r\n2023-07-07T03:10:07Z [net] Making network specific connection to [2001:9e8:4ac4:ec00:4335:6809:33d4:eb4a]:8333\r\n2023-07-07T03:13:57Z [net] Making network specific connection to [2a03:7846:7514:101:839a:c15e:6cb1:5771]:8333\r\n2023-07-07T03:17:14Z [net] Making network specific connection to [2a01:4b00:8648:8000:d888:1d8c:1818:213e]:8333\r\n2023-07-07T03:22:10Z [net] Making network specific connection to [2a00:23c8:7e01:1a01:f534:944b:397d:a9c6]:8333\r\n2023-07-07T03:24:18Z [net] Making network specific connection to [2001:8a0:f92b:de00:6468:8ba1:51e6:531f]:8333\r\n2023-07-07T03:28:20Z [net] Making network specific connection to [2a00:23c6:5e05:9401:251e:3e0d:8d3a:ebfe]:8333\r\n2023-07-07T03:32:17Z [net] Making network specific connection to [2602:ffc8:2:104::18]:8333\r\n2023-07-07T03:34:08Z [net] Making network specific connection to [2806:103e:22:846f::7]:8333\r\n2023-07-07T03:41:03Z [net] Making network specific connection to [2001:56a:f9b7:3900:69ad:63e5:fe49:37a9]:8333\r\n2023-07-07T03:43:36Z [net] Making network specific connection to [2a02:8109:3bbf:f41c:290d:4dc8:9923:23]:8333\r\n2023-07-07T03:55:28Z [net] Making network specific connection to [2a01:36d:111:6537:3fb8:f46a:8aaf:f509]:8333\r\n2023-07-07T04:08:36Z [net] Making network specific connection to [2a0d:6fc2:5420:5f00:64f1:d4c8:387a:8acb]:8333\r\n2023-07-07T04:09:20Z [net] Making network specific connection to [2601:681:8b80:10b0:91a6:3d6a:5903:f8ec]:8333\r\n2023-07-07T04:18:35Z [net] Making network specific connection to [2001:a61:3aff:6201:8b03:860b:d1fb:3cef]:8333\r\n2023-07-07T04:19:57Z [net] Making network specific connection to [2601:443:c100:59fc:5499:952a:17c7:2a47]:8333\r\n2023-07-07T04:54:30Z [net] Making network specific connection to [2a01:298:f7:1:51f9:79cd:7ca6:d8b2]:8333\r\n2023-07-07T04:55:04Z [net] Making network specific connection to [2600:1700:16d2:beaf::2000]:8333\r\n2023-07-07T04:55:53Z [net] Making network specific connection to [2a00:23c4:a71e:d301:2018:b0a1:3d8a:4c58]:8333\r\n2023-07-07T05:03:03Z [net] Making network specific connection to [2600:6c40:5c00:135e:8086:57fb:8445:1976]:8333\r\n2023-07-07T05:05:13Z [net] Making network specific connection to [2001:8a0:dec8:9a00:b8eb:fb:a4d7:360e]:8333\r\n2023-07-07T05:07:39Z [net] Making network specific connection to [2a01:e0a:320:39a0:6e9b:2c17:3975:a341]:8333\r\n2023-07-07T05:14:23Z [net] Making network specific connection to [2605:6400:30:f174::42]:8333\r\n2023-07-07T05:23:25Z [net] Making network specific connection to [2002:5bc:3e12::5bc:3e12]:8333\r\n2023-07-07T05:24:02Z [net] Making network specific connection to [2a01:598:9290:9950:90a6:677:13f6:8eb6]:8333\r\n2023-07-07T05:24:41Z [net] Making network specific connection to [2a02:1210:4ac4:a400:310f:a516:44a9:2de1]:8333\r\n2023-07-07T05:31:40Z [net] Making network specific connection to [2a0d:3344:19b2:8f10::d95]:8333\r\n2023-07-07T05:37:58Z [net] Making network specific connection to [2607:fea8:c21e:400::512c]:8333\r\n2023-07-07T05:39:31Z [net] Making network specific connection to [2a00:23c6:c8af:5601:b4fe:cbae:fce1:be84]:8333\r\n2023-07-07T05:43:36Z [net] Making network specific connection to [2001:8a0:d91f:6200:9363:daa3:9fd1:78b9]:8333\r\n2023-07-07T05:44:45Z [net] Making network specific connection to [2600:1001:a100:c26c:2aed:af3b:54a4:12df]:8333\r\n2023-07-07T05:45:08Z [net] Making network specific connection to [2001:9e8:8e25:5a00:459b:ff39:d304:1e96]:8333\r\n2023-07-07T05:54:02Z [net] Making network specific connection to [2804:d45:a305:1300:4320:ec0b:df48:2314]:8333\r\n2023-07-07T05:57:44Z [net] Making network specific connection to [2603:6011:7d00:f41b:20bf:be69:b0d2:36a3]:8333\r\n2023-07-07T05:58:20Z [net] Making network specific connection to [2003:c9:4f0f:a24f:210d:2795:3488:d8f2]:8333\r\n2023-07-07T05:58:57Z [net] Making network specific connection to [2003:e9:f0c:bd00:8550:ab03:d4fe:7286]:8333\r\n2023-07-07T06:07:31Z [net] Making network specific connection to [240e:39c:61:a140:a639:b3ff:fe54:93c4]:8333\r\n2023-07-07T06:10:17Z [net] Making network specific connection to [2003:cc:738:5800:dd00:81e3:b390:7a40]:8333\r\n2023-07-07T06:17:38Z [net] Making network specific connection to [2603:6010:f700:da2f::84f]:8333\r\n2023-07-07T06:20:26Z [net] Making network specific connection to [2603:3004:7e7:b800::fcc8]:8333\r\n2023-07-07T06:27:06Z [net] Making network specific connection to [2607:fb90:3c21:c041:86e:2e97:6a7b:2691]:8333\r\n2023-07-07T06:27:44Z [net] Making network specific connection to [2603:300a:21c3:4900:c83b:c1d2:2eee:9558]:8333\r\n2023-07-07T06:29:17Z [net] Making network specific connection to [2a02:8428:c488:7001:edaa:6bb3:810d:e9e6]:8333\r\n2023-07-07T06:37:46Z [net] Making network specific connection to [2603:8080:e900:2389:e008:e9c:473c:2253]:8333\r\n2023-07-07T06:45:32Z [net] Making network specific connection to [2606:9580:100:e:d075:a67e:1f9c:139d]:8333\r\n2023-07-07T07:01:01Z [net] Making network specific connection to [2a01:112f:42e1:e600:6d72:5128:84ef:f9e6]:8333\r\n2023-07-07T07:09:54Z [net] Making network specific connection to [2001:18c0:9e4:7400::a8e2]:8333\r\n2023-07-07T07:10:19Z [net] Making network specific connection to [2a02:9b0:403b:ac61:189e:2c0e:ac5:a]:8333\r\n2023-07-07T07:14:21Z [net] Making network specific connection to [2600:1014:a020:2187:8edc:d4ff:fe81:59c2]:8333\r\n2023-07-07T07:14:29Z [net] Making network specific connection to [2804:14c:657d:4030:28b4:eff:fe9b:8894]:8333\r\n2023-07-07T07:24:23Z [net] Making network specific connection to [2804:4308:99:5f00:153:78b1:769c:169f]:8333\r\n2023-07-07T07:29:40Z [net] Making network specific connection to [2a02:2f05:6806:a600:64b8:5656:cc2f:59f4]:8333\r\n2023-07-07T07:29:53Z [net] Making network specific connection to [fec0::6c05:e753:618:4306]:8333\r\n2023-07-07T07:39:24Z [net] Making network specific connection to [2003:f4:4f17:26f0:7285:c2ff:fe7f:6213]:8333\r\n2023-07-07T08:01:34Z [net] Making network specific connection to [2603:8000:4100:2994::138f]:8333\r\n2023-07-07T08:10:53Z [net] Making network specific connection to [2a02:8071:51f0:a9e0:4027:8a2c:1f5b:b414]:8333\r\n2023-07-07T08:16:11Z [net] Making network specific connection to [2a02:a470:8f22:1:593f:dc27:6917:997]:8333\r\n2023-07-07T08:20:32Z [net] Making network specific connection to [2602:feb4:1c8:d400:1890:f152:a5b4:241d]:8333\r\n2023-07-07T08:20:43Z [net] Making network specific connection to [2002:5477:7501:0:38fb:bb60:559b:138c]:8333\r\n```\r\n\r\n</details>\r\n\r\n",
      "created_at" : "2023-07-07T10:09:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1625181541",
      "id" : 1625181541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585g3k1l",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625181541/reactions"
      },
      "updated_at" : "2023-07-07T10:09:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1625181541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Is there some historical reason why we consider IPV6 to be active, even when it's not? I mean sure, attempting connections is pretty cheap, but still?\r\n\r\ngood question! looks like https://github.com/bitcoin/bitcoin/pull/1021 introduced support of IPV6. there's some PR convo that indicates it started with defaulting off, but review direction lead to it being on. \r\n\r\nmaybe we could consider a deeper fix that would allow nodes to detect whether IPV6 is actually connectable or not, and enable / disable whether that network is considered reachable. that would impact the behavior of this feature, but could be considered separately and have a wider impact. on master, nodes that are currently unable to connect to IPV6 are still going to be persisting addresses to addrman & attempting connections periodically. ",
      "created_at" : "2023-07-07T22:31:09Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1626315131",
      "id" : 1626315131,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585g75l7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626315131/reactions"
      },
      "updated_at" : "2023-07-07T22:31:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1626315131",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> a majority of my network specific connection attempts were to IPV6 addresses, even though I don't have an IPV6 address and can't make connections to it\r\n\r\nYeah. That is also an issue on `master`, without this PR. Maybe it deserves a separate PR. Opened https://github.com/bitcoin/bitcoin/issues/28061 to track that.",
      "created_at" : "2023-07-10T15:05:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1629155080",
      "id" : 1629155080,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585hGu8I",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1629155080/reactions"
      },
      "updated_at" : "2023-07-10T15:05:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1629155080",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275142287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275142287"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "commit d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9:\r\nIn the commit message, \"(counting IPv4 and IPv6 as one network)\" is no longer true",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-26T15:25:30Z",
      "diff_hunk" : "@@ -5159,6 +5161,9 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // If this is the only connection on a particular network that is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275142287",
      "id" : 1275142287,
      "line" : 5164,
      "node_id" : "PRRC_kwDOABII585MASCP",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 5164,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1548029271,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275142287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-26T18:15:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275142287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275342509"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275342509"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "gah, thanks. will update if I retouch.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-26T18:26:20Z",
      "diff_hunk" : "@@ -5159,6 +5161,9 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // If this is the only connection on a particular network that is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275342509",
      "id" : 1275342509,
      "in_reply_to_id" : 1275142287,
      "line" : 5164,
      "node_id" : "PRRC_kwDOABII585MBC6t",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 5164,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 13,
      "pull_request_review_id" : 1548359113,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275342509/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-26T18:26:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275342509",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275642065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642065"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "dev notes says `++i` preferred over `i++`, here and elsewhere",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T01:44:57Z",
      "diff_hunk" : "@@ -1135,6 +1135,9 @@ void CConnman::DisconnectNodes()\n                 // close socket and cleanup\n                 pnode->CloseSocketDisconnect();\n \n+                // update connection count by network\n+                if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[pnode->addr.GetNetwork()]--;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275642065",
      "id" : 1275642065,
      "line" : 1142,
      "node_id" : "PRRC_kwDOABII585MCMDR",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1139,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1548859239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T02:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275642506"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642506"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Having a map where a `std::array` would be fine is kind of lame... That said, this is the same setup as in addrman_impl.h for `m_network_counts`.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T01:45:56Z",
      "diff_hunk" : "@@ -1048,6 +1064,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275642506",
      "id" : 1275642506,
      "line" : 1082,
      "node_id" : "PRRC_kwDOABII585MCMKK",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1068,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 56,
      "pull_request_review_id" : 1548859239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642506/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T02:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275642506",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275648306"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275648306"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could be a `const` member function, if you weren't using `map::operator[]`. That would mean either switching to an array, where you can use `[]` for just a lookup, or doing a manual find:\r\n\r\n```c++\r\nif (auto it = m_network_conn_counts.find(net) && it != m_network_conn_counts.end()) {\r\n    return it->second > 0;\r\n}\r\nreturn false;\r\n```",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T01:56:30Z",
      "diff_hunk" : "@@ -1607,6 +1607,12 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);\n+    return m_network_conn_counts[net] > 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275648306",
      "id" : 1275648306,
      "line" : 1616,
      "node_id" : "PRRC_kwDOABII585MCNky",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 1613,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 1548859239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275648306/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T02:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275648306",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275652683"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275652683"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Isn't `network_peer == true` the same as `preferred_net != std::nullopt` ? Could drop the bool.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T02:04:48Z",
      "diff_hunk" : "@@ -1804,6 +1826,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             next_feeler = GetExponentialRand(now, FEELER_INTERVAL);\n             conn_type = ConnectionType::FEELER;\n             fFeeler = true;\n+        } else if (nOutboundFullRelay == m_max_outbound_full_relay &&\n+                   m_max_outbound_full_relay == MAX_OUTBOUND_FULL_RELAY_CONNECTIONS &&\n+                   now > next_extra_network_peer &&\n+                   MaybePickPreferredNetwork(preferred_net)) {\n+            // Full outbound connection management: Attempt to get at least one\n+            // outbound peer from each reachable network by making extra connections\n+            // and then protecting \"only\" peers from a network during outbound eviction.\n+            // This is not attempted if the user changed -maxconnections to a value\n+            // so low that less than MAX_OUTBOUND_FULL_RELAY_CONNECTIONS are made,\n+            // to prevent interactions with otherwise protected outbound peers.\n+            next_extra_network_peer = GetExponentialRand(now, EXTRA_NETWORK_PEER_INTERVAL);\n+            network_peer = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275652683",
      "id" : 1275652683,
      "line" : 1840,
      "node_id" : "PRRC_kwDOABII585MCOpL",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1840,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 81,
      "pull_request_review_id" : 1548859239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275652683/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T02:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275652683",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275653315"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275653315"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe report the `preferred_net` name here as well?",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T02:05:50Z",
      "diff_hunk" : "@@ -1904,6 +1941,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n                 LogPrint(BCLog::NET, \"Making feeler connection to %s\\n\", addrConnect.ToStringAddrPort());\n             }\n+\n+            if (network_peer) LogPrint(BCLog::NET, \"Making network specific connection to %s\\n\", addrConnect.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275653315",
      "id" : 1275653315,
      "line" : 1945,
      "node_id" : "PRRC_kwDOABII585MCOzD",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1945,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 102,
      "pull_request_review_id" : 1548859239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275653315/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T02:09:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1275653315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276078272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276078272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: may be worth explaining that this randomization helps to get to NET_I2P option without traversing the entire NET_ONION set of potentially rubbish or buggy stuff :)",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T10:24:11Z",
      "diff_hunk" : "@@ -1613,6 +1616,22 @@ bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n     return m_network_conn_counts[net] > 1;\n }\n \n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::array<Network, 5> nets{NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS};\n+    Shuffle(nets.begin(), nets.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276078272",
      "id" : 1276078272,
      "line" : 1622,
      "node_id" : "PRRC_kwDOABII585MD2jA",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1622,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 33,
      "pull_request_review_id" : 1549522614,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276078272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T10:24:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276078272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276083657"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276083657"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Do we have any risk of TOR and I2P peers bouncing each other forever?\r\nSay, you have 7 ip4 peers and 1 Tor peer. I2P bounces Tor. In the next step, Tor (maybe another node, or maybe the same) bounces I2P node back.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T10:28:46Z",
      "diff_hunk" : "@@ -1857,7 +1891,10 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n             } else {\n                 // Not a feeler\n-                std::tie(addr, addr_last_try) = addrman.Select();\n+                // If preferred_net has a value set, pick an extra outbound\n+                // peer from that network. The eviction logic in net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276083657",
      "id" : 1276083657,
      "line" : 1895,
      "node_id" : "PRRC_kwDOABII585MD33J",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1895,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 91,
      "pull_request_review_id" : 1549531552,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276083657/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T10:28:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276083657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276175156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276175156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This example should be prevented by the \"Protect extra full outbound peers by network\" commit, shouldn't it? ie the process would be:\r\n\r\n * 7 ipv4 + 1 tor\r\n * 7 ipv4 + 1 tor + 1 i2p (via \"network specific connection\")\r\n * 6 ipv4 + 1 tor + 1 i2p (tor and i2p nodes protected from eviction due to `if (!m_connman.MultipleManualOrFullOutboundConns(pnode->addr.GetNetwork())) return;` code path)",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-27T11:58:17Z",
      "diff_hunk" : "@@ -1857,7 +1891,10 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n             } else {\n                 // Not a feeler\n-                std::tie(addr, addr_last_try) = addrman.Select();\n+                // If preferred_net has a value set, pick an extra outbound\n+                // peer from that network. The eviction logic in net_processing",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1276175156",
      "id" : 1276175156,
      "in_reply_to_id" : 1276083657,
      "line" : 1895,
      "node_id" : "PRRC_kwDOABII585MEOM0",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1895,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 91,
      "pull_request_review_id" : 1549675499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276175156/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-27T11:58:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1276175156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Maybe a release note would be nice? \r\nNot because this would break anything, but so that users who are currently performing active measures to stay connected to multiple networks (e.g. `-addnode` together with regular monitoring if the added node is still online) know that there is another option now.",
      "created_at" : "2023-07-27T14:44:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1653766453",
      "id" : 1653766453,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585iknk1",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653766453/reactions"
      },
      "updated_at" : "2023-07-27T14:44:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1653766453",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278586562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278586562"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't quite follow. if we have multiple networks that match, the randomization seems valuable in all the cases? ",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T16:03:12Z",
      "diff_hunk" : "@@ -1613,6 +1616,22 @@ bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n     return m_network_conn_counts[net] > 1;\n }\n \n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::array<Network, 5> nets{NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS};\n+    Shuffle(nets.begin(), nets.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278586562",
      "id" : 1278586562,
      "in_reply_to_id" : 1276078272,
      "line" : 1622,
      "node_id" : "PRRC_kwDOABII585MNa7C",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1622,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 33,
      "pull_request_review_id" : 1553664688,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278586562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T16:03:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278586562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278617031"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278617031"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I considered that, but wouldn't it be pretty self-evident from the address format? happy to add if it still feels useful.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T20:46:19Z",
      "diff_hunk" : "@@ -1904,6 +1941,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n                 LogPrint(BCLog::NET, \"Making feeler connection to %s\\n\", addrConnect.ToStringAddrPort());\n             }\n+\n+            if (network_peer) LogPrint(BCLog::NET, \"Making network specific connection to %s\\n\", addrConnect.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278617031",
      "id" : 1278617031,
      "in_reply_to_id" : 1275653315,
      "line" : 1945,
      "node_id" : "PRRC_kwDOABII585MNiXH",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1945,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 102,
      "pull_request_review_id" : 1553704818,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278617031/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T20:46:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278617031",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "thank you for the reviews everyone ð  \r\n\r\nIn terms of next steps, we could either keep this PR as is in aims of merging soon & address follow-ups separately, or incorporate the review comments here. I've recapped the current status of the PR and am curious to hear feedback as to what route seems preferable. \r\n\r\n* the current tip on this PR has 3 review ACKs ([vasild](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1516160146), [mzumsande](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1548029271) with co-author caveat, [ajtowns](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1548859239)) and 1 lightly tested approach ACK ([willcl-ark](https://github.com/bitcoin/bitcoin/pull/27213#pullrequestreview-1516531774))\r\n* the outstanding review comments are relatively small & mostly can be addressed in a follow up. I opened #28189 to address reviewer suggestions of style, reverting `m_network_conn_counts` to an array & adding a release note\r\n* there are two review comments relating to outdated commit messages that can't be addressed in a follow up: [1](https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1254495003), [2](https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275142287)\r\n\r\nsince this PR has been open for a while & the remaining suggestions are relatively small, my preference is to continue trying to get enough review here for confidence to merge, then address the open improvements separately. that said, if maintainers or reviewers prefer otherwise, I am happy to incorporate those changes here. ",
      "created_at" : "2023-07-30T23:39:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1657295575",
      "id" : 1657295575,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585iyFLX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657295575/reactions"
      },
      "updated_at" : "2023-07-30T23:39:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657295575",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278638362"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638362"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "incorporated brace initialization in [`4428c6d` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/4428c6d25b9a9a0cbcb6ff01525fe2d751b7a5aa)",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T23:40:18Z",
      "diff_hunk" : "@@ -90,6 +90,9 @@ static constexpr std::chrono::seconds MAX_UPLOAD_TIMEFRAME{60 * 60 * 24};\n // A random time period (0 to 1 seconds) is added to feeler connections to prevent synchronization.\n static constexpr auto FEELER_SLEEP_WINDOW{1s};\n \n+/** Frequency to attempt extra connections to reachable networks we're not connected to yet **/\n+static constexpr auto EXTRA_NETWORK_PEER_INTERVAL = 5min;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278638362",
      "id" : 1278638362,
      "in_reply_to_id" : 1254429298,
      "line" : 94,
      "node_id" : "PRRC_kwDOABII585MNnka",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 5,
      "pull_request_review_id" : 1553729368,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638362/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T23:40:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638362",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278638425"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638425"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated in [`4428c6d` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/4428c6d25b9a9a0cbcb6ff01525fe2d751b7a5aa)",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T23:40:44Z",
      "diff_hunk" : "@@ -1135,6 +1135,9 @@ void CConnman::DisconnectNodes()\n                 // close socket and cleanup\n                 pnode->CloseSocketDisconnect();\n \n+                // update connection count by network\n+                if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[pnode->addr.GetNetwork()]--;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278638425",
      "id" : 1278638425,
      "in_reply_to_id" : 1275642065,
      "line" : 1142,
      "node_id" : "PRRC_kwDOABII585MNnlZ",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1139,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 15,
      "pull_request_review_id" : 1553729444,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638425/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T23:40:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278638425",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639092"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639092"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "for anyone following along in review, some historical context of why it was initially changed from `std::array` to `std::unordered_map` here: https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1242196931 \r\n\r\n@ajtowns I agree with your reasoning in https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1253827052 that an array doesn't tangibly make the code more brittle. since an array has a significantly smaller memory footprint, I think it's slightly preferable. incorporated in [`84495cd` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/84495cd2a8d12121b3164d20bd6b7c87a9ef43e2)\r\n",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T23:45:54Z",
      "diff_hunk" : "@@ -1048,6 +1064,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639092",
      "id" : 1278639092,
      "in_reply_to_id" : 1275642506,
      "line" : 1082,
      "node_id" : "PRRC_kwDOABII585MNnv0",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1068,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 56,
      "pull_request_review_id" : 1553730875,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639092/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T23:45:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639092",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639126"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated in [`84495cd` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/84495cd2a8d12121b3164d20bd6b7c87a9ef43e2) by turning `m_network_counts` to an array ",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T23:46:11Z",
      "diff_hunk" : "@@ -1607,6 +1607,12 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);\n+    return m_network_conn_counts[net] > 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639126",
      "id" : 1278639126,
      "in_reply_to_id" : 1275648306,
      "line" : 1616,
      "node_id" : "PRRC_kwDOABII585MNnwW",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 1613,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 1553730929,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T23:46:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639150"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done in [`006b8dd` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/006b8dd3e6a161932a376a3988b5531410fa88a1)",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-30T23:46:27Z",
      "diff_hunk" : "@@ -1804,6 +1826,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             next_feeler = GetExponentialRand(now, FEELER_INTERVAL);\n             conn_type = ConnectionType::FEELER;\n             fFeeler = true;\n+        } else if (nOutboundFullRelay == m_max_outbound_full_relay &&\n+                   m_max_outbound_full_relay == MAX_OUTBOUND_FULL_RELAY_CONNECTIONS &&\n+                   now > next_extra_network_peer &&\n+                   MaybePickPreferredNetwork(preferred_net)) {\n+            // Full outbound connection management: Attempt to get at least one\n+            // outbound peer from each reachable network by making extra connections\n+            // and then protecting \"only\" peers from a network during outbound eviction.\n+            // This is not attempted if the user changed -maxconnections to a value\n+            // so low that less than MAX_OUTBOUND_FULL_RELAY_CONNECTIONS are made,\n+            // to prevent interactions with otherwise protected outbound peers.\n+            next_extra_network_peer = GetExponentialRand(now, EXTRA_NETWORK_PEER_INTERVAL);\n+            network_peer = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1278639150",
      "id" : 1278639150,
      "in_reply_to_id" : 1275652683,
      "line" : 1840,
      "node_id" : "PRRC_kwDOABII585MNnwu",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1840,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 81,
      "pull_request_review_id" : 1553730965,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-30T23:46:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1278639150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@mzumsande - release note added in [`a6d270d` (#28189)](https://github.com/bitcoin/bitcoin/pull/28189/commits/a6d270db4238c48a7a1a70e4398f2b33a97ed037)",
      "created_at" : "2023-07-30T23:47:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1657297571",
      "id" : 1657297571,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585iyFqj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657297571/reactions"
      },
      "updated_at" : "2023-07-30T23:47:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657297571",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279003069"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279003069"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I was pointing out a specific (probably stronger-than-rest) benefit of randomization. So that if one wants to drop the randomization from the code, they consider that.\r\n\r\nFeel free to ignore it.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-31T09:05:09Z",
      "diff_hunk" : "@@ -1613,6 +1616,22 @@ bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n     return m_network_conn_counts[net] > 1;\n }\n \n+bool CConnman::MaybePickPreferredNetwork(std::optional<Network>& network)\n+{\n+    std::array<Network, 5> nets{NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS};\n+    Shuffle(nets.begin(), nets.end(), FastRandomContext());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279003069",
      "id" : 1279003069,
      "in_reply_to_id" : 1276078272,
      "line" : 1622,
      "node_id" : "PRRC_kwDOABII585MPAm9",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1622,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 33,
      "pull_request_review_id" : 1554296527,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279003069/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T09:05:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279003069",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK 1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-31T09:15:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1657983184",
      "id" : 1657983184,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585i0tDQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657983184/reactions"
      },
      "updated_at" : "2023-07-31T09:15:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1657983184",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7975071?v=4",
         "events_url" : "https://api.github.com/users/naumenkogs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/naumenkogs/followers",
         "following_url" : "https://api.github.com/users/naumenkogs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/naumenkogs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/naumenkogs",
         "id" : 7975071,
         "login" : "naumenkogs",
         "node_id" : "MDQ6VXNlcjc5NzUwNzE=",
         "organizations_url" : "https://api.github.com/users/naumenkogs/orgs",
         "received_events_url" : "https://api.github.com/users/naumenkogs/received_events",
         "repos_url" : "https://api.github.com/users/naumenkogs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/naumenkogs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/naumenkogs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/naumenkogs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279081462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279081462"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "CJDNS vs IPv6 difference may not be very obvious to some people.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-31T10:07:06Z",
      "diff_hunk" : "@@ -1904,6 +1941,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n                 LogPrint(BCLog::NET, \"Making feeler connection to %s\\n\", addrConnect.ToStringAddrPort());\n             }\n+\n+            if (network_peer) LogPrint(BCLog::NET, \"Making network specific connection to %s\\n\", addrConnect.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279081462",
      "id" : 1279081462,
      "in_reply_to_id" : 1275653315,
      "line" : 1945,
      "node_id" : "PRRC_kwDOABII585MPTv2",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1945,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 102,
      "pull_request_review_id" : 1554424197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279081462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T10:07:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279081462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I would be happy to re-ack if followups are incorporated here. That would also keep git history cleaner. Can't amend commit messages in a followup, it will remain as \"IPv4 and IPv6 as one network\" forever in git history, could confuse the future generations (or me after a few months have passed and I have forgotten everything :disappointed:).",
      "created_at" : "2023-07-31T10:16:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1658080945",
      "id" : 1658080945,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585i1E6x",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658080945/reactions"
      },
      "updated_at" : "2023-07-31T10:16:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658080945",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279106923"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279106923"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "> Having a map where a `std::array` would be fine is kind of lame\r\n\r\nWhy? Semantically the closest container to what is needed here is a map. Do you mean from performance point of view? I would go with map first and consider an optimization only if it has been demonstrated that the optimization results in faster code or smaller memory footprint.\r\n\r\nTo be explicit - I would also ack this PR if this is changed to array. I think the map vs array discussion is minor for this PR and shouldn't block it.\r\n\r\nHowever, if this gets as map in `master`, taking an extra effort in a separate PR to change it to array would better be backed by some performance or memory measurements to demonstrate that there is an actual reason to change it.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-07-31T10:32:49Z",
      "diff_hunk" : "@@ -1048,6 +1064,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1279106923",
      "id" : 1279106923,
      "in_reply_to_id" : 1275642506,
      "line" : 1082,
      "node_id" : "PRRC_kwDOABII585MPZ9r",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1068,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 56,
      "pull_request_review_id" : 1554465463,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279106923/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-31T10:32:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279106923",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1280786062"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280786062"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n    AssertLockHeld(m_nodes_mutex);\r\n```\r\n\r\nWe lock `m_nodes_mutex` here, but this is only called from inside `ForEachNode`, which itself has already locked the same mutex. It's no problem because `m-Nodes_mutex` is Recursive, but as there is a passive [effort to replace Recursive Mutexes](https://github.com/bitcoin/bitcoin/issues/19303), if you do end up touching this again perhaps you could assert the lock is held at runtime with `AssertLockHeld` and decorate header declaration with `EXCLUSIVE_LOCKS_REQUIRED` for compile time analysis, instead?",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-08-01T15:07:46Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1280786062",
      "id" : 1280786062,
      "line" : 1615,
      "node_id" : "PRRC_kwDOABII585MVz6O",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 1557235174,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280786062/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T15:22:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280786062",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Going to suggest closing #28189 and just dealing with the final changes here. We can't change commit messages after the fact, so if that's a concern for some, we should correct them. I think with range-diff, and two reviewers already commited to re-ACKing, we can integrate the final changes and get this merged without issue.",
      "created_at" : "2023-08-01T15:25:08Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#issuecomment-1660554671",
      "id" : 1660554671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27213",
      "node_id" : "IC_kwDOABII585i-g2v",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660554671/reactions"
      },
      "updated_at" : "2023-08-01T15:25:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660554671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1280831815"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280831815"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : ":+1: ",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-08-01T15:42:52Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1280831815",
      "id" : 1280831815,
      "in_reply_to_id" : 1280786062,
      "line" : 1615,
      "node_id" : "PRRC_kwDOABII585MV_FH",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 26,
      "pull_request_review_id" : 1557311118,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280831815/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-01T15:42:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1280831815",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1281498873"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281498873"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "A `std::array` can be viewed as a specific form of map that uses keys from a range of integers starting at 0 that's known at compile time, with either few or no missing elements. Where that's the case, an array is more efficient (smaller storage, no dynamic allocation needed, faster lookups, better caching behaviour etc) and more convenient (eg, `x = a[3]` works even if `a` is a `const&` which isn't true for a map, requiring a [much more convoluted approach]https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1275648306) instead).\r\n\r\nThe \"don't optimise unless it's necessary\" philosophy doesn't mean \"write slow code until you find out faster code is needed\", it means \"write simple code until you find out faster code is needed\", but an array *is* simpler than a map in the first place. Using something a bit more complicated in its place, when that's both not useful and slower isn't the end of the world, but it's still kind of lame.",
      "commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "created_at" : "2023-08-02T07:21:21Z",
      "diff_hunk" : "@@ -1048,6 +1064,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1281498873",
      "id" : 1281498873,
      "in_reply_to_id" : 1275642506,
      "line" : 1082,
      "node_id" : "PRRC_kwDOABII585MYh75",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1068,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : 56,
      "pull_request_review_id" : 1558363454,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281498873/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-02T07:21:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281498873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283582108"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283582108"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated the commit message and incorporated brace initialization in latest push ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:40:11Z",
      "diff_hunk" : "@@ -90,6 +90,9 @@ static constexpr std::chrono::seconds MAX_UPLOAD_TIMEFRAME{60 * 60 * 24};\n // A random time period (0 to 1 seconds) is added to feeler connections to prevent synchronization.\n static constexpr auto FEELER_SLEEP_WINDOW{1s};\n \n+/** Frequency to attempt extra connections to reachable networks we're not connected to yet **/\n+static constexpr auto EXTRA_NETWORK_PEER_INTERVAL = 5min;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283582108",
      "id" : 1283582108,
      "in_reply_to_id" : 1254429298,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mgeic",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 94,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561662455,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 1,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283582108/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:40:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283582108",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283584387"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283584387"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated in latest push. no longer any references to the bundling in the commit messages ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:42:21Z",
      "diff_hunk" : "@@ -5159,6 +5161,9 @@ void PeerManagerImpl::EvictExtraOutboundPeers(std::chrono::seconds now)\n             if (state == nullptr) return; // shouldn't be possible, but just in case\n             // Don't evict our protected peers\n             if (state->m_chain_sync.m_protect) return;\n+            // If this is the only connection on a particular network that is",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283584387",
      "id" : 1283584387,
      "in_reply_to_id" : 1275142287,
      "line" : 5164,
      "node_id" : "PRRC_kwDOABII585MgfGD",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 5164,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/net_processing.cpp",
      "position" : 18,
      "pull_request_review_id" : 1561665500,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283584387/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:42:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283584387",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283585262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283585262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated in latest push. I think I caught them all ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:43:13Z",
      "diff_hunk" : "@@ -1135,6 +1135,9 @@ void CConnman::DisconnectNodes()\n                 // close socket and cleanup\n                 pnode->CloseSocketDisconnect();\n \n+                // update connection count by network\n+                if (pnode->IsManualOrFullOutboundConn()) m_network_conn_counts[pnode->addr.GetNetwork()]--;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283585262",
      "id" : 1283585262,
      "in_reply_to_id" : 1275642065,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MgfTu",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1139,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561666687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283585262/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:43:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283585262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283594372"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283594372"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "updated to an `std:array` in the latest push ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:51:02Z",
      "diff_hunk" : "@@ -1048,6 +1064,9 @@ class CConnman\n     std::atomic<NodeId> nLastNodeId{0};\n     unsigned int nPrevNodeCount{0};\n \n+    // Stores number of full-tx connections (outbound and manual) per network\n+    std::unordered_map<Network, size_t> m_network_conn_counts GUARDED_BY(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283594372",
      "id" : 1283594372,
      "in_reply_to_id" : 1275642506,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MghiE",
      "original_commit_id" : "9b97c34dbeecce1548cc1fd0f0f593db33d50f21",
      "original_line" : 1082,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/net.h",
      "position" : null,
      "pull_request_review_id" : 1561679574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283594372/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:51:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283594372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283595087"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283595087"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "incorporated here in latest push ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:51:50Z",
      "diff_hunk" : "@@ -1607,6 +1607,12 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);\n+    return m_network_conn_counts[net] > 1;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283595087",
      "id" : 1283595087,
      "in_reply_to_id" : 1275648306,
      "line" : 1616,
      "node_id" : "PRRC_kwDOABII585MghtP",
      "original_commit_id" : "d0ac2d6602ab5fd32d8d22b49488f77b33d6f0a9",
      "original_line" : 1616,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 27,
      "pull_request_review_id" : 1561680675,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283595087/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:51:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283595087",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283596113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283596113"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "done in latest push ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:52:49Z",
      "diff_hunk" : "@@ -1804,6 +1826,18 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n             next_feeler = GetExponentialRand(now, FEELER_INTERVAL);\n             conn_type = ConnectionType::FEELER;\n             fFeeler = true;\n+        } else if (nOutboundFullRelay == m_max_outbound_full_relay &&\n+                   m_max_outbound_full_relay == MAX_OUTBOUND_FULL_RELAY_CONNECTIONS &&\n+                   now > next_extra_network_peer &&\n+                   MaybePickPreferredNetwork(preferred_net)) {\n+            // Full outbound connection management: Attempt to get at least one\n+            // outbound peer from each reachable network by making extra connections\n+            // and then protecting \"only\" peers from a network during outbound eviction.\n+            // This is not attempted if the user changed -maxconnections to a value\n+            // so low that less than MAX_OUTBOUND_FULL_RELAY_CONNECTIONS are made,\n+            // to prevent interactions with otherwise protected outbound peers.\n+            next_extra_network_peer = GetExponentialRand(now, EXTRA_NETWORK_PEER_INTERVAL);\n+            network_peer = true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283596113",
      "id" : 1283596113,
      "in_reply_to_id" : 1275652683,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mgh9R",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1840,
      "original_position" : 65,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561682021,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283596113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:52:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283596113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283599071"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283599071"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added the network to print statement ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T18:55:52Z",
      "diff_hunk" : "@@ -1904,6 +1941,9 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 }\n                 LogPrint(BCLog::NET, \"Making feeler connection to %s\\n\", addrConnect.ToStringAddrPort());\n             }\n+\n+            if (network_peer) LogPrint(BCLog::NET, \"Making network specific connection to %s\\n\", addrConnect.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283599071",
      "id" : 1283599071,
      "in_reply_to_id" : 1275653315,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mgirf",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1945,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561686150,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283599071/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T18:55:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283599071",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283615894"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283615894"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "good catch! totally agree with the suggestion - def agree that we shouldn't introduce more uses of recursive mutexes, esp when not necessary. \r\n\r\nthat said, I'm struggling a bit to communicate with the compiler-\r\n\r\nwhen I add both the runtime `AssertLockHeld` and annotation of `EXCLUSIVE_LOCKS_REQUIRED`, I'm getting a compile time warning from `-Wthread-safety-analysis`\r\n\r\n<details>\r\n<summary>diff</summary>\r\n\r\n\r\n```\r\ndiff --git a/src/net.cpp b/src/net.cpp\r\nindex a504289fa5..228d081aa6 100644\r\n--- a/src/net.cpp\r\n+++ b/src/net.cpp\r\n@@ -1612,7 +1612,7 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\r\n\r\n bool CConnman::MultipleManualOrFullOutboundConns(Network net) const\r\n {\r\n-    LOCK(m_nodes_mutex);\r\n+    AssertLockHeld(m_nodes_mutex);\r\n     return m_network_conn_counts[net] > 1;\r\n }\r\n\r\ndiff --git a/src/net.h b/src/net.h\r\nindex 55f5631d43..0a3de19281 100644\r\n--- a/src/net.h\r\n+++ b/src/net.h\r\n@@ -909,7 +909,7 @@ public:\r\n     /** Return true if we should disconnect the peer for failing an inactivity check. */\r\n     bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const;\r\n\r\n-    bool MultipleManualOrFullOutboundConns(Network net) const;\r\n+    bool MultipleManualOrFullOutboundConns(Network net) const EXCLUSIVE_LOCKS_REQUIRED(m_nodes_mutex);\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>error</summary>\r\n\r\n```\r\nnet_processing.cpp:5166:28: warning: calling function 'MultipleManualOrFullOutboundConns' requires holding mutex 'm_connman.m_nodes_mutex' exclusively [-Wthread-safety-analysis]\r\n            if (!m_connman.MultipleManualOrFullOutboundConns(pnode->addr.GetNetwork())) return;\r\n```\r\n\r\n</details>\r\n\r\n\r\nand if I remove `EXCLUSIVE_LOCKS_REQUIRED` from the declaration, it complains about `AssertLockHeld` and `m_network_conn_counts`\r\n\r\n<details>\r\n<summary>error</summary>\r\n\r\n```\r\nnet.cpp:1615:5: warning: calling function 'AssertLockHeldInternal<AnnotatedMixin<std::recursive_mutex>>' requires holding mutex 'm_nodes_mutex' exclusively [-Wthread-safety-analysis]\r\n    AssertLockHeld(m_nodes_mutex);\r\n    ^\r\n./sync.h:143:28: note: expanded from macro 'AssertLockHeld'\r\n#define AssertLockHeld(cs) AssertLockHeldInternal(#cs, __FILE__, __LINE__, &cs)\r\n                           ^\r\nnet.cpp:1616:12: warning: reading variable 'm_network_conn_counts' requires holding mutex 'm_nodes_mutex' [-Wthread-safety-analysis]\r\n    return m_network_conn_counts[net] > 1;\r\n           ^\r\n```\r\n\r\n</details>\r\n\r\nI think this is an issue because `ForEachNode` is called in a lamdba which gets evaluated at runtime? I'm not sure how I can work around this, open to any suggestions :) ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T19:12:31Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283615894",
      "id" : 1283615894,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MgmyW",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561711775,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283615894/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T19:12:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283615894",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283620563"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283620563"
         }
      },
      "author_association" : "NONE",
      "body" : "I've been hacked",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T19:17:26Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283620563",
      "id" : 1283620563,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mgn7T",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561718537,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283620563/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T19:17:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283620563",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/95483929?v=4",
         "events_url" : "https://api.github.com/users/Malk8628/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Malk8628/followers",
         "following_url" : "https://api.github.com/users/Malk8628/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Malk8628/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Malk8628",
         "id" : 95483929,
         "login" : "Malk8628",
         "node_id" : "U_kgDOBbD4GQ",
         "organizations_url" : "https://api.github.com/users/Malk8628/orgs",
         "received_events_url" : "https://api.github.com/users/Malk8628/received_events",
         "repos_url" : "https://api.github.com/users/Malk8628/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Malk8628/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Malk8628/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Malk8628"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283682048"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283682048"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `ForEachNode` lambda is already annotated with `EXCLUSIVE_LOCKS_REQUIRED(::cs_main)` so all that 's needed is to add `m_connman.m_nodes_mutex` to that. That doesn't work directly, because `m_nodes_mutex` is private and the `ForEachNode` is in a different class, but you can work around that by declaring:\r\n\r\n```c++\r\npublic:\r\n    // alias for thread safety annotations only, not defined.\r\n    RecursiveMutex& GetNodesMutex() const LOCK_RETURNED(m_nodes_mutex); \r\n```\r\n\r\nin `CConnman`, and writing:\r\n\r\n```c++\r\n        m_connman.ForEachNode([&](CNode* pnode) EXCLUSIVE_LOCKS_REQUIRED(::cs_main, m_connman.GetNodesMutex()) {\r\n```",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-03T20:24:36Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283682048",
      "id" : 1283682048,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mg28A",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1561806538,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283682048/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-03T20:24:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283682048",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283872989"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283872989"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "oh interesting. do I understand this correctly: the `LOCK_RETURNED` annotation tells thread safety analysis that this function will return `m_nodes_mutex`, even though it's just an empty function, which lets the lambda use `EXCLUSIVE_LOCKS_REQUIRED`. this works because it doesn't need to actually return the mutex there, it just needs to promise the compiler it will be there, which is handled elsewhere. ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-04T01:13:10Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283872989",
      "id" : 1283872989,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mhljd",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1562046574,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283872989/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T01:13:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283872989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283935267"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283935267"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "hm, thinking about this more... I believe this workaround diminishes some of the value of the compile-time notation. for example, if `ForEachNode` no longer acquired `m_nodes_mutex`, then the compiler wouldn't be able to flag the issue, but the `AssertLockHeld` would catch it at runtime. \r\n\r\nthe advantage is that this one weak check allows to maintain the compiler checks at the other levels (of functions and members that are protected), and we remove the recursive locking of the mutex. \r\n\r\nthis seems reasonable to me, so I'll incorporate. ",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-04T03:20:57Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1283935267",
      "id" : 1283935267,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mh0wj",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1562118181,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283935267/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T03:20:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1283935267",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1500952?v=4",
         "events_url" : "https://api.github.com/users/amitiuttarwar/events{/privacy}",
         "followers_url" : "https://api.github.com/users/amitiuttarwar/followers",
         "following_url" : "https://api.github.com/users/amitiuttarwar/following{/other_user}",
         "gists_url" : "https://api.github.com/users/amitiuttarwar/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/amitiuttarwar",
         "id" : 1500952,
         "login" : "amitiuttarwar",
         "node_id" : "MDQ6VXNlcjE1MDA5NTI=",
         "organizations_url" : "https://api.github.com/users/amitiuttarwar/orgs",
         "received_events_url" : "https://api.github.com/users/amitiuttarwar/received_events",
         "repos_url" : "https://api.github.com/users/amitiuttarwar/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/amitiuttarwar/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/amitiuttarwar/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/amitiuttarwar"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1284001844"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001844"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Because `ForEachNode` takes a `std::function`, the thread safety annotations on the lambda are dropped, so the compiler can't verify that `ForEachNode` has actually taken all the locks that the lambda expects to have held. Problem is that doing it any other way (eg templates) requires `ForEachNode` to be annotated to require any extra locks that the lambda requires that were already held by the caller.",
      "commit_id" : "1b52d16d07be3b5d968157913f04d9cd1e2d3678",
      "created_at" : "2023-08-04T05:41:35Z",
      "diff_hunk" : "@@ -1604,6 +1610,28 @@ std::unordered_set<Network> CConnman::GetReachableEmptyNetworks() const\n     return networks;\n }\n \n+bool CConnman::MultipleManualOrFullOutboundConns(Network net)\n+{\n+    LOCK(m_nodes_mutex);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1284001844",
      "id" : 1284001844,
      "in_reply_to_id" : 1280786062,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MiFA0",
      "original_commit_id" : "1e65aae8068ecf313a7c3b176dfc1326b3b67fbe",
      "original_line" : 1615,
      "original_position" : 26,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1562204726,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27213",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001844/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-04T05:41:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1284001844",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   }
]
