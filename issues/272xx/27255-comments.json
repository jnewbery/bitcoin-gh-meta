[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27255).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [michaelfolkson](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468032095), [josibake](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1485343142), [sipa](https://github.com/bitcoin/bitcoin/pull/27255#pullrequestreview-1520822745) |\n| Stale ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1741276032), [scgbckbone](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1743258096), [bigspider](https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1744390972) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28602](https://github.com/bitcoin/bitcoin/pull/28602) (descriptors: Disallow hybrid and uncompressed keys when inferring by achow101)\n* [#28583](https://github.com/bitcoin/bitcoin/pull/28583) (refactor: [tidy] modernize-use-emplace by maflcko)\n* [#28528](https://github.com/bitcoin/bitcoin/pull/28528) (test: Use test framework utils in functional tests by osagie98)\n* [#22838](https://github.com/bitcoin/bitcoin/pull/22838) (descriptors: Be able to specify change and receiving in a single descriptor string by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-14T12:24:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468010901",
      "id" : 1468010901,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgBGV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468010901/reactions"
      },
      "updated_at" : "2023-10-06T17:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468010901",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK, an important piece in opening up Taproot scripting.\r\n\r\n> The design of Miniscript for Tapscript is the result of discussions between various people over the past year(s).\r\n\r\nYour PR description is great but perhaps you can link to a few of those discussions for extra background reading for those that are interested? e.g. https://gist.github.com/sipa/06c5c844df155d4e5044c2c8cac9c05e\r\n\r\nAlso just checking if this PR should be in Draft or not? Are there ongoing open discussions on anything important or is this ready for extensive review?\r\n\r\n",
      "created_at" : "2023-03-14T12:40:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468032095",
      "id" : 1468032095,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgGRf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468032095/reactions"
      },
      "updated_at" : "2023-03-14T12:40:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468032095",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yeah, thanks for the suggestion. Reviewers may be interested in https://github.com/sipa/miniscript/pull/134 as well.\r\n\r\n> Also just checking if this PR should be in Draft or not? Are there ongoing open discussions on anything important or is this ready for extensive review?\r\n\r\nIt is ready for (extensive or not) review. Otherwise i'd have opened it as a draft. But please tell me clearly if you disagree.",
      "created_at" : "2023-03-14T14:31:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468209943",
      "id" : 1468209943,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XgxsX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468209943/reactions"
      },
      "updated_at" : "2023-03-14T14:31:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468209943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "As it stands in this PR it would be possible to import a `tr()` descriptor unspendable by standardness: in addition to the script itself, we also need to check if the whole witness (including the control block, which is outside Miniscript..) isn't larger than the maximum standard transaction size.\r\n\r\nEDIT: Actually since we are still bounded by the `MAX_STACK_SIZE`Â of `1000` and no element is larger than `65` bytes, i think we can do something more elegant than having to compute the maximum witness size of a script. Just have the following conservative bound: refuse any script whose size is larger than `MAX_STANDARD_TX_WEIGHT - (1 + 65) * MAX_STACK_SIZE - TAPROOT_CONTROL_MAX_SIZE` (i.e. `329871` bytes). This is still plenty, and should there ever be a usecase for a larger script we can always relax this check by having an accurate max witness size calculation.",
      "created_at" : "2023-03-14T14:58:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1468263557",
      "id" : 1468263557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585Xg-yF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468263557/reactions"
      },
      "updated_at" : "2023-03-16T11:25:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1468263557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1136724397"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397"
         }
      },
      "author_association" : "NONE",
      "body" : "Perhaps `multi_a` for consistency, since `multi` is a valid fragment elsewhere?\r\nOr `Tapscript multisig` if you want to explicitly _not_ refer to the fragment.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T08:57:45Z",
      "diff_hunk" : "@@ -1901,7 +2136,38 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 if (!k || *k < 1 || *k > *n) return {};\n                 in += 3 + *n;\n                 std::reverse(keys.begin(), keys.end());\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::MULTI, std::move(keys), *k));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::MULTI, std::move(keys), *k));\n+                break;\n+            }\n+            // Tapscript's multi",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1136724397",
      "id" : 1136724397,
      "line" : 2142,
      "node_id" : "PRRC_kwDOABII585DwQmt",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 2142,
      "original_position" : 965,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 965,
      "pull_request_review_id" : 1340932665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T08:57:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1136724397",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137201661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661"
         }
      },
      "author_association" : "NONE",
      "body" : "It might be worth explicitly enumerating both the known contexts, and have a defensive final  `assert(false);`.\r\nSimilarly for other places where the context is accessed).",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T14:42:41Z",
      "diff_hunk" : "@@ -1188,23 +1188,28 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137201661",
      "id" : 1137201661,
      "line" : 1320,
      "node_id" : "PRRC_kwDOABII585DyFH9",
      "original_commit_id" : "62d31e6c7bc190602b0a89a1ff330a2bf6aefbf3",
      "original_line" : 1194,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 407,
      "pull_request_review_id" : 1341664972,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T14:42:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137201661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137224005"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I could have a `IsTapscript(ctx)` helper that does that next to the `MiniscriptContext` enum. It could then be used in all those places to not have to duplicate the verbose `switch () ... assert(false)`.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T14:55:02Z",
      "diff_hunk" : "@@ -1188,23 +1188,28 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137224005",
      "id" : 1137224005,
      "in_reply_to_id" : 1137201661,
      "line" : 1320,
      "node_id" : "PRRC_kwDOABII585DyKlF",
      "original_commit_id" : "62d31e6c7bc190602b0a89a1ff330a2bf6aefbf3",
      "original_line" : 1194,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 407,
      "pull_request_review_id" : 1341692112,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T14:55:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137224005",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137247463"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137247463"
         }
      },
      "author_association" : "NONE",
      "body" : "Why not this?\r\n```C++\r\n        if (ctx.MsContext() == MiniscriptContext::P2WSH) {\r\n            return GetStackSize() <= MAX_STANDARD_P2WSH_STACK_ITEMS;\r\n        }\r\n```\r\nOtherwise, it seems to add the other condition for the `P2WSH` context as well.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T15:08:07Z",
      "diff_hunk" : "@@ -1139,24 +1314,37 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }\n+\n+    //! Return the maximum number of stack elements needed to satisfy this script non-malleably.\n+    uint32_t GetStackSize() const { return ss.sat.size.value; }\n \n-    /** Return the maximum number of stack elements needed to satisfy this script non-malleably, including\n-     * the script push. */\n-    uint32_t GetStackSize() const { return ss.sat.value + 1; }\n+    //! Return the maximum size of the stack during execution of this script.\n+    uint32_t GetExecStackSize() const {\n+        return ss.sat.size.value + (uint32_t)std::max(ss.sat.exec.value, 0);\n+    }\n \n-    //! Check the maximum stack size for this script against the policy limit.\n-    bool CheckStackSize() const { return GetStackSize() - 1 <= MAX_STANDARD_P2WSH_STACK_ITEMS; }\n+    //! Check the maximum stack size for this script against the limits.\n+    template <typename Ctx> bool CheckStackSize(const Ctx& ctx) const {\n+        if (ctx.MsContext() == MiniscriptContext::P2WSH && GetStackSize() > MAX_STANDARD_P2WSH_STACK_ITEMS) {\n+            return false;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137247463",
      "id" : 1137247463,
      "line" : 1334,
      "node_id" : "PRRC_kwDOABII585DyQTn",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 1334,
      "original_position" : 426,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 426,
      "pull_request_review_id" : 1341720788,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137247463/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T15:08:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137247463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137259200"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137259200"
         }
      },
      "author_association" : "NONE",
      "body" : "Typo: \"contexts\"",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T15:14:54Z",
      "diff_hunk" : "@@ -536,10 +537,10 @@ BOOST_AUTO_TEST_CASE(descriptor_test)\n \n     // Invalid checksum\n     CheckUnparsable(\"wsh(and_v(vc:andor(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk_k(Kx9HCDjGiwFcgVNhTrS5z5NeZdD6veeam61eDxLDCkGWujvL4Gnn),and_v(v:older(1),pk_k(L4o2kDvXXDRH2VS9uBnouScLduWt4dZnM25se7kvEjJeQ285en2A))),after(10)))#abcdef12\", \"wsh(and_v(vc:andor(pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204),pk_k(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0),and_v(v:older(1),pk_k(02aa27e5eb2c185e87cd1dbc3e0efc9cb1175235e0259df1713424941c3cb40402))),after(10)))#abcdef12\", \"Provided checksum 'abcdef12' does not match computed checksum 'tyzp6a7p'\");\n-    // Only p2wsh context is valid\n-    CheckUnparsable(\"sh(and_v(vc:andor(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk_k(Kx9HCDjGiwFcgVNhTrS5z5NeZdD6veeam61eDxLDCkGWujvL4Gnn),and_v(v:older(1),pk_k(L4o2kDvXXDRH2VS9uBnouScLduWt4dZnM25se7kvEjJeQ285en2A))),after(10)))\", \"sh(and_v(vc:andor(pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204),pk_k(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0),and_v(v:older(1),pk_k(02aa27e5eb2c185e87cd1dbc3e0efc9cb1175235e0259df1713424941c3cb40402))),after(10)))\", \"Miniscript expressions can only be used in wsh\");\n+    // Only p2wsh or tr context are valid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137259200",
      "id" : 1137259200,
      "line" : 540,
      "node_id" : "PRRC_kwDOABII585DyTLA",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 540,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : 14,
      "pull_request_review_id" : 1341735215,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137259200/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T15:14:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137259200",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137280634"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137280634"
         }
      },
      "author_association" : "NONE",
      "body" : "Nit: missing a newline",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T15:20:51Z",
      "diff_hunk" : "@@ -1017,7 +1148,7 @@ void TestNode(const NodeRef& node, FuzzedDataProvider& provider)\n             assert(it != TEST_DATA.dummy_sigs.end());\n             return it->second.second;\n         }\n-        case Fragment::MULTI: {\n+        case Fragment::MULTI: case Fragment::MULTI_A: {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137280634",
      "id" : 1137280634,
      "line" : 1151,
      "node_id" : "PRRC_kwDOABII585DyYZ6",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 1151,
      "original_position" : 480,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 480,
      "pull_request_review_id" : 1341762826,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137280634/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T15:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137280634",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137296790"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137296790"
         }
      },
      "author_association" : "NONE",
      "body" : "I suppose it never happens, but worth checking that `a.value >= b`?\r\nEspecially since it could be used with unsigned types.",
      "commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "created_at" : "2023-03-15T15:25:05Z",
      "diff_hunk" : "@@ -316,11 +316,22 @@ struct MaxInt {\n         return a.value + b.value;\n     }\n \n+    friend MaxInt<I> operator-(const MaxInt<I>& a, const I& b) {\n+        if (!a.valid) return {};\n+        return a.value - b;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1137296790",
      "id" : 1137296790,
      "line" : 321,
      "node_id" : "PRRC_kwDOABII585DycWW",
      "original_commit_id" : "157c4a047b573dfac775f25c970e1f1762fe8f7b",
      "original_line" : 321,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 48,
      "pull_request_review_id" : 1341784989,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137296790/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-15T15:25:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137296790",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138537375"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138537375"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yeah, it didn't matter since the computation is trivial and the bounds more loose for Tapscript anyways. But your suggestion is clearer indeed, taken, thanks.",
      "commit_id" : "b4e747e267a8b7e910de4d0a40e41708a6fca4f1",
      "created_at" : "2023-03-16T11:57:43Z",
      "diff_hunk" : "@@ -1139,24 +1314,37 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }\n+\n+    //! Return the maximum number of stack elements needed to satisfy this script non-malleably.\n+    uint32_t GetStackSize() const { return ss.sat.size.value; }\n \n-    /** Return the maximum number of stack elements needed to satisfy this script non-malleably, including\n-     * the script push. */\n-    uint32_t GetStackSize() const { return ss.sat.value + 1; }\n+    //! Return the maximum size of the stack during execution of this script.\n+    uint32_t GetExecStackSize() const {\n+        return ss.sat.size.value + (uint32_t)std::max(ss.sat.exec.value, 0);\n+    }\n \n-    //! Check the maximum stack size for this script against the policy limit.\n-    bool CheckStackSize() const { return GetStackSize() - 1 <= MAX_STANDARD_P2WSH_STACK_ITEMS; }\n+    //! Check the maximum stack size for this script against the limits.\n+    template <typename Ctx> bool CheckStackSize(const Ctx& ctx) const {\n+        if (ctx.MsContext() == MiniscriptContext::P2WSH && GetStackSize() > MAX_STANDARD_P2WSH_STACK_ITEMS) {\n+            return false;\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138537375",
      "id" : 1138537375,
      "in_reply_to_id" : 1137247463,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D3LOf",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 1334,
      "original_position" : 426,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1343600247,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138537375/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T11:57:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138537375",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138538592"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138538592"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Meh. Done.",
      "commit_id" : "b4e747e267a8b7e910de4d0a40e41708a6fca4f1",
      "created_at" : "2023-03-16T11:58:49Z",
      "diff_hunk" : "@@ -536,10 +537,10 @@ BOOST_AUTO_TEST_CASE(descriptor_test)\n \n     // Invalid checksum\n     CheckUnparsable(\"wsh(and_v(vc:andor(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk_k(Kx9HCDjGiwFcgVNhTrS5z5NeZdD6veeam61eDxLDCkGWujvL4Gnn),and_v(v:older(1),pk_k(L4o2kDvXXDRH2VS9uBnouScLduWt4dZnM25se7kvEjJeQ285en2A))),after(10)))#abcdef12\", \"wsh(and_v(vc:andor(pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204),pk_k(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0),and_v(v:older(1),pk_k(02aa27e5eb2c185e87cd1dbc3e0efc9cb1175235e0259df1713424941c3cb40402))),after(10)))#abcdef12\", \"Provided checksum 'abcdef12' does not match computed checksum 'tyzp6a7p'\");\n-    // Only p2wsh context is valid\n-    CheckUnparsable(\"sh(and_v(vc:andor(pk(L4gM1FBdyHNpkzsFh9ipnofLhpZRp2mwobpeULy1a6dBTvw8Ywtd),pk_k(Kx9HCDjGiwFcgVNhTrS5z5NeZdD6veeam61eDxLDCkGWujvL4Gnn),and_v(v:older(1),pk_k(L4o2kDvXXDRH2VS9uBnouScLduWt4dZnM25se7kvEjJeQ285en2A))),after(10)))\", \"sh(and_v(vc:andor(pk(03cdabb7f2dce7bfbd8a0b9570c6fd1e712e5d64045e9d6b517b3d5072251dc204),pk_k(032707170c71d8f75e4ca4e3fce870b9409dcaf12b051d3bcadff74747fa7619c0),and_v(v:older(1),pk_k(02aa27e5eb2c185e87cd1dbc3e0efc9cb1175235e0259df1713424941c3cb40402))),after(10)))\", \"Miniscript expressions can only be used in wsh\");\n+    // Only p2wsh or tr context are valid",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138538592",
      "id" : 1138538592,
      "in_reply_to_id" : 1137259200,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D3Lhg",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 540,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/test/descriptor_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1343601973,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138538592/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T11:58:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138538592",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138541531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138541531"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm i thought i was following the style used elsewhere, but i must have dreamed it. Done.",
      "commit_id" : "b4e747e267a8b7e910de4d0a40e41708a6fca4f1",
      "created_at" : "2023-03-16T12:01:05Z",
      "diff_hunk" : "@@ -1017,7 +1148,7 @@ void TestNode(const NodeRef& node, FuzzedDataProvider& provider)\n             assert(it != TEST_DATA.dummy_sigs.end());\n             return it->second.second;\n         }\n-        case Fragment::MULTI: {\n+        case Fragment::MULTI: case Fragment::MULTI_A: {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138541531",
      "id" : 1138541531,
      "in_reply_to_id" : 1137280634,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585D3MPb",
      "original_commit_id" : "33f28a8d472a2869d37e40f5f9d7efd7f88bcc89",
      "original_line" : 1151,
      "original_position" : 480,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1343605518,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138541531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T12:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138541531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138548620"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138548620"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Hmm that's a good point re unsigned type, but it needs to be able to return negative values. So i guess it's up to the caller to make sure they don't call this with `b > a` if `a` is unsigned, as with regular substractions?",
      "commit_id" : "b4e747e267a8b7e910de4d0a40e41708a6fca4f1",
      "created_at" : "2023-03-16T12:06:40Z",
      "diff_hunk" : "@@ -316,11 +316,22 @@ struct MaxInt {\n         return a.value + b.value;\n     }\n \n+    friend MaxInt<I> operator-(const MaxInt<I>& a, const I& b) {\n+        if (!a.valid) return {};\n+        return a.value - b;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138548620",
      "id" : 1138548620,
      "in_reply_to_id" : 1137296790,
      "line" : 330,
      "node_id" : "PRRC_kwDOABII585D3N-M",
      "original_commit_id" : "157c4a047b573dfac775f25c970e1f1762fe8f7b",
      "original_line" : 330,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 57,
      "pull_request_review_id" : 1343614719,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138548620/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T12:06:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138548620",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138892649"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138892649"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Alright, finally applied the change to the many occurrences in each commit. It should also be more readable now.",
      "commit_id" : "b4e747e267a8b7e910de4d0a40e41708a6fca4f1",
      "created_at" : "2023-03-16T15:33:33Z",
      "diff_hunk" : "@@ -1188,23 +1188,28 @@ struct Node {\n     //! Return the number of ops in the script (not counting the dynamic ones that depend on execution).\n     uint32_t GetStaticOps() const { return ops.count; }\n \n-    //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const { return GetOps() <= MAX_OPS_PER_SCRIPT; }\n+    //! Check the ops limit of this script against the consensus limit. This limit is only present for P2WSH.\n+    template <typename Ctx> bool CheckOpsLimit(const Ctx& ctx) const {\n+        return ctx.MsContext() == MiniscriptContext::TAPSCRIPT || GetOps() <= MAX_OPS_PER_SCRIPT;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1138892649",
      "id" : 1138892649,
      "in_reply_to_id" : 1137201661,
      "line" : 1342,
      "node_id" : "PRRC_kwDOABII585D4h9p",
      "original_commit_id" : "62d31e6c7bc190602b0a89a1ff330a2bf6aefbf3",
      "original_line" : 1342,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 438,
      "pull_request_review_id" : 1344105798,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138892649/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-03-16T15:33:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1138892649",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "In the last push i've:\r\n- Added a commit to avoid a stack overflow during the destruction of a too large `Node`, due to recursive calls in `shared_ptr`'s destructor. (The reason the CI was failing under MSVC.)\r\n- Lowered the maximum size of a TapMiniscript to make sure a spending witness would never hit the maximum standard transaction size limit. (It's still pretty high.)\r\n- Addressed all comments from @bigspider.\r\n\r\nThis PR is now ready for another round of review.",
      "created_at" : "2023-03-16T17:04:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1472365761",
      "id" : 1472365761,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585XwoTB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472365761/reactions"
      },
      "updated_at" : "2023-03-16T17:04:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1472365761",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed to try to wake the CI up. Looks like it worked!",
      "created_at" : "2023-03-17T10:31:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1473626748",
      "id" : 1473626748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585X1cJ8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473626748/reactions"
      },
      "updated_at" : "2023-03-17T10:31:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473626748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Very cool. I also noticed [bitcoin.sipa.be/miniscript](https://bitcoin.sipa.be/miniscript/) has been updated.\r\n\r\nHas there been any thought into how MuSig2 (and threshold friends) would fit into this in the future? I guess that's only a problem for the compiler, since for the purpose of script it doesn't matter if e.g. public key C is an aggregate of A + B. But it does change the meaning of something like `tr(C,multi_a(2,A,B))` (i.e. regular tapscript multisig fallback if MuSig2 coordination fails - maybe not a good example, since this already works).",
      "created_at" : "2023-03-17T12:40:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1473771519",
      "id" : 1473771519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585X1_f_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473771519/reactions"
      },
      "updated_at" : "2023-03-17T12:45:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473771519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Has there been any thought into how MuSig2 (and threshold friends) would fit into this in the future?\r\n\r\nDiscussed in sipa's [gist](https://gist.github.com/sipa/06c5c844df155d4e5044c2c8cac9c05e#musig-descriptors). Can comment on that gist @Sjors \r\n",
      "created_at" : "2023-03-17T12:45:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1473777054",
      "id" : 1473777054,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585X2A2e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473777054/reactions"
      },
      "updated_at" : "2023-03-17T12:45:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1473777054",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-03-27T15:30:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1485343142",
      "id" : 1485343142,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585YiImm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1485343142/reactions"
      },
      "updated_at" : "2023-03-27T15:30:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1485343142",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-04-05T14:18:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1497570962",
      "id" : 1497570962,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585ZQx6S",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497570962/reactions"
      },
      "updated_at" : "2023-04-05T14:18:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497570962",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160599451"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160599451"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        KeyParser parser(/*out =*/&out, /*in=*/nullptr, /*ctx=*/miniscript::MiniscriptContext::P2WSH);\r\n```",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:04:12Z",
      "diff_hunk" : "@@ -1502,7 +1524,7 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n     }\n     // Process miniscript expressions.\n     {\n-        KeyParser parser(&out, nullptr);\n+        KeyParser parser(/*out = */&out, /* in = */nullptr, /* ctx = */miniscript::MiniscriptContext::P2WSH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160599451",
      "id" : 1160599451,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FLVeb",
      "original_commit_id" : "ef0eb7f87d19bd8a3ebff4f095d321964808df73",
      "original_line" : 1527,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160599451/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160599451",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160600034"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160600034"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        KeyParser parser(/*out=*/nullptr, /*in=*/&provider, /*ctx=*/miniscript::MiniscriptContext::P2WSH);",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:05:19Z",
      "diff_hunk" : "@@ -1670,7 +1692,7 @@ std::unique_ptr<DescriptorImpl> InferScript(const CScript& script, ParseScriptCo\n     }\n \n     if (ctx == ParseScriptContext::P2WSH) {\n-        KeyParser parser(nullptr, &provider);\n+        KeyParser parser(/* out = */nullptr, /* in = */&provider, /* ctx = */miniscript::MiniscriptContext::P2WSH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160600034",
      "id" : 1160600034,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FLVni",
      "original_commit_id" : "ef0eb7f87d19bd8a3ebff4f095d321964808df73",
      "original_line" : 1695,
      "original_position" : 109,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160600034/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160600034",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606636"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606636"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "iirc, `assert` crashes the node. wouldn't it be better to use the `Assume` macro?",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:17:46Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n \n namespace miniscript {\n+\n+bool IsTapscript(MiniscriptContext ms_ctx)\n+{\n+    switch (ms_ctx) {\n+        case MiniscriptContext::P2WSH: return false;\n+        case MiniscriptContext::TAPSCRIPT: return true;\n+    }\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606636",
      "id" : 1160606636,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585FLXOs",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 21,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 11,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606636/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606636",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "same comment as above re: `assert`",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:17:59Z",
      "diff_hunk" : "@@ -605,6 +608,7 @@ struct Node {\n                 case Fragment::OR_I: return BuildScript(OP_IF, subs[0], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::ANDOR: return BuildScript(std::move(subs[0]), OP_NOTIF, subs[2], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::MULTI: {\n+                    assert(!IsTapscript(ctx.MsContext()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606743",
      "id" : 1160606743,
      "line" : 656,
      "node_id" : "PRRC_kwDOABII585FLXQX",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 611,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 167,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606878"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606878"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "same comment as above re: `assert`",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:18:15Z",
      "diff_hunk" : "@@ -704,6 +708,7 @@ struct Node {\n                     if (node.subs[2]->fragment == Fragment::JUST_0) return std::move(ret) + \"and_n(\" + std::move(subs[0]) + \",\" + std::move(subs[1]) + \")\";\n                     return std::move(ret) + \"andor(\" + std::move(subs[0]) + \",\" + std::move(subs[1]) + \",\" + std::move(subs[2]) + \")\";\n                 case Fragment::MULTI: {\n+                    assert(!IsTapscript(ctx.MsContext()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160606878",
      "id" : 1160606878,
      "line" : 764,
      "node_id" : "PRRC_kwDOABII585FLXSe",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 711,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 189,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606878/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160606878",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160608237"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160608237"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "probably out of scope for this PR, but it would be nice to have the parser tell you why it wasn't able to parse the script, rather than just return empty",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:20:52Z",
      "diff_hunk" : "@@ -1534,6 +1539,7 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n                 in = in.subspan(arg_size + 1);\n                 script_size += 1 + (num > 16) + (num > 0x7f) + (num > 0x7fff) + (num > 0x7fffff);\n             } else if (Const(\"multi(\", in)) {\n+                if (IsTapscript(ctx.MsContext())) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160608237",
      "id" : 1160608237,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FLXnt",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 1542,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160608237/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160608237",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160609483"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160609483"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "not a big deal, but I think it's more correct to say \"CHECKMULTISIG is disabled in Tapscript\" in the commit message",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:23:16Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160609483",
      "id" : 1160609483,
      "line" : 12,
      "node_id" : "PRRC_kwDOABII585FLX7L",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 12,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 2,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160609483/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160609483",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160611768"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160611768"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n                if (!parse_multi_exp(in, /*is_multi_a=*/false)) return {};\r\n```",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:27:31Z",
      "diff_hunk" : "@@ -1539,27 +1617,9 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n                 in = in.subspan(arg_size + 1);\n                 script_size += 1 + (num > 16) + (num > 0x7f) + (num > 0x7fff) + (num > 0x7fffff);\n             } else if (Const(\"multi(\", in)) {\n-                if (IsTapscript(ctx.MsContext())) return {};\n-                // Get threshold\n-                int next_comma = FindNextChar(in, ',');\n-                if (next_comma < 1) return {};\n-                if (!ParseInt64(std::string(in.begin(), in.begin() + next_comma), &k)) return {};\n-                in = in.subspan(next_comma + 1);\n-                // Get keys\n-                std::vector<Key> keys;\n-                while (next_comma != -1) {\n-                    next_comma = FindNextChar(in, ',');\n-                    int key_length = (next_comma == -1) ? FindNextChar(in, ')') : next_comma;\n-                    if (key_length < 1) return {};\n-                    auto key = ctx.FromString(in.begin(), in.begin() + key_length);\n-                    if (!key) return {};\n-                    keys.push_back(std::move(*key));\n-                    in = in.subspan(key_length + 1);\n-                }\n-                if (keys.size() < 1 || keys.size() > 20) return {};\n-                if (k < 1 || k > (int64_t)keys.size()) return {};\n-                script_size += 2 + (keys.size() > 16) + (k > 16) + 34 * keys.size();\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::MULTI, std::move(keys), k));\n+                if (!parse_multi_exp(in, /* is_multi_a = */false)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160611768",
      "id" : 1160611768,
      "line" : 1802,
      "node_id" : "PRRC_kwDOABII585FLYe4",
      "original_commit_id" : "c0ba8ebbf6369b37b645165bb5cd638fc7eee67f",
      "original_line" : 1620,
      "original_position" : 172,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 776,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160611768/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160611768",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160612094"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160612094"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n                if (!parse_multi_exp(in, /*is_multi_a=*/true)) return {};\r\n```",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:28:16Z",
      "diff_hunk" : "@@ -1539,27 +1617,9 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n                 in = in.subspan(arg_size + 1);\n                 script_size += 1 + (num > 16) + (num > 0x7f) + (num > 0x7fff) + (num > 0x7fffff);\n             } else if (Const(\"multi(\", in)) {\n-                if (IsTapscript(ctx.MsContext())) return {};\n-                // Get threshold\n-                int next_comma = FindNextChar(in, ',');\n-                if (next_comma < 1) return {};\n-                if (!ParseInt64(std::string(in.begin(), in.begin() + next_comma), &k)) return {};\n-                in = in.subspan(next_comma + 1);\n-                // Get keys\n-                std::vector<Key> keys;\n-                while (next_comma != -1) {\n-                    next_comma = FindNextChar(in, ',');\n-                    int key_length = (next_comma == -1) ? FindNextChar(in, ')') : next_comma;\n-                    if (key_length < 1) return {};\n-                    auto key = ctx.FromString(in.begin(), in.begin() + key_length);\n-                    if (!key) return {};\n-                    keys.push_back(std::move(*key));\n-                    in = in.subspan(key_length + 1);\n-                }\n-                if (keys.size() < 1 || keys.size() > 20) return {};\n-                if (k < 1 || k > (int64_t)keys.size()) return {};\n-                script_size += 2 + (keys.size() > 16) + (k > 16) + 34 * keys.size();\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::MULTI, std::move(keys), k));\n+                if (!parse_multi_exp(in, /* is_multi_a = */false)) return {};\n+            } else if (Const(\"multi_a(\", in)) {\n+                if (!parse_multi_exp(in, /* is_multi_a = */true)) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160612094",
      "id" : 1160612094,
      "line" : 1804,
      "node_id" : "PRRC_kwDOABII585FLYj-",
      "original_commit_id" : "c0ba8ebbf6369b37b645165bb5cd638fc7eee67f",
      "original_line" : 1622,
      "original_position" : 174,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 778,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160612094/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160612094",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160615879"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160615879"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"warning: suggest parentheses around arithmetic in operand of â|â [-Wparentheses]\"\r\n\r\n```suggestion\r\n                        next_sats_diff.push_back((sats_diff[j] + subs[i]->ss.dsat.diff) | ((sats_diff[j - 1] + subs[i]->ss.sat.diff) + add_diff));",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:36:06Z",
      "diff_hunk" : "@@ -833,51 +858,152 @@ struct Node {\n     }\n \n     internal::StackSize CalcStackSize() const {\n+        // Among non-malleable satisfactions and dissatisfactions, this computes for each fragment:\n+        // - The maximum witness stack size of this (dis)satisfaction;\n+        // - The maximum number of elements added or removed on the stack after executing it;\n+        // - The maximum number of elements added to the stack while executing it.\n         switch (fragment) {\n-            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_0: return {{}, {0, 1}};\n             case Fragment::JUST_1:\n             case Fragment::OLDER:\n-            case Fragment::AFTER: return {0, {}};\n-            case Fragment::PK_K: return {1, 1};\n-            case Fragment::PK_H: return {2, 2};\n+            case Fragment::AFTER: return {{0, 1}, {}};\n+            case Fragment::PK_K: return {{1, 1}, {1, 1}};\n+            case Fragment::PK_H: return {{2, 0, 2}, {2, 0, 2}};\n             case Fragment::SHA256:\n             case Fragment::RIPEMD160:\n             case Fragment::HASH256:\n-            case Fragment::HASH160: return {1, {}};\n+            case Fragment::HASH160: return {{1, 0, 2}, {}};\n             case Fragment::ANDOR: {\n-                const auto sat{(subs[0]->ss.sat + subs[1]->ss.sat) | (subs[0]->ss.dsat + subs[2]->ss.sat)};\n-                const auto dsat{subs[0]->ss.dsat + subs[2]->ss.dsat};\n-                return {sat, dsat};\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto& z{subs[2]->ss};\n+                const auto sat_size{(x.sat.size + y.sat.size) | (x.dsat.size + z.sat.size)};\n+                const auto dsat_size{x.dsat.size + z.dsat.size};\n+                const auto sat_diff{((x.sat.diff + y.sat.diff) | (x.dsat.diff + z.sat.diff)) - 1};\n+                const auto dsat_diff{x.dsat.diff - 1 + z.dsat.diff};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.sat.diff - 1 + y.sat.exec) | (x.dsat.diff - 1 + z.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff - 1 + z.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::AND_V: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size + y.sat.size};\n+                const auto sat_diff{x.sat.diff + y.sat.diff};\n+                const auto sat_exec{x.sat.exec | (x.sat.diff + y.sat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {}};\n+            }\n+            case Fragment::AND_B: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size + y.sat.size};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{x.sat.diff + y.sat.diff - 1};\n+                const auto dsat_diff{x.dsat.diff + y.dsat.diff - 1};\n+                const auto sat_exec{x.sat.exec | (x.sat.diff + y.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n             }\n-            case Fragment::AND_V: return {subs[0]->ss.sat + subs[1]->ss.sat, {}};\n-            case Fragment::AND_B: return {subs[0]->ss.sat + subs[1]->ss.sat, subs[0]->ss.dsat + subs[1]->ss.dsat};\n             case Fragment::OR_B: {\n-                const auto sat{(subs[0]->ss.dsat + subs[1]->ss.sat) | (subs[0]->ss.sat + subs[1]->ss.dsat)};\n-                const auto dsat{subs[0]->ss.dsat + subs[1]->ss.dsat};\n-                return {sat, dsat};\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{(x.dsat.size + y.sat.size) | (x.sat.size + y.dsat.size)};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{((x.dsat.diff + y.sat.diff) | (x.sat.diff + y.dsat.diff)) - 1};\n+                const auto dsat_diff{x.dsat.diff + y.dsat.diff - 1};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.dsat.diff + y.sat.exec) | (x.sat.diff + y.dsat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::OR_C: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size | (x.dsat.size + y.sat.size)};\n+                const auto sat_diff{(x.sat.diff | (x.dsat.diff + y.sat.diff)) - 1};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.dsat.diff - 1 + y.sat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {}};\n+            }\n+            case Fragment::OR_D: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size | (x.dsat.size + y.sat.size)};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{x.sat.diff | (x.dsat.diff - 1 + y.sat.diff)};\n+                const auto dsat_diff{x.dsat.diff - 1 + y.dsat.diff};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.sat.diff + 1) | (x.dsat.diff + y.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff - 1 + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::OR_I: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{(x.sat.size + 1) | (y.sat.size + 1)};\n+                const auto dsat_size{(x.dsat.size + 1) | (y.dsat.size + 1)};\n+                const auto sat_diff{(x.sat.diff | y.sat.diff) - 1};\n+                const auto dsat_diff{(x.dsat.diff | y.dsat.diff) - 1};\n+                const auto sat_exec{(x.sat.exec | y.sat.exec) - 1};\n+                const auto dsat_exec{(x.dsat.exec | y.dsat.exec) - 1};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n             }\n-            case Fragment::OR_C: return {subs[0]->ss.sat | (subs[0]->ss.dsat + subs[1]->ss.sat), {}};\n-            case Fragment::OR_D: return {subs[0]->ss.sat | (subs[0]->ss.dsat + subs[1]->ss.sat), subs[0]->ss.dsat + subs[1]->ss.dsat};\n-            case Fragment::OR_I: return {(subs[0]->ss.sat + 1) | (subs[1]->ss.sat + 1), (subs[0]->ss.dsat + 1) | (subs[1]->ss.dsat + 1)};\n-            case Fragment::MULTI: return {k + 1, k + 1};\n-            case Fragment::MULTI_A: return {keys.size(), keys.size()};\n+            case Fragment::MULTI: return {{(uint32_t)k + 1, -(int32_t)k, 2 + (int32_t)keys.size()}, {(uint32_t)k + 1, -(int32_t)k, 2 + (int32_t)keys.size()}};\n+            case Fragment::MULTI_A: return {{(uint32_t)keys.size(), -(int32_t)keys.size() + 1, 1}, {(uint32_t)keys.size(), -(int32_t)keys.size() + 1, 1}};\n             case Fragment::WRAP_A:\n             case Fragment::WRAP_N:\n-            case Fragment::WRAP_S:\n-            case Fragment::WRAP_C: return subs[0]->ss;\n-            case Fragment::WRAP_D: return {1 + subs[0]->ss.sat, 1};\n-            case Fragment::WRAP_V: return {subs[0]->ss.sat, {}};\n-            case Fragment::WRAP_J: return {subs[0]->ss.sat, 1};\n+            case Fragment::WRAP_S: return subs[0]->ss;\n+            case Fragment::WRAP_C: {\n+                const auto& sub_sat{subs[0]->ss.sat};\n+                const auto& sub_dsat{subs[0]->ss.dsat};\n+                return {{sub_sat.size, sub_sat.diff - 1, sub_sat.exec}, {sub_dsat.size, sub_dsat.diff - 1, sub_dsat.exec}};\n+            }\n+            case Fragment::WRAP_D: return {{1 + subs[0]->ss.sat.size, subs[0]->ss.sat.diff, subs[0]->ss.sat.exec | 1}, {1, 0, 1}};\n+            case Fragment::WRAP_V: return {{subs[0]->ss.sat.size, subs[0]->ss.sat.diff - 1, subs[0]->ss.sat.exec}, {}};\n+            case Fragment::WRAP_J: return {{subs[0]->ss.sat.size, subs[0]->ss.sat.diff, subs[0]->ss.sat.exec | 1}, {1, 0, subs[0]->ss.dsat.exec | 1}};\n             case Fragment::THRESH: {\n-                auto sats = Vector(internal::MaxInt<uint32_t>(0));\n-                for (const auto& sub : subs) {\n-                    auto next_sats = Vector(sats[0] + sub->ss.dsat);\n-                    for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + sub->ss.dsat) | (sats[j - 1] + sub->ss.sat));\n-                    next_sats.push_back(sats[sats.size() - 1] + sub->ss.sat);\n-                    sats = std::move(next_sats);\n+                // The maximum satisfaction witness stack size for this fragment, indexed by threshold.\n+                auto sats_size = Vector(internal::MaxInt<uint32_t>(0));\n+                // Same for the stack size differential after executing this fragment.\n+                auto sats_diff = Vector(internal::MaxInt<int32_t>(0));\n+                // The maximum stack size at any point during execution of this fragment (or any sub\n+                // fragment thereoff), indexed by threshold.\n+                auto sats_exec = Vector(internal::MaxInt<int32_t>(0));\n+                for (size_t i = 0; i < subs.size(); ++i) {\n+                    // Start with the (non-malleable) dissatisfaction size.\n+                    auto next_sats_size = Vector(sats_size[0] + subs[i]->ss.dsat.size);\n+                    // Whether to account for OP_ADD that drops one element from the stack (-2 + 1).\n+                    auto add_diff = (i > 0 && i < subs.size() - 1) ? -1 : 0;\n+                    // The total difference in stack size after dissatisfying the first i first fragments.\n+                    auto next_sats_diff = Vector(sats_diff[0] + subs[i]->ss.dsat.diff + add_diff);\n+                    // Does the stack size gets bigger when dissatifying this fragment than the previous ones?\n+                    auto next_sats_exec = Vector(sats_exec[0] | (sats_diff[0] + subs[i]->ss.dsat.exec));\n+                    // Update what combination of sat/dsat is the largest per threshold.\n+                    for (size_t j = 1; j < sats_size.size(); ++j) {\n+                        // Which is larger, k-1 satisfaction and satifying this sub, or k satisfaction and dissatisfying\n+                        // this one?\n+                        next_sats_size.push_back((sats_size[j] + subs[i]->ss.dsat.size) | (sats_size[j - 1] + subs[i]->ss.sat.size));\n+                        // Same for size of the stack after satisfying k of the past i fragments.\n+                        next_sats_diff.push_back((sats_diff[j] + subs[i]->ss.dsat.diff) | (sats_diff[j - 1] + subs[i]->ss.sat.diff) + add_diff);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160615879",
      "id" : 1160615879,
      "line" : 997,
      "node_id" : "PRRC_kwDOABII585FLZfH",
      "original_commit_id" : "efdd1543597aff49c56a1abaa75b574be3b330db",
      "original_line" : 984,
      "original_position" : 212,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 373,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160615879/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160615879",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160622303"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160622303"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "\"warning: âvoid* __builtin_memcpy(void*, const void*, long unsigned int)â writing 33 bytes into a region of size 32 overflows the destination [-Wstringop-overflow=]\"\r\n\r\ngetting this warning but it doesn't make sense to me why, because it should be calling the right function based on `ctx`? there is a definition for `FromPKBytes` in `src/script/descriptor.cpp` and another one in `src/script/sign.cpp` and the warning is coming from the `src/sign.cpp` one. ",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-07T10:49:18Z",
      "diff_hunk" : "@@ -1828,65 +2081,66 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n             // Constants\n             if (in[0].first == OP_1) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_1));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_1));\n                 break;\n             }\n             if (in[0].first == OP_0) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_0));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_0));\n                 break;\n             }\n             // Public keys\n-            if (in[0].second.size() == 33) {\n+            if (in[0].second.size() == 33 || in[0].second.size() == 32) {\n                 auto key = ctx.FromPKBytes(in[0].second.begin(), in[0].second.end());\n                 if (!key) return {};\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::PK_K, Vector(std::move(*key))));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::PK_K, Vector(std::move(*key))));\n                 break;\n             }\n             if (last - in >= 5 && in[0].first == OP_VERIFY && in[1].first == OP_EQUAL && in[3].first == OP_HASH160 && in[4].first == OP_DUP && in[2].second.size() == 20) {\n                 auto key = ctx.FromPKHBytes(in[2].second.begin(), in[2].second.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1160622303",
      "id" : 1160622303,
      "line" : 2101,
      "node_id" : "PRRC_kwDOABII585FLbDf",
      "original_commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "original_line" : 2101,
      "original_position" : 932,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 932,
      "pull_request_review_id" : 1376054310,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160622303/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-07T10:54:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160622303",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1174534364"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174534364"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Is there a reason why the only two options are P2WSH and P2TR? Should there be a case statement for P2SH (`sh`) too?",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-23T08:21:55Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n \n namespace miniscript {\n+\n+bool IsTapscript(MiniscriptContext ms_ctx)\n+{\n+    switch (ms_ctx) {\n+        case MiniscriptContext::P2WSH: return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1174534364",
      "id" : 1174534364,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585GAfjc",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 18,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 8,
      "pull_request_review_id" : 1396864124,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174534364/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-23T08:21:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174534364",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Reviewers, i've seen the comments i'm going to address them soon and rebase this.\r\n\r\nI have discussed this with @sipa in person today. A couple notes from my recollection:\r\n- I introduce the `diff` (net difference in stack size before and after executing a fragment) and `exec`Â (maximum stack size reached during execution) here to account for the maximum stack size at all time.Â Pieter noticed we may be able to express the size in function of the diff. Or vice versa.\r\n- We tried to assert this property in the fuzz test.\r\n- We noticed `or_i` is the only fragment with two possible canonical dissatisfactions. If both dissatisfactions are available (only if both fragments are `d`) we choose the one with the largest stack size. But it seems unnecessary, the satisfier would always choose the smallest one. But the satisfier chooses in function of the actual witness size (not stack size) so it could be checking the dissatisfaction with the largest stack size.\r\n\r\nWe'll see if we can introduce some of this to the existing code and rebase this on top.",
      "created_at" : "2023-04-27T15:33:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1525910357",
      "id" : 1525910357,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585a84tV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525910357/reactions"
      },
      "updated_at" : "2023-04-27T15:33:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1525910357",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1180610019"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180610019"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Note to self: i should relax the ops and script size limits below under Tapscript context.",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-04-28T16:32:58Z",
      "diff_hunk" : "@@ -811,11 +856,15 @@ NodeRef GenNode(F ConsumeNode, Type root_type, bool strict_valid = false) {\n             // Fragment/children have not been decided yet. Decide them.\n             auto node_info = ConsumeNode(type_needed);\n             if (!node_info) return {};\n+            if ((!miniscript::IsTapscript(SCRIPT_CTX) && node_info->fragment == Fragment::MULTI_A)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1180610019",
      "id" : 1180610019,
      "line" : 859,
      "node_id" : "PRRC_kwDOABII585GXq3j",
      "original_commit_id" : "02a5fa633f9f44b378f7c015275eacd54939e980",
      "original_line" : 859,
      "original_position" : 223,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 288,
      "pull_request_review_id" : 1406271728,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180610019/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-28T16:32:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1180610019",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183400073"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183400073"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because the current codebase only support P2WSH, there is no support for legacy P2SH.",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T08:42:48Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n \n namespace miniscript {\n+\n+bool IsTapscript(MiniscriptContext ms_ctx)\n+{\n+    switch (ms_ctx) {\n+        case MiniscriptContext::P2WSH: return false;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183400073",
      "id" : 1183400073,
      "in_reply_to_id" : 1174534364,
      "line" : 18,
      "node_id" : "PRRC_kwDOABII585GiUCJ",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 18,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 8,
      "pull_request_review_id" : 1410428611,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183400073/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T08:42:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183400073",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183405185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183405185"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What's the rationale for changing this? Do whitespaces prevent the analysis? Happy to do this (and the other similar comments) but i'd rather not go through the hassle of applying it on every single of the 21 commits and solve the rebase conflicts if it's just a style nit. Let me know!",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T08:48:06Z",
      "diff_hunk" : "@@ -1502,7 +1524,7 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n     }\n     // Process miniscript expressions.\n     {\n-        KeyParser parser(&out, nullptr);\n+        KeyParser parser(/*out = */&out, /* in = */nullptr, /* ctx = */miniscript::MiniscriptContext::P2WSH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183405185",
      "id" : 1183405185,
      "in_reply_to_id" : 1160599451,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585GiVSB",
      "original_commit_id" : "ef0eb7f87d19bd8a3ebff4f095d321964808df73",
      "original_line" : 1527,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1410436660,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183405185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T08:48:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183405185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183410413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183410413"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This specific case is the very common match-all-variants-and-assert pattern so i think it's good like that. It's also documented this way in our style guidelines: https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#c-data-structures.",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T08:53:03Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n \n namespace miniscript {\n+\n+bool IsTapscript(MiniscriptContext ms_ctx)\n+{\n+    switch (ms_ctx) {\n+        case MiniscriptContext::P2WSH: return false;\n+        case MiniscriptContext::TAPSCRIPT: return true;\n+    }\n+    assert(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183410413",
      "id" : 1183410413,
      "in_reply_to_id" : 1160606636,
      "line" : 21,
      "node_id" : "PRRC_kwDOABII585GiWjt",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 21,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 11,
      "pull_request_review_id" : 1410444252,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183410413/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T08:53:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183410413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183419232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183419232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For this and the other assertions of the context: if we get in such an inconsistent state as having a `multi_a` in a `wsh()` descriptor or a `multi` in a `tr()` descriptor, it's probably better to crash than to return inconsistent (and potentially harmful, like an unspendable address) data to the user. Though it could raise an exception instead of crashing the node. I'll see if i can use `CHECK_NONFATAL` instead.\r\n\r\nEDIT: used `CHECK_NONFATAL` instead here and for `MULTI_A` too.",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T09:00:48Z",
      "diff_hunk" : "@@ -605,6 +608,7 @@ struct Node {\n                 case Fragment::OR_I: return BuildScript(OP_IF, subs[0], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::ANDOR: return BuildScript(std::move(subs[0]), OP_NOTIF, subs[2], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::MULTI: {\n+                    assert(!IsTapscript(ctx.MsContext()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183419232",
      "id" : 1183419232,
      "in_reply_to_id" : 1160606743,
      "line" : 656,
      "node_id" : "PRRC_kwDOABII585GiYtg",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 611,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 167,
      "pull_request_review_id" : 1410457197,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183419232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T09:22:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183419232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183444783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183444783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes generally it would be nice to have better error reporting for descriptors. And i think there are lower hanging fruits when it comes to unclear descriptor errors that confuse users, for instance https://bitcoin.stackexchange.com/q/118022/101498.\r\n\r\nBut yeah definitely not going to bring that into this PR. :)",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T09:24:05Z",
      "diff_hunk" : "@@ -1534,6 +1539,7 @@ inline NodeRef<Key> Parse(Span<const char> in, const Ctx& ctx)\n                 in = in.subspan(arg_size + 1);\n                 script_size += 1 + (num > 16) + (num > 0x7f) + (num > 0x7fff) + (num > 0x7fffff);\n             } else if (Const(\"multi(\", in)) {\n+                if (IsTapscript(ctx.MsContext())) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183444783",
      "id" : 1183444783,
      "in_reply_to_id" : 1160608237,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Gie8v",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 1542,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1410501997,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183444783/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T09:24:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183444783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183446113"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183446113"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T09:25:25Z",
      "diff_hunk" : "@@ -11,6 +11,16 @@\n #include <assert.h>\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183446113",
      "id" : 1183446113,
      "in_reply_to_id" : 1160609483,
      "line" : 12,
      "node_id" : "PRRC_kwDOABII585GifRh",
      "original_commit_id" : "1360b541ae509f2df5ec319be63b083860bed603",
      "original_line" : 12,
      "original_position" : 2,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 2,
      "pull_request_review_id" : 1410504054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183446113/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T09:25:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183446113",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183487461"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183487461"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, good suggestion that i add those for clarity because your suggestion is incorrect: `add_diff` should always be added. The current (and intended) semantic is:\r\n```diff\r\ndiff --git a/src/script/miniscript.h b/src/script/miniscript.h\r\nindex 011c7ac6d6..35797153da 100644\r\n--- a/src/script/miniscript.h\r\n+++ b/src/script/miniscript.h\r\n@@ -1002,7 +1002,7 @@ private:\r\n                         // this one?\r\n                         next_sats_size.push_back((sats_size[j] + subs[i]->ss.dsat.size) | (sats_size[j - 1] + subs[i]->ss.sat.size));\r\n                         // Same for size of the stack after satisfying k of the past i fragments.\r\n-                        next_sats_diff.push_back((sats_diff[j] + sub_diff.dsat) | (sats_diff[j - 1] + sub_diff.sat) + add_diff);\r\n+                        next_sats_diff.push_back(((sats_diff[j] + sub_diff.dsat) | (sats_diff[j - 1] + sub_diff.sat)) + add_diff);\r\n                         // Update the maximum stack size for satisfying k subs with the largest of the maximum cost of\r\n                         // satisfying k-1 subs (implying we satisfy this one), the cost of dissatisfying this sub\r\n                         // after the satisfaction of j subs beforehand, and the cost of satisfying this sub after the\r\n```\r\n\r\nDid you get this warning with GCC?",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T10:05:50Z",
      "diff_hunk" : "@@ -833,51 +858,152 @@ struct Node {\n     }\n \n     internal::StackSize CalcStackSize() const {\n+        // Among non-malleable satisfactions and dissatisfactions, this computes for each fragment:\n+        // - The maximum witness stack size of this (dis)satisfaction;\n+        // - The maximum number of elements added or removed on the stack after executing it;\n+        // - The maximum number of elements added to the stack while executing it.\n         switch (fragment) {\n-            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_0: return {{}, {0, 1}};\n             case Fragment::JUST_1:\n             case Fragment::OLDER:\n-            case Fragment::AFTER: return {0, {}};\n-            case Fragment::PK_K: return {1, 1};\n-            case Fragment::PK_H: return {2, 2};\n+            case Fragment::AFTER: return {{0, 1}, {}};\n+            case Fragment::PK_K: return {{1, 1}, {1, 1}};\n+            case Fragment::PK_H: return {{2, 0, 2}, {2, 0, 2}};\n             case Fragment::SHA256:\n             case Fragment::RIPEMD160:\n             case Fragment::HASH256:\n-            case Fragment::HASH160: return {1, {}};\n+            case Fragment::HASH160: return {{1, 0, 2}, {}};\n             case Fragment::ANDOR: {\n-                const auto sat{(subs[0]->ss.sat + subs[1]->ss.sat) | (subs[0]->ss.dsat + subs[2]->ss.sat)};\n-                const auto dsat{subs[0]->ss.dsat + subs[2]->ss.dsat};\n-                return {sat, dsat};\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto& z{subs[2]->ss};\n+                const auto sat_size{(x.sat.size + y.sat.size) | (x.dsat.size + z.sat.size)};\n+                const auto dsat_size{x.dsat.size + z.dsat.size};\n+                const auto sat_diff{((x.sat.diff + y.sat.diff) | (x.dsat.diff + z.sat.diff)) - 1};\n+                const auto dsat_diff{x.dsat.diff - 1 + z.dsat.diff};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.sat.diff - 1 + y.sat.exec) | (x.dsat.diff - 1 + z.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff - 1 + z.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::AND_V: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size + y.sat.size};\n+                const auto sat_diff{x.sat.diff + y.sat.diff};\n+                const auto sat_exec{x.sat.exec | (x.sat.diff + y.sat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {}};\n+            }\n+            case Fragment::AND_B: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size + y.sat.size};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{x.sat.diff + y.sat.diff - 1};\n+                const auto dsat_diff{x.dsat.diff + y.dsat.diff - 1};\n+                const auto sat_exec{x.sat.exec | (x.sat.diff + y.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n             }\n-            case Fragment::AND_V: return {subs[0]->ss.sat + subs[1]->ss.sat, {}};\n-            case Fragment::AND_B: return {subs[0]->ss.sat + subs[1]->ss.sat, subs[0]->ss.dsat + subs[1]->ss.dsat};\n             case Fragment::OR_B: {\n-                const auto sat{(subs[0]->ss.dsat + subs[1]->ss.sat) | (subs[0]->ss.sat + subs[1]->ss.dsat)};\n-                const auto dsat{subs[0]->ss.dsat + subs[1]->ss.dsat};\n-                return {sat, dsat};\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{(x.dsat.size + y.sat.size) | (x.sat.size + y.dsat.size)};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{((x.dsat.diff + y.sat.diff) | (x.sat.diff + y.dsat.diff)) - 1};\n+                const auto dsat_diff{x.dsat.diff + y.dsat.diff - 1};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.dsat.diff + y.sat.exec) | (x.sat.diff + y.dsat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::OR_C: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size | (x.dsat.size + y.sat.size)};\n+                const auto sat_diff{(x.sat.diff | (x.dsat.diff + y.sat.diff)) - 1};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.dsat.diff - 1 + y.sat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {}};\n+            }\n+            case Fragment::OR_D: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{x.sat.size | (x.dsat.size + y.sat.size)};\n+                const auto dsat_size{x.dsat.size + y.dsat.size};\n+                const auto sat_diff{x.sat.diff | (x.dsat.diff - 1 + y.sat.diff)};\n+                const auto dsat_diff{x.dsat.diff - 1 + y.dsat.diff};\n+                const auto sat_exec{x.sat.exec | x.dsat.exec | (x.sat.diff + 1) | (x.dsat.diff + y.sat.exec)};\n+                const auto dsat_exec{x.dsat.exec | (x.dsat.diff - 1 + y.dsat.exec)};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n+            }\n+            case Fragment::OR_I: {\n+                const auto& x{subs[0]->ss};\n+                const auto& y{subs[1]->ss};\n+                const auto sat_size{(x.sat.size + 1) | (y.sat.size + 1)};\n+                const auto dsat_size{(x.dsat.size + 1) | (y.dsat.size + 1)};\n+                const auto sat_diff{(x.sat.diff | y.sat.diff) - 1};\n+                const auto dsat_diff{(x.dsat.diff | y.dsat.diff) - 1};\n+                const auto sat_exec{(x.sat.exec | y.sat.exec) - 1};\n+                const auto dsat_exec{(x.dsat.exec | y.dsat.exec) - 1};\n+                return {{sat_size, sat_diff, sat_exec}, {dsat_size, dsat_diff, dsat_exec}};\n             }\n-            case Fragment::OR_C: return {subs[0]->ss.sat | (subs[0]->ss.dsat + subs[1]->ss.sat), {}};\n-            case Fragment::OR_D: return {subs[0]->ss.sat | (subs[0]->ss.dsat + subs[1]->ss.sat), subs[0]->ss.dsat + subs[1]->ss.dsat};\n-            case Fragment::OR_I: return {(subs[0]->ss.sat + 1) | (subs[1]->ss.sat + 1), (subs[0]->ss.dsat + 1) | (subs[1]->ss.dsat + 1)};\n-            case Fragment::MULTI: return {k + 1, k + 1};\n-            case Fragment::MULTI_A: return {keys.size(), keys.size()};\n+            case Fragment::MULTI: return {{(uint32_t)k + 1, -(int32_t)k, 2 + (int32_t)keys.size()}, {(uint32_t)k + 1, -(int32_t)k, 2 + (int32_t)keys.size()}};\n+            case Fragment::MULTI_A: return {{(uint32_t)keys.size(), -(int32_t)keys.size() + 1, 1}, {(uint32_t)keys.size(), -(int32_t)keys.size() + 1, 1}};\n             case Fragment::WRAP_A:\n             case Fragment::WRAP_N:\n-            case Fragment::WRAP_S:\n-            case Fragment::WRAP_C: return subs[0]->ss;\n-            case Fragment::WRAP_D: return {1 + subs[0]->ss.sat, 1};\n-            case Fragment::WRAP_V: return {subs[0]->ss.sat, {}};\n-            case Fragment::WRAP_J: return {subs[0]->ss.sat, 1};\n+            case Fragment::WRAP_S: return subs[0]->ss;\n+            case Fragment::WRAP_C: {\n+                const auto& sub_sat{subs[0]->ss.sat};\n+                const auto& sub_dsat{subs[0]->ss.dsat};\n+                return {{sub_sat.size, sub_sat.diff - 1, sub_sat.exec}, {sub_dsat.size, sub_dsat.diff - 1, sub_dsat.exec}};\n+            }\n+            case Fragment::WRAP_D: return {{1 + subs[0]->ss.sat.size, subs[0]->ss.sat.diff, subs[0]->ss.sat.exec | 1}, {1, 0, 1}};\n+            case Fragment::WRAP_V: return {{subs[0]->ss.sat.size, subs[0]->ss.sat.diff - 1, subs[0]->ss.sat.exec}, {}};\n+            case Fragment::WRAP_J: return {{subs[0]->ss.sat.size, subs[0]->ss.sat.diff, subs[0]->ss.sat.exec | 1}, {1, 0, subs[0]->ss.dsat.exec | 1}};\n             case Fragment::THRESH: {\n-                auto sats = Vector(internal::MaxInt<uint32_t>(0));\n-                for (const auto& sub : subs) {\n-                    auto next_sats = Vector(sats[0] + sub->ss.dsat);\n-                    for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + sub->ss.dsat) | (sats[j - 1] + sub->ss.sat));\n-                    next_sats.push_back(sats[sats.size() - 1] + sub->ss.sat);\n-                    sats = std::move(next_sats);\n+                // The maximum satisfaction witness stack size for this fragment, indexed by threshold.\n+                auto sats_size = Vector(internal::MaxInt<uint32_t>(0));\n+                // Same for the stack size differential after executing this fragment.\n+                auto sats_diff = Vector(internal::MaxInt<int32_t>(0));\n+                // The maximum stack size at any point during execution of this fragment (or any sub\n+                // fragment thereoff), indexed by threshold.\n+                auto sats_exec = Vector(internal::MaxInt<int32_t>(0));\n+                for (size_t i = 0; i < subs.size(); ++i) {\n+                    // Start with the (non-malleable) dissatisfaction size.\n+                    auto next_sats_size = Vector(sats_size[0] + subs[i]->ss.dsat.size);\n+                    // Whether to account for OP_ADD that drops one element from the stack (-2 + 1).\n+                    auto add_diff = (i > 0 && i < subs.size() - 1) ? -1 : 0;\n+                    // The total difference in stack size after dissatisfying the first i first fragments.\n+                    auto next_sats_diff = Vector(sats_diff[0] + subs[i]->ss.dsat.diff + add_diff);\n+                    // Does the stack size gets bigger when dissatifying this fragment than the previous ones?\n+                    auto next_sats_exec = Vector(sats_exec[0] | (sats_diff[0] + subs[i]->ss.dsat.exec));\n+                    // Update what combination of sat/dsat is the largest per threshold.\n+                    for (size_t j = 1; j < sats_size.size(); ++j) {\n+                        // Which is larger, k-1 satisfaction and satifying this sub, or k satisfaction and dissatisfying\n+                        // this one?\n+                        next_sats_size.push_back((sats_size[j] + subs[i]->ss.dsat.size) | (sats_size[j - 1] + subs[i]->ss.sat.size));\n+                        // Same for size of the stack after satisfying k of the past i fragments.\n+                        next_sats_diff.push_back((sats_diff[j] + subs[i]->ss.dsat.diff) | (sats_diff[j - 1] + subs[i]->ss.sat.diff) + add_diff);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183487461",
      "id" : 1183487461,
      "in_reply_to_id" : 1160615879,
      "line" : 997,
      "node_id" : "PRRC_kwDOABII585GipXl",
      "original_commit_id" : "efdd1543597aff49c56a1abaa75b574be3b330db",
      "original_line" : 984,
      "original_position" : 212,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 373,
      "pull_request_review_id" : 1410572054,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183487461/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T10:05:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183487461",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183502224"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183502224"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm trying to reproduce the warning. What version of which compiler do you use? And what flags have you enabled?",
      "commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "created_at" : "2023-05-03T10:21:47Z",
      "diff_hunk" : "@@ -1828,65 +2081,66 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n             // Constants\n             if (in[0].first == OP_1) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_1));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_1));\n                 break;\n             }\n             if (in[0].first == OP_0) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_0));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_0));\n                 break;\n             }\n             // Public keys\n-            if (in[0].second.size() == 33) {\n+            if (in[0].second.size() == 33 || in[0].second.size() == 32) {\n                 auto key = ctx.FromPKBytes(in[0].second.begin(), in[0].second.end());\n                 if (!key) return {};\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::PK_K, Vector(std::move(*key))));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::PK_K, Vector(std::move(*key))));\n                 break;\n             }\n             if (last - in >= 5 && in[0].first == OP_VERIFY && in[1].first == OP_EQUAL && in[3].first == OP_HASH160 && in[4].first == OP_DUP && in[2].second.size() == 20) {\n                 auto key = ctx.FromPKHBytes(in[2].second.begin(), in[2].second.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1183502224",
      "id" : 1183502224,
      "in_reply_to_id" : 1160622303,
      "line" : 2101,
      "node_id" : "PRRC_kwDOABII585Gis-Q",
      "original_commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "original_line" : 2101,
      "original_position" : 932,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 932,
      "pull_request_review_id" : 1410595992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183502224/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-03T10:21:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1183502224",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1195519598"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195519598"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reproduced and fixed!",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-05-16T18:02:15Z",
      "diff_hunk" : "@@ -1828,65 +2081,66 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n             // Constants\n             if (in[0].first == OP_1) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_1));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_1));\n                 break;\n             }\n             if (in[0].first == OP_0) {\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::JUST_0));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::JUST_0));\n                 break;\n             }\n             // Public keys\n-            if (in[0].second.size() == 33) {\n+            if (in[0].second.size() == 33 || in[0].second.size() == 32) {\n                 auto key = ctx.FromPKBytes(in[0].second.begin(), in[0].second.end());\n                 if (!key) return {};\n                 ++in;\n-                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, Fragment::PK_K, Vector(std::move(*key))));\n+                constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx, Fragment::PK_K, Vector(std::move(*key))));\n                 break;\n             }\n             if (last - in >= 5 && in[0].first == OP_VERIFY && in[1].first == OP_EQUAL && in[3].first == OP_HASH160 && in[4].first == OP_DUP && in[2].second.size() == 20) {\n                 auto key = ctx.FromPKHBytes(in[2].second.begin(), in[2].second.end());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1195519598",
      "id" : 1195519598,
      "in_reply_to_id" : 1160622303,
      "line" : 2202,
      "node_id" : "PRRC_kwDOABII585HQi5u",
      "original_commit_id" : "6e3b37b80cebf9c3f3370f5efbd38f776a918d9c",
      "original_line" : 2202,
      "original_position" : 932,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 965,
      "pull_request_review_id" : 1429125748,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195519598/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-05-16T18:02:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1195519598",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and updated.\r\n- I addressed @josibake's comments. (thanks for the review!)\r\n- I fixed the `multi_a` satisfaction to use an algorithm similar to `multi`'s.\r\n- Modified the maximum script size to account for some breathing room for the spending transaction size.\r\n- Made the execution size accounting easier by not tracking the size of the stack after execution of a fragment, instead assuming the maximum amount of stack elements the fragment can consume were consumed. The number of items pushed is an invariant on the type (1 for `B` `K` and `W`, 0 for `V`). See the code comments for more details.",
      "created_at" : "2023-05-16T18:25:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1550158814",
      "id" : 1550158814,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585cZYve",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550158814/reactions"
      },
      "updated_at" : "2023-05-16T18:25:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1550158814",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks @scgbckbone, good catch.\r\n\r\nWhen populating `SignatureData` from a PSBT input, i (ab)used the `misc_pubkeys` member to find pubkey hash preimages also when signing for Tapscript. As a consequence, Tapscript public keys would be serialized back into the PSBT input as `PSBT_IN_BIP32_DERIVATION`.\r\n\r\nThis is unnecessary. Instead i pushed a modification that simply adds a new field to `SignatureData` so we have a separate mapping for Tapscript keys in the signing logic that is not serialized back into the PSBT input.\r\n\r\n<details>\r\n\r\n<summary>Expand to see the diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/psbt.cpp b/src/psbt.cpp\r\nindex a06f89cb3d..7d50402324 100644\r\n--- a/src/psbt.cpp\r\n+++ b/src/psbt.cpp\r\n@@ -131,7 +131,7 @@ void PSBTInput::FillSignatureData(SignatureData& sigdata) const\r\n     }\r\n     for (const auto& [pubkey, leaf_origin] : m_tap_bip32_paths) {\r\n         sigdata.taproot_misc_pubkeys.emplace(pubkey, leaf_origin);\r\n-        sigdata.misc_pubkeys.emplace(Hash160(pubkey), std::make_pair(pubkey.GetCPubKey(), leaf_origin.second));\r\n+        sigdata.tap_pubkeys.emplace(Hash160(pubkey), pubkey);\r\n     }\r\n     for (const auto& [hash, preimage] : ripemd160_preimages) {\r\n         sigdata.ripemd160_preimages.emplace(std::vector<unsigned char>(hash.begin(), hash.end()), preimage);\r\n@@ -246,7 +246,7 @@ void PSBTOutput::FillSignatureData(SignatureData& sigdata) const\r\n     }\r\n     for (const auto& [pubkey, leaf_origin] : m_tap_bip32_paths) {\r\n         sigdata.taproot_misc_pubkeys.emplace(pubkey, leaf_origin);\r\n-        sigdata.misc_pubkeys.emplace(Hash160(pubkey), std::make_pair(pubkey.GetCPubKey(), leaf_origin.second));\r\n+        sigdata.tap_pubkeys.emplace(Hash160(pubkey), pubkey);\r\n     }\r\n }\r\n \r\ndiff --git a/src/script/sign.cpp b/src/script/sign.cpp\r\nindex 515a296d60..b4af979f85 100644\r\n--- a/src/script/sign.cpp\r\n+++ b/src/script/sign.cpp\r\n@@ -113,12 +113,17 @@ static bool GetPubKey(const SigningProvider& provider, const SignatureData& sigd\r\n         pubkey = it->second.first;\r\n         return true;\r\n     }\r\n-    // Look for pubkey in pubkey list\r\n+    // Look for pubkey in pubkey lists\r\n     const auto& pk_it = sigdata.misc_pubkeys.find(address);\r\n     if (pk_it != sigdata.misc_pubkeys.end()) {\r\n         pubkey = pk_it->second.first;\r\n         return true;\r\n     }\r\n+    const auto& tap_pk_it = sigdata.tap_pubkeys.find(address);\r\n+    if (tap_pk_it != sigdata.tap_pubkeys.end()) {\r\n+        pubkey = tap_pk_it->second.GetCPubKey();\r\n+        return true;\r\n+    }\r\n     // Query the underlying provider\r\n     return provider.GetPubKey(address, pubkey);\r\n }\r\ndiff --git a/src/script/sign.h b/src/script/sign.h\r\nindex f46bc55992..1cd82a7764 100644\r\n--- a/src/script/sign.h\r\n+++ b/src/script/sign.h\r\n@@ -79,6 +79,7 @@ struct SignatureData {\r\n     std::vector<unsigned char> taproot_key_path_sig; /// Schnorr signature for key path spending\r\n     std::map<std::pair<XOnlyPubKey, uint256>, std::vector<unsigned char>> taproot_script_sigs; ///< (Partial) schnorr signatures, indexed by XOnlyPubKey and leaf_hash.\r\n     std::map<XOnlyPubKey, std::pair<std::set<uint256>, KeyOriginInfo>> taproot_misc_pubkeys; ///< Miscellaneous Taproot pubkeys involved in this input along with their leaf script hashes and key origin data. Also includes the Taproot internal key (may have no leaf script hashes).\r\n+    std::map<CKeyID, XOnlyPubKey> tap_pubkeys; ///< Misc Taproot pubkeys involved in this input, by hash. (Equivalent of misc_pubkeys but for Taproot.)\r\n     std::vector<CKeyID> missing_pubkeys; ///< KeyIDs of pubkeys which could not be found\r\n     std::vector<CKeyID> missing_sigs; ///< KeyIDs of pubkeys for signatures which could not be found\r\n     uint160 missing_redeem_script; ///< ScriptID of the missing redeemScript (if any)\r\n```\r\n\r\n</details>\r\n\r\nAlso took the opportunity to rebase on master.",
      "created_at" : "2023-06-20T11:01:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1598564442",
      "id" : 1598564442,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585fSCha",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598564442/reactions"
      },
      "updated_at" : "2023-06-20T11:01:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1598564442",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-04T03:06:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1619401778",
      "id" : 1619401778,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585ghhwy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619401778/reactions"
      },
      "updated_at" : "2023-07-04T03:06:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1619401778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1257381343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257381343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`clang-tidy --checks=bugprone-argument-comment` catches if the names in such comments mismatch the formal parameter names of the called function, but (I just tested) it works both with and without the spaces.",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-07-08T22:28:29Z",
      "diff_hunk" : "@@ -1502,7 +1524,7 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n     }\n     // Process miniscript expressions.\n     {\n-        KeyParser parser(&out, nullptr);\n+        KeyParser parser(/*out = */&out, /* in = */nullptr, /* ctx = */miniscript::MiniscriptContext::P2WSH);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1257381343",
      "id" : 1257381343,
      "in_reply_to_id" : 1160599451,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585K8h3f",
      "original_commit_id" : "ef0eb7f87d19bd8a3ebff4f095d321964808df73",
      "original_line" : 1527,
      "original_position" : 100,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1520821386,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 1,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257381343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-07-08T22:28:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257381343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1257383444"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257383444"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Is it possible to instead (or in addition) add an assertion in `ComputeType` that `multi()` is not used in `TAPSCRIPT` context?",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-07-08T22:56:07Z",
      "diff_hunk" : "@@ -605,6 +609,7 @@ struct Node {\n                 case Fragment::OR_I: return BuildScript(OP_IF, subs[0], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::ANDOR: return BuildScript(std::move(subs[0]), OP_NOTIF, subs[2], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::MULTI: {\n+                    CHECK_NONFATAL(!IsTapscript(ctx.MsContext()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1257383444",
      "id" : 1257383444,
      "line" : 667,
      "node_id" : "PRRC_kwDOABII585K8iYU",
      "original_commit_id" : "6e450bd77f82abe910906b437b54df01adc10b62",
      "original_line" : 667,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 169,
      "pull_request_review_id" : 1520822745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257383444/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:40:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1257383444",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased (and corrected a comment in the fuzz test witness padding commit).",
      "created_at" : "2023-07-20T15:28:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1644136991",
      "id" : 1644136991,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585h_4of",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1644136991/reactions"
      },
      "updated_at" : "2023-07-20T15:28:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1644136991",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Added a missing check in the fuzz target since `GetExecStackSize()` now returns an optional.",
      "created_at" : "2023-07-21T21:48:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1646270585",
      "id" : 1646270585,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585iIBh5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1646270585/reactions"
      },
      "updated_at" : "2023-07-21T21:48:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1646270585",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Needs rebase if still relevant",
      "created_at" : "2023-08-29T06:55:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1696873989",
      "id" : 1696873989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585lJD4F",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1696873989/reactions"
      },
      "updated_at" : "2023-08-29T06:55:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1696873989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. Thanks Marco for the ping.",
      "created_at" : "2023-08-30T15:30:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1699400416",
      "id" : 1699400416,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585lSsrg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 1,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699400416/reactions"
      },
      "updated_at" : "2023-08-30T15:30:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699400416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Scratched around a bit more on this but will go deeper. Built fine and tests passed on MacOS Ventura.\r\n\r\n- There are more multisig related tests not touched by this PR that seem to need a Tapscript/`multi_a `equivalent added (e.g. wallet_multisig_descriptor_psbt.py). The `multi_a` descriptor leaks into a lot of the multisig code, tests and documentation. It might be best to leave that for other PRs (and possibly other authors) but some sort of issue/plan for what needs to be done post this PR would be nice.\r\n- sipa's [site](https://bitcoin.sipa.be/miniscript/) that I personally use as the go-to resource (or spec) on Miniscript has some documentation on Tapscript but the Miniscript analyzer doesn't take Tapscript Miniscripts (or at least it doesn't analyze `multi_a` descriptors). That is a handy tool for reviewers, testers, implementers.\r\n\r\nedit: I forgot support for the `multi_a` **descriptor** i.e. `tr(KEY, multi_a)` has already been merged in #24043, this PR is adding support for the `multi_a` **Miniscript fragment**,e.g. a Miniscript that contains a `multi_a` within it e.g. `tr(KEY, Miniscript that includes a multi_a)` or `tr(KEY,{S1, Miniscript that includes a multi_a})` Also, `sortedmulti_a` is only a descriptor and not a Miniscript fragment and so not included in this PR.",
      "created_at" : "2023-08-31T09:13:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1700663702",
      "id" : 1700663702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585lXhGW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700663702/reactions"
      },
      "updated_at" : "2023-09-01T10:26:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1700663702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/16323900?v=4",
         "events_url" : "https://api.github.com/users/michaelfolkson/events{/privacy}",
         "followers_url" : "https://api.github.com/users/michaelfolkson/followers",
         "following_url" : "https://api.github.com/users/michaelfolkson/following{/other_user}",
         "gists_url" : "https://api.github.com/users/michaelfolkson/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/michaelfolkson",
         "id" : 16323900,
         "login" : "michaelfolkson",
         "node_id" : "MDQ6VXNlcjE2MzIzOTAw",
         "organizations_url" : "https://api.github.com/users/michaelfolkson/orgs",
         "received_events_url" : "https://api.github.com/users/michaelfolkson/received_events",
         "repos_url" : "https://api.github.com/users/michaelfolkson/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/michaelfolkson/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/michaelfolkson/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/michaelfolkson"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased post #26567. This allows to get rid of one commit here that is now part of master :tada:. Also fixed a bug in commit 8288091031b481d59cc2b5894fa790a70654496a (\"miniscript: don't anticipate signature presence in `CalcStackSize()`\") where i overlooked how the patch applied to more than one `case:` within the `switch` statement.\r\n\r\n@michaelfolkson thanks for having a look here.\r\nRegarding the `multi_a` tests: half of this PR is already tests, exercising the code introduced here under a large number of different scenarii. I'll leave it to others to try to find blind posts in the pre-existing tests for Tapscript multisigs compared to former multisigs.\r\nRegarding Pieter's website, i plan to PR MiniTapscript support to [`sipa/miniscript`](https://github.com/sipa/miniscript/) once it's merged here. So i don't expect it to be available on the website before then. It should be trivial to achieve the same using the Miniscript unit tests here though.",
      "created_at" : "2023-09-07T10:36:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1709917245",
      "id" : 1709917245,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585l60Q9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1709917245/reactions"
      },
      "updated_at" : "2023-09-07T10:36:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1709917245",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "tACK\r\n\r\nThis is also tested in the integration tests for Ledger's implementation (open PR: https://github.com/LedgerHQ/app-bitcoin-new/pull/155). Note that there are some syntactic differences as Ledger's implementation is based on [Wallet Policies](https://github.com/bitcoin/bips/pull/1389) rather than bare descriptors.\r\n\r\ne2e tests signing with both bitcoin-core and the Ledger app are still quite minimal â but no issues found so far: could sign with core for both a purely miniscript taptree, and a mix of miniscript and non-miniscript leaves.\r\n\r\nAlso implemented unit tests for miniscript sanity checks (tests taken from this PR).",
      "created_at" : "2023-09-20T12:59:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1727679423",
      "id" : 1727679423,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585m-ku_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727679423/reactions"
      },
      "updated_at" : "2023-09-20T13:10:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727679423",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "If anyone is interested in testing things end-2-end with a Ledger device, the \"Bitcoin Test\" app with taproot-miniscript is available as version 2.2.0-alpha, after enabling \"Experimental features\" â¹ \"Developer tools\" in Ledger Live's settings.\r\n\r\n(As it's not yet integrated with HWI, testing the app will require using either the python, JS, or Rust client libraries for the Ledger bitcoin app)",
      "created_at" : "2023-09-20T13:01:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1727683807",
      "id" : 1727683807,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585m-lzf",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727683807/reactions"
      },
      "updated_at" : "2023-09-20T13:01:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1727683807",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331716441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331716441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I don't care particularly strongly about what this limit is set to, because practically guaranteeing spendability is hard. However, if the goal is guaranteeing just \"can this script be spent with at all\", then I think the overhead should be exactly that of a 1-input 1-output 1-tapscript transaction.",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-09-20T14:22:24Z",
      "diff_hunk" : "@@ -22,6 +22,21 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! 200vbytes for the spending transaction data other than the witness\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{800};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331716441",
      "id" : 1331716441,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII585PYGFZ",
      "original_commit_id" : "434bdbe030f0fcfe89912de5f92c70244df8d07f",
      "original_line" : 26,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 17,
      "pull_request_review_id" : 1520822745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331716441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:40:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331716441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331719498"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331719498"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Can we give this a more explicit name like `GetEvenCorrespondingCPubKey` or so?",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-09-20T14:24:29Z",
      "diff_hunk" : "@@ -204,6 +204,13 @@ std::vector<CKeyID> XOnlyPubKey::GetKeyIDs() const\n     return out;\n }\n \n+CPubKey XOnlyPubKey::GetCPubKey() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331719498",
      "id" : 1331719498,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585PYG1K",
      "original_commit_id" : "d46788c1a31fc170dbe08d28db8266ce03f3d9e1",
      "original_line" : 207,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/pubkey.cpp",
      "position" : 4,
      "pull_request_review_id" : 1520822745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331719498/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:40:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331719498",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331735314"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331735314"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Having this check is fine, but it shouldn't be hit for the `smart` target (we can intelligently decide there where to construct MULTI vs MULTI_A based on the context under which we're fuzzing).",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-09-20T14:35:14Z",
      "diff_hunk" : "@@ -809,11 +857,15 @@ NodeRef GenNode(F ConsumeNode, Type root_type, bool strict_valid = false) {\n             // Fragment/children have not been decided yet. Decide them.\n             auto node_info = ConsumeNode(type_needed);\n             if (!node_info) return {};\n+            if ((!miniscript::IsTapscript(SCRIPT_CTX) && node_info->fragment == Fragment::MULTI_A)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1331735314",
      "id" : 1331735314,
      "line" : 860,
      "node_id" : "PRRC_kwDOABII585PYKsS",
      "original_commit_id" : "a9b2e8f07ef22a5f6e51083d92a3a6077fc9b738",
      "original_line" : 860,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 294,
      "pull_request_review_id" : 1520822745,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331735314/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T14:40:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331735314",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1333003641"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333003641"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Had a quick look into this. I could adapt `SmartInfo` to hold two tables or something similar. But that'd greatly increase the size of the diff for what i feel would not be greatly beneficial? The fuzzer would adapt pretty soon to not generate MULTIs under Tapscript and the other way around?\r\n\r\nHappy to do it, just want to ponder it against the review burden.",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-09-21T12:51:40Z",
      "diff_hunk" : "@@ -809,11 +857,15 @@ NodeRef GenNode(F ConsumeNode, Type root_type, bool strict_valid = false) {\n             // Fragment/children have not been decided yet. Decide them.\n             auto node_info = ConsumeNode(type_needed);\n             if (!node_info) return {};\n+            if ((!miniscript::IsTapscript(SCRIPT_CTX) && node_info->fragment == Fragment::MULTI_A)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1333003641",
      "id" : 1333003641,
      "in_reply_to_id" : 1331735314,
      "line" : 860,
      "node_id" : "PRRC_kwDOABII585PdAV5",
      "original_commit_id" : "a9b2e8f07ef22a5f6e51083d92a3a6077fc9b738",
      "original_line" : 860,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 294,
      "pull_request_review_id" : 1637745134,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333003641/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T12:51:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333003641",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1333273430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333273430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Figured it'd be harder to review to have a precise calculation, but happy to change that.",
      "commit_id" : "75656d04582248306e7cd9fcb3d02faaa283e7b5",
      "created_at" : "2023-09-21T15:41:08Z",
      "diff_hunk" : "@@ -22,6 +22,21 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! 200vbytes for the spending transaction data other than the witness\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{800};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1333273430",
      "id" : 1333273430,
      "in_reply_to_id" : 1331716441,
      "line" : 26,
      "node_id" : "PRRC_kwDOABII585PeCNW",
      "original_commit_id" : "434bdbe030f0fcfe89912de5f92c70244df8d07f",
      "original_line" : 26,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 17,
      "pull_request_review_id" : 1638183579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333273430/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-21T15:41:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1333273430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've reworked this a bit to hopefully make it easier to review (and also nicer). Here is a list of the changes i've made:\r\n- Addressed @sipa's comments:\r\n  - Added a couple assertions in `ComputeType` for context-specific fragments.\r\n  - Made the \"minimum viable transaction\" size calculation explicit instead of a magic \"800 WU\" value. This introduced some constant values, which i've tried to document extensively.\r\n  - The `GetCPubKey` method introduced to `CPubKey` was renamed to `GetEvenCorrespondingCPubKey` to make its name explicit. I've removed the now-redundant doc-comment.\r\n  - In the fuzz targets, `ConsumeNodeSmart` now always returns only valid recipes for each context. `ConsumeNodeStable` was also modified to return early on a fragment invalid for a context. The check to ignore those in the caller `GenNode` was removed to assert we always return a recipe from `ConsumeNodeSmart` and that it's valid (it would make the fuzzer crash otherwise).\r\n- Changed the API to only ask for a `MiniscriptContext` (either Tapscript or P2WSH) instead of a whole (`Ctx`Â template) context object wherever we only needed the script context. This makes the API nicer as we often know the script context when calling for instance `IsValid()` on a node, without necessarily having a parsing/satisfying context at hand. For instance, this helped not overusing globals in the fuzzer. (Not that i'm trying to optimize for the tests, but i think it was an indication that the API could be improved.)\r\n- In the fuzz targets, the `MiniscriptContext` is now directly passed to `GenNode`, `TestNode`, etc.. instead of relying on it being set indirectly through the global parsing/satisfying contexts.\r\n- All the introduction of Tapscript in the fuzzing targets was moved to the appropriate commit. Previously part of it was in the commit introducing the `multi_a` fragment, which made the changes to the fuzzer a bit harder to follow.\r\n- To make sure the change in the max script size calculation mentioned above didn't introduce a bug, i've added a functional test that sanity checks we can spend a maximum-sized TapMiniscript (last commit).\r\n- Found an occurrence we had missed in #27117. Added a commit for this (the first one).\r\n- In addition to compiling and passing the unit tests, all commits now pass the `miniscript_smart` fuzzer (on my own corpus which contains Tapscript seeds).",
      "created_at" : "2023-09-26T15:46:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1735816030",
      "id" : 1735816030,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585ndnNe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735816030/reactions"
      },
      "updated_at" : "2023-09-26T15:46:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1735816030",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337828935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337828935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 80606412f087eef74dedea008dc84a5efb715a49 \"miniscript: check maximum stack size during execution\"\r\n\r\nIs this size as in bytes or size as in number of items on the stack?",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-26T22:07:20Z",
      "diff_hunk" : "@@ -344,13 +349,32 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Maximum witness size to (dis)satisfy;\n+    MaxInt<uint32_t> size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337828935",
      "id" : 1337828935,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII585PvaZH",
      "original_commit_id" : "80606412f087eef74dedea008dc84a5efb715a49",
      "original_line" : 354,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 77,
      "pull_request_review_id" : 1645273510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337828935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T22:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337828935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337833665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337833665"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 80606412f087eef74dedea008dc84a5efb715a49 \"miniscript: check maximum stack size during execution\"\r\n\r\nI'm slightly confused by these return values. There will always be something on the stack for both satisfy and dissatisfy, and the fragment itself will push a key, so shouldn't this be `{1, 2}`?",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-26T22:11:30Z",
      "diff_hunk" : "@@ -844,52 +868,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the\n+        // maximum initial stack size. Any increase in the execution stack size (by using a path that removes less items\n+        // than we estimate here) necessarily involves an equal decrease in the initial stack size.\n+        const auto neg_stack_size = [&](bool dsat) -> internal::MaxInt<int32_t> {\n+            if (!dsat && ss.sat.size.valid) return -static_cast<int32_t>(ss.sat.size.value);\n+            if (dsat && ss.dsat.size.valid) return -static_cast<int32_t>(ss.dsat.size.value);\n+            return {};\n+        };\n+        return {added_items + neg_stack_size(/* dsat = */false), added_items + neg_stack_size(/* dsat = */true)};\n+    }\n+\n     internal::StackSize CalcStackSize() const {\n+        // Among non-malleable satisfactions and dissatisfactions, this computes for each fragment:\n+        // - The maximum witness stack size of this (dis)satisfaction;\n+        // - The maximum number of elements added to the stack during its execution. Note this computation is\n+        // based on the net difference in stack size after executing fragments preceding it. This net difference\n+        // is computed based on the maximum witness stack size of previous fragments' (dis)satisfactions.\n         switch (fragment) {\n-            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_0: return {{}, {0, 1}};\n             case Fragment::JUST_1:\n             case Fragment::OLDER:\n-            case Fragment::AFTER: return {0, {}};\n-            case Fragment::PK_K: return {0, 0};\n-            case Fragment::PK_H: return {1, 1};\n+            case Fragment::AFTER: return {{0, 1}, {}};\n+            case Fragment::PK_K: return {{0, 1}, {0, 1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337833665",
      "id" : 1337833665,
      "line" : 911,
      "node_id" : "PRRC_kwDOABII585PvbjB",
      "original_commit_id" : "80606412f087eef74dedea008dc84a5efb715a49",
      "original_line" : 898,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 255,
      "pull_request_review_id" : 1645273510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337833665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T22:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337833665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337839749"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337839749"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ffdca88818f77fda06c6331df5b4bb408ab1833b \"descriptor: parse Miniscript expressions within Taproot descriptors\"\r\n\r\nI don't think this is correct. In most places, we don't lookup xonly pubkeys by their hash. We look them up by getting the hashes of both the even and odd versions of the pubkey. So this would result in pubkeys that cannot be found.\r\n\r\nIt may be necessary to add this to deal with `pkh()`s, but I think we also need to add the hashes of the even and odd too.",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-26T22:21:53Z",
      "diff_hunk" : "@@ -1189,23 +1189,30 @@ class MiniscriptDescriptor final : public DescriptorImpl\n {\n private:\n     miniscript::NodeRef<uint32_t> m_node;\n+    miniscript::MiniscriptContext script_ctx;\n \n protected:\n     std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript> scripts,\n                                      FlatSigningProvider& provider) const override\n     {\n-        for (const auto& key : keys) provider.pubkeys.emplace(key.GetID(), key);\n-        return Vector(m_node->ToScript(ScriptMaker(keys, miniscript::MiniscriptContext::P2WSH)));\n+        for (const auto& key : keys) {\n+            if (miniscript::IsTapscript(script_ctx)) {\n+                provider.pubkeys.emplace(Hash160(XOnlyPubKey{key}), key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337839749",
      "id" : 1337839749,
      "line" : 1200,
      "node_id" : "PRRC_kwDOABII585PvdCF",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1200,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 85,
      "pull_request_review_id" : 1645273510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337839749/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-26T22:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337839749",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337842439"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337842439"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In ffdca88818f77fda06c6331df5b4bb408ab1833b \"descriptor: parse Miniscript expressions within Taproot descriptors\"\r\n\r\nThis doesn't actually allow `pkh()` to be parsed by the descriptor parsing code, but I assume that's because the point is to let the miniscript parser deal with it. In that case, a comment here would be helpful.",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-26T22:26:28Z",
      "diff_hunk" : "@@ -1546,8 +1556,8 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         }\n         ++key_exp_index;\n         return std::make_unique<PKHDescriptor>(std::move(pubkey));\n-    } else if (Func(\"pkh\", expr)) {\n-        error = \"Can only have pkh at top level, in sh(), or in wsh()\";\n+    } else if (ctx != ParseScriptContext::P2TR && Func(\"pkh\", expr)) {\n+        error = \"Can only have pkh at top level, in sh(), wsh(), or in tr()\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1337842439",
      "id" : 1337842439,
      "line" : 1560,
      "node_id" : "PRRC_kwDOABII585PvdsH",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1560,
      "original_position" : 67,
      "original_start_line" : 1559,
      "path" : "src/script/descriptor.cpp",
      "position" : 200,
      "pull_request_review_id" : 1645273510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337842439/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 1559,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-26T22:39:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1337842439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338335474"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338335474"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This is the size of the witness stack (since we want to check the stack size during execution). I'll update the comment to make it more explicit. ",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-27T09:32:35Z",
      "diff_hunk" : "@@ -344,13 +349,32 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Maximum witness size to (dis)satisfy;\n+    MaxInt<uint32_t> size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338335474",
      "id" : 1338335474,
      "in_reply_to_id" : 1337828935,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII585PxWDy",
      "original_commit_id" : "80606412f087eef74dedea008dc84a5efb715a49",
      "original_line" : 354,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 77,
      "pull_request_review_id" : 1646038833,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338335474/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T09:32:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338335474",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338341216"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338341216"
         }
      },
      "author_association" : "MEMBER",
      "body" : "We don't account for what's already on the stack. We account for how many elements are *added* by this fragment (both during and after execution).\r\n\r\nThe check then consists in adding the maximum number of elements added to the stack and the maximum size of the initial witness stack: https://github.com/bitcoin/bitcoin/commit/80606412f087eef74dedea008dc84a5efb715a49#diff-a55760aaec4bce216663f5ebf65823516347356a8320d30459427149f7bbc2c5R1422-R1424.\r\n\r\nNote this is (slightly) conservative, it's possible the spending path adding the largest number of elements to the stack is not the same as the one requiring the largest initial witness stack.",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-27T09:37:15Z",
      "diff_hunk" : "@@ -844,52 +868,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the\n+        // maximum initial stack size. Any increase in the execution stack size (by using a path that removes less items\n+        // than we estimate here) necessarily involves an equal decrease in the initial stack size.\n+        const auto neg_stack_size = [&](bool dsat) -> internal::MaxInt<int32_t> {\n+            if (!dsat && ss.sat.size.valid) return -static_cast<int32_t>(ss.sat.size.value);\n+            if (dsat && ss.dsat.size.valid) return -static_cast<int32_t>(ss.dsat.size.value);\n+            return {};\n+        };\n+        return {added_items + neg_stack_size(/* dsat = */false), added_items + neg_stack_size(/* dsat = */true)};\n+    }\n+\n     internal::StackSize CalcStackSize() const {\n+        // Among non-malleable satisfactions and dissatisfactions, this computes for each fragment:\n+        // - The maximum witness stack size of this (dis)satisfaction;\n+        // - The maximum number of elements added to the stack during its execution. Note this computation is\n+        // based on the net difference in stack size after executing fragments preceding it. This net difference\n+        // is computed based on the maximum witness stack size of previous fragments' (dis)satisfactions.\n         switch (fragment) {\n-            case Fragment::JUST_0: return {{}, 0};\n+            case Fragment::JUST_0: return {{}, {0, 1}};\n             case Fragment::JUST_1:\n             case Fragment::OLDER:\n-            case Fragment::AFTER: return {0, {}};\n-            case Fragment::PK_K: return {0, 0};\n-            case Fragment::PK_H: return {1, 1};\n+            case Fragment::AFTER: return {{0, 1}, {}};\n+            case Fragment::PK_K: return {{0, 1}, {0, 1}};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338341216",
      "id" : 1338341216,
      "in_reply_to_id" : 1337833665,
      "line" : 911,
      "node_id" : "PRRC_kwDOABII585PxXdg",
      "original_commit_id" : "80606412f087eef74dedea008dc84a5efb715a49",
      "original_line" : 898,
      "original_position" : 85,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 255,
      "pull_request_review_id" : 1646047578,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338341216/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T09:37:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338341216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338368638"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338368638"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Happy to also emplace the hashes of the even and odd serializations, but if i remember correctly it seemed unnecessary to me at the time to hash the public key thrice. What's a usecase for this?\r\n\r\nAlso, since an x-only serialization is always available but it's not the case for an even or odd serialization should we always look up Taproot key by x-only serialization hash instead of having 3 different identifiers?",
      "commit_id" : "8ced2a4da508f7fd4d87c8855ed66320081e9761",
      "created_at" : "2023-09-27T09:59:09Z",
      "diff_hunk" : "@@ -1189,23 +1189,30 @@ class MiniscriptDescriptor final : public DescriptorImpl\n {\n private:\n     miniscript::NodeRef<uint32_t> m_node;\n+    miniscript::MiniscriptContext script_ctx;\n \n protected:\n     std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript> scripts,\n                                      FlatSigningProvider& provider) const override\n     {\n-        for (const auto& key : keys) provider.pubkeys.emplace(key.GetID(), key);\n-        return Vector(m_node->ToScript(ScriptMaker(keys, miniscript::MiniscriptContext::P2WSH)));\n+        for (const auto& key : keys) {\n+            if (miniscript::IsTapscript(script_ctx)) {\n+                provider.pubkeys.emplace(Hash160(XOnlyPubKey{key}), key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1338368638",
      "id" : 1338368638,
      "in_reply_to_id" : 1337839749,
      "line" : 1200,
      "node_id" : "PRRC_kwDOABII585PxeJ-",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1200,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 85,
      "pull_request_review_id" : 1646089838,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338368638/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-27T09:59:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1338368638",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341035045"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035045"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a comment to this effect.",
      "commit_id" : "f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T07:53:08Z",
      "diff_hunk" : "@@ -1546,8 +1556,8 @@ std::unique_ptr<DescriptorImpl> ParseScript(uint32_t& key_exp_index, Span<const\n         }\n         ++key_exp_index;\n         return std::make_unique<PKHDescriptor>(std::move(pubkey));\n-    } else if (Func(\"pkh\", expr)) {\n-        error = \"Can only have pkh at top level, in sh(), or in wsh()\";\n+    } else if (ctx != ParseScriptContext::P2TR && Func(\"pkh\", expr)) {\n+        error = \"Can only have pkh at top level, in sh(), wsh(), or in tr()\";",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341035045",
      "id" : 1341035045,
      "in_reply_to_id" : 1337842439,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585P7pIl",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1548,
      "original_position" : 67,
      "original_start_line" : 1559,
      "path" : "src/script/descriptor.cpp",
      "position" : null,
      "pull_request_review_id" : 1650254697,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035045/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-29T07:53:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035045",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341035144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Added a comment to clarify.",
      "commit_id" : "f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T07:53:13Z",
      "diff_hunk" : "@@ -344,13 +349,32 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Maximum witness size to (dis)satisfy;\n+    MaxInt<uint32_t> size;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341035144",
      "id" : 1341035144,
      "in_reply_to_id" : 1337828935,
      "line" : 354,
      "node_id" : "PRRC_kwDOABII585P7pKI",
      "original_commit_id" : "80606412f087eef74dedea008dc84a5efb715a49",
      "original_line" : 354,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 77,
      "pull_request_review_id" : 1650254840,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T07:53:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341035144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I've now made the script context a member of the `Node` structure. The recent change to directly pass the `MiniscriptContext` instead of the whole `Ctx`Â when appropriate already went halfway down this road. This makes more sense (why should you have to pass the script context to `IsValid()` if you already passed it when constructing the `Node`?) and reduces the diff a little bit.\r\n\r\nh/t @achow101 for the suggestion.",
      "created_at" : "2023-09-29T12:16:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1740795955",
      "id" : 1740795955,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585nwnAz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740795955/reactions"
      },
      "updated_at" : "2023-09-29T12:16:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740795955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341306431"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306431"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done. (See https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1735816030 for details.)",
      "commit_id" : "f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T12:29:25Z",
      "diff_hunk" : "@@ -22,6 +22,21 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! 200vbytes for the spending transaction data other than the witness\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{800};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341306431",
      "id" : 1341306431,
      "in_reply_to_id" : 1331716441,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585P8rY_",
      "original_commit_id" : "434bdbe030f0fcfe89912de5f92c70244df8d07f",
      "original_line" : 26,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1650683565,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306431/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T12:29:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306431",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341306693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done as a separate commit.",
      "commit_id" : "f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T12:29:44Z",
      "diff_hunk" : "@@ -605,6 +609,7 @@ struct Node {\n                 case Fragment::OR_I: return BuildScript(OP_IF, subs[0], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::ANDOR: return BuildScript(std::move(subs[0]), OP_NOTIF, subs[2], OP_ELSE, subs[1], OP_ENDIF);\n                 case Fragment::MULTI: {\n+                    CHECK_NONFATAL(!IsTapscript(ctx.MsContext()));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341306693",
      "id" : 1341306693,
      "in_reply_to_id" : 1257383444,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585P8rdF",
      "original_commit_id" : "6e450bd77f82abe910906b437b54df01adc10b62",
      "original_line" : 667,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1650684032,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T12:29:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341306693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341313430"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341313430"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I have removed this check and made the `miniscript_smart` target always generate a valid recipe.\r\n\r\nThe `SmartInfo` struct now holds two tables, one for each context. It's not ideal since there is a lot of overlap between the two sets of valid recipes, but i don't think it's worth optimizing the one-time initialization cost and small additional memory footprint at this stage. Let me know if you disagree.",
      "commit_id" : "f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T12:37:15Z",
      "diff_hunk" : "@@ -809,11 +857,15 @@ NodeRef GenNode(F ConsumeNode, Type root_type, bool strict_valid = false) {\n             // Fragment/children have not been decided yet. Decide them.\n             auto node_info = ConsumeNode(type_needed);\n             if (!node_info) return {};\n+            if ((!miniscript::IsTapscript(SCRIPT_CTX) && node_info->fragment == Fragment::MULTI_A)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1341313430",
      "id" : 1341313430,
      "in_reply_to_id" : 1331735314,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585P8tGW",
      "original_commit_id" : "a9b2e8f07ef22a5f6e51083d92a3a6077fc9b738",
      "original_line" : 860,
      "original_position" : 229,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1650695088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341313430/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T12:37:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341313430",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "ACK f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-09-29T17:47:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1741276032",
      "id" : 1741276032,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585nycOA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741276032/reactions"
      },
      "updated_at" : "2023-09-29T17:47:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741276032",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@scgbckbone want to take another look here?",
      "created_at" : "2023-09-30T10:25:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1741735041",
      "id" : 1741735041,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585n0MSB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741735041/reactions"
      },
      "updated_at" : "2023-09-30T10:25:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741735041",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK https://github.com/bitcoin/bitcoin/pull/27255/commits/f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-10-02T15:41:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1743258096",
      "id" : 1743258096,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585n6AHw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743258096/reactions"
      },
      "updated_at" : "2023-10-02T15:41:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743258096",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25349625?v=4",
         "events_url" : "https://api.github.com/users/scgbckbone/events{/privacy}",
         "followers_url" : "https://api.github.com/users/scgbckbone/followers",
         "following_url" : "https://api.github.com/users/scgbckbone/following{/other_user}",
         "gists_url" : "https://api.github.com/users/scgbckbone/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/scgbckbone",
         "id" : 25349625,
         "login" : "scgbckbone",
         "node_id" : "MDQ6VXNlcjI1MzQ5NjI1",
         "organizations_url" : "https://api.github.com/users/scgbckbone/orgs",
         "received_events_url" : "https://api.github.com/users/scgbckbone/received_events",
         "repos_url" : "https://api.github.com/users/scgbckbone/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/scgbckbone/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/scgbckbone/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/scgbckbone"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "ACK f45cb489029abfb0f82ebced167d9b5833960f22",
      "created_at" : "2023-10-03T07:49:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1744390972",
      "id" : 1744390972,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585n-Us8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744390972/reactions"
      },
      "updated_at" : "2023-10-03T07:49:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744390972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6681844?v=4",
         "events_url" : "https://api.github.com/users/bigspider/events{/privacy}",
         "followers_url" : "https://api.github.com/users/bigspider/followers",
         "following_url" : "https://api.github.com/users/bigspider/following{/other_user}",
         "gists_url" : "https://api.github.com/users/bigspider/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/bigspider",
         "id" : 6681844,
         "login" : "bigspider",
         "node_id" : "MDQ6VXNlcjY2ODE4NDQ=",
         "organizations_url" : "https://api.github.com/users/bigspider/orgs",
         "received_events_url" : "https://api.github.com/users/bigspider/received_events",
         "repos_url" : "https://api.github.com/users/bigspider/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/bigspider/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/bigspider/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/bigspider"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks everyone for your reviews! Just as this is piling up ACKs i'd like to explicit that i believe this needs a review from @sipa before it can be merged.",
      "created_at" : "2023-10-03T08:03:47Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1744416873",
      "id" : 1744416873,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585n-bBp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744416873/reactions"
      },
      "updated_at" : "2023-10-03T08:03:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1744416873",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346220567"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346220567"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: introduce a multi_a fragment\"\r\n\r\nShouldn't this be `last - in < k + 2`? If `last - in = k + 1`, then `in[k + 1]` is the same as `*last`.",
      "commit_id" : "c4a88b0a084a07cf960f2181501317983ae8d8bd",
      "created_at" : "2023-10-04T17:22:25Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);\n+                if (!num) return {};\n+                if (*num < 1 || *num > MAX_PUBKEYS_PER_MULTI_A) return {};\n+                if (last - in < 2 + *num * 2) return {};\n+                std::vector<Key> keys;\n+                keys.reserve(*num);\n+                // Walk through the expected (pubkey, CHECKSIG[ADD]) pairs.\n+                for (int k = 2;; k += 2) {\n+                    if (last - in < k + 1) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346220567",
      "id" : 1346220567,
      "line" : 2272,
      "node_id" : "PRRC_kwDOABII585QPbIX",
      "original_commit_id" : "4ce118b1de1de55d721c588cb92b1eb69d578825",
      "original_line" : 2097,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 995,
      "pull_request_review_id" : 1658137883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346220567/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T20:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346220567",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346438441"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346438441"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nIf there are 253 witness stack elements or more, 3 bytes are needed for it (and below, 1 byte suffices). Did you mean to use 3 or 1 instead of 2?",
      "commit_id" : "c4a88b0a084a07cf960f2181501317983ae8d8bd",
      "created_at" : "2023-10-04T20:43:30Z",
      "diff_hunk" : "@@ -22,6 +22,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+// nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+// prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+// nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + 1 + TXIN_BYTES_NO_WITNESS + 1 + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself). +2 for witness stack size.\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{2 + (1 + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + TAPROOT_CONTROL_MAX_SIZE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346438441",
      "id" : 1346438441,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QQQUp",
      "original_commit_id" : "475a2a3988e3837c4c10220b5fd75100a3d7dc1c",
      "original_line" : 34,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1658137883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346438441/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T20:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346438441",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346441132"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346441132"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could this function (and many other below) not use `m_script_ctx` to decide script context instead of needing to take an argument?",
      "commit_id" : "c4a88b0a084a07cf960f2181501317983ae8d8bd",
      "created_at" : "2023-10-04T20:46:21Z",
      "diff_hunk" : "@@ -1268,7 +1274,8 @@ struct Node {\n     uint32_t GetStaticOps() const { return ops.count; }\n \n     //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const {\n+    bool CheckOpsLimit(const MiniscriptContext script_ctx) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346441132",
      "id" : 1346441132,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QQQ-s",
      "original_commit_id" : "475a2a3988e3837c4c10220b5fd75100a3d7dc1c",
      "original_line" : 1277,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1658137883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346441132/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T20:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346441132",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346445011"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346445011"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit: \"pubkey: introduce a GetCPubKey helper\"\r\n\r\nNit: update commit title to reflect new function name.",
      "commit_id" : "c4a88b0a084a07cf960f2181501317983ae8d8bd",
      "created_at" : "2023-10-04T20:48:58Z",
      "diff_hunk" : "@@ -204,6 +204,13 @@ std::vector<CKeyID> XOnlyPubKey::GetKeyIDs() const\n     return out;\n }\n \n+CPubKey XOnlyPubKey::GetEvenCorrespondingCPubKey() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1346445011",
      "id" : 1346445011,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585QQR7T",
      "original_commit_id" : "69da583e58131c0be757c71eb388554772b576a1",
      "original_line" : 207,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/pubkey.cpp",
      "position" : 4,
      "pull_request_review_id" : 1658137883,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346445011/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-04T20:51:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1346445011",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347190756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347190756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, and we don't want to dereference `last` since it's past the last element? (It's the vector `end()`, maybe it's confusing to name it \"last\".)",
      "commit_id" : "c4a88b0a084a07cf960f2181501317983ae8d8bd",
      "created_at" : "2023-10-05T10:22:25Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);\n+                if (!num) return {};\n+                if (*num < 1 || *num > MAX_PUBKEYS_PER_MULTI_A) return {};\n+                if (last - in < 2 + *num * 2) return {};\n+                std::vector<Key> keys;\n+                keys.reserve(*num);\n+                // Walk through the expected (pubkey, CHECKSIG[ADD]) pairs.\n+                for (int k = 2;; k += 2) {\n+                    if (last - in < k + 1) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347190756",
      "id" : 1347190756,
      "in_reply_to_id" : 1346220567,
      "line" : 2272,
      "node_id" : "PRRC_kwDOABII585QTH_k",
      "original_commit_id" : "4ce118b1de1de55d721c588cb92b1eb69d578825",
      "original_line" : 2097,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 995,
      "pull_request_review_id" : 1659485120,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347190756/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T10:22:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347190756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347309800"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347309800"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oh, right, i meant 3. I overlooked CompactSize needs 3 bytes for values >= 253. Fixed now, thanks.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T12:00:04Z",
      "diff_hunk" : "@@ -22,6 +22,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+// nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+// prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+// nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + 1 + TXIN_BYTES_NO_WITNESS + 1 + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself). +2 for witness stack size.\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{2 + (1 + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + TAPROOT_CONTROL_MAX_SIZE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347309800",
      "id" : 1347309800,
      "in_reply_to_id" : 1346438441,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QTlDo",
      "original_commit_id" : "475a2a3988e3837c4c10220b5fd75100a3d7dc1c",
      "original_line" : 34,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1659670313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347309800/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T12:00:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347309800",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347310053"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310053"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I had somehow dropped half the of the changes i advertized in https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1740795955. Sorry about that, this is now fixed.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T12:00:18Z",
      "diff_hunk" : "@@ -1268,7 +1274,8 @@ struct Node {\n     uint32_t GetStaticOps() const { return ops.count; }\n \n     //! Check the ops limit of this script against the consensus limit.\n-    bool CheckOpsLimit() const {\n+    bool CheckOpsLimit(const MiniscriptContext script_ctx) const {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347310053",
      "id" : 1347310053,
      "in_reply_to_id" : 1346441132,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QTlHl",
      "original_commit_id" : "475a2a3988e3837c4c10220b5fd75100a3d7dc1c",
      "original_line" : 1277,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1659670731,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310053/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T12:00:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310053",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347310297"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310297"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T12:00:31Z",
      "diff_hunk" : "@@ -204,6 +204,13 @@ std::vector<CKeyID> XOnlyPubKey::GetKeyIDs() const\n     return out;\n }\n \n+CPubKey XOnlyPubKey::GetEvenCorrespondingCPubKey() const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347310297",
      "id" : 1347310297,
      "in_reply_to_id" : 1346445011,
      "line" : 207,
      "node_id" : "PRRC_kwDOABII585QTlLZ",
      "original_commit_id" : "69da583e58131c0be757c71eb388554772b576a1",
      "original_line" : 207,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/pubkey.cpp",
      "position" : 4,
      "pull_request_review_id" : 1659671095,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310297/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T12:00:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347310297",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347359943"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347359943"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, and you're accessing `in[k + 1]` below, so if `last - in = k + 1`, then this `if (last - in < k + 1) return {};` won't execute, and you'll be dereferencing the vector end below.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T12:41:10Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);\n+                if (!num) return {};\n+                if (*num < 1 || *num > MAX_PUBKEYS_PER_MULTI_A) return {};\n+                if (last - in < 2 + *num * 2) return {};\n+                std::vector<Key> keys;\n+                keys.reserve(*num);\n+                // Walk through the expected (pubkey, CHECKSIG[ADD]) pairs.\n+                for (int k = 2;; k += 2) {\n+                    if (last - in < k + 1) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347359943",
      "id" : 1347359943,
      "in_reply_to_id" : 1346220567,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QTxTH",
      "original_commit_id" : "4ce118b1de1de55d721c588cb92b1eb69d578825",
      "original_line" : 2097,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1659758859,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347359943/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T12:41:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347359943",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347443156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347443156"
         }
      },
      "author_association" : "MEMBER",
      "body" : "My bad, i had this backward. Fixed and added a couple test cases that would run into this.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T13:41:32Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);\n+                if (!num) return {};\n+                if (*num < 1 || *num > MAX_PUBKEYS_PER_MULTI_A) return {};\n+                if (last - in < 2 + *num * 2) return {};\n+                std::vector<Key> keys;\n+                keys.reserve(*num);\n+                // Walk through the expected (pubkey, CHECKSIG[ADD]) pairs.\n+                for (int k = 2;; k += 2) {\n+                    if (last - in < k + 1) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347443156",
      "id" : 1347443156,
      "in_reply_to_id" : 1346220567,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QUFnU",
      "original_commit_id" : "4ce118b1de1de55d721c588cb92b1eb69d578825",
      "original_line" : 2097,
      "original_position" : 218,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1659898946,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347443156/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-05T13:41:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347443156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-05T16:52:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1749305036",
      "id" : 1749305036,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585oREbM",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749305036/reactions"
      },
      "updated_at" : "2023-10-05T16:52:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1749305036",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347938935"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347938935"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: introduce a multi_a fragment\"\r\n\r\nI believe this comment needs to be adapted for `multi_a`: `next_sats[j]` is either equal to `sats[j]` *plus ZERO*, or to `sats[j-1]` plus a signature for the i'th key.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T20:34:11Z",
      "diff_hunk" : "@@ -940,6 +962,33 @@ struct Node {\n                     Availability avail = ctx.Sign(node.keys[0], sig);\n                     return {ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail)};\n                 }\n+                case Fragment::MULTI_A: {\n+                    // sats[j] represents the best stack containing j valid signatures (out of the first i keys).\n+                    // In the loop below, these stacks are built up using a dynamic programming approach.\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    // The dissatisfaction consists of as many empty vectors as there are keys.\n+                    InputStack nsat;\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        nsat = std::move(nsat) + ZERO;\n+                        // Get the signature for the i'th key in reverse order (the signature for the first key needs to\n+                        // be at the top of the stack, contrary to CHECKMULTISIG's satisfaction).\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[node.keys.size() - 1 - i], sig);\n+                        // Compute signature stack for just this key.\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        // Compute the next sats vector: next_sats[0] is a copy of sats[0] (no signatures). All further\n+                        // next_sats[j] are equal to either the existing sats[j], or sats[j-1] plus a signature for the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347938935",
      "id" : 1347938935,
      "line" : 1135,
      "node_id" : "PRRC_kwDOABII585QV-p3",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 980,
      "original_position" : 96,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 448,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347938935/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:03:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347938935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347940283"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347940283"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: introduce a multi_a fragment\":\r\n\r\nI'm idly wondering why we need `nsat` (here, and in `multi` and `thresh`), can't we use `sats[0]` instead?\r\n\r\n(no need to address this, I'm just a bit confused by the existing code which IIRC I wrote myself)",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T20:35:45Z",
      "diff_hunk" : "@@ -940,6 +962,33 @@ struct Node {\n                     Availability avail = ctx.Sign(node.keys[0], sig);\n                     return {ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail)};\n                 }\n+                case Fragment::MULTI_A: {\n+                    // sats[j] represents the best stack containing j valid signatures (out of the first i keys).\n+                    // In the loop below, these stacks are built up using a dynamic programming approach.\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    // The dissatisfaction consists of as many empty vectors as there are keys.\n+                    InputStack nsat;\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        nsat = std::move(nsat) + ZERO;\n+                        // Get the signature for the i'th key in reverse order (the signature for the first key needs to\n+                        // be at the top of the stack, contrary to CHECKMULTISIG's satisfaction).\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[node.keys.size() - 1 - i], sig);\n+                        // Compute signature stack for just this key.\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        // Compute the next sats vector: next_sats[0] is a copy of sats[0] (no signatures). All further\n+                        // next_sats[j] are equal to either the existing sats[j], or sats[j-1] plus a signature for the\n+                        // current (i'th) key. The very last element needs all signatures filled.\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + ZERO);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + ZERO) | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        // Switch over.\n+                        sats = std::move(next_sats);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return {std::move(nsat), std::move(sats[node.k])};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347940283",
      "id" : 1347940283,
      "line" : 1145,
      "node_id" : "PRRC_kwDOABII585QV--7",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 990,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 458,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347940283/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347940283",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347949150"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347949150"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: introduce a multi_a fragment\"\r\n\r\nIt took me a while to realize that `num` is actually the threshold here, and not the number of keys (especially with a `k` variable below, but which is a position and not key count or threshold either). Some comments would help, or alternatively renaming `num` -> `k`, and `k` -> `pos` or so.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T20:44:47Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347949150",
      "id" : 1347949150,
      "line" : 2264,
      "node_id" : "PRRC_kwDOABII585QWBJe",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 2089,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 987,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347949150/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347949150",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347957128"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347957128"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nThe compactsize encoding for the script push can be 5 bytes if it's more than 65535, I think?",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T20:52:04Z",
      "diff_hunk" : "@@ -22,6 +22,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + 1 + TXIN_BYTES_NO_WITNESS + 1 + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself). +3 for witness stack size.\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{3 + (1 + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)\n+{\n+    if (IsTapscript(ms_ctx)) {\n+        // Leaf scripts under Tapscript are not explicitly limited in size. They are only implicitly bounded\n+        // by the maximum standard size of a spending transaction. Let the maximum script size conservatively\n+        // be small enough such as even a maximum sized witness and a reasonably sized spending transaction can\n+        // spend an output paying to this script without running into the maximum standard tx size limit.\n+        // +4 to account for the maximum compactsize encoding for the script push.\n+        return MAX_STANDARD_TX_WEIGHT - TX_BODY_LEEWAY_WEIGHT - MAX_TAPSCRIPT_SAT_SIZE - 4;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347957128",
      "id" : 1347957128,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585QWDGI",
      "original_commit_id" : "a6314b6172ab4cf0e992873911d250f097d7fdf5",
      "original_line" : 44,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 35,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347957128/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347957128",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347965677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347965677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"qa: Tapscript-Miniscript unit tests\"\r\n\r\nAny specific reason to replace this (arbitrary) message hash with 0? Not that it should matter for this test, but my gut feeling says it's better not to use message hash 0 in ECDSA.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T21:00:53Z",
      "diff_hunk" : "@@ -44,8 +47,11 @@ struct TestData {\n \n     TestData()\n     {\n-        // All our signatures sign (and are required to sign) this constant message.\n-        auto const MESSAGE_HASH = uint256S(\"f5cd94e18b6fe77dd7aca9e35c2b0c9cbd86356c80a71065\");\n+        // All our signatures sign (and are required to sign) this empty message.\n+        auto const MESSAGE_HASH{uint256S(\"\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347965677",
      "id" : 1347965677,
      "line" : 51,
      "node_id" : "PRRC_kwDOABII585QWFLt",
      "original_commit_id" : "388ee976a6c7a58112c4ff8f90157c041f79913f",
      "original_line" : 51,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/miniscript_tests.cpp",
      "position" : 25,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347965677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1347965677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348020155"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348020155"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"fuzz: adapt Miniscript targets to Tapscript\"\r\n\r\n(Here and below) Shouldn't this use `TEST_DATA.schnorr_sigs` instead of `TEST_DATA.dummy_sigs` in tapscript context?",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T21:46:32Z",
      "diff_hunk" : "@@ -1029,16 +1134,14 @@ void TestNode(const NodeRef& node, FuzzedDataProvider& provider)\n     // satisfaction will also match the expected policy.\n     bool satisfiable = node->IsSatisfiable([](const Node& node) -> bool {\n         switch (node.fragment) {\n-        case Fragment::MULTI_A:\n-            // TODO: Tapscript support.\n-            assert(false);\n         case Fragment::PK_K:\n         case Fragment::PK_H: {\n             auto it = TEST_DATA.dummy_sigs.find(node.keys[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348020155",
      "id" : 1348020155,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QWSe7",
      "original_commit_id" : "0d9495104bda7986faed3c1bbd849e3e8822deaa",
      "original_line" : 1139,
      "original_position" : 510,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348020155/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348020155",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348029664"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348029664"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: check maximum stack size during execution\"\r\n\r\nNit: typo \"framgents\"",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-05T21:58:45Z",
      "diff_hunk" : "@@ -848,52 +872,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348029664",
      "id" : 1348029664,
      "line" : 890,
      "node_id" : "PRRC_kwDOABII585QWUzg",
      "original_commit_id" : "660da8656442a9410cea0a29b0033090f55efe38",
      "original_line" : 877,
      "original_position" : 56,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 232,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348029664/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348029664",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348132869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348132869"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: check maximum stack size during execution\"\r\n\r\nI believe an alternative approach is possible with similar complexity as what's being done in this commit, which does not suffer from the inaccuracy caused by distinct paths which cause maximal initial stack size and maximal execution growth. I just want to get the idea out here, I don't consider this a requirement for this PR (as you know, I was fine with a much more approximate approach too).\r\n\r\nThe idea is to reason backwards. We know that every satisfaction of the overall script ends with a single stack item (a 1). From that endpoint, it seems possible to me to reason backwards through all possible execution paths and compute their maximal stack size at every point. Taking the maximum of that should give the desired limit.\r\n\r\nTo implement this, I think you need almost exactly what this commit is already doing, just reasoning in reverse: e.g. taking the maximum of the execution maximum of the second part and the execution maximum of the first plus the net effect of a second part.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T00:44:13Z",
      "diff_hunk" : "@@ -848,52 +872,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348132869",
      "id" : 1348132869,
      "line" : 893,
      "node_id" : "PRRC_kwDOABII585QWuAF",
      "original_commit_id" : "660da8656442a9410cea0a29b0033090f55efe38",
      "original_line" : 880,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 235,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348132869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348132869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348137056"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348137056"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nit: this comment is slightly outdated now that P2TR is also supported.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T00:55:08Z",
      "diff_hunk" : "@@ -1205,19 +1424,32 @@ struct Node {\n \n     //! Check the ops limit of this script against the consensus limit.\n     bool CheckOpsLimit() const {\n+        if (IsTapscript(m_script_ctx)) return true;\n         if (const auto ops = GetOps()) return *ops <= MAX_OPS_PER_SCRIPT;\n         return true;\n     }\n \n     /** Return the maximum number of stack elements needed to satisfy this script non-malleably.\n      * This does not account for the P2WSH script push. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348137056",
      "id" : 1348137056,
      "line" : 1433,
      "node_id" : "PRRC_kwDOABII585QWvBg",
      "original_commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "original_line" : 1433,
      "original_position" : 473,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 473,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348137056/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348137056",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348141619"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348141619"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@darosior @achow101 Did [this](https://github.com/bitcoin/bitcoin/pull/27255/commits/4ef415c7b849e4f591a874ee600c0944772c0e05#r1338368638) get resolved?",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T01:00:06Z",
      "diff_hunk" : "@@ -1189,23 +1189,30 @@ class MiniscriptDescriptor final : public DescriptorImpl\n {\n private:\n     miniscript::NodeRef<uint32_t> m_node;\n+    miniscript::MiniscriptContext script_ctx;\n \n protected:\n     std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript> scripts,\n                                      FlatSigningProvider& provider) const override\n     {\n-        for (const auto& key : keys) provider.pubkeys.emplace(key.GetID(), key);\n-        return Vector(m_node->ToScript(ScriptMaker(keys, miniscript::MiniscriptContext::P2WSH)));\n+        for (const auto& key : keys) {\n+            if (miniscript::IsTapscript(script_ctx)) {\n+                provider.pubkeys.emplace(Hash160(XOnlyPubKey{key}), key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348141619",
      "id" : 1348141619,
      "in_reply_to_id" : 1337839749,
      "line" : 1187,
      "node_id" : "PRRC_kwDOABII585QWwIz",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1187,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 46,
      "pull_request_review_id" : 1660661830,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348141619/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T01:02:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348141619",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348438774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348438774"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For my code you are right, i don't need `nsat`, i can juste reuse `sats[0]`. I made the change, it's straightforward and i think cleaner that way.\r\n\r\nFor `multi` however we can't do this since `sats[0]` doesn't have `ZERO`s, since `CHECKMULTISIG` does not need a `ZERO` as signatures for keys that are unused in case of satisfaction (it will just try the next public key for the same signature in case of failure). I haven't looked into `thresh`, but i suppose we could (i mostly reused `thresh`'s algorithm for `multi_a`).",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T08:54:58Z",
      "diff_hunk" : "@@ -940,6 +962,33 @@ struct Node {\n                     Availability avail = ctx.Sign(node.keys[0], sig);\n                     return {ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail)};\n                 }\n+                case Fragment::MULTI_A: {\n+                    // sats[j] represents the best stack containing j valid signatures (out of the first i keys).\n+                    // In the loop below, these stacks are built up using a dynamic programming approach.\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    // The dissatisfaction consists of as many empty vectors as there are keys.\n+                    InputStack nsat;\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        nsat = std::move(nsat) + ZERO;\n+                        // Get the signature for the i'th key in reverse order (the signature for the first key needs to\n+                        // be at the top of the stack, contrary to CHECKMULTISIG's satisfaction).\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[node.keys.size() - 1 - i], sig);\n+                        // Compute signature stack for just this key.\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        // Compute the next sats vector: next_sats[0] is a copy of sats[0] (no signatures). All further\n+                        // next_sats[j] are equal to either the existing sats[j], or sats[j-1] plus a signature for the\n+                        // current (i'th) key. The very last element needs all signatures filled.\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + ZERO);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + ZERO) | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        // Switch over.\n+                        sats = std::move(next_sats);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return {std::move(nsat), std::move(sats[node.k])};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348438774",
      "id" : 1348438774,
      "in_reply_to_id" : 1347940283,
      "line" : 1145,
      "node_id" : "PRRC_kwDOABII585QX4r2",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 990,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 458,
      "pull_request_review_id" : 1661414322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348438774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T08:54:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348438774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348450557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348450557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Did both, let's try to make this code as clear as possible to future readers (which may well be ourselves).",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T09:05:55Z",
      "diff_hunk" : "@@ -2016,6 +2083,35 @@ inline NodeRef<Key> DecodeScript(I& in, I last, const Ctx& ctx)\n                 constructed.push_back(MakeNodeRef<Key>(internal::NoDupCheck{}, ctx.MsContext(), Fragment::MULTI, std::move(keys), *k));\n                 break;\n             }\n+            // Tapscript's equivalent of multi\n+            if (last - in >= 4 && in[0].first == OP_NUMEQUAL) {\n+                if (!IsTapscript(ctx.MsContext())) return {};\n+                const auto num = ParseScriptNumber(in[1]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348450557",
      "id" : 1348450557,
      "in_reply_to_id" : 1347949150,
      "line" : 2264,
      "node_id" : "PRRC_kwDOABII585QX7j9",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 2089,
      "original_position" : 210,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 987,
      "pull_request_review_id" : 1661431873,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348450557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T09:05:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348450557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348474293"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348474293"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Errr. Again an off-by-one (like https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1347309800). I was previously hesitant to pull in more changes but i've now made `GetSizeOfCompactSize` `constexpr` and used it here to self-document the calculation and make sure the values are correct.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T09:27:12Z",
      "diff_hunk" : "@@ -22,6 +22,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + 1 + TXIN_BYTES_NO_WITNESS + 1 + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself). +3 for witness stack size.\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{3 + (1 + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)\n+{\n+    if (IsTapscript(ms_ctx)) {\n+        // Leaf scripts under Tapscript are not explicitly limited in size. They are only implicitly bounded\n+        // by the maximum standard size of a spending transaction. Let the maximum script size conservatively\n+        // be small enough such as even a maximum sized witness and a reasonably sized spending transaction can\n+        // spend an output paying to this script without running into the maximum standard tx size limit.\n+        // +4 to account for the maximum compactsize encoding for the script push.\n+        return MAX_STANDARD_TX_WEIGHT - TX_BODY_LEEWAY_WEIGHT - MAX_TAPSCRIPT_SAT_SIZE - 4;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348474293",
      "id" : 1348474293,
      "in_reply_to_id" : 1347957128,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585QYBW1",
      "original_commit_id" : "a6314b6172ab4cf0e992873911d250f097d7fdf5",
      "original_line" : 44,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 35,
      "pull_request_review_id" : 1661468339,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348474293/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T09:27:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348474293",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348500965"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348500965"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I also added a missing compactsize for the control block in the `MAX_TAPSCRIPT_SAT_SIZE` calculation.",
      "commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "created_at" : "2023-10-06T09:52:30Z",
      "diff_hunk" : "@@ -22,6 +22,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + 1 + TXIN_BYTES_NO_WITNESS + 1 + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself). +3 for witness stack size.\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{3 + (1 + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)\n+{\n+    if (IsTapscript(ms_ctx)) {\n+        // Leaf scripts under Tapscript are not explicitly limited in size. They are only implicitly bounded\n+        // by the maximum standard size of a spending transaction. Let the maximum script size conservatively\n+        // be small enough such as even a maximum sized witness and a reasonably sized spending transaction can\n+        // spend an output paying to this script without running into the maximum standard tx size limit.\n+        // +4 to account for the maximum compactsize encoding for the script push.\n+        return MAX_STANDARD_TX_WEIGHT - TX_BODY_LEEWAY_WEIGHT - MAX_TAPSCRIPT_SAT_SIZE - 4;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348500965",
      "id" : 1348500965,
      "in_reply_to_id" : 1347957128,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585QYH3l",
      "original_commit_id" : "a6314b6172ab4cf0e992873911d250f097d7fdf5",
      "original_line" : 44,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 35,
      "pull_request_review_id" : 1661510710,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348500965/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T09:52:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348500965",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348509896"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348509896"
         }
      },
      "author_association" : "MEMBER",
      "body" : "No, no reason. I confused myself by somehow thinking i changed hash 0 for this arbitrary hash in this PR and quickly removed it in my last push to minimize the diff, it was not the case... Dropped this change now.\r\n\r\nEDIT: found the origin of my confusion. In the fuzz test i indeed do this change, i just mixed up the two. I'll just leave it as is now.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T10:01:00Z",
      "diff_hunk" : "@@ -44,8 +47,11 @@ struct TestData {\n \n     TestData()\n     {\n-        // All our signatures sign (and are required to sign) this constant message.\n-        auto const MESSAGE_HASH = uint256S(\"f5cd94e18b6fe77dd7aca9e35c2b0c9cbd86356c80a71065\");\n+        // All our signatures sign (and are required to sign) this empty message.\n+        auto const MESSAGE_HASH{uint256S(\"\")};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348509896",
      "id" : 1348509896,
      "in_reply_to_id" : 1347965677,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QYKDI",
      "original_commit_id" : "388ee976a6c7a58112c4ff8f90157c041f79913f",
      "original_line" : 51,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/test/miniscript_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1661524897,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348509896/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T10:44:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348509896",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348539776"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348539776"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Good catch. Fixed.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T10:26:08Z",
      "diff_hunk" : "@@ -1029,16 +1134,14 @@ void TestNode(const NodeRef& node, FuzzedDataProvider& provider)\n     // satisfaction will also match the expected policy.\n     bool satisfiable = node->IsSatisfiable([](const Node& node) -> bool {\n         switch (node.fragment) {\n-        case Fragment::MULTI_A:\n-            // TODO: Tapscript support.\n-            assert(false);\n         case Fragment::PK_K:\n         case Fragment::PK_H: {\n             auto it = TEST_DATA.dummy_sigs.find(node.keys[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348539776",
      "id" : 1348539776,
      "in_reply_to_id" : 1348020155,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QYRWA",
      "original_commit_id" : "0d9495104bda7986faed3c1bbd849e3e8822deaa",
      "original_line" : 1139,
      "original_position" : 510,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1661573023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348539776/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T10:26:08Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348539776",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348548229"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348548229"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Dropped this part of the comment in a new commit.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T10:32:10Z",
      "diff_hunk" : "@@ -1205,19 +1424,32 @@ struct Node {\n \n     //! Check the ops limit of this script against the consensus limit.\n     bool CheckOpsLimit() const {\n+        if (IsTapscript(m_script_ctx)) return true;\n         if (const auto ops = GetOps()) return *ops <= MAX_OPS_PER_SCRIPT;\n         return true;\n     }\n \n     /** Return the maximum number of stack elements needed to satisfy this script non-malleably.\n      * This does not account for the P2WSH script push. */",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348548229",
      "id" : 1348548229,
      "in_reply_to_id" : 1348137056,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QYTaF",
      "original_commit_id" : "14d0c1d27094e55ae9c260d982878bb4a019a6d8",
      "original_line" : 1433,
      "original_position" : 473,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1661583904,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348548229/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T10:32:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348548229",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348554101"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348554101"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't get any response to my questions from Andrew but figured he thought my approach was fine since he then ACK'd the PR.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T10:37:54Z",
      "diff_hunk" : "@@ -1189,23 +1189,30 @@ class MiniscriptDescriptor final : public DescriptorImpl\n {\n private:\n     miniscript::NodeRef<uint32_t> m_node;\n+    miniscript::MiniscriptContext script_ctx;\n \n protected:\n     std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript> scripts,\n                                      FlatSigningProvider& provider) const override\n     {\n-        for (const auto& key : keys) provider.pubkeys.emplace(key.GetID(), key);\n-        return Vector(m_node->ToScript(ScriptMaker(keys, miniscript::MiniscriptContext::P2WSH)));\n+        for (const auto& key : keys) {\n+            if (miniscript::IsTapscript(script_ctx)) {\n+                provider.pubkeys.emplace(Hash160(XOnlyPubKey{key}), key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348554101",
      "id" : 1348554101,
      "in_reply_to_id" : 1337839749,
      "line" : 1187,
      "node_id" : "PRRC_kwDOABII585QYU11",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1187,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 46,
      "pull_request_review_id" : 1661593479,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348554101/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T10:37:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348554101",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348979857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979857"
         }
      },
      "author_association" : "MEMBER",
      "body" : "For anyone following along, i discussed this with @sipa on ##miniscript on Libera. I think he's currently trying to implement it.\r\n\r\nI was previously contemplating the idea of including it in this PR, but given the tight deadline (if we are aiming to get it into 26 at all, maybe some disagree) i would suggest we do this in a follow-up. This should only relax the limit anyways. (So even if we release this conservative estimate for 26, and change for the accurate calculation for 27, there should be no Miniscript descriptor that could ever be accepted by 26 but refused by 27.)",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T16:55:45Z",
      "diff_hunk" : "@@ -848,52 +872,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1348979857",
      "id" : 1348979857,
      "in_reply_to_id" : 1348132869,
      "line" : 893,
      "node_id" : "PRRC_kwDOABII585QZ8yR",
      "original_commit_id" : "660da8656442a9410cea0a29b0033090f55efe38",
      "original_line" : 893,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 235,
      "pull_request_review_id" : 1662312624,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T16:55:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1348979857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349224934"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349224934"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It seems to work, and I think it's a bit simpler too: https://github.com/sipa/bitcoin/commits/202310_wip_miniscript_stack\r\n\r\nFuzz tests pass, and execution limits are 1 lower in two of the unit tests. I hand-verified one of them, and I believe the computation is correct.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T19:14:21Z",
      "diff_hunk" : "@@ -848,52 +872,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349224934",
      "id" : 1349224934,
      "in_reply_to_id" : 1348132869,
      "line" : 893,
      "node_id" : "PRRC_kwDOABII585Qa4nm",
      "original_commit_id" : "660da8656442a9410cea0a29b0033090f55efe38",
      "original_line" : 893,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 235,
      "pull_request_review_id" : 1662656354,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349224934/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T19:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349224934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349382065"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349382065"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I convinced myself that this is fine. IIRC, these pubkeys are actually never used anywhere relevant (I think the only actual usage is in importing a descriptor to a legacy wallet). In signing, the keys will always be in the `SigningProvider` anyways since they have to be provided externally to the descriptor. Since there's no way for a private key of any format to produce an `XOnlyPubKey`, this case is already being handled elsewhere in signing logic.",
      "commit_id" : "473c17dc0e6962de4a1821ce18b178df3e90b3a9",
      "created_at" : "2023-10-06T23:06:14Z",
      "diff_hunk" : "@@ -1189,23 +1189,30 @@ class MiniscriptDescriptor final : public DescriptorImpl\n {\n private:\n     miniscript::NodeRef<uint32_t> m_node;\n+    miniscript::MiniscriptContext script_ctx;\n \n protected:\n     std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript> scripts,\n                                      FlatSigningProvider& provider) const override\n     {\n-        for (const auto& key : keys) provider.pubkeys.emplace(key.GetID(), key);\n-        return Vector(m_node->ToScript(ScriptMaker(keys, miniscript::MiniscriptContext::P2WSH)));\n+        for (const auto& key : keys) {\n+            if (miniscript::IsTapscript(script_ctx)) {\n+                provider.pubkeys.emplace(Hash160(XOnlyPubKey{key}), key);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349382065",
      "id" : 1349382065,
      "in_reply_to_id" : 1337839749,
      "line" : 1187,
      "node_id" : "PRRC_kwDOABII585Qbe-x",
      "original_commit_id" : "ffdca88818f77fda06c6331df5b4bb408ab1833b",
      "original_line" : 1187,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 46,
      "pull_request_review_id" : 1662894003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349382065/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-06T23:06:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349382065",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
         "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
         "followers_url" : "https://api.github.com/users/achow101/followers",
         "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
         "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/achow101",
         "id" : 3782274,
         "login" : "achow101",
         "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
         "organizations_url" : "https://api.github.com/users/achow101/orgs",
         "received_events_url" : "https://api.github.com/users/achow101/received_events",
         "repos_url" : "https://api.github.com/users/achow101/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/achow101"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349502207"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349502207"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Reviewed, cherry-picked and squashed your commit into the execution stack size tracking one from this PR. Thanks.",
      "commit_id" : "f677e5c84497f9c5c4d4730636bcad08ea23fa2a",
      "created_at" : "2023-10-07T10:34:10Z",
      "diff_hunk" : "@@ -848,52 +872,164 @@ struct Node {\n         assert(false);\n     }\n \n+    //! Get the net difference in the number of stack items after executing this fragment.\n+    internal::NetDiff CalcNetDiff() const {\n+        // B, K, and W fragments always push (or leave) exactly one element on the stack. V framgents never do.\n+        const auto added_items{((typ & \"V\"_mst) == \"V\"_mst) ? 0 : 1};\n+        // Get the maximum stack size necessary to (dis)satisfy this fragment as a negative number, if it exists.\n+        // NOTE: it is fine to use the maximum stack size here, since we add the execution stack size value to the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349502207",
      "id" : 1349502207,
      "in_reply_to_id" : 1348132869,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Qb8T_",
      "original_commit_id" : "660da8656442a9410cea0a29b0033090f55efe38",
      "original_line" : 893,
      "original_position" : 59,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1663037617,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349502207/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T10:34:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349502207",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349515686"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349515686"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: clearer as\r\n\r\n```diff\r\ndiff --git a/src/script/miniscript.h b/src/script/miniscript.h\r\nindex 1f596376d3..a3618362da 100644\r\n--- a/src/script/miniscript.h\r\n+++ b/src/script/miniscript.h\r\n@@ -361,7 +361,7 @@ struct SatInfo {\r\n     constexpr friend SatInfo operator+(const SatInfo& a, const SatInfo& b) noexcept\r\n     {\r\n         if (!a.valid || !b.valid) return {};\r\n-        return {a.netdiff + b.netdiff, b.exec > b.netdiff + a.exec ? b.exec : b.netdiff + a.exec};\r\n+        return {a.netdiff + b.netdiff, std::max(b.exec, b.netdiff + a.exec)};\r\n     }\r\n \r\n     /** Branching. */\r\n@@ -369,7 +369,7 @@ struct SatInfo {\r\n     {\r\n         if (!a.valid) return b;\r\n         if (!b.valid) return a;\r\n-        return {a.netdiff > b.netdiff ? a.netdiff : b.netdiff, a.exec > b.exec ? a.exec : b.exec};\r\n+        return {std::max(a.netdiff, b.netdiff), std::max(a.exec, b.exec)};\r\n     }\r\n };\r\n ```\r\n\r\n(I'll do only if i have to retouch)",
      "commit_id" : "f677e5c84497f9c5c4d4730636bcad08ea23fa2a",
      "created_at" : "2023-10-07T12:36:57Z",
      "diff_hunk" : "@@ -344,13 +344,58 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Whether a canonical satisfaction/dissatisfaction is possible at all.\n+    const bool valid;\n+    //! How much higher the stack size at start of execution can be compared to at the end.\n+    const int32_t netdiff;\n+    //! Mow much higher the stack size can be during execution compared to at the end.\n+    const int32_t exec;\n+\n+    constexpr SatInfo(int32_t in_netdiff, int32_t in_exec) noexcept\n+        : valid(true), netdiff(in_netdiff), exec(in_exec) {}\n+\n+    constexpr SatInfo() noexcept : valid(false), netdiff(0), exec(0) {}\n+\n+    /** Script concatenation. */\n+    constexpr friend SatInfo operator+(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid || !b.valid) return {};\n+        return {a.netdiff + b.netdiff, b.exec > b.netdiff + a.exec ? b.exec : b.netdiff + a.exec};\n+    }\n+\n+    /** Branching. */\n+    constexpr friend SatInfo operator|(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid) return b;\n+        if (!b.valid) return a;\n+        return {a.netdiff > b.netdiff ? a.netdiff : b.netdiff, a.exec > b.exec ? a.exec : b.exec};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349515686",
      "id" : 1349515686,
      "line" : 373,
      "node_id" : "PRRC_kwDOABII585Qb_mm",
      "original_commit_id" : "59ee9a2a3c2557f2099aec8f5acabccb87ceb092",
      "original_line" : 373,
      "original_position" : 30,
      "original_start_line" : 360,
      "path" : "src/script/miniscript.h",
      "position" : 89,
      "pull_request_review_id" : 1663050526,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349515686/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 360,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-07T12:36:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349515686",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349516344"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349516344"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I didn't do that because I wasn't sure if `std::max` was constexpr, and I missed the note on cppreference that it indeed is since c++14.\n\nSo feel free to make that change if you retouch.",
      "commit_id" : "f677e5c84497f9c5c4d4730636bcad08ea23fa2a",
      "created_at" : "2023-10-07T12:42:11Z",
      "diff_hunk" : "@@ -344,13 +344,58 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Whether a canonical satisfaction/dissatisfaction is possible at all.\n+    const bool valid;\n+    //! How much higher the stack size at start of execution can be compared to at the end.\n+    const int32_t netdiff;\n+    //! Mow much higher the stack size can be during execution compared to at the end.\n+    const int32_t exec;\n+\n+    constexpr SatInfo(int32_t in_netdiff, int32_t in_exec) noexcept\n+        : valid(true), netdiff(in_netdiff), exec(in_exec) {}\n+\n+    constexpr SatInfo() noexcept : valid(false), netdiff(0), exec(0) {}\n+\n+    /** Script concatenation. */\n+    constexpr friend SatInfo operator+(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid || !b.valid) return {};\n+        return {a.netdiff + b.netdiff, b.exec > b.netdiff + a.exec ? b.exec : b.netdiff + a.exec};\n+    }\n+\n+    /** Branching. */\n+    constexpr friend SatInfo operator|(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid) return b;\n+        if (!b.valid) return a;\n+        return {a.netdiff > b.netdiff ? a.netdiff : b.netdiff, a.exec > b.exec ? a.exec : b.exec};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349516344",
      "id" : 1349516344,
      "in_reply_to_id" : 1349515686,
      "line" : 373,
      "node_id" : "PRRC_kwDOABII585Qb_w4",
      "original_commit_id" : "59ee9a2a3c2557f2099aec8f5acabccb87ceb092",
      "original_line" : 373,
      "original_position" : 30,
      "original_start_line" : 360,
      "path" : "src/script/miniscript.h",
      "position" : 89,
      "pull_request_review_id" : 1663051048,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349516344/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 360,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-07T12:42:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349516344",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349546920"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349546920"
         }
      },
      "author_association" : "MEMBER",
      "body" : "You're right, the same approach doesn't work for `multi`, because dissatisfying a `multi(k, ...)` is not the same as satisfying a `multi(0, ...)` (they consume different numbers of elements).",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:09:07Z",
      "diff_hunk" : "@@ -940,6 +962,33 @@ struct Node {\n                     Availability avail = ctx.Sign(node.keys[0], sig);\n                     return {ZERO + InputStack(key), (InputStack(std::move(sig)).SetWithSig() + InputStack(key)).SetAvailable(avail)};\n                 }\n+                case Fragment::MULTI_A: {\n+                    // sats[j] represents the best stack containing j valid signatures (out of the first i keys).\n+                    // In the loop below, these stacks are built up using a dynamic programming approach.\n+                    std::vector<InputStack> sats = Vector(EMPTY);\n+                    // The dissatisfaction consists of as many empty vectors as there are keys.\n+                    InputStack nsat;\n+                    for (size_t i = 0; i < node.keys.size(); ++i) {\n+                        nsat = std::move(nsat) + ZERO;\n+                        // Get the signature for the i'th key in reverse order (the signature for the first key needs to\n+                        // be at the top of the stack, contrary to CHECKMULTISIG's satisfaction).\n+                        std::vector<unsigned char> sig;\n+                        Availability avail = ctx.Sign(node.keys[node.keys.size() - 1 - i], sig);\n+                        // Compute signature stack for just this key.\n+                        auto sat = InputStack(std::move(sig)).SetWithSig().SetAvailable(avail);\n+                        // Compute the next sats vector: next_sats[0] is a copy of sats[0] (no signatures). All further\n+                        // next_sats[j] are equal to either the existing sats[j], or sats[j-1] plus a signature for the\n+                        // current (i'th) key. The very last element needs all signatures filled.\n+                        std::vector<InputStack> next_sats;\n+                        next_sats.push_back(sats[0] + ZERO);\n+                        for (size_t j = 1; j < sats.size(); ++j) next_sats.push_back((sats[j] + ZERO) | (std::move(sats[j - 1]) + sat));\n+                        next_sats.push_back(std::move(sats[sats.size() - 1]) + std::move(sat));\n+                        // Switch over.\n+                        sats = std::move(next_sats);\n+                    }\n+                    assert(node.k <= sats.size());\n+                    return {std::move(nsat), std::move(sats[node.k])};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349546920",
      "id" : 1349546920,
      "in_reply_to_id" : 1347940283,
      "line" : 1173,
      "node_id" : "PRRC_kwDOABII585QcHOo",
      "original_commit_id" : "8b6c8ac42c588f2f13bff4a53733706a9549a834",
      "original_line" : 1173,
      "original_position" : 106,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 478,
      "pull_request_review_id" : 1663080887,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349546920/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T17:09:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349546920",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548038"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548038"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nNit: `constexpr` ?",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:19:40Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself).\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{GetSizeOfCompactSize(MAX_STACK_SIZE) + (GetSizeOfCompactSize(MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + GetSizeOfCompactSize(TAPROOT_CONTROL_MAX_SIZE) + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)\n+{\n+    if (IsTapscript(ms_ctx)) {\n+        // Leaf scripts under Tapscript are not explicitly limited in size. They are only implicitly bounded\n+        // by the maximum standard size of a spending transaction. Let the maximum script size conservatively\n+        // be small enough such as even a maximum sized witness and a reasonably sized spending transaction can\n+        // spend an output paying to this script without running into the maximum standard tx size limit.\n+        const auto max_size{MAX_STANDARD_TX_WEIGHT - TX_BODY_LEEWAY_WEIGHT - MAX_TAPSCRIPT_SAT_SIZE};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548038",
      "id" : 1349548038,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585QcHgG",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 44,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 39,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548038/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548038",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548093"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548093"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nNit typo: \"such as\" -> \"such that\"",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:20:17Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself).\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{GetSizeOfCompactSize(MAX_STACK_SIZE) + (GetSizeOfCompactSize(MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + GetSizeOfCompactSize(TAPROOT_CONTROL_MAX_SIZE) + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)\n+{\n+    if (IsTapscript(ms_ctx)) {\n+        // Leaf scripts under Tapscript are not explicitly limited in size. They are only implicitly bounded\n+        // by the maximum standard size of a spending transaction. Let the maximum script size conservatively\n+        // be small enough such as even a maximum sized witness and a reasonably sized spending transaction can",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548093",
      "id" : 1349548093,
      "line" : 42,
      "node_id" : "PRRC_kwDOABII585QcHg9",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 42,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 37,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548093/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548144"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548144"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nNit: I think this function can be constexpr too.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:20:50Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself).\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{GetSizeOfCompactSize(MAX_STACK_SIZE) + (GetSizeOfCompactSize(MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + GetSizeOfCompactSize(TAPROOT_CONTROL_MAX_SIZE) + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548144",
      "id" : 1349548144,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585QcHhw",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 37,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 32,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548144/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548144",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548490"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548490"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nThe `GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS)` and `GetSizeOfCompactSize(P2WSH_TXOUT_BYTES)` are confusing here; there is no actual push/bytevector anywhere in the serialization with the non-witness txin bytes as contents. You do need to account for the number of inputs and outputs, but `GetSizeOfCompactSize(1)` would be more appropriate for those.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:24:14Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349548490",
      "id" : 1349548490,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585QcHnK",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 33,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 28,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548490/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349548490",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a [bunch of cleanups and documentation improvements](https://github.com/sipa/bitcoin/commit/61c7555f1b9c17d7999cac2d00672f8db746e5ad) from @sipa to the execution stack size tracking code. Also we now only add `1` in `GetExecStackSize` / `GetStackSize` for non-V expressions.",
      "created_at" : "2023-10-07T17:38:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#issuecomment-1751778671",
      "id" : 1751778671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27255",
      "node_id" : "IC_kwDOABII585oagVv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1751778671/reactions"
      },
      "updated_at" : "2023-10-07T17:39:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1751778671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349550232"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349550232"
         }
      },
      "author_association" : "MEMBER",
      "body" : "This was included in the latest push.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T17:38:37Z",
      "diff_hunk" : "@@ -344,13 +344,58 @@ struct Ops {\n     Ops(uint32_t in_count, MaxInt<uint32_t> in_sat, MaxInt<uint32_t> in_dsat) : count(in_count), sat(in_sat), dsat(in_dsat) {};\n };\n \n+struct SatInfo {\n+    //! Whether a canonical satisfaction/dissatisfaction is possible at all.\n+    const bool valid;\n+    //! How much higher the stack size at start of execution can be compared to at the end.\n+    const int32_t netdiff;\n+    //! Mow much higher the stack size can be during execution compared to at the end.\n+    const int32_t exec;\n+\n+    constexpr SatInfo(int32_t in_netdiff, int32_t in_exec) noexcept\n+        : valid(true), netdiff(in_netdiff), exec(in_exec) {}\n+\n+    constexpr SatInfo() noexcept : valid(false), netdiff(0), exec(0) {}\n+\n+    /** Script concatenation. */\n+    constexpr friend SatInfo operator+(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid || !b.valid) return {};\n+        return {a.netdiff + b.netdiff, b.exec > b.netdiff + a.exec ? b.exec : b.netdiff + a.exec};\n+    }\n+\n+    /** Branching. */\n+    constexpr friend SatInfo operator|(const SatInfo& a, const SatInfo& b) noexcept\n+    {\n+        if (!a.valid) return b;\n+        if (!b.valid) return a;\n+        return {a.netdiff > b.netdiff ? a.netdiff : b.netdiff, a.exec > b.exec ? a.exec : b.exec};\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349550232",
      "id" : 1349550232,
      "in_reply_to_id" : 1349515686,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QcICY",
      "original_commit_id" : "59ee9a2a3c2557f2099aec8f5acabccb87ceb092",
      "original_line" : 422,
      "original_position" : 30,
      "original_start_line" : 360,
      "path" : "src/script/miniscript.h",
      "position" : null,
      "pull_request_review_id" : 1663084815,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349550232/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-10-07T17:38:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349550232",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349555551"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349555551"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"miniscript: adapt resources checks depending on context\"\r\n\r\nNit: `internal::` is unnecessary given `using namespace internal;` above.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T18:03:28Z",
      "diff_hunk" : "@@ -2379,7 +2392,7 @@ template<typename Ctx>\n inline NodeRef<typename Ctx::Key> FromScript(const CScript& script, const Ctx& ctx) {\n     using namespace internal;\n     // A too large Script is necessarily invalid, don't bother parsing it.\n-    if (script.size() > MAX_STANDARD_P2WSH_SCRIPT_SIZE) return {};\n+    if (script.size() > internal::MaxScriptSize(ctx.MsContext())) return {};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349555551",
      "id" : 1349555551,
      "line" : 2588,
      "node_id" : "PRRC_kwDOABII585QcJVf",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 2395,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/script/miniscript.h",
      "position" : 1148,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349555551/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349555551",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349559134"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349559134"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"fuzz: adapt Miniscript targets to Tapscript\"\r\n\r\nNit: make function `const`, and make it return a const pointer to pair?",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T18:29:04Z",
      "diff_hunk" : "@@ -70,6 +92,19 @@ struct TestData {\n             if (i & 1) hash160_preimages[hash] = std::vector<unsigned char>(keydata, keydata + 32);\n         }\n     }\n+\n+    //! Get the (Schnorr or ECDSA, depending on context) signature for this pubkey.\n+    std::pair<std::vector<unsigned char>, bool>* GetSig(const MsCtx script_ctx, const Key& key) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349559134",
      "id" : 1349559134,
      "line" : 97,
      "node_id" : "PRRC_kwDOABII585QcKNe",
      "original_commit_id" : "edc3e5477034768d51b8926cef5685fafe2e0e53",
      "original_line" : 97,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 70,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349559134/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349559134",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349562834"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349562834"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"fuzz: miniscript: higher sensitivity for max stack size limit under Tapscript\"\r\n\r\nThe way this is structured, with two nested conditionals that each have `provider.ConsumeBool()` call will break stability of seeds for `miniscript_stable`, which is a goal I believe.\r\n\r\nInstead I'd structure it as:\r\n\r\n```c++\r\nif (provider.ConsumeBool()) {\r\n    if (!IsTapscript(script_ctx) && node_ops && *node_ops < MAX_OPS_PER_SCRIPT && node->ScriptSize() < MAX_STANDARD_P2WSH_SCRIPT_SIZE) {\r\n        // P2WSH OP_NOP padding\r\n    }\r\n    if (IsTapscript(script_ctx) && node_exec_ss && *node_exec_ss < MAX_STACK_SIZE) {\r\n        // P2TR OP_NIP padding\r\n    }\r\n}\r\n```\r\n\r\n(to make it clearer that this retains stability, it's probably best not to introduce the `!IsTapscript(script_ctx) &&` in the conditional in an earlier commit, but instead pull the `const bool pad{provider.ConsumeBool()}` out first there.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T19:06:00Z",
      "diff_hunk" : "@@ -1071,10 +1072,25 @@ void TestNode(const MsCtx script_ctx, const NodeRef& node, FuzzedDataProvider& p\n         // maximal.\n         // Do not pad more than what would cause MAX_STANDARD_P2WSH_SCRIPT_SIZE to be reached, however,\n         // as that also invalidates scripts.\n-        int add = std::min<int>(\n-            MAX_OPS_PER_SCRIPT - *node_ops,\n-            MAX_STANDARD_P2WSH_SCRIPT_SIZE - node->ScriptSize());\n-        for (int i = 0; i < add; ++i) script.push_back(OP_NOP);\n+        const auto node_ops{node->GetOps()};\n+        if (!IsTapscript(script_ctx) && provider.ConsumeBool() && node_ops && *node_ops < MAX_OPS_PER_SCRIPT",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349562834",
      "id" : 1349562834,
      "line" : 1076,
      "node_id" : "PRRC_kwDOABII585QcLHS",
      "original_commit_id" : "6baff32e78ef779b3ff89d6725e01e04299f685f",
      "original_line" : 1076,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : 462,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349562834/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349562834",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349566496"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349566496"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In commit \"script/sign: Miniscript support in Tapscript\"\r\n\r\nDoes this need to be a mutable reference? If at all possible, I'd make it a `const uint256 m_leaf_hash`.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T19:43:54Z",
      "diff_hunk" : "@@ -263,49 +253,81 @@ struct Satisfier {\n     }\n };\n \n-static bool SignTaprootScript(const SigningProvider& provider, const BaseSignatureCreator& creator, SignatureData& sigdata, int leaf_version, Span<const unsigned char> script_bytes, std::vector<valtype>& result)\n-{\n-    // Only BIP342 tapscript signing is supported for now.\n-    if (leaf_version != TAPROOT_LEAF_TAPSCRIPT) return false;\n-    SigVersion sigversion = SigVersion::TAPSCRIPT;\n+/** Miniscript satisfier specific to P2WSH context. */\n+struct WshSatisfier: Satisfier<CPubKey> {\n+    explicit WshSatisfier(const SigningProvider& provider LIFETIMEBOUND, SignatureData& sig_data LIFETIMEBOUND,\n+                          const BaseSignatureCreator& creator LIFETIMEBOUND, const CScript& witscript LIFETIMEBOUND)\n+                          : Satisfier(provider, sig_data, creator, witscript, miniscript::MiniscriptContext::P2WSH) {}\n \n-    uint256 leaf_hash = ComputeTapleafHash(leaf_version, script_bytes);\n-    CScript script = CScript(script_bytes.begin(), script_bytes.end());\n+    //! Conversion from a raw compressed public key.\n+    template <typename I>\n+    std::optional<CPubKey> FromPKBytes(I first, I last) const {\n+        CPubKey pubkey{first, last};\n+        if (pubkey.IsValid()) return pubkey;\n+        return {};\n+    }\n \n-    // <xonly pubkey> OP_CHECKSIG\n-    if (script.size() == 34 && script[33] == OP_CHECKSIG && script[0] == 0x20) {\n-        XOnlyPubKey pubkey{Span{script}.subspan(1, 32)};\n-        std::vector<unsigned char> sig;\n-        if (CreateTaprootScriptSig(creator, sigdata, provider, sig, pubkey, leaf_hash, sigversion)) {\n-            result = Vector(std::move(sig));\n-            return true;\n-        }\n-        return false;\n+    //! Conversion from a raw compressed public key hash.\n+    template<typename I>\n+    std::optional<CPubKey> FromPKHBytes(I first, I last) const {\n+        return Satisfier::CPubFromPKHBytes(first, last);\n     }\n \n-    // multi_a scripts (<key> OP_CHECKSIG <key> OP_CHECKSIGADD <key> OP_CHECKSIGADD <k> OP_NUMEQUAL)\n-    if (auto match = MatchMultiA(script)) {\n-        std::vector<std::vector<unsigned char>> sigs;\n-        int good_sigs = 0;\n-        for (size_t i = 0; i < match->second.size(); ++i) {\n-            XOnlyPubKey pubkey{*(match->second.rbegin() + i)};\n-            std::vector<unsigned char> sig;\n-            bool good_sig = CreateTaprootScriptSig(creator, sigdata, provider, sig, pubkey, leaf_hash, sigversion);\n-            if (good_sig && good_sigs < match->first) {\n-                ++good_sigs;\n-                sigs.push_back(std::move(sig));\n-            } else {\n-                sigs.emplace_back();\n-            }\n+    //! Satisfy an ECDSA signature check.\n+    miniscript::Availability Sign(const CPubKey& key, std::vector<unsigned char>& sig) const {\n+        if (CreateSig(m_creator, m_sig_data, m_provider, sig, key, m_witness_script, SigVersion::WITNESS_V0)) {\n+            return miniscript::Availability::YES;\n         }\n-        if (good_sigs == match->first) {\n-            result = std::move(sigs);\n-            return true;\n+        return miniscript::Availability::NO;\n+    }\n+};\n+\n+/** Miniscript satisfier specific to Tapscript context. */\n+struct TapSatisfier: Satisfier<XOnlyPubKey> {\n+    uint256& m_leaf_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349566496",
      "id" : 1349566496,
      "line" : 287,
      "node_id" : "PRRC_kwDOABII585QcMAg",
      "original_commit_id" : "5f8d2d58805d35d3be792dca149f4fd9795f6f98",
      "original_line" : 287,
      "original_position" : 165,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : 163,
      "pull_request_review_id" : 1663082383,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349566496/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T19:54:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349566496",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/548488?v=4",
         "events_url" : "https://api.github.com/users/sipa/events{/privacy}",
         "followers_url" : "https://api.github.com/users/sipa/followers",
         "following_url" : "https://api.github.com/users/sipa/following{/other_user}",
         "gists_url" : "https://api.github.com/users/sipa/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/sipa",
         "id" : 548488,
         "login" : "sipa",
         "node_id" : "MDQ6VXNlcjU0ODQ4OA==",
         "organizations_url" : "https://api.github.com/users/sipa/orgs",
         "received_events_url" : "https://api.github.com/users/sipa/received_events",
         "repos_url" : "https://api.github.com/users/sipa/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/sipa/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/sipa/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/sipa"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349598126"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349598126"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Err.. Right.",
      "commit_id" : "586142714c96571ab88c4776bf8b24e6d78325ce",
      "created_at" : "2023-10-07T23:35:23Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349598126",
      "id" : 1349598126,
      "in_reply_to_id" : 1349548490,
      "line" : 33,
      "node_id" : "PRRC_kwDOABII585QcTuu",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 33,
      "original_position" : 19,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : 28,
      "pull_request_review_id" : 1663134786,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349598126/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-07T23:35:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349598126",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349600967"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349600967"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Right, good catch! I left the `ConsumeBool()` in the P2WSH branch.\r\n\r\nI think simply removing the leftover call to `ConsumeBool()` is all is needed to keep seed stability however. I'm not sure about re-structuring it and moving the `!IsTapscript()` in this commit. For reasoning about seed stability i just think of `IsTapscript()` as always `false`, and i find the diff before and after this PR makes it pretty clear we do consume exactly the same bytes as before under P2WSH context: \r\n```diff\r\n-    const auto node_ops{node->GetOps()};\r\n-    if (provider.ConsumeBool() && node_ops && *node_ops < MAX_OPS_PER_SCRIPT && node->ScriptSize() < MAX_STANDARD_P2WSH_SCRIPT_SIZE) {\r\n-        // Optionally pad the script with OP_NOPs to max op the ops limit of the constructed script.\r\n+    // Optionally pad the script or the witness in order to increase the sensitivity of the tests of\r\n+    // the resources limits logic.\r\n+    CScriptWitness witness_mal, witness_nonmal;\r\n+    if (provider.ConsumeBool()) {\r\n+        // Under P2WSH, optionally pad the script with OP_NOPs to max op the ops limit of the constructed script.\r\n         // This makes the script obviously not actually miniscript-compatible anymore, but the\r\n         // signatures constructed in this test don't commit to the script anyway, so the same\r\n         // miniscript satisfier will work. This increases the sensitivity of the test to the ops\r\n@@ -954,31 +1072,54 @@ void TestNode(const NodeRef& node, FuzzedDataProvider& provider)\r\n         // maximal.\r\n         // Do not pad more than what would cause MAX_STANDARD_P2WSH_SCRIPT_SIZE to be reached, however,\r\n         // as that also invalidates scripts.\r\n-        int add = std::min<int>(\r\n-            MAX_OPS_PER_SCRIPT - *node_ops,\r\n-            MAX_STANDARD_P2WSH_SCRIPT_SIZE - node->ScriptSize());\r\n-        for (int i = 0; i < add; ++i) script.push_back(OP_NOP);\r\n+        const auto node_ops{node->GetOps()};\r\n+        if (!IsTapscript(script_ctx) && node_ops && *node_ops < MAX_OPS_PER_SCRIPT\r\n+            && node->ScriptSize() < MAX_STANDARD_P2WSH_SCRIPT_SIZE) {\r\n+            int add = std::min<int>(\r\n+                MAX_OPS_PER_SCRIPT - *node_ops,\r\n+                MAX_STANDARD_P2WSH_SCRIPT_SIZE - node->ScriptSize());\r\n+            for (int i = 0; i < add; ++i) script.push_back(OP_NOP);\r\n+        }\r\n+\r\n+        // Under Tapscript, optionally pad the stack up to the limit minus the calculated maximum execution stack\r\n+        // size to assert a Miniscript would never add more elements to the stack during execution than anticipated.\r\n+        const auto node_exec_ss{node->GetExecStackSize()};\r\n+        if (miniscript::IsTapscript(script_ctx) && node_exec_ss && *node_exec_ss < MAX_STACK_SIZE) {\r\n+            unsigned add{(unsigned)MAX_STACK_SIZE - *node_exec_ss};\r\n+            witness_mal.stack.resize(add);\r\n+            witness_nonmal.stack.resize(add);\r\n+            script.reserve(add);\r\n+            for (unsigned i = 0; i < add; ++i) script.push_back(OP_NIP);\r\n+        }\r\n     }\r\n```",
      "commit_id" : "ec0fc14a22f38b487929ec21145945966f301eb5",
      "created_at" : "2023-10-08T00:14:19Z",
      "diff_hunk" : "@@ -1071,10 +1072,25 @@ void TestNode(const MsCtx script_ctx, const NodeRef& node, FuzzedDataProvider& p\n         // maximal.\n         // Do not pad more than what would cause MAX_STANDARD_P2WSH_SCRIPT_SIZE to be reached, however,\n         // as that also invalidates scripts.\n-        int add = std::min<int>(\n-            MAX_OPS_PER_SCRIPT - *node_ops,\n-            MAX_STANDARD_P2WSH_SCRIPT_SIZE - node->ScriptSize());\n-        for (int i = 0; i < add; ++i) script.push_back(OP_NOP);\n+        const auto node_ops{node->GetOps()};\n+        if (!IsTapscript(script_ctx) && provider.ConsumeBool() && node_ops && *node_ops < MAX_OPS_PER_SCRIPT",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349600967",
      "id" : 1349600967,
      "in_reply_to_id" : 1349562834,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QcUbH",
      "original_commit_id" : "6baff32e78ef779b3ff89d6725e01e04299f685f",
      "original_line" : 1076,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/test/fuzz/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1663137087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349600967/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-08T00:14:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349600967",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349601084"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601084"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The reference didn't need to be mutable. Fixed.",
      "commit_id" : "ec0fc14a22f38b487929ec21145945966f301eb5",
      "created_at" : "2023-10-08T00:16:05Z",
      "diff_hunk" : "@@ -263,49 +253,81 @@ struct Satisfier {\n     }\n };\n \n-static bool SignTaprootScript(const SigningProvider& provider, const BaseSignatureCreator& creator, SignatureData& sigdata, int leaf_version, Span<const unsigned char> script_bytes, std::vector<valtype>& result)\n-{\n-    // Only BIP342 tapscript signing is supported for now.\n-    if (leaf_version != TAPROOT_LEAF_TAPSCRIPT) return false;\n-    SigVersion sigversion = SigVersion::TAPSCRIPT;\n+/** Miniscript satisfier specific to P2WSH context. */\n+struct WshSatisfier: Satisfier<CPubKey> {\n+    explicit WshSatisfier(const SigningProvider& provider LIFETIMEBOUND, SignatureData& sig_data LIFETIMEBOUND,\n+                          const BaseSignatureCreator& creator LIFETIMEBOUND, const CScript& witscript LIFETIMEBOUND)\n+                          : Satisfier(provider, sig_data, creator, witscript, miniscript::MiniscriptContext::P2WSH) {}\n \n-    uint256 leaf_hash = ComputeTapleafHash(leaf_version, script_bytes);\n-    CScript script = CScript(script_bytes.begin(), script_bytes.end());\n+    //! Conversion from a raw compressed public key.\n+    template <typename I>\n+    std::optional<CPubKey> FromPKBytes(I first, I last) const {\n+        CPubKey pubkey{first, last};\n+        if (pubkey.IsValid()) return pubkey;\n+        return {};\n+    }\n \n-    // <xonly pubkey> OP_CHECKSIG\n-    if (script.size() == 34 && script[33] == OP_CHECKSIG && script[0] == 0x20) {\n-        XOnlyPubKey pubkey{Span{script}.subspan(1, 32)};\n-        std::vector<unsigned char> sig;\n-        if (CreateTaprootScriptSig(creator, sigdata, provider, sig, pubkey, leaf_hash, sigversion)) {\n-            result = Vector(std::move(sig));\n-            return true;\n-        }\n-        return false;\n+    //! Conversion from a raw compressed public key hash.\n+    template<typename I>\n+    std::optional<CPubKey> FromPKHBytes(I first, I last) const {\n+        return Satisfier::CPubFromPKHBytes(first, last);\n     }\n \n-    // multi_a scripts (<key> OP_CHECKSIG <key> OP_CHECKSIGADD <key> OP_CHECKSIGADD <k> OP_NUMEQUAL)\n-    if (auto match = MatchMultiA(script)) {\n-        std::vector<std::vector<unsigned char>> sigs;\n-        int good_sigs = 0;\n-        for (size_t i = 0; i < match->second.size(); ++i) {\n-            XOnlyPubKey pubkey{*(match->second.rbegin() + i)};\n-            std::vector<unsigned char> sig;\n-            bool good_sig = CreateTaprootScriptSig(creator, sigdata, provider, sig, pubkey, leaf_hash, sigversion);\n-            if (good_sig && good_sigs < match->first) {\n-                ++good_sigs;\n-                sigs.push_back(std::move(sig));\n-            } else {\n-                sigs.emplace_back();\n-            }\n+    //! Satisfy an ECDSA signature check.\n+    miniscript::Availability Sign(const CPubKey& key, std::vector<unsigned char>& sig) const {\n+        if (CreateSig(m_creator, m_sig_data, m_provider, sig, key, m_witness_script, SigVersion::WITNESS_V0)) {\n+            return miniscript::Availability::YES;\n         }\n-        if (good_sigs == match->first) {\n-            result = std::move(sigs);\n-            return true;\n+        return miniscript::Availability::NO;\n+    }\n+};\n+\n+/** Miniscript satisfier specific to Tapscript context. */\n+struct TapSatisfier: Satisfier<XOnlyPubKey> {\n+    uint256& m_leaf_hash;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349601084",
      "id" : 1349601084,
      "in_reply_to_id" : 1349566496,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QcUc8",
      "original_commit_id" : "5f8d2d58805d35d3be792dca149f4fd9795f6f98",
      "original_line" : 287,
      "original_position" : 165,
      "original_start_line" : null,
      "path" : "src/script/sign.cpp",
      "position" : null,
      "pull_request_review_id" : 1663137225,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601084/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-08T00:16:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349601189"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601189"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done and made `IsTapscript` `constexpr` too while i was at it.",
      "commit_id" : "ec0fc14a22f38b487929ec21145945966f301eb5",
      "created_at" : "2023-10-08T00:17:29Z",
      "diff_hunk" : "@@ -22,6 +23,30 @@ bool IsTapscript(MiniscriptContext ms_ctx)\n \n namespace internal {\n \n+//! nVersion + nLockTime\n+constexpr uint32_t TX_OVERHEAD{4 + 4};\n+//! prevout + nSequence + scriptSig\n+constexpr uint32_t TXIN_BYTES_NO_WITNESS{36 + 4 + 1};\n+//! nValue + script len + OP_0 + pushdata 32.\n+constexpr uint32_t P2WSH_TXOUT_BYTES{8 + 1 + 1 + 33};\n+//! Data other than the witness in a transaction. Overhead + vin count + one vin + vout count + one vout + segwit marker\n+constexpr uint32_t TX_BODY_LEEWAY_WEIGHT{(TX_OVERHEAD + GetSizeOfCompactSize(TXIN_BYTES_NO_WITNESS) + TXIN_BYTES_NO_WITNESS + GetSizeOfCompactSize(P2WSH_TXOUT_BYTES) + P2WSH_TXOUT_BYTES) * WITNESS_SCALE_FACTOR + 2};\n+//! Maximum possible stack size to spend a Taproot output (excluding the script itself).\n+constexpr uint32_t MAX_TAPSCRIPT_SAT_SIZE{GetSizeOfCompactSize(MAX_STACK_SIZE) + (GetSizeOfCompactSize(MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) + MAX_TAPMINISCRIPT_STACK_ELEM_SIZE) * MAX_STACK_SIZE + GetSizeOfCompactSize(TAPROOT_CONTROL_MAX_SIZE) + TAPROOT_CONTROL_MAX_SIZE};\n+\n+uint32_t MaxScriptSize(MiniscriptContext ms_ctx)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27255#discussion_r1349601189",
      "id" : 1349601189,
      "in_reply_to_id" : 1349548144,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585QcUel",
      "original_commit_id" : "f3ad6144d2b51c26868c2bf2f1bac6f749b04154",
      "original_line" : 37,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/script/miniscript.cpp",
      "position" : null,
      "pull_request_review_id" : 1663137338,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27255",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601189/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-10-08T00:17:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1349601189",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/22457751?v=4",
         "events_url" : "https://api.github.com/users/darosior/events{/privacy}",
         "followers_url" : "https://api.github.com/users/darosior/followers",
         "following_url" : "https://api.github.com/users/darosior/following{/other_user}",
         "gists_url" : "https://api.github.com/users/darosior/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/darosior",
         "id" : 22457751,
         "login" : "darosior",
         "node_id" : "MDQ6VXNlcjIyNDU3NzUx",
         "organizations_url" : "https://api.github.com/users/darosior/orgs",
         "received_events_url" : "https://api.github.com/users/darosior/received_events",
         "repos_url" : "https://api.github.com/users/darosior/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/darosior/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/darosior/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/darosior"
      }
   }
]
