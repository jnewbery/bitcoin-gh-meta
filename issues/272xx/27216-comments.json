[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [jarolrod](https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1621182702) |\n| Stale ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/27216#pullrequestreview-1494051688) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28528](https://github.com/bitcoin/bitcoin/pull/28528) (test: Use test framework utils in functional tests by osagie98)\n* [#28454](https://github.com/bitcoin/bitcoin/pull/28454) (wallet: allowing walletpassphrase timeout to be MAX_SLEEP_TIME if set to -1 by kevkevinpal)\n* [#28403](https://github.com/bitcoin/bitcoin/pull/28403) (test: Bump walletpassphrase timeouts to avoid intermittent issues by MarcoFalke)\n* [#28333](https://github.com/bitcoin/bitcoin/pull/28333) (wallet: Construct ScriptPubKeyMans with all data rather than loaded progressively by achow101)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-03-06T21:37:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1457038403",
      "id" : 1457038403,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585W2KRD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1457038403/reactions"
      },
      "updated_at" : "2023-09-25T07:44:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1457038403",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1127978416"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127978416"
         }
      },
      "author_association" : "MEMBER",
      "body" : "https://cirrus-ci.com/task/6502838134636544:\r\n```bash\r\nwallet/test/scriptpubkeyman_tests.cpp:142:48: error: argument name 'index' in comment does not match parameter name 'pos' [bugprone-argument-comment,-warnings-as-errors]\r\n        descriptor.descriptor->ExpandFromCache(/*index=*/10, descriptor.cache, scripts3, provider);\r\n                                               ^\r\n./script/descriptor.h:137:38: note: 'pos' declared here\r\n    virtual bool ExpandFromCache(int pos, const DescriptorCache& read_cache, std::vector<CScript>& output_scripts, FlatSigningProvider& out) const = 0;\r\n```",
      "commit_id" : "63f1d1e56a7a90160c9610a68b990ff27d3dc451",
      "created_at" : "2023-03-07T14:45:05Z",
      "diff_hunk" : "@@ -39,5 +40,146 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_isKeyInPool)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 1000 external keys\n+    // (HD wallet change addresses are not pre-generated)\n+    spkm.TopUp();\n+\n+    // 2000 Scripts (P2PK and P2PKH): DEFAULT_KEYPOOL_SIZE * 2\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 2000);\n+\n+    // All 1000 keys are in keypool\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm.IsKeyInKeypool(script));\n+    }\n+\n+    // Requesting single key from spkm should remove that key from pool\n+    auto dest1 = spkm.GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(!spkm.IsKeyInKeypool(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 2000);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm.cs_KeyStore);\n+        spkm.MarkReserveKeysAsUsed(10);\n+    }\n+\n+    // Key pool size did not change\n+    auto scripts3 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts3.size() == 2000);\n+\n+    // All keys up to and including that key are removed from pool\n+    int num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts3) {\n+        if (!spkm.IsKeyInKeypool(script))\n+            num_script_keys_not_found++;\n+    }\n+    BOOST_CHECK(num_script_keys_not_found == 20);\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from pool\n+    spkm.NewKeyPool(); // called by EncryptWallet()->SetupGeneration()\n+    num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts3) {\n+        if (!spkm.IsKeyInKeypool(script))\n+            num_script_keys_not_found++;\n+    }\n+    BOOST_CHECK(num_script_keys_not_found == 2000);\n+\n+    // 1000 new keys were added\n+    auto scripts4 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 4000);\n+}\n+\n+BOOST_AUTO_TEST_CASE(Descriptor_isKeyInPool)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+    DescriptorScriptPubKeyMan* spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(wallet.GetScriptPubKeyMan(OutputType::BECH32, /*internal=*/false));\n+\n+    // Start off with 1000 pre-generated keys, 1 script each\n+    auto scripts1 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 1000);\n+\n+    // All 1000 keys are in keypool\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm->IsKeyInKeypool(script));\n+    }\n+\n+    // Requesting single key from spkm should remove that key from pool\n+    auto dest1 = spkm->GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(!spkm->IsKeyInKeypool(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 1000);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm->cs_desc_man);\n+        WalletDescriptor descriptor = spkm->GetWalletDescriptor();\n+        FlatSigningProvider provider;\n+        std::vector<CScript> scripts3;\n+        descriptor.descriptor->ExpandFromCache(/*index=*/10, descriptor.cache, scripts3, provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1127978416",
      "id" : 1127978416,
      "line" : 142,
      "node_id" : "PRRC_kwDOABII585DO5Ww",
      "original_commit_id" : "63f1d1e56a7a90160c9610a68b990ff27d3dc451",
      "original_line" : 142,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 111,
      "pull_request_review_id" : 1328671625,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127978416/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T14:45:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1127978416",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "https://github.com/bitcoin/bitcoin/pull/27216/checks?check_run_id=11804958852\r\n```bash\r\nAssertion failed: lock cs_wallet not held in ./wallet/wallet.h:444; locks held:\r\n'cs_KeyStore' in wallet/scriptpubkeyman.cpp:1185 (in thread 'test')\r\n```",
      "created_at" : "2023-03-07T14:46:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1458300719",
      "id" : 1458300719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585W6-cv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458300719/reactions"
      },
      "updated_at" : "2023-03-07T14:46:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1458300719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1128006272"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128006272"
         }
      },
      "author_association" : "MEMBER",
      "body" : "oooh thanks, didn't realize those comments were parsed by anything!",
      "commit_id" : "63f1d1e56a7a90160c9610a68b990ff27d3dc451",
      "created_at" : "2023-03-07T15:01:49Z",
      "diff_hunk" : "@@ -39,5 +40,146 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_isKeyInPool)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 1000 external keys\n+    // (HD wallet change addresses are not pre-generated)\n+    spkm.TopUp();\n+\n+    // 2000 Scripts (P2PK and P2PKH): DEFAULT_KEYPOOL_SIZE * 2\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 2000);\n+\n+    // All 1000 keys are in keypool\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm.IsKeyInKeypool(script));\n+    }\n+\n+    // Requesting single key from spkm should remove that key from pool\n+    auto dest1 = spkm.GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(!spkm.IsKeyInKeypool(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 2000);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm.cs_KeyStore);\n+        spkm.MarkReserveKeysAsUsed(10);\n+    }\n+\n+    // Key pool size did not change\n+    auto scripts3 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts3.size() == 2000);\n+\n+    // All keys up to and including that key are removed from pool\n+    int num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts3) {\n+        if (!spkm.IsKeyInKeypool(script))\n+            num_script_keys_not_found++;\n+    }\n+    BOOST_CHECK(num_script_keys_not_found == 20);\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from pool\n+    spkm.NewKeyPool(); // called by EncryptWallet()->SetupGeneration()\n+    num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts3) {\n+        if (!spkm.IsKeyInKeypool(script))\n+            num_script_keys_not_found++;\n+    }\n+    BOOST_CHECK(num_script_keys_not_found == 2000);\n+\n+    // 1000 new keys were added\n+    auto scripts4 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 4000);\n+}\n+\n+BOOST_AUTO_TEST_CASE(Descriptor_isKeyInPool)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+    DescriptorScriptPubKeyMan* spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(wallet.GetScriptPubKeyMan(OutputType::BECH32, /*internal=*/false));\n+\n+    // Start off with 1000 pre-generated keys, 1 script each\n+    auto scripts1 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 1000);\n+\n+    // All 1000 keys are in keypool\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm->IsKeyInKeypool(script));\n+    }\n+\n+    // Requesting single key from spkm should remove that key from pool\n+    auto dest1 = spkm->GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(!spkm->IsKeyInKeypool(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 1000);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm->cs_desc_man);\n+        WalletDescriptor descriptor = spkm->GetWalletDescriptor();\n+        FlatSigningProvider provider;\n+        std::vector<CScript> scripts3;\n+        descriptor.descriptor->ExpandFromCache(/*index=*/10, descriptor.cache, scripts3, provider);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1128006272",
      "id" : 1128006272,
      "in_reply_to_id" : 1127978416,
      "line" : 142,
      "node_id" : "PRRC_kwDOABII585DPAKA",
      "original_commit_id" : "63f1d1e56a7a90160c9610a68b990ff27d3dc451",
      "original_line" : 142,
      "original_position" : 111,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 111,
      "pull_request_review_id" : 1328722903,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128006272/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "updated_at" : "2023-03-07T15:01:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1128006272",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased on master and addressed some nits from follow-up PR https://github.com/bitcoin-core/gui/pull/723",
      "created_at" : "2023-04-05T16:01:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1497746671",
      "id" : 1497746671,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585ZRczv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497746671/reactions"
      },
      "updated_at" : "2023-04-05T16:01:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1497746671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1159068107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159068107"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "45d565073cab12b6107aae9d08048 nit, remove unnecessary local object while still keeping code readability.\r\n\r\n(Also if we're not sure the element exists or its absence would be a logic error, maybe `s/keys[0]/keys.at(0)` to have bounds checks, as accessing a nonexistent element with `vector#operator[]` is UB).\r\n\r\n```diff\r\n-        CKeyID id = keys[0].GetID();\r\n-        out.pubkeys.emplace(id, keys[0]);\r\n+        out.pubkeys.emplace(/*CKeyID=*/keys[0].GetID(), /*CPubKey=*/keys[0]);\r\n```\r\n",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-05T22:02:48Z",
      "diff_hunk" : "@@ -730,8 +730,11 @@ class PKDescriptor final : public DescriptorImpl\n private:\n     const bool m_xonly;\n protected:\n-    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider&) const override\n+    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider& out) const override\n     {\n+        CKeyID id = keys[0].GetID();\n+        out.pubkeys.emplace(id, keys[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1159068107",
      "id" : 1159068107,
      "line" : 736,
      "node_id" : "PRRC_kwDOABII585FFfnL",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 736,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 8,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159068107/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159068107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160257900"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160257900"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/45d565073cab12b6107aae9d08048d5310d752d4 If they are thread-safe, should the `IsKeyActive` member functions be `const`?\r\n\r\n<details><summary>diff</summary><p>\r\n\r\n```diff\r\ndiff --git a/src/wallet/scriptpubkeyman.cpp b/src/wallet/scriptpubkeyman.cpp\r\nindex 9afd2538b0c..87ab7cc034b 100644\r\n--- a/src/wallet/scriptpubkeyman.cpp\r\n+++ b/src/wallet/scriptpubkeyman.cpp\r\n \r\n-bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script)\r\n+bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script) const\r\n@@ -2228,7 +2226,7 @@ std::vector<WalletDestination> DescriptorScriptPubKeyMan::MarkUnusedAddresses(co\r\n \r\n-bool DescriptorScriptPubKeyMan::IsKeyActive(const CScript& script)\r\n+bool DescriptorScriptPubKeyMan::IsKeyActive(const CScript& script) const\r\n\r\ndiff --git a/src/wallet/scriptpubkeyman.h b/src/wallet/scriptpubkeyman.h\r\nindex 4b2a6c5b177..aeef722d31f 100644\r\n--- a/src/wallet/scriptpubkeyman.h\r\n+++ b/src/wallet/scriptpubkeyman.h\r\n     /* Determines if address is derived from active key manager */\r\n-    virtual bool IsKeyActive(const CScript& script) { return false; };\r\n+    virtual bool IsKeyActive(const CScript& script) const { return false; };\r\n \r\n@@ -385,7 +385,7 @@ public:\r\n \r\n-    bool IsKeyActive(const CScript& script) override;\r\n+    bool IsKeyActive(const CScript& script) const override;\r\n \r\n@@ -612,7 +612,7 @@ public:\r\n \r\n-    bool IsKeyActive(const CScript& script) override;\r\n+    bool IsKeyActive(const CScript& script) const override;\r\n```\r\n</p></details>\r\n",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T21:04:35Z",
      "diff_hunk" : "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n      */\n     virtual std::vector<WalletDestination> MarkUnusedAddresses(const CScript& script) { return {}; }\n \n+    /* Determines if address is derived from active key manager */\n+    virtual bool IsKeyActive(const CScript& script) { return false; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160257900",
      "id" : 1160257900,
      "line" : 202,
      "node_id" : "PRRC_kwDOABII585FKCFs",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 202,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 5,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160257900/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160257900",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160261941"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160261941"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/45d565073cab12b6107aae9d08048d5310d752d4\r\n\r\n- add missing conditional brackets (see developer notes)\r\n- avoid unneeded `const CKeyMetadata& meta` overhead in the loop, or...\r\n\r\n```diff\r\n     LOCK(cs_KeyStore);\r\n-\r\n-    // Not in the keystore at all\r\n-    if (!IsMine(script)) return false;\r\n+    if (!IsMine(script)) return false; // not in the keystore at all\r\n \r\n     for (const auto& key_id : GetAffectedKeys(script, *this)) {\r\n-        auto it = mapKeyMetadata.find(key_id);\r\n+        const auto it{mapKeyMetadata.find(key_id)};\r\n         if (it == mapKeyMetadata.end()) {\r\n             // This key must be really old\r\n             return false;\r\n         }\r\n-        const CKeyMetadata& meta = it->second;\r\n-        if (m_hd_chain.seed_id == meta.hd_seed_id)\r\n+        if (m_hd_chain.seed_id == it->second.hd_seed_id) {\r\n             return true;\r\n+        }\r\n     }\r\n```\r\n\r\n...or alternately, do we need a null check here?\r\n\r\n```diff\r\n         const CKeyMetadata& meta = it->second;\r\n-        if (m_hd_chain.seed_id == meta.hd_seed_id)\r\n+        if (!meta.hd_seed_id.IsNull() && meta.hd_seed_id == m_hd_chain.seed_id) {\r\n```\r\n",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T21:10:54Z",
      "diff_hunk" : "@@ -392,6 +392,28 @@ std::vector<WalletDestination> LegacyScriptPubKeyMan::MarkUnusedAddresses(const\n     return result;\n }\n \n+bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script)\n+{\n+    LOCK(cs_KeyStore);\n+\n+    // Not in the keystore at all\n+    if (!IsMine(script)) return false;\n+\n+    for (const auto& key_id : GetAffectedKeys(script, *this)) {\n+        auto it = mapKeyMetadata.find(key_id);\n+        if (it == mapKeyMetadata.end()) {\n+            // This key must be really old\n+            return false;\n+        }\n+        const CKeyMetadata& meta = it->second;\n+        if (m_hd_chain.seed_id == meta.hd_seed_id)\n+            return true;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160261941",
      "id" : 1160261941,
      "line" : 411,
      "node_id" : "PRRC_kwDOABII585FKDE1",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 411,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 20,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160261941/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160261941",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160272170"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160272170"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "81f29f03a607cbfb7162705 I'm not sure if or when legacy wallet support is expected to be phased out, but if isactive is only different from ismine in legacy wallets, is it worth adding a field (and all the new methods), versus just updating the ismine field documentation in the help for descriptor wallets? (When I'm double-checking an address with getaddressinfo before using it to receive, ismine is a field I'm already checking.)\r\n\r\nOtherwise, it might be handy for cli users to order isactive just after ismine, and in general group the \"is\" type of fields together in the RPC help and output, i.e. an order along the lines of ismine, isactive, iswatchonly, iswitness, isscript.",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T21:27:06Z",
      "diff_hunk" : "@@ -602,6 +603,7 @@ RPCHelpMan getaddressinfo()\n     ret.pushKVs(detail);\n \n     ret.pushKV(\"ischange\", ScriptIsChange(*pwallet, scriptPubKey));\n+    ret.pushKV(\"isactive\", pwallet->IsDestinationActive(dest));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160272170",
      "id" : 1160272170,
      "line" : 606,
      "node_id" : "PRRC_kwDOABII585FKFkq",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 606,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : 14,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160272170/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:24:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160272170",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160291829"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160291829"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "in general can use `BOOST_CHECK_EQUAL` for equality checks, if you prefer\r\n```suggestion\r\n    BOOST_CHECK_EQUAL(scripts1.size(), 84);\r\n```",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T22:01:28Z",
      "diff_hunk" : "@@ -39,5 +40,159 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetMinVersion(FEATURE_LATEST);\n+        wallet.m_keypool_size = 10;\n+    }\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 20 keypool keys (10 internal, 10 external)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        spkm.SetupGeneration();\n+    }\n+\n+    // 4 scripts per keypool key (P2PK, P2PKH, P2WPKH, P2SH-P2WPKH)\n+    // Plus 4 scripts for the seed key\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 84);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160291829",
      "id" : 1160291829,
      "line" : 65,
      "node_id" : "PRRC_kwDOABII585FKKX1",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 65,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 34,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160291829/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160291829",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160298313"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160298313"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "81f29f03a607cbfb7162705 conditional brackets and prefix increment operator per developer notes, drop unneeded localvar\r\n\r\n```diff\r\n-        WitnessV0ScriptHash scripthash(script);\r\n-        if (!wallet.IsDestinationActive(scripthash))\r\n-            num_script_keys_not_found++;\r\n+        if (!wallet.IsDestinationActive(WitnessV0ScriptHash(script))) {\r\n+            ++num_script_keys_not_found;\r\n+        }\r\n```\r\n",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T22:13:19Z",
      "diff_hunk" : "@@ -39,5 +40,159 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetMinVersion(FEATURE_LATEST);\n+        wallet.m_keypool_size = 10;\n+    }\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 20 keypool keys (10 internal, 10 external)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        spkm.SetupGeneration();\n+    }\n+\n+    // 4 scripts per keypool key (P2PK, P2PKH, P2WPKH, P2SH-P2WPKH)\n+    // Plus 4 scripts for the seed key\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 84);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // Requesting single from spkm should not deactivate key\n+    CTxDestination dest1;\n+    {\n+        LOCK(wallet.cs_wallet);\n+        auto result = spkm.GetNewDestination(OutputType::BECH32);\n+        dest1 = result.value();\n+    }\n+    CScript script = GetScriptForDestination(dest1);\n+    BOOST_CHECK(spkm.IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 84);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        LOCK(spkm.cs_KeyStore);\n+        auto keys = spkm.MarkReserveKeysAsUsed(5);\n+        BOOST_CHECK(keys.size() == 4); // Because we already used one with GetNewDestination\n+    }\n+\n+    // Key pool size did not change\n+    auto scripts3 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts3.size() == 84);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        spkm.SetupGeneration(true);\n+    }\n+\n+    // 20 new keys were added\n+    auto scripts4 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 84 * 2);\n+\n+    // All 10 original keys are now inactive\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(!spkm.IsKeyActive(script));\n+    }\n+}\n+\n+BOOST_AUTO_TEST_CASE(Descriptor_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.LoadMinVersion(FEATURE_LATEST);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.m_keypool_size = 10;\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+    DescriptorScriptPubKeyMan* spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(wallet.GetScriptPubKeyMan(OutputType::BECH32, /*internal=*/false));\n+\n+    // Start off with 10 pre-generated keys, 1 script each\n+    auto scripts1 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 10);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // Requesting single key from spkm should not deactivate key\n+    auto dest1 = spkm->GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(spkm->IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 10);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm->cs_desc_man);\n+        WalletDescriptor descriptor = spkm->GetWalletDescriptor();\n+        FlatSigningProvider provider;\n+        std::vector<CScript> scripts3;\n+        descriptor.descriptor->ExpandFromCache(/*pos=*/5, descriptor.cache, scripts3, provider);\n+\n+        BOOST_CHECK(scripts3.size() == 1);\n+        spkm->MarkUnusedAddresses(scripts3.front());\n+    }\n+\n+    // Key pool size increased to replace used keys\n+    auto scripts4 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 16);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+\n+    // This SPKM is not affected\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // ...but at the wallet level all the keys from that SPKM are deactivated\n+    int num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts4) {\n+        WitnessV0ScriptHash scripthash(script);\n+        if (!wallet.IsDestinationActive(scripthash))\n+            num_script_keys_not_found++;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160298313",
      "id" : 1160298313,
      "line" : 193,
      "node_id" : "PRRC_kwDOABII585FKL9J",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 193,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 162,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160298313/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160298313",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160313284"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160313284"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/81f29f03a607cbfb7162705c1c1618ca7b59640e \r\n\r\n- avoid copy\r\n\r\n```suggestion\r\n    const CScript& script{GetScriptForDestination(dest)};\r\n```\r\n\r\n- remove extra newline, and another implementation for the fun of it\r\n\r\n```diff\r\n bool CWallet::IsDestinationActive(const CTxDestination& dest) const\r\n {\r\n-    CScript script = GetScriptForDestination(dest);\r\n-    for (const auto& spk_man : GetActiveScriptPubKeyMans()) {\r\n-        if (spk_man->IsKeyActive(script)) return true;\r\n-    }\r\n-    return false;\r\n+    const CScript& script{GetScriptForDestination(dest)};\r\n+    const std::set<ScriptPubKeyMan*>& spkms{GetActiveScriptPubKeyMans()};\r\n+    return std::any_of(spkms.cbegin(), spkms.cend(), [&script](const auto& spkm) { return spkm->IsKeyActive(script); });\r\n }\r\n-\r\n\r\n```\r\n",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T22:41:50Z",
      "diff_hunk" : "@@ -2557,6 +2557,16 @@ void CWallet::ForEachAddrBookEntry(const ListAddrBookFunc& func) const\n     }\n }\n \n+bool CWallet::IsDestinationActive(const CTxDestination& dest) const\n+{\n+    CScript script = GetScriptForDestination(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160313284",
      "id" : 1160313284,
      "line" : 2562,
      "node_id" : "PRRC_kwDOABII585FKPnE",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 2562,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : 6,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160313284/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160313284",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160327631"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160327631"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "https://github.com/bitcoin/bitcoin/commit/81f29f03a607cbfb7162705c1c1618ca7b59640e style nit, either omit the `== False` and the 3 `== True` above, or use `assert_equal`",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T23:16:11Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\n+\n+        addr0 = addrs[0]\n+        addr9 = addrs[9] # arbitrary future address index\n+\n+        # Address is active before it is removed from keypool by getnewaddress\n+        addr0_before_getting_data = nodes[0].getaddressinfo(addr0)\n+        assert addr0_before_getting_data['isactive'] == True\n+\n         addr_before_encrypting = nodes[0].getnewaddress()\n         addr_before_encrypting_data = nodes[0].getaddressinfo(addr_before_encrypting)\n+        assert addr0 == addr_before_encrypting\n+        # Address is still active even after being removed from keypool\n+        assert addr_before_encrypting_data['isactive'] == True\n+\n         wallet_info_old = nodes[0].getwalletinfo()\n         if not self.options.descriptors:\n             assert addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid']\n \n+        # Address is active before wallet is encrypted (resetting keypool)\n+        addr9_before_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        assert addr9_before_encrypting_data['isactive'] == True\n+\n+        # Imported things are never considered active, no need to rescan\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"addr(bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", False)\n+        import_addr_data = nodes[0].getaddressinfo(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\")\n+        assert not import_addr_data[\"ismine\"]\n+        assert import_addr_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_addr_data[\"isactive\"]\n+\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"pk(02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importpubkey(\"02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e\", \"label\", False)\n+        import_pub_data = nodes[0].getaddressinfo(\"bcrt1q4v7a8wn5vqd6fk4026s5gzzxyu7cfzz23n576h\")\n+        assert not import_pub_data[\"ismine\"]\n+        assert import_pub_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_pub_data[\"isactive\"]\n+\n+        nodes[0].importprivkey(\"cPMX7v5CNV1zCphFSq2hnR5rCjzAhA1GsBfD1qrJGdj4QEfu38Qx\", \"label\", False)\n+        import_priv_data = nodes[0].getaddressinfo(\"bcrt1qa985v5d53qqtrfujmzq2zrw3r40j6zz4ns02kj\")\n+        assert import_priv_data[\"ismine\"]\n+        assert not import_priv_data[\"iswatchonly\"]\n+        assert not import_priv_data[\"isactive\"]\n+\n         # Encrypt wallet and wait to terminate\n         nodes[0].encryptwallet('test')\n+        addr9_after_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        # Key is from unencrypted seed, no longer considered active\n+        assert addr9_after_encrypting_data['isactive'] == False",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160327631",
      "id" : 1160327631,
      "line" : 106,
      "node_id" : "PRRC_kwDOABII585FKTHP",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 106,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : 103,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160327631/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160327631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160329162"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160329162"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Might be good to explain this \"or will be\" change.",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-06T23:20:18Z",
      "diff_hunk" : "@@ -506,7 +506,8 @@ RPCHelpMan getaddressinfo()\n                         {RPCResult::Type::STR, \"desc\", /*optional=*/true, \"A descriptor for spending coins sent to this address (only when solvable).\"},\n                         {RPCResult::Type::STR, \"parent_desc\", /*optional=*/true, \"The descriptor used to derive this address if this is a descriptor wallet\"},\n                         {RPCResult::Type::BOOL, \"isscript\", \"If the key is a script.\"},\n-                        {RPCResult::Type::BOOL, \"ischange\", \"If the address was used for change output.\"},\n+                        {RPCResult::Type::BOOL, \"ischange\", \"If the address was or will be used for change output.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160329162",
      "id" : 1160329162,
      "line" : 509,
      "node_id" : "PRRC_kwDOABII585FKTfK",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 509,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : 5,
      "pull_request_review_id" : 1373758349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160329162/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-06T23:23:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1160329162",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161121018"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161121018"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The style here matches the neighboring descriptors but I see your point about using `.at(0)` -- do you think all the `descriptor::MakeScripts()` should be cleaned up like this?\r\n\r\nAlso this chunk is the patch alluded to in the comment\r\n> This PR also patches PKDescriptor from https://github.com/bitcoin/bitcoin/pull/22051 where matching public keys were not returned.\r\n\r\nWhen we expand a bare pubkey descriptor we weren't populating `out.pubkeys` and so `GetAffectedKeys()` wouldn't return anything",
      "commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "created_at" : "2023-04-08T14:48:38Z",
      "diff_hunk" : "@@ -730,8 +730,11 @@ class PKDescriptor final : public DescriptorImpl\n private:\n     const bool m_xonly;\n protected:\n-    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider&) const override\n+    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider& out) const override\n     {\n+        CKeyID id = keys[0].GetID();\n+        out.pubkeys.emplace(id, keys[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161121018",
      "id" : 1161121018,
      "in_reply_to_id" : 1159068107,
      "line" : 736,
      "node_id" : "PRRC_kwDOABII585FNUz6",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 736,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 8,
      "pull_request_review_id" : 1376771630,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161121018/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T14:48:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161121018",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130735"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130735"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks will add this -- also I think these could be `[[nodiscard]]` as well? But I don't see that for any of the other `bool Is...()` members in SPKM...",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:13Z",
      "diff_hunk" : "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n      */\n     virtual std::vector<WalletDestination> MarkUnusedAddresses(const CScript& script) { return {}; }\n \n+    /* Determines if address is derived from active key manager */\n+    virtual bool IsKeyActive(const CScript& script) { return false; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130735",
      "id" : 1161130735,
      "in_reply_to_id" : 1160257900,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXLv",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 202,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 1376780649,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130735/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130735",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130743"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, updating.",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:17Z",
      "diff_hunk" : "@@ -392,6 +392,28 @@ std::vector<WalletDestination> LegacyScriptPubKeyMan::MarkUnusedAddresses(const\n     return result;\n }\n \n+bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script)\n+{\n+    LOCK(cs_KeyStore);\n+\n+    // Not in the keystore at all\n+    if (!IsMine(script)) return false;\n+\n+    for (const auto& key_id : GetAffectedKeys(script, *this)) {\n+        auto it = mapKeyMetadata.find(key_id);\n+        if (it == mapKeyMetadata.end()) {\n+            // This key must be really old\n+            return false;\n+        }\n+        const CKeyMetadata& meta = it->second;\n+        if (m_hd_chain.seed_id == meta.hd_seed_id)\n+            return true;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130743",
      "id" : 1161130743,
      "in_reply_to_id" : 1160261941,
      "line" : 406,
      "node_id" : "PRRC_kwDOABII585FNXL3",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 406,
      "original_position" : 20,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : 15,
      "pull_request_review_id" : 1376780656,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130747"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok, moving `isactive` next to `ismine`. You have a good point about legacy wallet deprecation. I suppose when that happens most of this new code will be deprecated as well since its mainly implemented only in `LegacyScriptPubKeyMan`. Would it make sense to only add the field to RPC response in legacy wallets?",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:19Z",
      "diff_hunk" : "@@ -602,6 +603,7 @@ RPCHelpMan getaddressinfo()\n     ret.pushKVs(detail);\n \n     ret.pushKV(\"ischange\", ScriptIsChange(*pwallet, scriptPubKey));\n+    ret.pushKV(\"isactive\", pwallet->IsDestinationActive(dest));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130747",
      "id" : 1161130747,
      "in_reply_to_id" : 1160272170,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXL7",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 606,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : null,
      "pull_request_review_id" : 1376780661,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130750"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130750"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks, I do prefer!",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:21Z",
      "diff_hunk" : "@@ -39,5 +40,159 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetMinVersion(FEATURE_LATEST);\n+        wallet.m_keypool_size = 10;\n+    }\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 20 keypool keys (10 internal, 10 external)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        spkm.SetupGeneration();\n+    }\n+\n+    // 4 scripts per keypool key (P2PK, P2PKH, P2WPKH, P2SH-P2WPKH)\n+    // Plus 4 scripts for the seed key\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 84);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130750",
      "id" : 1161130750,
      "in_reply_to_id" : 1160291829,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXL-",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 65,
      "original_position" : 34,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1376780665,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130750/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "thanks got it",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:24Z",
      "diff_hunk" : "@@ -39,5 +40,159 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetMinVersion(FEATURE_LATEST);\n+        wallet.m_keypool_size = 10;\n+    }\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 20 keypool keys (10 internal, 10 external)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        spkm.SetupGeneration();\n+    }\n+\n+    // 4 scripts per keypool key (P2PK, P2PKH, P2WPKH, P2SH-P2WPKH)\n+    // Plus 4 scripts for the seed key\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 84);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // Requesting single from spkm should not deactivate key\n+    CTxDestination dest1;\n+    {\n+        LOCK(wallet.cs_wallet);\n+        auto result = spkm.GetNewDestination(OutputType::BECH32);\n+        dest1 = result.value();\n+    }\n+    CScript script = GetScriptForDestination(dest1);\n+    BOOST_CHECK(spkm.IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 84);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        LOCK(spkm.cs_KeyStore);\n+        auto keys = spkm.MarkReserveKeysAsUsed(5);\n+        BOOST_CHECK(keys.size() == 4); // Because we already used one with GetNewDestination\n+    }\n+\n+    // Key pool size did not change\n+    auto scripts3 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts3.size() == 84);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        spkm.SetupGeneration(true);\n+    }\n+\n+    // 20 new keys were added\n+    auto scripts4 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 84 * 2);\n+\n+    // All 10 original keys are now inactive\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(!spkm.IsKeyActive(script));\n+    }\n+}\n+\n+BOOST_AUTO_TEST_CASE(Descriptor_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.LoadMinVersion(FEATURE_LATEST);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.m_keypool_size = 10;\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+    DescriptorScriptPubKeyMan* spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(wallet.GetScriptPubKeyMan(OutputType::BECH32, /*internal=*/false));\n+\n+    // Start off with 10 pre-generated keys, 1 script each\n+    auto scripts1 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts1.size() == 10);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // Requesting single key from spkm should not deactivate key\n+    auto dest1 = spkm->GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(spkm->IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts2.size() == 10);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm->cs_desc_man);\n+        WalletDescriptor descriptor = spkm->GetWalletDescriptor();\n+        FlatSigningProvider provider;\n+        std::vector<CScript> scripts3;\n+        descriptor.descriptor->ExpandFromCache(/*pos=*/5, descriptor.cache, scripts3, provider);\n+\n+        BOOST_CHECK(scripts3.size() == 1);\n+        spkm->MarkUnusedAddresses(scripts3.front());\n+    }\n+\n+    // Key pool size increased to replace used keys\n+    auto scripts4 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK(scripts4.size() == 16);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+\n+    // This SPKM is not affected\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // ...but at the wallet level all the keys from that SPKM are deactivated\n+    int num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts4) {\n+        WitnessV0ScriptHash scripthash(script);\n+        if (!wallet.IsDestinationActive(scripthash))\n+            num_script_keys_not_found++;\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130751",
      "id" : 1161130751,
      "in_reply_to_id" : 1160298313,
      "line" : 192,
      "node_id" : "PRRC_kwDOABII585FNXL_",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 192,
      "original_position" : 162,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 154,
      "pull_request_review_id" : 1376780667,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130754"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130754"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah really cool with `any_of` thanks",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:27Z",
      "diff_hunk" : "@@ -2557,6 +2557,16 @@ void CWallet::ForEachAddrBookEntry(const ListAddrBookFunc& func) const\n     }\n }\n \n+bool CWallet::IsDestinationActive(const CTxDestination& dest) const\n+{\n+    CScript script = GetScriptForDestination(dest);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130754",
      "id" : 1161130754,
      "in_reply_to_id" : 1160313284,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXMC",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 2562,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.cpp",
      "position" : null,
      "pull_request_review_id" : 1376780670,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130754/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130754",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130756"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130756"
         }
      },
      "author_association" : "MEMBER",
      "body" : "okay yes",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:30Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\n+\n+        addr0 = addrs[0]\n+        addr9 = addrs[9] # arbitrary future address index\n+\n+        # Address is active before it is removed from keypool by getnewaddress\n+        addr0_before_getting_data = nodes[0].getaddressinfo(addr0)\n+        assert addr0_before_getting_data['isactive'] == True\n+\n         addr_before_encrypting = nodes[0].getnewaddress()\n         addr_before_encrypting_data = nodes[0].getaddressinfo(addr_before_encrypting)\n+        assert addr0 == addr_before_encrypting\n+        # Address is still active even after being removed from keypool\n+        assert addr_before_encrypting_data['isactive'] == True\n+\n         wallet_info_old = nodes[0].getwalletinfo()\n         if not self.options.descriptors:\n             assert addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid']\n \n+        # Address is active before wallet is encrypted (resetting keypool)\n+        addr9_before_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        assert addr9_before_encrypting_data['isactive'] == True\n+\n+        # Imported things are never considered active, no need to rescan\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"addr(bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", False)\n+        import_addr_data = nodes[0].getaddressinfo(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\")\n+        assert not import_addr_data[\"ismine\"]\n+        assert import_addr_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_addr_data[\"isactive\"]\n+\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"pk(02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importpubkey(\"02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e\", \"label\", False)\n+        import_pub_data = nodes[0].getaddressinfo(\"bcrt1q4v7a8wn5vqd6fk4026s5gzzxyu7cfzz23n576h\")\n+        assert not import_pub_data[\"ismine\"]\n+        assert import_pub_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_pub_data[\"isactive\"]\n+\n+        nodes[0].importprivkey(\"cPMX7v5CNV1zCphFSq2hnR5rCjzAhA1GsBfD1qrJGdj4QEfu38Qx\", \"label\", False)\n+        import_priv_data = nodes[0].getaddressinfo(\"bcrt1qa985v5d53qqtrfujmzq2zrw3r40j6zz4ns02kj\")\n+        assert import_priv_data[\"ismine\"]\n+        assert not import_priv_data[\"iswatchonly\"]\n+        assert not import_priv_data[\"isactive\"]\n+\n         # Encrypt wallet and wait to terminate\n         nodes[0].encryptwallet('test')\n+        addr9_after_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        # Key is from unencrypted seed, no longer considered active\n+        assert addr9_after_encrypting_data['isactive'] == False",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130756",
      "id" : 1161130756,
      "in_reply_to_id" : 1160327631,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXME",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 106,
      "original_position" : 103,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : null,
      "pull_request_review_id" : 1376780680,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130756/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130756",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130759"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130759"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ok?\r\n\r\n> \"If the address is reserved for use as a change output. It may or may not have already been used as change.\"",
      "commit_id" : "05959e5bd579fc66f5bf81ce6e51d9089062475d",
      "created_at" : "2023-04-08T16:23:34Z",
      "diff_hunk" : "@@ -506,7 +506,8 @@ RPCHelpMan getaddressinfo()\n                         {RPCResult::Type::STR, \"desc\", /*optional=*/true, \"A descriptor for spending coins sent to this address (only when solvable).\"},\n                         {RPCResult::Type::STR, \"parent_desc\", /*optional=*/true, \"The descriptor used to derive this address if this is a descriptor wallet\"},\n                         {RPCResult::Type::BOOL, \"isscript\", \"If the key is a script.\"},\n-                        {RPCResult::Type::BOOL, \"ischange\", \"If the address was used for change output.\"},\n+                        {RPCResult::Type::BOOL, \"ischange\", \"If the address was or will be used for change output.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1161130759",
      "id" : 1161130759,
      "in_reply_to_id" : 1160329162,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FNXMH",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 509,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : null,
      "pull_request_review_id" : 1376780686,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130759/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-08T16:23:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161130759",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@jonatack thanks so much for the great review, addressed comments (1 or 2 questions along the way) rebase on master and also rebased the GUI follow up ",
      "created_at" : "2023-04-08T16:30:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1500927311",
      "id" : 1500927311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585ZdlVP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500927311/reactions"
      },
      "updated_at" : "2023-04-08T16:30:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500927311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebase to: 58fba35e25c2b9dcdd5b3dd0aa8f412801a98146\r\n- added `nodiscard`\r\n- cleaned up help message in `getaddressinfo`\r\n- added release note file",
      "created_at" : "2023-04-13T15:14:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1507152541",
      "id" : 1507152541,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585Z1VKd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507152541/reactions"
      },
      "updated_at" : "2023-04-13T15:14:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507152541",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165902595"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165902595"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Per `doc/release-notes-empty-template.md` would suggest\r\n\r\n```\r\nUpdated RPCs\r\n------------\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T18:42:18Z",
      "diff_hunk" : "@@ -0,0 +1,5 @@\n+RPC",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165902595",
      "id" : 1165902595,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FfkMD",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "doc/release-notes/release-notes-27216.md",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165902595/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165902595",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165903530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165903530"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\naddress is derived from an active descriptor or HD seed. (#27216)\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T18:43:29Z",
      "diff_hunk" : "@@ -0,0 +1,5 @@\n+RPC\n+---\n+\n+- `getaddressinfo` returns new boolean field `\"isactive\"` which is `true` if the\n+address is derived from an active descriptor or HD seed.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165903530",
      "id" : 1165903530,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Ffkaq",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 5,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "doc/release-notes/release-notes-27216.md",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165903530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165903530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165908531"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165908531"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "- Suggestion\r\n\r\n```suggestion\r\n- RPC `getaddressinfo` now returns a new boolean field `\"isactive\"`, which is `true` if the\r\n```\r\n\r\n- For the release note (and/or in the RPC help), it may be good to briefly explain *why* this field is added, i.e. maybe something roughly like: \"Keys become non-active if derived before the wallet was encrypted or imported using RPCs `importprivkey`, `importaddress`, or `importpubkey`. The new field is intended to help users avoid using such keys to receive new transactions, as they can be exposed or compromised.\"\r\n\r\n- A release note can take time to do well and is often a separate commit (up to you).",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T18:49:16Z",
      "diff_hunk" : "@@ -0,0 +1,5 @@\n+RPC\n+---\n+\n+- `getaddressinfo` returns new boolean field `\"isactive\"` which is `true` if the",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165908531",
      "id" : 1165908531,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Ffloz",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 4,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "doc/release-notes/release-notes-27216.md",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165908531/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:07:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165908531",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165915371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165915371"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Unsure, but seems like this doc change could be a separate commit if it is an unrelated fix/improvement.",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T18:56:32Z",
      "diff_hunk" : "@@ -501,12 +501,13 @@ RPCHelpMan getaddressinfo()\n                         {RPCResult::Type::STR, \"address\", \"The bitcoin address validated.\"},\n                         {RPCResult::Type::STR_HEX, \"scriptPubKey\", \"The hex-encoded scriptPubKey generated by the address.\"},\n                         {RPCResult::Type::BOOL, \"ismine\", \"If the address is yours.\"},\n+                        {RPCResult::Type::BOOL, \"isactive\", \"If the key is in the active keypool (always equal to \\\"ismine\\\" in descriptor wallets).\"},\n                         {RPCResult::Type::BOOL, \"iswatchonly\", \"If the address is watchonly.\"},\n                         {RPCResult::Type::BOOL, \"solvable\", \"If we know how to spend coins sent to this address, ignoring the possible lack of private keys.\"},\n                         {RPCResult::Type::STR, \"desc\", /*optional=*/true, \"A descriptor for spending coins sent to this address (only when solvable).\"},\n                         {RPCResult::Type::STR, \"parent_desc\", /*optional=*/true, \"The descriptor used to derive this address if this is a descriptor wallet\"},\n                         {RPCResult::Type::BOOL, \"isscript\", \"If the key is a script.\"},\n-                        {RPCResult::Type::BOOL, \"ischange\", \"If the address was used for change output.\"},\n+                        {RPCResult::Type::BOOL, \"ischange\", \"If the address is reserved for use as a change output. It may or may not have already been used as change.\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1165915371",
      "id" : 1165915371,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FfnTr",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 510,
      "original_position" : 11,
      "original_start_line" : null,
      "path" : "src/wallet/rpc/addresses.cpp",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165915371/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165915371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166088185"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166088185"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, prefer named args when multiple\r\n\r\n```diff\r\n-            addrs = nodes[0].deriveaddresses(desc, [0, 9])\r\n+            addrs = nodes[0].deriveaddresses(descriptor=desc, range=[0, 9])\r\n         else:\r\n             list_descriptors = nodes[0].listdescriptors()\r\n             for desc in list_descriptors[\"descriptors\"]:\r\n                 if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\r\n-                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\r\n+                    addrs = nodes[0].deriveaddresses(descriptor=desc[\"desc\"], range=[0, 9])\r\n```\r\n",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:31:22Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166088185",
      "id" : 1166088185,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgRf5",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 48,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166088185/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166088185",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166089491"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089491"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", rescan=False)\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:34:01Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\n+\n+        addr0 = addrs[0]\n+        addr9 = addrs[9] # arbitrary future address index\n+\n+        # Address is active before it is removed from keypool by getnewaddress\n+        addr0_before_getting_data = nodes[0].getaddressinfo(addr0)\n+        assert addr0_before_getting_data['isactive']\n+\n         addr_before_encrypting = nodes[0].getnewaddress()\n         addr_before_encrypting_data = nodes[0].getaddressinfo(addr_before_encrypting)\n+        assert addr0 == addr_before_encrypting\n+        # Address is still active even after being removed from keypool\n+        assert addr_before_encrypting_data['isactive']\n+\n         wallet_info_old = nodes[0].getwalletinfo()\n         if not self.options.descriptors:\n             assert addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid']\n \n+        # Address is active before wallet is encrypted (resetting keypool)\n+        addr9_before_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        assert addr9_before_encrypting_data['isactive']\n+\n+        # Imported things are never considered active, no need to rescan\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"addr(bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166089491",
      "id" : 1166089491,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgR0T",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 78,
      "original_position" : 75,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089491/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089491",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166089789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n            nodes[0].importpubkey(\"02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e\", \"label\", rescan=False)\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:34:28Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\n+\n+        addr0 = addrs[0]\n+        addr9 = addrs[9] # arbitrary future address index\n+\n+        # Address is active before it is removed from keypool by getnewaddress\n+        addr0_before_getting_data = nodes[0].getaddressinfo(addr0)\n+        assert addr0_before_getting_data['isactive']\n+\n         addr_before_encrypting = nodes[0].getnewaddress()\n         addr_before_encrypting_data = nodes[0].getaddressinfo(addr_before_encrypting)\n+        assert addr0 == addr_before_encrypting\n+        # Address is still active even after being removed from keypool\n+        assert addr_before_encrypting_data['isactive']\n+\n         wallet_info_old = nodes[0].getwalletinfo()\n         if not self.options.descriptors:\n             assert addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid']\n \n+        # Address is active before wallet is encrypted (resetting keypool)\n+        addr9_before_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        assert addr9_before_encrypting_data['isactive']\n+\n+        # Imported things are never considered active, no need to rescan\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"addr(bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", False)\n+        import_addr_data = nodes[0].getaddressinfo(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\")\n+        assert not import_addr_data[\"ismine\"]\n+        assert import_addr_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_addr_data[\"isactive\"]\n+\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"pk(02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importpubkey(\"02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e\", \"label\", False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166089789",
      "id" : 1166089789,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgR49",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 90,
      "original_position" : 87,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166089789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166090006"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166090006"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        nodes[0].importprivkey(\"cPMX7v5CNV1zCphFSq2hnR5rCjzAhA1GsBfD1qrJGdj4QEfu38Qx\", \"label\", rescan=False)\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:34:54Z",
      "diff_hunk" : "@@ -4,32 +4,107 @@\n # file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \"\"\"Test the wallet keypool and interaction with wallet encryption/locking.\"\"\"\n \n+import os\n+import re\n import time\n from decimal import Decimal\n \n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import assert_equal, assert_raises_rpc_error\n+from test_framework.descriptors import descsum_create\n+\n+TEST_KEYPOOL_SIZE = 10\n+TEST_NEW_KEYPOOL_SIZE = TEST_KEYPOOL_SIZE + 2\n \n class KeyPoolTest(BitcoinTestFramework):\n     def add_options(self, parser):\n         self.add_wallet_options(parser)\n \n     def set_test_params(self):\n         self.num_nodes = 1\n+        self.extra_args = [[f\"-keypool={TEST_KEYPOOL_SIZE}\"]]\n \n     def skip_test_if_missing_module(self):\n         self.skip_if_no_wallet()\n \n     def run_test(self):\n         nodes = self.nodes\n+\n+        # Derive addresses from the wallet without removing them from keypool\n+        addrs = []\n+        if not self.options.descriptors:\n+            path = os.path.join(self.nodes[0].datadir, 'wallet.dump')\n+            nodes[0].dumpwallet(path)\n+            file = open(path, \"r\", encoding=\"utf8\")\n+            m = re.search(r\"masterkey: (\\w+)\", file.read())\n+            file.close()\n+            xpriv = m.group(1)\n+            desc = descsum_create(f\"wpkh({xpriv}/0h/0h/*h)\")\n+            addrs = nodes[0].deriveaddresses(desc, [0, 9])\n+        else:\n+            list_descriptors = nodes[0].listdescriptors()\n+            for desc in list_descriptors[\"descriptors\"]:\n+                if desc['active'] and not desc[\"internal\"] and desc[\"desc\"][:4] == \"wpkh\":\n+                    addrs = nodes[0].deriveaddresses(desc[\"desc\"], [0, 9])\n+\n+        addr0 = addrs[0]\n+        addr9 = addrs[9] # arbitrary future address index\n+\n+        # Address is active before it is removed from keypool by getnewaddress\n+        addr0_before_getting_data = nodes[0].getaddressinfo(addr0)\n+        assert addr0_before_getting_data['isactive']\n+\n         addr_before_encrypting = nodes[0].getnewaddress()\n         addr_before_encrypting_data = nodes[0].getaddressinfo(addr_before_encrypting)\n+        assert addr0 == addr_before_encrypting\n+        # Address is still active even after being removed from keypool\n+        assert addr_before_encrypting_data['isactive']\n+\n         wallet_info_old = nodes[0].getwalletinfo()\n         if not self.options.descriptors:\n             assert addr_before_encrypting_data['hdseedid'] == wallet_info_old['hdseedid']\n \n+        # Address is active before wallet is encrypted (resetting keypool)\n+        addr9_before_encrypting_data = nodes[0].getaddressinfo(addr9)\n+        assert addr9_before_encrypting_data['isactive']\n+\n+        # Imported things are never considered active, no need to rescan\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"addr(bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importaddress(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\", \"label\", False)\n+        import_addr_data = nodes[0].getaddressinfo(\"bcrt1q95gp4zeaah3qcerh35yhw02qeptlzasdtst55v\")\n+        assert not import_addr_data[\"ismine\"]\n+        assert import_addr_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_addr_data[\"isactive\"]\n+\n+        if self.options.descriptors:\n+            nodes[0].importdescriptors([{\n+                \"desc\": \"pk(02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e)\",\n+                \"timestamp\": \"now\"\n+            }])\n+        else:\n+            nodes[0].importpubkey(\"02f893ca95b0d55b4ce4e72ae94982eb679158cb2ebc120ff62c17fedfd1f0700e\", \"label\", False)\n+        import_pub_data = nodes[0].getaddressinfo(\"bcrt1q4v7a8wn5vqd6fk4026s5gzzxyu7cfzz23n576h\")\n+        assert not import_pub_data[\"ismine\"]\n+        assert import_pub_data[\"iswatchonly\"] is not self.options.descriptors\n+        assert not import_pub_data[\"isactive\"]\n+\n+        nodes[0].importprivkey(\"cPMX7v5CNV1zCphFSq2hnR5rCjzAhA1GsBfD1qrJGdj4QEfu38Qx\", \"label\", False)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166090006",
      "id" : 1166090006,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgR8W",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 96,
      "original_position" : 93,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166090006/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166090006",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166092789"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166092789"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "It may be nice to add a comment on why the choice of 50 here.",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:40:09Z",
      "diff_hunk" : "@@ -84,50 +161,44 @@ def run_test(self):\n             assert addr_data['hdseedid'] == wallet_info['hdseedid']\n         assert_raises_rpc_error(-12, \"Error: Keypool ran out, please call keypoolrefill first\", nodes[0].getnewaddress)\n \n-        # put six (plus 2) new keys in the keypool (100% external-, +100% internal-keys, 1 in min)\n+        # put two new keys in the keypool\n         nodes[0].walletpassphrase('test', 12000)\n-        nodes[0].keypoolrefill(6)\n+        nodes[0].keypoolrefill(TEST_NEW_KEYPOOL_SIZE)\n         nodes[0].walletlock()\n         wi = nodes[0].getwalletinfo()\n         if self.options.descriptors:\n-            assert_equal(wi['keypoolsize_hd_internal'], 24)\n-            assert_equal(wi['keypoolsize'], 24)\n+            # Descriptors wallet: keypool size applies to both internal and external\n+            # chains and there are four of each (legacy, nested, segwit, and taproot)\n+            assert_equal(wi['keypoolsize_hd_internal'], TEST_NEW_KEYPOOL_SIZE * 4)\n+            assert_equal(wi['keypoolsize'], TEST_NEW_KEYPOOL_SIZE * 4)\n         else:\n-            assert_equal(wi['keypoolsize_hd_internal'], 6)\n-            assert_equal(wi['keypoolsize'], 6)\n+            # Legacy wallet: keypool size applies to both internal and external HD chains\n+            assert_equal(wi['keypoolsize_hd_internal'], TEST_NEW_KEYPOOL_SIZE)\n+            assert_equal(wi['keypoolsize'], TEST_NEW_KEYPOOL_SIZE)\n \n         # drain the internal keys\n-        nodes[0].getrawchangeaddress()\n-        nodes[0].getrawchangeaddress()\n-        nodes[0].getrawchangeaddress()\n-        nodes[0].getrawchangeaddress()\n-        nodes[0].getrawchangeaddress()\n-        nodes[0].getrawchangeaddress()\n-        addr = set()\n+        for _ in range(TEST_NEW_KEYPOOL_SIZE):\n+            nodes[0].getrawchangeaddress()\n         # the next one should fail\n         assert_raises_rpc_error(-12, \"Keypool ran out\", nodes[0].getrawchangeaddress)\n \n         # drain the external keys\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n-        assert len(addr) == 6\n+        addr = set()\n+        for _ in range(TEST_NEW_KEYPOOL_SIZE):\n+            addr.add(nodes[0].getnewaddress(address_type=\"bech32\"))\n         # the next one should fail\n         assert_raises_rpc_error(-12, \"Error: Keypool ran out, please call keypoolrefill first\", nodes[0].getnewaddress)\n \n-        # refill keypool with three new addresses\n+        # refill keypool\n         nodes[0].walletpassphrase('test', 1)\n-        nodes[0].keypoolrefill(3)\n+        nodes[0].keypoolrefill(50)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166092789",
      "id" : 1166092789,
      "line" : 196,
      "node_id" : "PRRC_kwDOABII585FgSn1",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 196,
      "original_position" : 175,
      "original_start_line" : null,
      "path" : "test/functional/wallet_keypool.py",
      "position" : 177,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166092789/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166092789",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097250"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097250"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "My understanding is that [[[nodiscard]]](https://en.cppreference.com/w/cpp/language/attributes/nodiscard) only needs to be declared in the declaration (i.e. in the .h file here), not the definition as well (idem for the other functions where it has been added to the definitions in addition to the declarations).",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:48:58Z",
      "diff_hunk" : "@@ -392,6 +392,23 @@ std::vector<WalletDestination> LegacyScriptPubKeyMan::MarkUnusedAddresses(const\n     return result;\n }\n \n+[[nodiscard]] bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097250",
      "id" : 1166097250,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgTti",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 395,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097250/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097250",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097539"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097539"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, a one-liner like this can just be inlined in the declaration, and omit the definition.",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:49:36Z",
      "diff_hunk" : "@@ -2206,6 +2223,11 @@ std::vector<WalletDestination> DescriptorScriptPubKeyMan::MarkUnusedAddresses(co\n     return result;\n }\n \n+[[nodiscard]] bool DescriptorScriptPubKeyMan::IsKeyActive(const CScript& script) const\n+{\n+    return IsMine(script);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097539",
      "id" : 1166097539,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgTyD",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 2228,
      "original_position" : 30,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097539/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097539",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097803"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097803"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit, can be nodiscard",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:50:14Z",
      "diff_hunk" : "@@ -673,6 +673,11 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     using ListAddrBookFunc = std::function<void(const CTxDestination& dest, const std::string& label, const std::string& purpose, bool is_change)>;\n     void ForEachAddrBookEntry(const ListAddrBookFunc& func) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n+    /**\n+     * Determines if a destination is in the active spkm (not imported and not dumped for a new keypool)\n+     */\n+    bool IsDestinationActive(const CTxDestination& dest) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166097803",
      "id" : 1166097803,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FgT2L",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 679,
      "original_position" : 7,
      "original_start_line" : null,
      "path" : "src/wallet/wallet.h",
      "position" : null,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097803/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:06:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166097803",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166100726"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166100726"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "As to which one to use here in this new code, rather than following other code, I guess if we're not sure the element exists, use `vector#find` and check presence with `!end()`. If its absence is a program logic error (and to avoid UB), then `vector#at`. If we're sure of presence and optimizing for speed (say, in a hotspot), then `vector#operator[]`.",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T22:56:18Z",
      "diff_hunk" : "@@ -730,8 +730,11 @@ class PKDescriptor final : public DescriptorImpl\n private:\n     const bool m_xonly;\n protected:\n-    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider&) const override\n+    std::vector<CScript> MakeScripts(const std::vector<CPubKey>& keys, Span<const CScript>, FlatSigningProvider& out) const override\n     {\n+        CKeyID id = keys[0].GetID();\n+        out.pubkeys.emplace(id, keys[0]);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166100726",
      "id" : 1166100726,
      "in_reply_to_id" : 1159068107,
      "line" : 736,
      "node_id" : "PRRC_kwDOABII585FgUj2",
      "original_commit_id" : "81f29f03a607cbfb7162705c1c1618ca7b59640e",
      "original_line" : 736,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/script/descriptor.cpp",
      "position" : 8,
      "pull_request_review_id" : 1384012329,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166100726/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-13T23:09:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166100726",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166118176"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166118176"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Another implementation for fun!\r\n\r\n```diff\r\n-    int num_script_keys_not_found = 0;\r\n-    for (const CScript& script : scripts4) {\r\n-        if (!wallet.IsDestinationActive(WitnessV0ScriptHash(script))) {\r\n-            ++num_script_keys_not_found;\r\n-        }\r\n-    }\r\n+    int num_script_keys_not_found = std::accumulate(scripts4.cbegin(), scripts4.cend(), 0, [&wallet] (int n, const CScript& s) { return wallet.IsDestinationActive(WitnessV0ScriptHash(s)) ? n : ++n; });\r\n```\r\n\n(maybe improveable with std::reduce instead)",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-13T23:16:43Z",
      "diff_hunk" : "@@ -39,5 +39,159 @@ BOOST_AUTO_TEST_CASE(CanProvide)\n     BOOST_CHECK(keyman.CanProvide(p2sh_script, data));\n }\n \n+BOOST_AUTO_TEST_CASE(Legacy_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.SetMinVersion(FEATURE_LATEST);\n+        wallet.m_keypool_size = 10;\n+    }\n+    LegacyScriptPubKeyMan& spkm = *wallet.GetOrCreateLegacyScriptPubKeyMan();\n+\n+    // Start off empty\n+    BOOST_CHECK(spkm.GetScriptPubKeys().empty());\n+\n+    // Generate 20 keypool keys (10 internal, 10 external)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        spkm.SetupGeneration();\n+    }\n+\n+    // 4 scripts per keypool key (P2PK, P2PKH, P2WPKH, P2SH-P2WPKH)\n+    // Plus 4 scripts for the seed key\n+    auto scripts1 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts1.size(), 84);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // Requesting single from spkm should not deactivate key\n+    CTxDestination dest1;\n+    {\n+        LOCK(wallet.cs_wallet);\n+        auto result = spkm.GetNewDestination(OutputType::BECH32);\n+        dest1 = result.value();\n+    }\n+    CScript script = GetScriptForDestination(dest1);\n+    BOOST_CHECK(spkm.IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts2.size(), 84);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(wallet.cs_wallet);\n+        LOCK(spkm.cs_KeyStore);\n+        auto keys = spkm.MarkReserveKeysAsUsed(5);\n+        BOOST_CHECK_EQUAL(keys.size(), 4); // Because we already used one with GetNewDestination\n+    }\n+\n+    // Key pool size did not change\n+    auto scripts3 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts3.size(), 84);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(spkm.IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        spkm.SetupGeneration(true);\n+    }\n+\n+    // 20 new keys were added\n+    auto scripts4 = spkm.GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts4.size(), 84 * 2);\n+\n+    // All 10 original keys are now inactive\n+    for (const CScript& script : scripts3) {\n+        BOOST_CHECK(!spkm.IsKeyActive(script));\n+    }\n+}\n+\n+BOOST_AUTO_TEST_CASE(Descriptor_IsKeyActive)\n+{\n+    CWallet wallet(m_node.chain.get(), \"\", CreateMockWalletDatabase());\n+    {\n+        LOCK(wallet.cs_wallet);\n+        wallet.LoadMinVersion(FEATURE_LATEST);\n+        wallet.SetWalletFlag(WALLET_FLAG_DESCRIPTORS);\n+        wallet.m_keypool_size = 10;\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+    DescriptorScriptPubKeyMan* spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(wallet.GetScriptPubKeyMan(OutputType::BECH32, /*internal=*/false));\n+\n+    // Start off with 10 pre-generated keys, 1 script each\n+    auto scripts1 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts1.size(), 10);\n+\n+    // All keys are active\n+    for (const CScript& script : scripts1) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // Requesting single key from spkm should not deactivate key\n+    auto dest1 = spkm->GetNewDestination(OutputType::BECH32);\n+    CScript script = GetScriptForDestination(dest1.value());\n+    BOOST_CHECK(spkm->IsKeyActive(script));\n+\n+    // Key pool size did not change\n+    auto scripts2 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts2.size(), 10);\n+\n+    // Use key that is not the next key\n+    // (i.e. address gap in wallet recovery)\n+    {\n+        LOCK(spkm->cs_desc_man);\n+        WalletDescriptor descriptor = spkm->GetWalletDescriptor();\n+        FlatSigningProvider provider;\n+        std::vector<CScript> scripts3;\n+        descriptor.descriptor->ExpandFromCache(/*pos=*/5, descriptor.cache, scripts3, provider);\n+\n+        BOOST_CHECK_EQUAL(scripts3.size(), 1);\n+        spkm->MarkUnusedAddresses(scripts3.front());\n+    }\n+\n+    // Key pool size increased to replace used keys\n+    auto scripts4 = spkm->GetScriptPubKeys();\n+    BOOST_CHECK_EQUAL(scripts4.size(), 16);\n+\n+    // All keys are still active\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // When user encrypts wallet for the first time,\n+    // all existing keys are removed from active keypool\n+    {\n+        LOCK(wallet.cs_wallet);\n+        // called by EncryptWallet()\n+        wallet.SetupDescriptorScriptPubKeyMans();\n+    }\n+\n+    // This SPKM is not affected\n+    for (const CScript& script : scripts4) {\n+        BOOST_CHECK(spkm->IsKeyActive(script));\n+    }\n+\n+    // ...but at the wallet level all the keys from that SPKM are deactivated\n+    int num_script_keys_not_found = 0;\n+    for (const CScript& script : scripts4) {\n+        if (!wallet.IsDestinationActive(WitnessV0ScriptHash(script))) {\n+            ++num_script_keys_not_found;\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(num_script_keys_not_found, 16);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1166118176",
      "id" : 1166118176,
      "line" : 193,
      "node_id" : "PRRC_kwDOABII585FgY0g",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 193,
      "original_position" : 155,
      "original_start_line" : null,
      "path" : "src/wallet/test/scriptpubkeyman_tests.cpp",
      "position" : 155,
      "pull_request_review_id" : 1384371024,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166118176/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-14T00:42:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166118176",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1167110228"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1167110228"
         }
      },
      "author_association" : "MEMBER",
      "body" : "ah yeah \"...Appears in a function declaration, enumeration declaration, or class declaration. \"\r\n\r\nbut theres a few leaks in bitcoin...\r\n```\r\n--> git grep nodiscard *.cpp | wc -l\r\n       8\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-14T17:25:57Z",
      "diff_hunk" : "@@ -392,6 +392,23 @@ std::vector<WalletDestination> LegacyScriptPubKeyMan::MarkUnusedAddresses(const\n     return result;\n }\n \n+[[nodiscard]] bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1167110228",
      "id" : 1167110228,
      "in_reply_to_id" : 1166097250,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FkLBU",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 395,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1385895881,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1167110228/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-14T17:25:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1167110228",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "thanks again @jonatack \r\nrebase to 8139075244f1f361a14f80920c45d8c4f41d553e\r\n- refactor commits to separate tests in hygenic order!\r\n- address review nits",
      "created_at" : "2023-04-14T19:26:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1509119182",
      "id" : 1509119182,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585Z81TO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509119182/reactions"
      },
      "updated_at" : "2023-04-14T19:26:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1509119182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1170606402"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170606402"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Interesting, though only 3 of the 8 seem to be extraneous annotations (two in `src/base58.cpp` and one in `src/node/eviction.cpp`, and the one in `src/script/descriptor.cpp` should just have `static` added).",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-18T21:57:11Z",
      "diff_hunk" : "@@ -392,6 +392,23 @@ std::vector<WalletDestination> LegacyScriptPubKeyMan::MarkUnusedAddresses(const\n     return result;\n }\n \n+[[nodiscard]] bool LegacyScriptPubKeyMan::IsKeyActive(const CScript& script) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1170606402",
      "id" : 1170606402,
      "in_reply_to_id" : 1166097250,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585FxglC",
      "original_commit_id" : "b95e2ee9822e58451dbf662cdb2eae4d55431aff",
      "original_line" : 395,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.cpp",
      "position" : null,
      "pull_request_review_id" : 1390989423,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170606402/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T21:57:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170606402",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1170643262"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170643262"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fb3d39ad3e391da273a142c36 It may make sense to declare this base class member as a pure virtual function. The implementation here seems unused/unnecessary.\r\n```suggestion\r\n    virtual bool IsKeyActive(const CScript& script) const = 0;\r\n```",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-18T22:57:39Z",
      "diff_hunk" : "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n      */\n     virtual std::vector<WalletDestination> MarkUnusedAddresses(const CScript& script) { return {}; }\n \n+    /* Determines if address is derived from active key manager */\n+    [[nodiscard]] virtual bool IsKeyActive(const CScript& script) const { return false; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1170643262",
      "id" : 1170643262,
      "line" : 202,
      "node_id" : "PRRC_kwDOABII585Fxpk-",
      "original_commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "original_line" : 202,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 5,
      "pull_request_review_id" : 1391039049,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170643262/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-18T23:34:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170643262",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1171399601"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171399601"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Ah thanks for the ack, I'll update this and the commit message you mentioned if I need to revise again.",
      "commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "created_at" : "2023-04-19T14:06:27Z",
      "diff_hunk" : "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n      */\n     virtual std::vector<WalletDestination> MarkUnusedAddresses(const CScript& script) { return {}; }\n \n+    /* Determines if address is derived from active key manager */\n+    [[nodiscard]] virtual bool IsKeyActive(const CScript& script) const { return false; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1171399601",
      "id" : 1171399601,
      "in_reply_to_id" : 1170643262,
      "line" : 202,
      "node_id" : "PRRC_kwDOABII585F0iOx",
      "original_commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "original_line" : 202,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : 5,
      "pull_request_review_id" : 1392157023,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171399601/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-04-19T14:06:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171399601",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> https://github.com/bitcoin/bitcoin/commit/81f29f03a607cbfb7162705c1c1618ca7b59640e I'm not sure if or when legacy wallet support is expected to be phased out, but if isactive is only different from ismine in legacy wallets, is it worth adding a field (and all the new methods), versus just updating the ismine field documentation in the help for descriptor wallets\r\n\r\nFollowing up on https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1160272170 above, according to https://github.com/bitcoin/bitcoin/issues/20160 legacy wallet support may be dropped in the next couple releases.",
      "created_at" : "2023-04-28T16:00:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1527773928",
      "id" : 1527773928,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585bD_ro",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1527773928/reactions"
      },
      "updated_at" : "2023-04-28T16:00:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1527773928",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Needs rebase\r\n\r\ndone thanks",
      "created_at" : "2023-05-18T18:25:52Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1553450191",
      "id" : 1553450191,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585cl8TP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553450191/reactions"
      },
      "updated_at" : "2023-05-18T18:25:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553450191",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1214557458"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214557458"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, both comments addressed with rebase",
      "commit_id" : "f7cd46280fefa06f9487a8a2927de093af1d421d",
      "created_at" : "2023-06-02T15:59:48Z",
      "diff_hunk" : "@@ -198,6 +198,9 @@ class ScriptPubKeyMan\n      */\n     virtual std::vector<WalletDestination> MarkUnusedAddresses(const CScript& script) { return {}; }\n \n+    /* Determines if address is derived from active key manager */\n+    [[nodiscard]] virtual bool IsKeyActive(const CScript& script) const { return false; };",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#discussion_r1214557458",
      "id" : 1214557458,
      "in_reply_to_id" : 1170643262,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585IZK0S",
      "original_commit_id" : "8139075244f1f361a14f80920c45d8c4f41d553e",
      "original_line" : 202,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/wallet/scriptpubkeyman.h",
      "position" : null,
      "pull_request_review_id" : 1457894930,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/27216",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214557458/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-06-02T15:59:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214557458",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I don't mind the new field, but it's not correct to say users should be discouraged from using any key they import...",
      "created_at" : "2023-06-22T20:54:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1603302152",
      "id" : 1603302152,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585fkHMI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1603302152/reactions"
      },
      "updated_at" : "2023-06-22T20:54:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1603302152",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK",
      "created_at" : "2023-07-05T07:25:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1621182702",
      "id" : 1621182702,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585goUju",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1621182702/reactions"
      },
      "updated_at" : "2023-07-05T07:25:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1621182702",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/23396902?v=4",
         "events_url" : "https://api.github.com/users/jarolrod/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jarolrod/followers",
         "following_url" : "https://api.github.com/users/jarolrod/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jarolrod/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jarolrod",
         "id" : 23396902,
         "login" : "jarolrod",
         "node_id" : "MDQ6VXNlcjIzMzk2OTAy",
         "organizations_url" : "https://api.github.com/users/jarolrod/orgs",
         "received_events_url" : "https://api.github.com/users/jarolrod/received_events",
         "repos_url" : "https://api.github.com/users/jarolrod/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jarolrod/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jarolrod/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jarolrod"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I don't mind the new field, but it's not correct to say users should be discouraged from using any key they import...\r\n\r\n@luke-jr  Fair point, I updated the OP (no code changes needed)\r\n\r\n>  legacy wallet support may be dropped in the next couple releases.\r\n\r\n@jonatack It may take about that long for this PR to get merged anyway ð¤£. So, I can remove the legacy stuff from this PR right now and only descriptor wallet users can enjoy the feature, OR, we can keep `isactive` in there for now and then remove it along with the rest of the legacy wallet stuff when that is appropriate. Thoughts? Preference?\r\n",
      "created_at" : "2023-07-05T19:19:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1622332067",
      "id" : 1622332067,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585gstKj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622332067/reactions"
      },
      "updated_at" : "2023-07-05T19:19:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622332067",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2084648?v=4",
         "events_url" : "https://api.github.com/users/pinheadmz/events{/privacy}",
         "followers_url" : "https://api.github.com/users/pinheadmz/followers",
         "following_url" : "https://api.github.com/users/pinheadmz/following{/other_user}",
         "gists_url" : "https://api.github.com/users/pinheadmz/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/pinheadmz",
         "id" : 2084648,
         "login" : "pinheadmz",
         "node_id" : "MDQ6VXNlcjIwODQ2NDg=",
         "organizations_url" : "https://api.github.com/users/pinheadmz/orgs",
         "received_events_url" : "https://api.github.com/users/pinheadmz/received_events",
         "repos_url" : "https://api.github.com/users/pinheadmz/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/pinheadmz/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/pinheadmz/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/pinheadmz"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@pinheadmz I'd do the simplest thing, or what @achow101 thinks on this and regarding progress on the https://github.com/bitcoin/bitcoin/issues/20160 timeline.",
      "created_at" : "2023-07-05T20:59:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/27216#issuecomment-1622495909",
      "id" : 1622495909,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/27216",
      "node_id" : "IC_kwDOABII585gtVKl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622495909/reactions"
      },
      "updated_at" : "2023-07-05T20:59:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1622495909",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   }
]
