{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "### Is there an existing issue for this?\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Current behaviour\r\n\r\nThe GetBlockSubsidy function could potentially encounter a signed integer overflow if nHeight reaches the next value at 2,147,483,647 causing it to wrap to -2,147,483,648. This overflow can disrupt the halving mechanism implemented in the function, particularly around the calculated 10,226th halving interval derived from INT_MAX / nSubsidyHalvingInterval.\r\n\r\n```\r\nCAmount GetBlockSubsidy(int nHeight, const Consensus::Params& consensusParams)\r\n{\r\n    int halvings = nHeight / consensusParams.nSubsidyHalvingInterval;\r\n    // Force block reward to zero when right shift is undefined.\r\n    if (halvings >= 64)\r\n        return 0;\r\n\r\n    CAmount nSubsidy = 50 * COIN;\r\n    // Subsidy is cut in half every 210,000 blocks which will occur approximately every 4 years.\r\n    nSubsidy >>= halvings;\r\n    return nSubsidy;\r\n}\r\n```\r\n\r\nImplications:\r\n\r\nSuch an overflow could lead to erroneous block subsidy calculations, impacting not only the subsidy value but also the overall supply curve of the cryptocurrency. This would diverge from the predefined monetary supply rules and could potentially compromise the economic model established by the protocol.\r\n\r\nEven if there are sanity checks in place to prevent these incorrect subsidy from being issued, the presence of such anomalous values could lead to a situation where no blocks are validated by the network. This would effectively halt the processing of new transactions and block creation, disrupting the network's functionality.\r\n\r\nThe failure to validate blocks because of incorrect block height values compromises the network's reliability and can lead to severe trust and security issues among users and participants. Therefore, it is crucial to address this to maintain the integrity and reliability of the monetary policy mechanism and the overall stability of the network.\r\n\r\n### Expected behaviour\r\n\r\nIt is recommended to hard-code the block subsidy to be zero for block heights greater or equal than 64 times the consensusParams.nSubsidyHalvingInterval (13,440,000). This approach aligns with the logical endpoint of the current halving mechanism, where the subsidy should theoretically reduce to zero due to the defined right shift operation, which becomes undefined beyond 64 halvings.\r\n\r\n### Steps to reproduce\r\n\r\n```\r\n#include <iostream>\r\n\r\ntypedef int64_t CAmount;\r\nstatic constexpr CAmount COIN = 100000000;\r\nstatic constexpr CAmount MAX_MONEY = 21000000 * COIN;\r\nint nSubsidyHalvingInterval = 210000;\r\n\r\nCAmount GetBlockSubsidy(int nHeight) {\r\n\r\n    int halvings = nHeight / nSubsidyHalvingInterval;\r\n    \r\n    if (halvings >= 64) {\r\n        return 0;\r\n    }\r\n\r\n    CAmount nSubsidy = 50 * COIN;\r\n    nSubsidy >>= halvings;\r\n    return nSubsidy;\r\n}\r\n\r\nint main() {\r\n    int halving = 0;\r\n    int blockHeight = 0;\r\n    int pendingBlocks4Halving = 21000000;\r\n    while (true) {\r\n        if (blockHeight % nSubsidyHalvingInterval == 0) {\r\n            CAmount nSubsidy = GetBlockSubsidy(blockHeight);\r\n            std::cout << \"Epoch \" << halving + 1 << \": Block = \" << blockHeight << \", Halving = \" << halving << \", Block Subsidy = \" << nSubsidy << \" satoshis\" << std::endl;\r\n            halving+=1;\r\n            pendingBlocks4Halving=21000000;\r\n        }\r\n        if (pendingBlocks4Halving < 10000 || blockHeight % 10000 !=0) {\r\n            blockHeight += 1; // Slow progress due to Integer Signed Overflow that changes the height to a negative number not multiple of 10000\r\n            pendingBlocks4Halving-=1;\r\n        }\r\n        else {\r\n            blockHeight += 10000; // Fast foward\r\n            pendingBlocks4Halving-=10000;\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\n```\r\n\r\n### Relevant log output\r\n\r\nEpoch 32: Block = 6510000, Halving = 31, Block Subsidy = 2 satoshis\r\nEpoch 33: Block = 6720000, Halving = 32, Block Subsidy = 1 satoshis\r\nEpoch 34: Block = 6930000, Halving = 33, Block Subsidy = 0 satoshis\r\nEpoch 35: Block = 7140000, Halving = 34, Block Subsidy = 0 satoshis\r\n...\r\n...\r\n...\r\n\r\nEpoch 10223: Block = 2146620000, Halving = 10222, Block Subsidy = 0 satoshis\r\nEpoch 10224: Block = 2146830000, Halving = 10223, Block Subsidy = 0 satoshis\r\nEpoch 10225: Block = 2147040000, Halving = 10224, Block Subsidy = 0 satoshis\r\nEpoch 10226: Block = 2147250000, Halving = 10225, Block Subsidy = 0 satoshis\r\n**Epoch 10227: Block = 2147460000, Halving = 10226, Block Subsidy = 0 satoshis\r\nEpoch 10228: Block = -2147460000, Halving = 10227, Block Subsidy = 305175 satoshis**\r\nEpoch 10229: Block = -2147250000, Halving = 10228, Block Subsidy = 152587 satoshis\r\nEpoch 10230: Block = -2147040000, Halving = 10229, Block Subsidy = 76293 satoshis\r\nEpoch 10231: Block = -2146830000, Halving = 10230, Block Subsidy = 38146 satoshis\r\nEpoch 10232: Block = -2146620000, Halving = 10231, Block Subsidy = 19073 satoshis\r\nEpoch 10233: Block = -2146410000, Halving = 10232, Block Subsidy = 9536 satoshis\r\nEpoch 10234: Block = -2146200000, Halving = 10233, Block Subsidy = 4768 satoshis\r\nEpoch 10235: Block = -2145990000, Halving = 10234, Block Subsidy = 2384 satoshis\r\nEpoch 10236: Block = -2145780000, Halving = 10235, Block Subsidy = 1192 satoshis\r\nEpoch 10237: Block = -2145570000, Halving = 10236, Block Subsidy = 596 satoshis\r\nEpoch 10238: Block = -2145360000, Halving = 10237, Block Subsidy = 298 satoshis\r\nEpoch 10239: Block = -2145150000, Halving = 10238, Block Subsidy = 149 satoshis\r\nEpoch 10240: Block = -2144940000, Halving = 10239, Block Subsidy = 74 satoshis\r\nEpoch 10241: Block = -2144730000, Halving = 10240, Block Subsidy = 37 satoshis\r\nEpoch 10242: Block = -2144520000, Halving = 10241, Block Subsidy = 18 satoshis\r\nEpoch 10243: Block = -2144310000, Halving = 10242, Block Subsidy = 9 satoshis\r\nEpoch 10244: Block = -2144100000, Halving = 10243, Block Subsidy = 4 satoshis\r\nEpoch 10245: Block = -2143890000, Halving = 10244, Block Subsidy = 2 satoshis\r\nEpoch 10246: Block = -2143680000, Halving = 10245, Block Subsidy = 1 satoshis\r\nEpoch 10247: Block = -2143470000, Halving = 10246, Block Subsidy = 0 satoshis\r\nEpoch 10248: Block = -2143260000, Halving = 10247, Block Subsidy = 0 satoshis\r\n...\r\n...\r\nEpoch 10276: Block = -2137380000, Halving = 10275, Block Subsidy = 0 satoshis\r\nEpoch 10277: Block = -2137170000, Halving = 10276, Block Subsidy = 0 satoshis\r\nEpoch 10278: Block = -2136960000, Halving = 10277, Block Subsidy = 5000000000 satoshis\r\nEpoch 10279: Block = -2136750000, Halving = 10278, Block Subsidy = 2500000000 satoshis\r\nEpoch 10280: Block = -2136540000, Halving = 10279, Block Subsidy = 1250000000 satoshis\r\nEpoch 10281: Block = -2136330000, Halving = 10280, Block Subsidy = 625000000 satoshis\r\nEpoch 10282: Block = -2136120000, Halving = 10281, Block Subsidy = 312500000 satoshis\r\nEpoch 10283: Block = -2135910000, Halving = 10282, Block Subsidy = 156250000 satoshis\r\nEpoch 10284: Block = -2135700000, Halving = 10283, Block Subsidy = 78125000 satoshis\r\nEpoch 10285: Block = -2135490000, Halving = 10284, Block Subsidy = 39062500 satoshis\r\nEpoch 10286: Block = -2135280000, Halving = 10285, Block Subsidy = 19531250 satoshis\r\nEpoch 10287: Block = -2135070000, Halving = 10286, Block Subsidy = 9765625 satoshis\r\nEpoch 10288: Block = -2134860000, Halving = 10287, Block Subsidy = 4882812 satoshis\r\nEpoch 10289: Block = -2134650000, Halving = 10288, Block Subsidy = 2441406 satoshis\r\nEpoch 10290: Block = -2134440000, Halving = 10289, Block Subsidy = 1220703 satoshis\r\nEpoch 10291: Block = -2134230000, Halving = 10290, Block Subsidy = 610351 satoshis\r\nEpoch 10292: Block = -2134020000, Halving = 10291, Block Subsidy = 305175 satoshis\r\nEpoch 10293: Block = -2133810000, Halving = 10292, Block Subsidy = 152587 satoshis\r\nEpoch 10294: Block = -2133600000, Halving = 10293, Block Subsidy = 76293 satoshis\r\nEpoch 10295: Block = -2133390000, Halving = 10294, Block Subsidy = 38146 satoshis\r\nEpoch 10296: Block = -2133180000, Halving = 10295, Block Subsidy = 19073 satoshis\r\nEpoch 10297: Block = -2132970000, Halving = 10296, Block Subsidy = 9536 satoshis\r\nEpoch 10298: Block = -2132760000, Halving = 10297, Block Subsidy = 4768 satoshis\r\nEpoch 10299: Block = -2132550000, Halving = 10298, Block Subsidy = 2384 satoshis\r\nEpoch 10300: Block = -2132340000, Halving = 10299, Block Subsidy = 1192 satoshis\r\nEpoch 10301: Block = -2132130000, Halving = 10300, Block Subsidy = 596 satoshis\r\nEpoch 10302: Block = -2131920000, Halving = 10301, Block Subsidy = 298 satoshis\r\nEpoch 10303: Block = -2131710000, Halving = 10302, Block Subsidy = 149 satoshis\r\nEpoch 10304: Block = -2131500000, Halving = 10303, Block Subsidy = 74 satoshis\r\nEpoch 10305: Block = -2131290000, Halving = 10304, Block Subsidy = 37 satoshis\r\nEpoch 10306: Block = -2131080000, Halving = 10305, Block Subsidy = 18 satoshis\r\nEpoch 10307: Block = -2130870000, Halving = 10306, Block Subsidy = 9 satoshis\r\nEpoch 10308: Block = -2130660000, Halving = 10307, Block Subsidy = 4 satoshis\r\nEpoch 10309: Block = -2130450000, Halving = 10308, Block Subsidy = 2 satoshis\r\nEpoch 10310: Block = -2130240000, Halving = 10309, Block Subsidy = 1 satoshis\r\nEpoch 10311: Block = -2130030000, Halving = 10310, Block Subsidy = 0 satoshis\r\nEpoch 10312: Block = -2129820000, Halving = 10311, Block Subsidy = 0 satoshis\r\n...\r\n...\r\nEpoch 10340: Block = -2123940000, Halving = 10339, Block Subsidy = 0 satoshis\r\nEpoch 10341: Block = -2123730000, Halving = 10340, Block Subsidy = 0 satoshis\r\nEpoch 10342: Block = -2123520000, Halving = 10341, Block Subsidy = 5000000000 satoshis\r\nEpoch 10343: Block = -2123310000, Halving = 10342, Block Subsidy = 2500000000 satoshis\r\nEpoch 10344: Block = -2123100000, Halving = 10343, Block Subsidy = 1250000000 satoshis\r\nEpoch 10345: Block = -2122890000, Halving = 10344, Block Subsidy = 625000000 satoshis\r\nEpoch 10346: Block = -2122680000, Halving = 10345, Block Subsidy = 312500000 satoshis\r\nEpoch 10347: Block = -2122470000, Halving = 10346, Block Subsidy = 156250000 satoshis\r\nEpoch 10348: Block = -2122260000, Halving = 10347, Block Subsidy = 78125000 satoshis\r\nEpoch 10349: Block = -2122050000, Halving = 10348, Block Subsidy = 39062500 satoshis\r\nEpoch 10350: Block = -2121840000, Halving = 10349, Block Subsidy = 19531250 satoshis\r\n...\r\n...\r\n...\r\n...\r\n\r\nIt seems to be cyclical...\r\n\r\n### How did you obtain Bitcoin Core\r\n\r\nCompiled from source\r\n\r\n### What version of Bitcoin Core are you using?\r\n\r\nmaster@67c0d93\r\n\r\n### Operating system and version\r\n\r\nUbuntu 23.10\r\n\r\n### Machine specifications\r\n\r\n_No response_",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928/comments",
   "created_at" : "2024-04-21T07:43:06Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/29928",
   "id" : 2254948118,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII586GZ8cW",
   "number" : 29928,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928/timeline",
   "title" : "Signed Integer Overflow in GetBlockSubsidy at block height 2,147,483,647 (During Epoch 10,227, halving 10,226) could Increase Block Subsidy and Total Supply",
   "updated_at" : "2024-04-21T07:59:30Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29928",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/49944060?v=4",
      "events_url" : "https://api.github.com/users/Kino1994/events{/privacy}",
      "followers_url" : "https://api.github.com/users/Kino1994/followers",
      "following_url" : "https://api.github.com/users/Kino1994/following{/other_user}",
      "gists_url" : "https://api.github.com/users/Kino1994/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/Kino1994",
      "id" : 49944060,
      "login" : "Kino1994",
      "node_id" : "MDQ6VXNlcjQ5OTQ0MDYw",
      "organizations_url" : "https://api.github.com/users/Kino1994/orgs",
      "received_events_url" : "https://api.github.com/users/Kino1994/received_events",
      "repos_url" : "https://api.github.com/users/Kino1994/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/Kino1994/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/Kino1994/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/Kino1994"
   }
}
