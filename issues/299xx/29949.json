{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "NONE",
   "body" : "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nI want to create signature by calling `walletprocesspsbt` endpoint to spend from multisig output. It is worth stating that this is taproot output with one leaf.\r\n\r\nWallet contains one of the key from multisig.  Key was created by first calling `getnewaddress` and then calling `getaddressinfo` and retrieving public key.\r\n\r\nNow the issue is that if multisig script is in format:\r\n`<key1> OP_CHECKSIG <key2> OP_CHECKSIGADD <key3> OP_CHECKSIGADD 2 OP_NUMEQUAL`\r\n\r\nwhere one of the keys is in wallet everything works as expected.\r\n\r\nPsbt to sign:\r\n```\r\n{\r\n  \"tx\": {\r\n    \"txid\": \"626f61fa0b711187cd29a82c7ec0ae56447a8c8b4955bf99c9c8a6459522cf40\",\r\n    \"hash\": \"626f61fa0b711187cd29a82c7ec0ae56447a8c8b4955bf99c9c8a6459522cf40\",\r\n    \"version\": 2,\r\n    \"size\": 82,\r\n    \"vsize\": 82,\r\n    \"weight\": 328,\r\n    \"locktime\": 0,\r\n    \"vin\": [\r\n      {\r\n        \"txid\": \"32f9c12fe803fa2c26c168850b424e260bca7191b39e775ddf946d51cb0c929b\",\r\n        \"vout\": 0,\r\n        \"scriptSig\": {\r\n          \"asm\": \"\",\r\n          \"hex\": \"\"\r\n        },\r\n        \"sequence\": 0\r\n      }\r\n    ],\r\n    \"vout\": [\r\n      {\r\n        \"value\": 0.00098000,\r\n        \"n\": 0,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"0 a2ec9907bfd06d26e41e8af835c8b2b39400bb56\",\r\n          \"desc\": \"addr(bcrt1q5tkfjpal6pkjdeq73turtj9jkw2qpw6kfnjp63)#3rygmz90\",\r\n          \"hex\": \"0014a2ec9907bfd06d26e41e8af835c8b2b39400bb56\",\r\n          \"address\": \"bcrt1q5tkfjpal6pkjdeq73turtj9jkw2qpw6kfnjp63\",\r\n          \"type\": \"witness_v0_keyhash\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"global_xpubs\": [\r\n  ],\r\n  \"psbt_version\": 0,\r\n  \"proprietary\": [\r\n  ],\r\n  \"unknown\": {\r\n  },\r\n  \"inputs\": [\r\n    {\r\n      \"witness_utxo\": {\r\n        \"amount\": 0.00100000,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"1 c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a\",\r\n          \"desc\": \"rawtr(c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a)#kgt72cne\",\r\n          \"hex\": \"5120c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a\",\r\n          \"address\": \"bcrt1pc05w9j0uvqel867dn4dnjgf022rnazmwx44xf0fkf4mwtyq37vaqrecrxw\",\r\n          \"type\": \"witness_v1_taproot\"\r\n        }\r\n      },\r\n      \"witness_script\": {\r\n        \"asm\": \"51af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53 OP_CHECKSIG 65a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403 OP_CHECKSIGADD 71a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9 OP_CHECKSIGADD 2 OP_NUMEQUAL\",\r\n        \"hex\": \"2051af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53ac2065a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403ba2071a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9ba529c\",\r\n        \"type\": \"nonstandard\"\r\n      },\r\n      \"taproot_scripts\": [\r\n        {\r\n          \"script\": \"2051af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53ac2065a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403ba2071a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9ba529c\",\r\n          \"leaf_ver\": 192,\r\n          \"control_blocks\": [\r\n            \"c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\"\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_bip32_derivs\": [\r\n        {\r\n          \"pubkey\": \"65a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403\",\r\n          \"master_fingerprint\": \"00000000\",\r\n          \"path\": \"m\",\r\n          \"leaf_hashes\": [\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_internal_key\": \"50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\",\r\n      \"taproot_merkle_root\": \"a0739e00a984d9cdfb5f08740d3c6b405af4d98baa7dfcc823cab15c8c465661\"\r\n    }\r\n  ],\r\n  \"outputs\": [\r\n    {\r\n    }\r\n  ],\r\n  \"fee\": 0.00002000\r\n}\r\n```\r\nPsbt signed:\r\n```\r\n{\r\n  \"tx\": {\r\n    \"txid\": \"626f61fa0b711187cd29a82c7ec0ae56447a8c8b4955bf99c9c8a6459522cf40\",\r\n    \"hash\": \"626f61fa0b711187cd29a82c7ec0ae56447a8c8b4955bf99c9c8a6459522cf40\",\r\n    \"version\": 2,\r\n    \"size\": 82,\r\n    \"vsize\": 82,\r\n    \"weight\": 328,\r\n    \"locktime\": 0,\r\n    \"vin\": [\r\n      {\r\n        \"txid\": \"32f9c12fe803fa2c26c168850b424e260bca7191b39e775ddf946d51cb0c929b\",\r\n        \"vout\": 0,\r\n        \"scriptSig\": {\r\n          \"asm\": \"\",\r\n          \"hex\": \"\"\r\n        },\r\n        \"sequence\": 0\r\n      }\r\n    ],\r\n    \"vout\": [\r\n      {\r\n        \"value\": 0.00098000,\r\n        \"n\": 0,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"0 a2ec9907bfd06d26e41e8af835c8b2b39400bb56\",\r\n          \"desc\": \"addr(bcrt1q5tkfjpal6pkjdeq73turtj9jkw2qpw6kfnjp63)#3rygmz90\",\r\n          \"hex\": \"0014a2ec9907bfd06d26e41e8af835c8b2b39400bb56\",\r\n          \"address\": \"bcrt1q5tkfjpal6pkjdeq73turtj9jkw2qpw6kfnjp63\",\r\n          \"type\": \"witness_v0_keyhash\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"global_xpubs\": [\r\n  ],\r\n  \"psbt_version\": 0,\r\n  \"proprietary\": [\r\n  ],\r\n  \"unknown\": {\r\n  },\r\n  \"inputs\": [\r\n    {\r\n      \"witness_utxo\": {\r\n        \"amount\": 0.00100000,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"1 c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a\",\r\n          \"desc\": \"rawtr(c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a)#kgt72cne\",\r\n          \"hex\": \"5120c3e8e2c9fc6033f3ebcd9d5b39212f52873e8b6e356a64bd364d76e59011f33a\",\r\n          \"address\": \"bcrt1pc05w9j0uvqel867dn4dnjgf022rnazmwx44xf0fkf4mwtyq37vaqrecrxw\",\r\n          \"type\": \"witness_v1_taproot\"\r\n        }\r\n      },\r\n      \"witness_script\": {\r\n        \"asm\": \"51af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53 OP_CHECKSIG 65a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403 OP_CHECKSIGADD 71a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9 OP_CHECKSIGADD 2 OP_NUMEQUAL\",\r\n        \"hex\": \"2051af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53ac2065a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403ba2071a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9ba529c\",\r\n        \"type\": \"nonstandard\"\r\n      },\r\n      \"taproot_script_path_sigs\": [\r\n        {\r\n          \"pubkey\": \"65a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403\",\r\n          \"leaf_hash\": \"a0739e00a984d9cdfb5f08740d3c6b405af4d98baa7dfcc823cab15c8c465661\",\r\n          \"sig\": \"34ac8762e23d1521611f67ce608bf36a46ed5036b2cbc4fa3d6b8bde8d85449eea31e52422589199e63c0d0fd62fd6e03d840e00bf03d52c6e5e7987e1901a1a\"\r\n        }\r\n      ],\r\n      \"taproot_scripts\": [\r\n        {\r\n          \"script\": \"2051af6bd7bdaa1e3d2dc777c27bdf76b7ad1161ee48197cd8cf0ea4523b3dfa53ac2065a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403ba2071a79e74ad98f51b2c299de2c10f298130e2c3be2c3a266767a2c55d420749a9ba529c\",\r\n          \"leaf_ver\": 192,\r\n          \"control_blocks\": [\r\n            \"c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\"\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_bip32_derivs\": [\r\n        {\r\n          \"pubkey\": \"65a70371debcdafa542f1570282395054c082efada30e03d93c1b98cc1963403\",\r\n          \"master_fingerprint\": \"00000000\",\r\n          \"path\": \"m\",\r\n          \"leaf_hashes\": [\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_internal_key\": \"50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\",\r\n      \"taproot_merkle_root\": \"a0739e00a984d9cdfb5f08740d3c6b405af4d98baa7dfcc823cab15c8c465661\"\r\n    }\r\n  ],\r\n  \"outputs\": [\r\n    {\r\n    }\r\n  ],\r\n  \"fee\": 0.00002000\r\n}\r\n```\r\n\r\nIssue arises when script is changed to similar, but different form:\r\n`<key1> OP_CHECKSIG <key2> OP_CHECKSIGADD <key3> OP_CHECKSIGADD 2 OP_GREATERTHANOREQUAL`\r\n\r\nWith such script psbt becomes:\r\n```\r\n{\r\n  \"tx\": {\r\n    \"txid\": \"c0ee6554b98748d4bddb2f1fefae3e3470f70ba4901fceb56caf1df502cca29c\",\r\n    \"hash\": \"c0ee6554b98748d4bddb2f1fefae3e3470f70ba4901fceb56caf1df502cca29c\",\r\n    \"version\": 2,\r\n    \"size\": 82,\r\n    \"vsize\": 82,\r\n    \"weight\": 328,\r\n    \"locktime\": 0,\r\n    \"vin\": [\r\n      {\r\n        \"txid\": \"c660a8f365c54bf78f5a7f7d59d7b02d81d76434117433e0719f50b19d793c3f\",\r\n        \"vout\": 0,\r\n        \"scriptSig\": {\r\n          \"asm\": \"\",\r\n          \"hex\": \"\"\r\n        },\r\n        \"sequence\": 0\r\n      }\r\n    ],\r\n    \"vout\": [\r\n      {\r\n        \"value\": 0.00098000,\r\n        \"n\": 0,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"0 885d64578216908d6e0a745295149a648deb89cb\",\r\n          \"desc\": \"addr(bcrt1q3pwkg4uzz6gg6ms2w3ff29y6vjx7hzwt6dg29t)#2kplfgfu\",\r\n          \"hex\": \"0014885d64578216908d6e0a745295149a648deb89cb\",\r\n          \"address\": \"bcrt1q3pwkg4uzz6gg6ms2w3ff29y6vjx7hzwt6dg29t\",\r\n          \"type\": \"witness_v0_keyhash\"\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"global_xpubs\": [\r\n  ],\r\n  \"psbt_version\": 0,\r\n  \"proprietary\": [\r\n  ],\r\n  \"unknown\": {\r\n  },\r\n  \"inputs\": [\r\n    {\r\n      \"witness_utxo\": {\r\n        \"amount\": 0.00100000,\r\n        \"scriptPubKey\": {\r\n          \"asm\": \"1 acd1d2a6e6b8a5366046fc8c4b0beb0f1f731416ddfc2b6ce5e8a6ec05494d22\",\r\n          \"desc\": \"rawtr(acd1d2a6e6b8a5366046fc8c4b0beb0f1f731416ddfc2b6ce5e8a6ec05494d22)#l0v0wqh8\",\r\n          \"hex\": \"5120acd1d2a6e6b8a5366046fc8c4b0beb0f1f731416ddfc2b6ce5e8a6ec05494d22\",\r\n          \"address\": \"bcrt1p4nga9fhxhzjnvczxljxykzltpu0hx9qkmh7zkm89aznwcp2ff53qlumd30\",\r\n          \"type\": \"witness_v1_taproot\"\r\n        }\r\n      },\r\n      \"witness_script\": {\r\n        \"asm\": \"1ab6538f0041c05f205f04b8f98f671ab30059ebabba92abfc0b717b663ff6e8 OP_CHECKSIG 6b198710ea0801dd2bd0fa492745ade0287a56ad3de5db3b16cb2da00d67dd0d OP_CHECKSIGADD dcd39254d982fc1e65e71b765e278115a53d25351ccebf64c213d70f69804957 OP_CHECKSIGADD 2 OP_GREATERTHANOREQUAL\",\r\n        \"hex\": \"201ab6538f0041c05f205f04b8f98f671ab30059ebabba92abfc0b717b663ff6e8ac206b198710ea0801dd2bd0fa492745ade0287a56ad3de5db3b16cb2da00d67dd0dba20dcd39254d982fc1e65e71b765e278115a53d25351ccebf64c213d70f69804957ba52a2\",\r\n        \"type\": \"nonstandard\"\r\n      },\r\n      \"taproot_scripts\": [\r\n        {\r\n          \"script\": \"201ab6538f0041c05f205f04b8f98f671ab30059ebabba92abfc0b717b663ff6e8ac206b198710ea0801dd2bd0fa492745ade0287a56ad3de5db3b16cb2da00d67dd0dba20dcd39254d982fc1e65e71b765e278115a53d25351ccebf64c213d70f69804957ba52a2\",\r\n          \"leaf_ver\": 192,\r\n          \"control_blocks\": [\r\n            \"c150929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\"\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_bip32_derivs\": [\r\n        {\r\n          \"pubkey\": \"dcd39254d982fc1e65e71b765e278115a53d25351ccebf64c213d70f69804957\",\r\n          \"master_fingerprint\": \"00000000\",\r\n          \"path\": \"m\",\r\n          \"leaf_hashes\": [\r\n          ]\r\n        }\r\n      ],\r\n      \"taproot_internal_key\": \"50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0\",\r\n      \"taproot_merkle_root\": \"8dcf9fd2a9bff82480b8113d97bdd1f1b0324c58cb7f767421bf4764e6e40536\"\r\n    }\r\n  ],\r\n  \"outputs\": [\r\n    {\r\n    }\r\n  ],\r\n  \"fee\": 0.00002000\r\n}\r\n```\r\n\r\nIn this case bitcoind, returns the same psbt, without `taproot_script_path_sigs` field or any error.\r\n\r\nI actually created question on bitcoin stack exchange - https://bitcoin.stackexchange.com/questions/122759/how-can-i-sign-custom-tapscript-leaf-using-bitcoind-walletprocesspsbt-rpc-endp, but looked into this a bit deeper and isolated \r\n`OP_GREATERTHANOREQUAL` as op code which made all difference.\r\n\n\n### Expected behaviour\n\nIn this case I would expect:\r\n- either return signatures also for script containing `OP_GREATERTHANOREQUAL`\r\n- or return error saying that this op_code is not supported for `walletprocesspsbt` call\n\n### Steps to reproduce\n\n1. Create wallet with the `key` which should later become part of the multisig.\r\n2. Create taproot output with one script spending path. The script should be the taproot multi sig (`OP_CHECKSIGADD`) with `OP_GREATERTHANOREQUAL` opcode and contain `key` created in step 1\r\n3. Create `psbt` and call `walletprocesspsbt` endpoint on wallet created in step 1\r\n4. Response should be an error or psbt with signature made by `key`\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv26.0\n\n### Operating system and version\n\n\"MacOs Sonoma 14.3\"\n\n### Machine specifications\n\n_No response_",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 0,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949/comments",
   "created_at" : "2024-04-24T07:43:25Z",
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/issues/29949",
   "id" : 2260609839,
   "labels" : [],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "I_kwDOABII586Gvisv",
   "number" : 29949,
   "performed_via_github_app" : null,
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949/timeline",
   "title" : "Calling `walletprocesspsbt` to sign multisig containing `OP_GREATERTHANOREQUAL` op_code",
   "updated_at" : "2024-04-24T07:43:25Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29949",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/10688236?v=4",
      "events_url" : "https://api.github.com/users/KonradStaniec/events{/privacy}",
      "followers_url" : "https://api.github.com/users/KonradStaniec/followers",
      "following_url" : "https://api.github.com/users/KonradStaniec/following{/other_user}",
      "gists_url" : "https://api.github.com/users/KonradStaniec/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/KonradStaniec",
      "id" : 10688236,
      "login" : "KonradStaniec",
      "node_id" : "MDQ6VXNlcjEwNjg4MjM2",
      "organizations_url" : "https://api.github.com/users/KonradStaniec/orgs",
      "received_events_url" : "https://api.github.com/users/KonradStaniec/received_events",
      "repos_url" : "https://api.github.com/users/KonradStaniec/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/KonradStaniec/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/KonradStaniec/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/KonradStaniec"
   }
}
