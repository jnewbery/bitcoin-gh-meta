{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "MEMBER",
   "body" : "Motivated by https://github.com/bitcoin/bitcoin/pull/28970#discussion_r1576401327\r\n\r\nAdds the following fixups in txorphan fuzz tests:\r\n\r\n- Don't bond the output count of the created orphans to the number of available coins\r\n- Allow duplicate inputs but don't store duplicate outpoints\r\n\r\nMost significantly, this gets rid of the `duplicate_input` flag altogether, making the test easier to reason about. Notice how, under normal conditions, duplicate inputs would be caught by `MemPoolAccept::PreChecks`, however, no validations checks are run on the test before adding data to the orphanage (neither were they before this patch)\r\n\r\n## Rationale\r\n\r\nThe way the test is currently written, duplicate inputs are allowed based on a random flag (`duplicate_input`). If the flag is unset, upon selecting an outpoint as input for a new transaction, the input is popped to prevent re-selection and later re-added to the collection (once all inputs have been picked). However, the re-addition to the collection is performed independently of whether the flag was set or not. This means that, if the flag is set, the selected inputs are duplicated which in turn makes these inputs more likely to be re-picked in the following iteration of the loop.\r\n\r\nAdditionally, both the input and output count of the transaction are bonded to the number of available outpoints. This makes sense for the former, but the latter shouldn't be.",
   "closed_at" : "2024-05-13T15:01:45Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
      "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
      "followers_url" : "https://api.github.com/users/glozow/followers",
      "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/glozow",
      "id" : 25183001,
      "login" : "glozow",
      "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
      "organizations_url" : "https://api.github.com/users/glozow/orgs",
      "received_events_url" : "https://api.github.com/users/glozow/received_events",
      "repos_url" : "https://api.github.com/users/glozow/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/glozow"
   },
   "comments" : 5,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974/comments",
   "created_at" : "2024-04-26T18:46:01Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29974",
   "id" : 2266326928,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585t30F1",
   "number" : 29974,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29974.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29974",
      "merged_at" : "2024-05-13T15:01:45Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29974.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29974"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974/timeline",
   "title" : "fuzz: txorphan tests fixups",
   "updated_at" : "2024-05-13T15:01:45Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29974",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/6665628?v=4",
      "events_url" : "https://api.github.com/users/sr-gi/events{/privacy}",
      "followers_url" : "https://api.github.com/users/sr-gi/followers",
      "following_url" : "https://api.github.com/users/sr-gi/following{/other_user}",
      "gists_url" : "https://api.github.com/users/sr-gi/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/sr-gi",
      "id" : 6665628,
      "login" : "sr-gi",
      "node_id" : "MDQ6VXNlcjY2NjU2Mjg=",
      "organizations_url" : "https://api.github.com/users/sr-gi/orgs",
      "received_events_url" : "https://api.github.com/users/sr-gi/received_events",
      "repos_url" : "https://api.github.com/users/sr-gi/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/sr-gi/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/sr-gi/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/sr-gi"
   }
}
