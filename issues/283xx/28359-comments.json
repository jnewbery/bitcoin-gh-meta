[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/28359#pullrequestreview-1610589147) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-08-28T19:29:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1696255910",
      "id" : 1696255910,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lGs-m",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1696255910/reactions"
      },
      "updated_at" : "2023-09-05T09:07:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1696255910",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "For reference, the CI failure, which should also reproduce in valgrind/msan if forcing a side-effect: https://cirrus-ci.com/task/6321987505618944?logs=ci#L3413\r\n\r\n```\r\n node0 stderr leveldb/db/db_impl.cc:1032:25: runtime error: implicit conversion from type 'uint64_t' (aka 'unsigned long') of value 12297829382473034410 (64-bit, unsigned) to type 'int64_t' (aka 'long') changed the value to -6148914691236517206 (64-bit, signed)\r\n    #0 0x55b9c99524ac in leveldb::DBImpl::DoCompactionWork(leveldb::DBImpl::CompactionState*) src/leveldb/db/db_impl.cc:1032:25\r\n    #1 0x55b9c994d9c4 in leveldb::DBImpl::BackgroundCompaction() src/leveldb/db/db_impl.cc:746:14\r\n    #2 0x55b9c994c1df in leveldb::DBImpl::BackgroundCall() src/leveldb/db/db_impl.cc:687:5\r\n    #3 0x55b9c99f6d96 in leveldb::(anonymous namespace)::PosixEnv::BackgroundThreadMain() src/leveldb/util/env_posix.cc:830:5\r\n    #4 0x55b9c99f6d96 in leveldb::(anonymous namespace)::PosixEnv::BackgroundThreadEntryPoint(leveldb::(anonymous namespace)::PosixEnv*) src/leveldb/util/env_posix.cc:736:10\r\n    #5 0x7fdf9f955362  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xe6362) (BuildId: 1fcdadafe5a79e1031ab0da645aa3798954cf53d)\r\n    #6 0x7fdf9f5d7189  (/lib/x86_64-linux-gnu/libc.so.6+0x8f189) (BuildId: bdb8aa3b1b60f9d43e1c70ba98158e05f765efdc)\r\n    #7 0x7fdf9f665bcf  (/lib/x86_64-linux-gnu/libc.so.6+0x11dbcf) (BuildId: bdb8aa3b1b60f9d43e1c70ba98158e05f765efdc)\r\nSUMMARY: UndefinedBehaviorSanitizer: implicit-integer-sign-change leveldb/db/db_impl.cc:1032:25 in \r\n```\r\n\r\n\r\nSince leveldb is unmaintained, the easiest fix would be to remove the buggy part of the logging code, which I guess never worked and no one noticed anyway?\r\n\r\n```diff\r\ndiff --git a/src/leveldb/db/db_impl.cc b/src/leveldb/db/db_impl.cc\r\nindex 65e31724bc..a0f8eda244 100644\r\n--- a/src/leveldb/db/db_impl.cc\r\n+++ b/src/leveldb/db/db_impl.cc\r\n@@ -537,7 +537,6 @@ Status DBImpl::WriteLevel0Table(MemTable* mem, VersionEdit* edit,\r\n \r\n   CompactionStats stats;\r\n   stats.micros = env_->NowMicros() - start_micros;\r\n-  stats.bytes_written = meta.file_size;\r\n   stats_[level].Add(stats);\r\n   return s;\r\n }\r\n@@ -1028,9 +1027,6 @@ Status DBImpl::DoCompactionWork(CompactionState* compact) {\r\n       stats.bytes_read += compact->compaction->input(which, i)->file_size;\r\n     }\r\n   }\r\n-  for (size_t i = 0; i < compact->outputs.size(); i++) {\r\n-    stats.bytes_written += compact->outputs[i].file_size;\r\n-  }\r\n \r\n   mutex_.Lock();\r\n   stats_[compact->compaction->level() + 1].Add(stats);\r\n@@ -1416,7 +1412,7 @@ bool DBImpl::GetProperty(const Slice& property, std::string* value) {\r\n                  files, versions_->NumLevelBytes(level) / 1048576.0,\r\n                  stats_[level].micros / 1e6,\r\n                  stats_[level].bytes_read / 1048576.0,\r\n-                 stats_[level].bytes_written / 1048576.0);\r\n+                 0 / 1048576.0);\r\n         value->append(buf);\r\n       }\r\n     }\r\ndiff --git a/src/leveldb/db/db_impl.h b/src/leveldb/db/db_impl.h\r\nindex 685735c733..8816a30a33 100644\r\n--- a/src/leveldb/db/db_impl.h\r\n+++ b/src/leveldb/db/db_impl.h\r\n@@ -88,17 +88,15 @@ class DBImpl : public DB {\r\n   // Per level compaction stats.  stats_[level] stores the stats for\r\n   // compactions that produced data for the specified \"level\".\r\n   struct CompactionStats {\r\n-    CompactionStats() : micros(0), bytes_read(0), bytes_written(0) {}\r\n+    CompactionStats() : micros(0), bytes_read(0) {}\r\n \r\n     void Add(const CompactionStats& c) {\r\n       this->micros += c.micros;\r\n       this->bytes_read += c.bytes_read;\r\n-      this->bytes_written += c.bytes_written;\r\n     }\r\n \r\n     int64_t micros;\r\n     int64_t bytes_read;\r\n-    int64_t bytes_written;\r\n   };\r\n \r\n   Iterator* NewInternalIterator(const ReadOptions&,\r\n",
      "created_at" : "2023-08-30T08:08:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1698694748",
      "id" : 1698694748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lQAZc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698694748/reactions"
      },
      "updated_at" : "2023-08-30T08:08:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698694748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and made CI green",
      "created_at" : "2023-08-30T10:57:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1698940857",
      "id" : 1698940857,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lQ8e5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698940857/reactions"
      },
      "updated_at" : "2023-08-30T10:57:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1698940857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK - Should we just put the leveldb changes into our subtree?",
      "created_at" : "2023-08-30T15:23:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1699388140",
      "id" : 1699388140,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lSprs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699388140/reactions"
      },
      "updated_at" : "2023-08-30T15:23:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699388140",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Concept ACK - Should we just put the leveldb changes into our subtree?\r\n\r\nYes, someone can create a pull request and see what happens. I am happy to review, but will probably not create it. Seems fine to have a test-only trivial patch to enable a useful sanitizer.",
      "created_at" : "2023-08-30T15:30:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1699400418",
      "id" : 1699400418,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lSsri",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699400418/reactions"
      },
      "updated_at" : "2023-08-30T15:30:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699400418",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Yea. I will get to pulling upstream leveldb & integrating these. Opened https://github.com/bitcoin-core/leveldb-subtree/issues/37.",
      "created_at" : "2023-09-05T09:05:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1706229164",
      "id" : 1706229164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lsv2s",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706229164/reactions"
      },
      "updated_at" : "2023-09-05T09:05:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706229164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/863730?v=4",
         "events_url" : "https://api.github.com/users/fanquake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fanquake/followers",
         "following_url" : "https://api.github.com/users/fanquake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fanquake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fanquake",
         "id" : 863730,
         "login" : "fanquake",
         "node_id" : "MDQ6VXNlcjg2MzczMA==",
         "organizations_url" : "https://api.github.com/users/fanquake/orgs",
         "received_events_url" : "https://api.github.com/users/fanquake/received_events",
         "repos_url" : "https://api.github.com/users/fanquake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fanquake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fanquake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> going to get back to fixing up the cxxflags usage in CI, but not a blocker here:\r\n\r\nYeah, that is intentional and the recommended way to set compiler flags in the CI, no? Otherwise, it will just disable the -O2 again, which would be bad?",
      "created_at" : "2023-09-05T09:10:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28359#issuecomment-1706237516",
      "id" : 1706237516,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28359",
      "node_id" : "IC_kwDOABII585lsx5M",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706237516/reactions"
      },
      "updated_at" : "2023-09-05T09:10:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706237516",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   }
]
