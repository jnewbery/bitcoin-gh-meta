[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/26966).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/26966#pullrequestreview-1275543891), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/26966#pullrequestreview-1749211886) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29623](https://github.com/bitcoin/bitcoin/pull/29623) (Simplify network-adjusted time warning logic by stickies-v)\n* [#29346](https://github.com/bitcoin/bitcoin/pull/29346) (Stratum v2 Noise Protocol by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-01-25T13:36:26Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1403631860",
      "id" : 1403631860,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585Tqbj0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403631860/reactions"
      },
      "updated_at" : "2024-04-23T09:26:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403631860",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Cool, will take it for a spin...",
      "created_at" : "2023-01-26T14:38:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1405102999",
      "id" : 1405102999,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585TwCuX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405102999/reactions"
      },
      "updated_at" : "2023-01-26T14:38:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405102999",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Cool @Sjors, just pushed a small update. Found a little bug.\r\n\r\nGoing to add an important note to the PR description (because otherwise testing results will vary a lot):\r\n\r\nAs the access to the block data on disk is protected by `cs_main`, this new feature runs substantially\r\nfaster when the node is not in IBD.\r\n(where \"substantially\" here means full index sync, with 5 workers, in less than 20 minutes in my computer).",
      "created_at" : "2023-01-28T15:18:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1407420783",
      "id" : 1407420783,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585T44lv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407420783/reactions"
      },
      "updated_at" : "2023-01-28T15:18:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1407420783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> It's probably much easier suggested than done, but did you attempt to implement parallelization in a more general way so that other indices could benefit from it as well?\r\n\r\nYeah, that is part of the plan. I started with the block filter index because it requires an special treatment that `txindex` parallelization does not require (block/undo data reading and block filters creation can be parallelized but writing must be done sequentially due the need to link filter headers to their predecessors to create the filters-chain on disk).\r\n\r\nMy idea was to start reviewing this one, so the process gets as clean as possible, and then move forward with the generalization step. It's usually more natural to abstract processes when the specific cases are well-defined.",
      "created_at" : "2023-01-30T13:37:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1408645764",
      "id" : 1408645764,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585T9jqE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408645764/reactions"
      },
      "updated_at" : "2023-01-30T13:37:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408645764",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Building the index on (AMD Ryzen 7950X, blocks stored on SSD):\r\n* master @ fe86616bb4ad0c4296d34299bc2e2f0fca1fe936: 35'15\" (mostly 1 alternating CPU thread)\r\n* this PR (rebased)\r\n  * n=8: 5'20\" (uses about 8 of 32 CPU threads as expected)\r\n  * n=32: 4'26\" (pleasantly close to 100% CPU usage with a dip every 10 seconds, but it drops to only 1 CPU in the last minute or two)\r\n  \r\nI made sure to not load any wallets and disabled other indexes.\r\n\r\nI didn't test if the index was correct.\r\n\r\nI wonder if, for users without this index, it would be faster to generate the index, rescan the wallet and then delete it again. Combined with #26951 you would only have to generate filters up to the age of the wallet (IIUC, cc @pstratem).\r\n\r\nNote to self for future benchmarks: `-txindex` takes 1:07'14\", `-coinstatsindex` takes 3.5 hours.",
      "created_at" : "2023-02-07T13:47:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1420800151",
      "id" : 1420800151,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585Ur7CX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 1,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420800151/reactions"
      },
      "updated_at" : "2023-02-07T18:47:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420800151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Great results @Sjors!.\r\n\r\nCould also give it a run rebased on top #27006.\r\nOn master, the index initial sync is slower when the node is in IBD because the index thread has to compete for access to block data on disk through `cs_main` acquisition.\r\n\r\n> I didn't test if the index was correct.\r\n\r\nThe PR contain a test verifying it.\r\n\r\n----------------------------------------------\r\n\r\nSide note:\r\nI'm working on generalizing the parallelization flow so other indexes, like the txindex and #26951 can make use of it too.",
      "created_at" : "2023-02-07T14:18:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1420850865",
      "id" : 1420850865,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585UsHax",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420850865/reactions"
      },
      "updated_at" : "2023-02-07T14:27:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1420850865",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-02-17T23:32:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1435394565",
      "id" : 1435394565,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585VjmIF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435394565/reactions"
      },
      "updated_at" : "2023-02-17T23:32:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435394565",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "PR updated, most of it implementation has changed.\r\n\r\nThe news are:\r\n1) Decreased ThreadSync `cs_main` lock contention.\r\n2) Removed `CBlockIndex` access from the child indexes internals.\r\n3) Implemented generic workers pool.\r\n4) Introduced a last header cache for the Block Filter index. Avoiding disk reads on every new processed block.\r\n5) Enabled parallel sync on the tx index.\r\n\r\nImportant Note:\r\nThe introduced workers pool spawned by the `-indexworkers` init arg is shared among all the enabled indexes that support parallel sync.\r\n\r\nThe implementation uses `std::any` mainly to simplify the patch-set, the base class template form of it requires a larger set of changes.\r\n\r\nSide note: in a first glance and without going too far over the coinstats index implementation, I would say that it could also be parallelized. But will leave it for a follow-up to not continue expanding the PR size.\r\n\r\nFuture (doesn't need to be included here, just mentioning so the path is clear):\r\nI'm working on decoupling the initial sync logic into a separate structure, so indexes subscribe to events instead of reading blocks from disk by themselves.",
      "created_at" : "2023-02-28T12:40:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1448113513",
      "id" : 1448113513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585WUHVp",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1448113513/reactions"
      },
      "updated_at" : "2023-02-28T12:40:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1448113513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-05-11T10:29:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1543743831",
      "id" : 1543743831,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585cA6lX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1543743831/reactions"
      },
      "updated_at" : "2023-05-11T10:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1543743831",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-06-30T11:24:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1614516340",
      "id" : 1614516340,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585gO5B0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1614516340/reactions"
      },
      "updated_at" : "2023-06-30T11:24:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1614516340",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-07-06T22:10:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1624375049",
      "id" : 1624375049,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585g0f8J",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624375049/reactions"
      },
      "updated_at" : "2023-07-06T22:10:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1624375049",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Could mark as draft while CI is red?",
      "created_at" : "2023-09-04T20:34:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1705682424",
      "id" : 1705682424,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585lqqX4",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705682424/reactions"
      },
      "updated_at" : "2023-09-04T20:34:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705682424",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "It looks like tsan failed, but there is no log, when there should be a log. Maybe it was accidentally removed by https://github.com/bitcoin/bitcoin/pull/27667 ?",
      "created_at" : "2023-09-06T05:47:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1707706393",
      "id" : 1707706393,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585lyYgZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1707706393/reactions"
      },
      "updated_at" : "2023-09-06T05:47:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1707706393",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-12T10:33:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1715469618",
      "id" : 1715469618,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585mP_0y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715469618/reactions"
      },
      "updated_at" : "2023-09-12T10:33:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715469618",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-10-02T21:55:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1743825774",
      "id" : 1743825774,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585n8Ktu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743825774/reactions"
      },
      "updated_at" : "2023-10-02T21:55:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1743825774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "CI is still red. Also, how would this work with AU?",
      "created_at" : "2023-10-25T09:16:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1778849023",
      "id" : 1778849023,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585qBxT_",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778849023/reactions"
      },
      "updated_at" : "2023-10-25T09:16:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778849023",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Could also give it a run rebased on top #27006.\r\n\r\nThat PR currently does not cleanly cherry-pick on top of this PR, not can I (trivially) rebase this PR on top top of it. Happy to try if you can make a branch.\r\n\r\nI just tried it again, deleting the blockfilterindex and rebuilding it. My impression is that it's going slower than before and I'm not seeing much CPU activity.\r\n\r\nI also noticed the shutdown takes a very long time, with the indexer (?) threads sticking around for many minutes:\r\n\r\n<img width=\"760\" alt=\"SchermÂ­afbeelding 2023-11-07 om 21 16 24\" src=\"https://github.com/bitcoin/bitcoin/assets/10217/909e8257-44e9-4c9c-8744-1876a9c41a9b\">\r\n",
      "created_at" : "2023-11-07T11:09:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1798294413",
      "id" : 1798294413,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585rL8uN",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798294413/reactions"
      },
      "updated_at" : "2023-11-07T12:18:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1798294413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404328365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404328365"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "NIt: Might take this opportunity to add the <uint256.h> header?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T12:58:03Z",
      "diff_hunk" : "@@ -42,6 +42,9 @@ class BlockFilterIndex final : public BaseIndex\n     /** cache of block hash to filter header, to avoid disk access when responding to getcfcheckpt. */\n     std::unordered_map<uint256, uint256, FilterHeaderHasher> m_headers_cache GUARDED_BY(m_cs_headers_cache);\n \n+    // Last computed header to avoid disk reads at every new block.\n+    uint256 last_header{};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404328365",
      "id" : 1404328365,
      "line" : 46,
      "node_id" : "PRRC_kwDOABII585TtFmt",
      "original_commit_id" : "003f076a150c1237e4b9b212265d4665a32dcb5c",
      "original_line" : 46,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/index/blockfilterindex.h",
      "position" : 5,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404328365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404328365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404459012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404459012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "NIt: `// In case it hasn't been stoppped.`",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T15:18:11Z",
      "diff_hunk" : "@@ -0,0 +1,124 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_THREADPOOL_H\n+#define BITCOIN_UTIL_THREADPOOL_H\n+\n+#include <sync.h>\n+#include <util/string.h>\n+#include <util/threadnames.h>\n+\n+#include <condition_variable>\n+#include <future>\n+#include <queue>\n+#include <thread>\n+\n+class ThreadPool {\n+\n+private:\n+    Mutex cs_work_queue;\n+    std::queue<std::function<void()>> m_work_queue GUARDED_BY(cs_work_queue);\n+    std::condition_variable m_condition;\n+    // Stop indicator\n+    std::atomic<bool> m_stop{false};\n+    // Worker threads\n+    std::vector<std::thread> m_workers;\n+\n+    void WorkerThread(const std::string& thread_name) EXCLUSIVE_LOCKS_REQUIRED(!cs_work_queue)\n+    {\n+        util::ThreadRename(std::string{thread_name});\n+        WAIT_LOCK(cs_work_queue, wait_lock);\n+        while (!m_stop.load()) {\n+            std::function<void()> task;\n+            {\n+                // Wait for the task or until the stop flag is set\n+                m_condition.wait(wait_lock,[&]() EXCLUSIVE_LOCKS_REQUIRED(cs_work_queue) { return m_stop.load() || !m_work_queue.empty(); });\n+\n+                // If stopped, exit worker.\n+                if (m_stop.load() && m_work_queue.empty()) {\n+                    return;\n+                }\n+\n+                // Pop the task\n+                task = std::move(m_work_queue.front());\n+                m_work_queue.pop();\n+            }\n+\n+            // Execute the task without the lock\n+            WITH_REVERSE_LOCK(wait_lock, task());\n+        }\n+    }\n+\n+public:\n+    ThreadPool() {}\n+\n+    ~ThreadPool()\n+    {\n+        Stop(); // In case it hasn't being stopped.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404459012",
      "id" : 1404459012,
      "line" : 58,
      "node_id" : "PRRC_kwDOABII585TtlgE",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 58,
      "original_position" : 58,
      "original_start_line" : null,
      "path" : "src/util/threadpool.h",
      "position" : 58,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404459012/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404459012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404460151"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404460151"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nit: Adjust copyright date.",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T15:19:04Z",
      "diff_hunk" : "@@ -0,0 +1,158 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404460151",
      "id" : 1404460151,
      "line" : 1,
      "node_id" : "PRRC_kwDOABII585Ttlx3",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 1,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/threadpool_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404460151/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404460151",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404471253"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404471253"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "If I run IWYU locally, it reports the following headers as missing:\r\n```\r\n#include <cstddef>            // for size_t\r\n#include <algorithm>           // for max\r\n#include <atomic>              // for atomic\r\n#include <functional>          // for function\r\n#include <memory>              // for make_shared\r\n#include <stdexcept>           // for runtime_error\r\n#include <utility>             // for move, swap\r\n#include <vector>              // for vector\r\n```",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T15:32:09Z",
      "diff_hunk" : "@@ -0,0 +1,124 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_THREADPOOL_H\n+#define BITCOIN_UTIL_THREADPOOL_H\n+\n+#include <sync.h>\n+#include <util/string.h>\n+#include <util/threadnames.h>\n+\n+#include <condition_variable>\n+#include <future>\n+#include <queue>\n+#include <thread>\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404471253",
      "id" : 1404471253,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII585TtofV",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 16,
      "original_position" : 16,
      "original_start_line" : null,
      "path" : "src/util/threadpool.h",
      "position" : 16,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404471253/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404471253",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404663869"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404663869"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Just a comment: It would be nice if we could re-use the `CThreadInterrupt` interface here, but I don't think it's easily possible.",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T22:37:07Z",
      "diff_hunk" : "@@ -0,0 +1,124 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_THREADPOOL_H\n+#define BITCOIN_UTIL_THREADPOOL_H\n+\n+#include <sync.h>\n+#include <util/string.h>\n+#include <util/threadnames.h>\n+\n+#include <condition_variable>\n+#include <future>\n+#include <queue>\n+#include <thread>\n+\n+class ThreadPool {\n+\n+private:\n+    Mutex cs_work_queue;\n+    std::queue<std::function<void()>> m_work_queue GUARDED_BY(cs_work_queue);\n+    std::condition_variable m_condition;\n+    // Stop indicator\n+    std::atomic<bool> m_stop{false};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404663869",
      "id" : 1404663869,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585TuXg9",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/util/threadpool.h",
      "position" : 24,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404663869/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404663869",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404664671"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404664671"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why is this added?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-24T22:41:50Z",
      "diff_hunk" : "@@ -0,0 +1,124 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_THREADPOOL_H\n+#define BITCOIN_UTIL_THREADPOOL_H\n+\n+#include <sync.h>\n+#include <util/string.h>\n+#include <util/threadnames.h>\n+\n+#include <condition_variable>\n+#include <future>\n+#include <queue>\n+#include <thread>\n+\n+class ThreadPool {\n+\n+private:\n+    Mutex cs_work_queue;\n+    std::queue<std::function<void()>> m_work_queue GUARDED_BY(cs_work_queue);\n+    std::condition_variable m_condition;\n+    // Stop indicator\n+    std::atomic<bool> m_stop{false};\n+    // Worker threads\n+    std::vector<std::thread> m_workers;\n+\n+    void WorkerThread(const std::string& thread_name) EXCLUSIVE_LOCKS_REQUIRED(!cs_work_queue)\n+    {\n+        util::ThreadRename(std::string{thread_name});\n+        WAIT_LOCK(cs_work_queue, wait_lock);\n+        while (!m_stop.load()) {\n+            std::function<void()> task;\n+            {\n+                // Wait for the task or until the stop flag is set\n+                m_condition.wait(wait_lock,[&]() EXCLUSIVE_LOCKS_REQUIRED(cs_work_queue) { return m_stop.load() || !m_work_queue.empty(); });\n+\n+                // If stopped, exit worker.\n+                if (m_stop.load() && m_work_queue.empty()) {\n+                    return;\n+                }\n+\n+                // Pop the task\n+                task = std::move(m_work_queue.front());\n+                m_work_queue.pop();\n+            }\n+\n+            // Execute the task without the lock\n+            WITH_REVERSE_LOCK(wait_lock, task());\n+        }\n+    }\n+\n+public:\n+    ThreadPool() {}\n+\n+    ~ThreadPool()\n+    {\n+        Stop(); // In case it hasn't being stopped.\n+    }\n+\n+    void Start(int num_workers)\n+    {\n+        if (!m_workers.empty()) throw std::runtime_error(\"Thread pool already started\");\n+\n+        // Create the workers\n+        for (int i=0; i<num_workers; i++) {\n+            m_workers.emplace_back(&ThreadPool::WorkerThread, this, \"threadpool_worker_\" + ToString(i));\n+        }\n+    }\n+\n+    void Stop()\n+    {\n+        // Notify workers and join them.\n+        m_stop = true;\n+        m_condition.notify_all();\n+        for (auto& worker : m_workers) {\n+            worker.join();\n+        }\n+        m_workers.clear();\n+        m_stop = false;\n+    }\n+\n+    template<class T> EXCLUSIVE_LOCKS_REQUIRED(!cs_work_queue)\n+    auto Submit(T task) -> std::future<decltype(task())>\n+    {\n+        auto ptr_task = std::make_shared<std::packaged_task<decltype(task()) ()>>(std::move(task));\n+        std::future<decltype(task())> future = ptr_task->get_future();\n+        {\n+            LOCK(cs_work_queue);\n+            m_work_queue.emplace([=]() {\n+                (*ptr_task)();\n+            });\n+        }\n+        m_condition.notify_one();\n+        return future;\n+    }\n+\n+    // Synchronous processing\n+    void ProcessTask() EXCLUSIVE_LOCKS_REQUIRED(!cs_work_queue)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404664671",
      "id" : 1404664671,
      "line" : 99,
      "node_id" : "PRRC_kwDOABII585TuXtf",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 99,
      "original_position" : 99,
      "original_start_line" : null,
      "path" : "src/util/threadpool.h",
      "position" : 99,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404664671/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404664671",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404871876"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404871876"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't think it would be necessary for the tasks themselves, since you already demonstrate in the tests how to retrieve exceptions, but I think some kind of exception handling and infomation logging similar to the one of `util::TraceThread` would still be nice. Did you choose not to use `TraceThread` on purpose?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T12:37:05Z",
      "diff_hunk" : "@@ -0,0 +1,124 @@\n+// Copyright (c) 2023-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_THREADPOOL_H\n+#define BITCOIN_UTIL_THREADPOOL_H\n+\n+#include <sync.h>\n+#include <util/string.h>\n+#include <util/threadnames.h>\n+\n+#include <condition_variable>\n+#include <future>\n+#include <queue>\n+#include <thread>\n+\n+class ThreadPool {\n+\n+private:\n+    Mutex cs_work_queue;\n+    std::queue<std::function<void()>> m_work_queue GUARDED_BY(cs_work_queue);\n+    std::condition_variable m_condition;\n+    // Stop indicator\n+    std::atomic<bool> m_stop{false};\n+    // Worker threads\n+    std::vector<std::thread> m_workers;\n+\n+    void WorkerThread(const std::string& thread_name) EXCLUSIVE_LOCKS_REQUIRED(!cs_work_queue)\n+    {\n+        util::ThreadRename(std::string{thread_name});\n+        WAIT_LOCK(cs_work_queue, wait_lock);\n+        while (!m_stop.load()) {\n+            std::function<void()> task;\n+            {\n+                // Wait for the task or until the stop flag is set\n+                m_condition.wait(wait_lock,[&]() EXCLUSIVE_LOCKS_REQUIRED(cs_work_queue) { return m_stop.load() || !m_work_queue.empty(); });\n+\n+                // If stopped, exit worker.\n+                if (m_stop.load() && m_work_queue.empty()) {\n+                    return;\n+                }\n+\n+                // Pop the task\n+                task = std::move(m_work_queue.front());\n+                m_work_queue.pop();\n+            }\n+\n+            // Execute the task without the lock\n+            WITH_REVERSE_LOCK(wait_lock, task());\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404871876",
      "id" : 1404871876,
      "line" : 50,
      "node_id" : "PRRC_kwDOABII585TvKTE",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 50,
      "original_position" : 50,
      "original_start_line" : null,
      "path" : "src/util/threadpool.h",
      "position" : 50,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404871876/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404871876",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404873978"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404873978"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could use this test to stress test the pool a bit with more tasks?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T12:44:25Z",
      "diff_hunk" : "@@ -0,0 +1,158 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/threadpool.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(threadpool_tests)\n+\n+BOOST_AUTO_TEST_CASE(threadpool_basic)\n+{\n+    // Test Cases\n+    // 1) Submit tasks and verify completion.\n+    // 2) Maintain all threads busy except one.\n+    // 3) Wait for work to finish.\n+    // 4) Wait for result object.\n+    // 5) The task throws an exception, catch must be done in the consumer side.\n+    // 6) Busy workers, help them by processing tasks from outside.\n+\n+    // Test case 1, submit tasks and verify completion.\n+    {\n+        int num_workers = 3;\n+        int num_tasks = 50;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404873978",
      "id" : 1404873978,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585TvKz6",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 24,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/test/threadpool_tests.cpp",
      "position" : 24,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404873978/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404873978",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404874302"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404874302"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think a test where each task is assigned slightly different data would be nice. Something like:\r\n```c++\r\n+        std::atomic<int> par_sum{0};\r\n+        for (int i = 0; i < num_tasks; i++) {\r\n+            threadPool.Submit([&par_sum,i]() {\r\n+                par_sum += i;\r\n             });\r\n         }\r\n+        int sync_sum{0};\r\n+        for (int i = 0; i < num_tasks; i++) {\r\n+            sync_sum += i;\r\n+        }\r\n```",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T12:45:50Z",
      "diff_hunk" : "@@ -0,0 +1,158 @@\n+// Copyright (c) 2012-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/threadpool.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(threadpool_tests)\n+\n+BOOST_AUTO_TEST_CASE(threadpool_basic)\n+{\n+    // Test Cases\n+    // 1) Submit tasks and verify completion.\n+    // 2) Maintain all threads busy except one.\n+    // 3) Wait for work to finish.\n+    // 4) Wait for result object.\n+    // 5) The task throws an exception, catch must be done in the consumer side.\n+    // 6) Busy workers, help them by processing tasks from outside.\n+\n+    // Test case 1, submit tasks and verify completion.\n+    {\n+        int num_workers = 3;\n+        int num_tasks = 50;\n+\n+        ThreadPool threadPool;\n+        threadPool.Start(num_workers);\n+        std::atomic<int> counter = 0;\n+        for (int i=0; i<num_tasks; i++) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1404874302",
      "id" : 1404874302,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII585TvK4-",
      "original_commit_id" : "46e74257f22ea35f21b522c5b01c8cc99e4d5482",
      "original_line" : 29,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/test/threadpool_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 1747911419,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404874302/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T12:53:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1404874302",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This all looks pretty promising. I left some feedback before continuing with the latter half of the PR.",
      "created_at" : "2023-11-25T12:54:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1826301507",
      "id" : 1826301507,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585s2yZD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1826301507/reactions"
      },
      "updated_at" : "2023-11-25T12:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1826301507",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405161198"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405161198"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`static constexpr int16_t INDEX_WORKERS_COUNT{0}` (and similarly below)?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T16:22:29Z",
      "diff_hunk" : "@@ -16,13 +16,17 @@ class CBlock;\n class CBlockIndex;\n class Chainstate;\n class ChainstateManager;\n+class ThreadPool;\n namespace interfaces {\n class Chain;\n } // namespace interfaces\n namespace Consensus {\n     struct Params;\n }\n \n+/** Number of concurrent jobs during the initial sync process */\n+const int16_t INDEX_WORKERS_COUNT = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405161198",
      "id" : 1405161198,
      "line" : 29,
      "node_id" : "PRRC_kwDOABII585TwQ7u",
      "original_commit_id" : "7b2d4d471ae251d4c22184dda26b73993a65eff8",
      "original_line" : 28,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/index/base.h",
      "position" : 20,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405161198/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405161198",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405168955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405168955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit 7b2d4d471ae251d4c22184dda26b73993a65eff8: Could the `AllowParallelSync` method be moved to this commit?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T16:46:03Z",
      "diff_hunk" : "@@ -1966,7 +1970,21 @@ bool StartIndexBackgroundSync(NodeContext& node)\n         }\n     }\n \n+    std::shared_ptr<ThreadPool> thread_pool;\n+    if (node.args->IsArgSet(\"-indexworkers\")) {\n+        int index_workers = node.args->GetIntArg(\"-indexworkers\", INDEX_WORKERS_COUNT);\n+        if (index_workers < 0 || index_workers > 100) return InitError(_(\"Invalid -indexworkers arg\"));\n+\n+        thread_pool = std::make_shared<ThreadPool>();\n+        thread_pool->Start(index_workers);\n+    }\n+\n     // Start threads\n-    for (auto index : node.indexes) if (!index->StartBackgroundSync()) return false;\n+    for (auto index : node.indexes) {\n+        // todo: Only provide thread pool to indexes that supports parallel sync",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405168955",
      "id" : 1405168955,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585TwS07",
      "original_commit_id" : "7b2d4d471ae251d4c22184dda26b73993a65eff8",
      "original_line" : 1984,
      "original_position" : 41,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : null,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405168955/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405168955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405180029"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180029"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Make `max_blocks_to_sync`, `tip_height`, and `remaining_blocks` `const`.",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T17:25:51Z",
      "diff_hunk" : "@@ -205,9 +217,53 @@ void BaseIndex::ThreadSync()\n                            __func__, GetName());\n                 return;\n             }\n-            pindex = pindex_next;\n \n+            // By default, parallel sync disabled\n+            int work_chunk = 1;\n+            int workers_count = 0;\n+            std::vector<std::future<std::vector<std::any>>> futures;\n+            const CBlockIndex* it_start = pindex_next;\n+\n+            if (parallel_sync_enabled) {\n+                int max_blocks_to_sync = m_tasks_per_worker * m_thread_pool->WorkersCount() + m_tasks_per_worker; // extra 'm_tasks_per_worker' due the active-wait.\n+                int tip_height = WITH_LOCK(cs_main, return m_chainstate->m_chain.Height());\n+                int remaining_blocks = tip_height - pindex_next->nHeight;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405180029",
      "id" : 1405180029,
      "line" : 230,
      "node_id" : "PRRC_kwDOABII585TwVh9",
      "original_commit_id" : "727be9d500c081309042c256dc02166acb6d4774",
      "original_line" : 230,
      "original_position" : 66,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 113,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180029/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180029",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405180661"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180661"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Nitty nit: Keep the order of `workers_count` and `work_chunk` consistent?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T17:28:24Z",
      "diff_hunk" : "@@ -205,9 +217,53 @@ void BaseIndex::ThreadSync()\n                            __func__, GetName());\n                 return;\n             }\n-            pindex = pindex_next;\n \n+            // By default, parallel sync disabled\n+            int work_chunk = 1;\n+            int workers_count = 0;\n+            std::vector<std::future<std::vector<std::any>>> futures;\n+            const CBlockIndex* it_start = pindex_next;\n+\n+            if (parallel_sync_enabled) {\n+                int max_blocks_to_sync = m_tasks_per_worker * m_thread_pool->WorkersCount() + m_tasks_per_worker; // extra 'm_tasks_per_worker' due the active-wait.\n+                int tip_height = WITH_LOCK(cs_main, return m_chainstate->m_chain.Height());\n+                int remaining_blocks = tip_height - pindex_next->nHeight;\n+                work_chunk = remaining_blocks > max_blocks_to_sync ? m_tasks_per_worker : remaining_blocks / (m_thread_pool->WorkersCount() + 1);\n+                workers_count = m_thread_pool->WorkersCount();\n+                if (work_chunk == 0) { // disable parallel sync if we are close to the tip\n+                    workers_count = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405180661",
      "id" : 1405180661,
      "line" : 234,
      "node_id" : "PRRC_kwDOABII585TwVr1",
      "original_commit_id" : "727be9d500c081309042c256dc02166acb6d4774",
      "original_line" : 234,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 117,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180661/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405180661",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405250581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405250581"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Would `so we also process blocks in this thread until all workers finish.` be more accurate?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T22:38:59Z",
      "diff_hunk" : "@@ -205,9 +217,53 @@ void BaseIndex::ThreadSync()\n                            __func__, GetName());\n                 return;\n             }\n-            pindex = pindex_next;\n \n+            // By default, parallel sync disabled\n+            int work_chunk = 1;\n+            int workers_count = 0;\n+            std::vector<std::future<std::vector<std::any>>> futures;\n+            const CBlockIndex* it_start = pindex_next;\n+\n+            if (parallel_sync_enabled) {\n+                int max_blocks_to_sync = m_tasks_per_worker * m_thread_pool->WorkersCount() + m_tasks_per_worker; // extra 'm_tasks_per_worker' due the active-wait.\n+                int tip_height = WITH_LOCK(cs_main, return m_chainstate->m_chain.Height());\n+                int remaining_blocks = tip_height - pindex_next->nHeight;\n+                work_chunk = remaining_blocks > max_blocks_to_sync ? m_tasks_per_worker : remaining_blocks / (m_thread_pool->WorkersCount() + 1);\n+                workers_count = m_thread_pool->WorkersCount();\n+                if (work_chunk == 0) { // disable parallel sync if we are close to the tip\n+                    workers_count = 0;\n+                    work_chunk = 1;\n+                }\n+\n+                for (int i = 0; i < workers_count; i++) {\n+                    const CBlockIndex* it_end =  WITH_LOCK(::cs_main, return m_chainstate->m_chain[it_start->nHeight + work_chunk - 1]);\n+                    // Async process\n+                    futures.emplace_back(m_thread_pool->Submit(std::bind(&BaseIndex::ProcessBlocks, this, it_start, it_end)));\n+                    // Update iterator\n+                    it_start = WITH_LOCK(::cs_main, return NextSyncBlock(it_end, m_chainstate->m_chain));\n+                }\n+            }\n \n+            // If we have only one block to process, run it directly.\n+            // Otherwise, this is an active-wait, so we process blocks until all workers finish.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405250581",
      "id" : 1405250581,
      "line" : 248,
      "node_id" : "PRRC_kwDOABII585TwmwV",
      "original_commit_id" : "727be9d500c081309042c256dc02166acb6d4774",
      "original_line" : 248,
      "original_position" : 84,
      "original_start_line" : null,
      "path" : "src/index/base.cpp",
      "position" : 136,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405250581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405250581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405253107"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405253107"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit de69506c090f530f34d78478db39898bd4e2cbba: I think the test introduction should be squashed into the following commit, or do you want to demonstrate something here first?",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-25T22:52:11Z",
      "diff_hunk" : "@@ -14,6 +14,7 @@\n #include <test/util/blockfilter.h>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405253107",
      "id" : 1405253107,
      "line" : 14,
      "node_id" : "PRRC_kwDOABII585TwnXz",
      "original_commit_id" : "de69506c090f530f34d78478db39898bd4e2cbba",
      "original_line" : 14,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/test/blockfilter_index_tests.cpp",
      "position" : 1,
      "pull_request_review_id" : 1749211886,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405253107/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-25T23:01:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405253107",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405426732"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405426732"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Since the constructor and `Start` are always called in succession in this patch set, you could make `ThreadPool` more RAII styled if the `Start` method were removed and instead placed in the constructor. Could also make sense to do the same with the destructor and `Stop`.",
      "commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "created_at" : "2023-11-26T16:08:46Z",
      "diff_hunk" : "@@ -1966,7 +1970,20 @@ bool StartIndexBackgroundSync(NodeContext& node)\n         }\n     }\n \n+    std::shared_ptr<ThreadPool> thread_pool;\n+    if (node.args->IsArgSet(\"-indexworkers\")) {\n+        int index_workers = node.args->GetIntArg(\"-indexworkers\", INDEX_WORKERS_COUNT);\n+        if (index_workers < 0 || index_workers > 100) return InitError(_(\"Invalid -indexworkers arg\"));\n+\n+        thread_pool = std::make_shared<ThreadPool>();\n+        thread_pool->Start(index_workers);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#discussion_r1405426732",
      "id" : 1405426732,
      "line" : 1979,
      "node_id" : "PRRC_kwDOABII585TxRws",
      "original_commit_id" : "373b0bb077296624b7aeb5108673ae8f8b00b20d",
      "original_line" : 1979,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 35,
      "pull_request_review_id" : 1749369732,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405426732/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-11-26T16:08:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1405426732",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-12-14T21:54:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1856718084",
      "id" : 1856718084,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII585uq0UE",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1856718084/reactions"
      },
      "updated_at" : "2023-12-14T21:54:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1856718084",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/22906894781</sub>",
      "created_at" : "2024-03-21T01:36:40Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2011026298",
      "id" : 2011026298,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII58533dN6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2011026298/reactions"
      },
      "updated_at" : "2024-03-21T01:36:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2011026298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Running it again, let's see how quick it is...\r\n\r\nSince I might set `indexworkers=32` in my config file, which is great for the initial sync and if it needs to do a big catchup. But does it cause much overhead when it's up to date? Maybe the threads should spin down if there's not much work.\r\n\r\nWhat happens when there are multiple `readBlockFromDisk` calls around the same time? I don't see any (obvious) thread locking happening in `CAutoFile`. Since I keep block files on a spinning disk (`-blocksdir`), I wonder if that potentially slows things down - compared to fetching one file in a single uninterrupted operation.\r\n\r\nSo far (block 200K) my spinning disk is making a ton of noise and CPU activity is negligible.\r\n\r\n---\r\n\r\nIt took 4 hours and 23 minutes. That's an improvement over the 5 hours 46 minutes without: https://github.com/bitcoin/bitcoin/pull/28955#issuecomment-1961511162\r\n\r\nNote that last year I tested with SSD - which resulted in a 16x improvement https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-1420800151. This time I used a spinning disk. CPU activity was negligible all the way.",
      "created_at" : "2024-03-21T17:44:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2013158583",
      "id" : 2013158583,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5853_ly3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013158583/reactions"
      },
      "updated_at" : "2024-03-21T22:13:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013158583",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Running it again, let's see how quick it is...\r\n> \r\n> Since I might set `indexworkers=32` in my config file, which is great for the initial sync and if it needs to do a big catchup. But does it cause much overhead when it's up to date? Maybe the threads should spin down if there's not much work.\r\n\r\nYeah sure. The thread pool can be destructed once all indexes initial sync finish (once the index is synced, it starts receiving blocks through the validation signals and does not use the initial sync workers anymore). \r\nI'm currently tackling theCharlatan's feedback, and thinking about some improvements. Will add this change too on the next push.",
      "created_at" : "2024-03-21T17:54:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2013176407",
      "id" : 2013176407,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5853_qJX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013176407/reactions"
      },
      "updated_at" : "2024-03-21T17:54:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2013176407",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the in-depth review theCharlatan! Most comments were tackled. And thanks for testing Sjors!\r\n\r\nNow that we've reached this point (after #28955 merge), I'm rethinking and polishing the design. I'm not totally convinced about the current implementation anymore. We've grown a lot since this was implemented two years ago.\r\nOther than that, Sjors had a nice idea that I want to try out (or at least design this in a way so that the idea can be implemented in isolation in the future) --> Instead of dividing the work based on block ranges, it can be divided based on block file ranges. This would minimize the needle movement on spinning disks.",
      "created_at" : "2024-03-23T13:34:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2016496882",
      "id" : 2016496882,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5854MUzy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2016496882/reactions"
      },
      "updated_at" : "2024-03-23T16:39:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2016496882",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5377650?v=4",
         "events_url" : "https://api.github.com/users/furszy/events{/privacy}",
         "followers_url" : "https://api.github.com/users/furszy/followers",
         "following_url" : "https://api.github.com/users/furszy/following{/other_user}",
         "gists_url" : "https://api.github.com/users/furszy/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/furszy",
         "id" : 5377650,
         "login" : "furszy",
         "node_id" : "MDQ6VXNlcjUzNzc2NTA=",
         "organizations_url" : "https://api.github.com/users/furszy/orgs",
         "received_events_url" : "https://api.github.com/users/furszy/received_events",
         "repos_url" : "https://api.github.com/users/furszy/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/furszy/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/furszy/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/furszy"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23011013574</sub>",
      "created_at" : "2024-03-23T14:10:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2016505858",
      "id" : 2016505858,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5854MXAC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2016505858/reactions"
      },
      "updated_at" : "2024-03-23T14:10:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2016505858",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : ">  Instead of dividing the work based on block ranges, it can be divided based on block file ranges. This would minimize the needle movement on spinning disks.\r\n\r\nIt's possible that this can be achieved with block ranges too. But you have to make sure only one block range is read at any given time. I.e. the other threads should wait while a disk read is in progress. I suspect the problem lies in having 32 threads trying to read different things at the same time, and then operating system goes and fetches a few kilobytes, a few kilobytes there, etc. Though I haven't measured this.",
      "created_at" : "2024-03-25T09:06:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2017518691",
      "id" : 2017518691,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5854QORj",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2017518691/reactions"
      },
      "updated_at" : "2024-03-25T09:08:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2017518691",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23011013574</sub>",
      "created_at" : "2024-04-05T07:54:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2039182163",
      "id" : 2039182163,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5855i3NT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039182163/reactions"
      },
      "updated_at" : "2024-04-05T07:54:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039182163",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "```\r\ntest/threadpool_tests.cpp(9): Entering test suite \"threadpool_tests\"\r\ntest/threadpool_tests.cpp(11): Entering test case \"threadpool_basic\"\r\n==================\r\nWARNING: ThreadSanitizer: data race (pid=26928)\r\n  Write of size 8 at 0x721000012718 by thread T13 (mutexes: write M0):\r\n    #0 free <null> (test_bitcoin+0x156ae3) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #1 std::range_error::~range_error() <null> (libc++abi.so.1+0x28b74) (BuildId: 40d8c515ee7a3c2d826acc730982f279ffe00146)\r\n    #2 std::__1::__shared_count::__release_shared[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__memory/shared_ptr.h:157:7 (test_bitcoin+0xb2e070) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #3 std::__1::__shared_weak_count::__release_shared[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__memory/shared_ptr.h:186:25 (test_bitcoin+0xb2e070)\r\n    #4 std::__1::shared_ptr<std::__1::packaged_task<void ()>>::~shared_ptr[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__memory/shared_ptr.h:648:17 (test_bitcoin+0xb2e070)\r\n    #5 std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'()::~() src/./util/threadpool.h:96:34 (test_bitcoin+0xb2e070)\r\n    #6 std::__1::__compressed_pair_elem<std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'(), 0, false>::~__compressed_pair_elem() /usr/lib/llvm-18/bin/../include/c++/v1/__memory/compressed_pair.h:44:8 (test_bitcoin+0xb2e070)\r\n    #7 std::__1::__function::__alloc_func<std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'(), std::__1::allocator<std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'()>, void ()>::destroy[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:182:58 (test_bitcoin+0xb2e070)\r\n    #8 std::__1::__function::__func<std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'(), std::__1::allocator<std::__1::future<decltype(fp())> ThreadPool::Submit<threadpool_tests::threadpool_basic::test_method()::$_6>(threadpool_tests::threadpool_basic::test_method()::$_6)::'lambda'()>, void ()>::destroy() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:297:8 (test_bitcoin+0xb2e070)\r\n    #9 std::__1::__function::__value_func<void ()>::~__value_func[abi:ne180100]() src/./sync.h (test_bitcoin+0x442c8b) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #10 std::__1::function<void ()>::~function() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:972:43 (test_bitcoin+0x442c8b)\r\n    #11 ThreadPool::WorkerThread() src/./util/threadpool.h:56:9 (test_bitcoin+0x442c8b)\r\n    #12 ThreadPool::Start(int)::'lambda'()::operator()() const src/./util/threadpool.h:73:101 (test_bitcoin+0x442ae5) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #13 decltype(std::declval<ThreadPool::Start(int)::'lambda'()&>()()) std::__1::__invoke[abi:ne180100]<ThreadPool::Start(int)::'lambda'()&>(ThreadPool::Start(int)::'lambda'()&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:344:25 (test_bitcoin+0x442ae5)\r\n    #14 void std::__1::__invoke_void_return_wrapper<void, true>::__call[abi:ne180100]<ThreadPool::Start(int)::'lambda'()&>(ThreadPool::Start(int)::'lambda'()&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:419:5 (test_bitcoin+0x442ae5)\r\n    #15 std::__1::__function::__alloc_func<ThreadPool::Start(int)::'lambda'(), std::__1::allocator<ThreadPool::Start(int)::'lambda'()>, void ()>::operator()[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:169:12 (test_bitcoin+0x442ae5)\r\n    #16 std::__1::__function::__func<ThreadPool::Start(int)::'lambda'(), std::__1::allocator<ThreadPool::Start(int)::'lambda'()>, void ()>::operator()() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:311:10 (test_bitcoin+0x442ae5)\r\n    #17 std::__1::__function::__value_func<void ()>::operator()[abi:ne180100]() const /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:428:12 (test_bitcoin+0x1815b98) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #18 std::__1::function<void ()>::operator()() const /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:981:10 (test_bitcoin+0x1815b98)\r\n    #19 util::TraceThread(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>) src/util/thread.cpp:21:9 (test_bitcoin+0x1815b98)\r\n    #20 decltype(std::declval<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>)>()(std::declval<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>>(), std::declval<ThreadPool::Start(int)::'lambda'()>())) std::__1::__invoke[abi:ne180100]<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>(void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:344:25 (test_bitcoin+0x44261e) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #21 void std::__1::__thread_execute[abi:ne180100]<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), 2ul, 3ul>(std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>&, std::__1::__tuple_indices<2ul, 3ul>) /usr/lib/llvm-18/bin/../include/c++/v1/__thread/thread.h:193:3 (test_bitcoin+0x44261e)\r\n    #22 void* std::__1::__thread_proxy[abi:ne180100]<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>>(void*) /usr/lib/llvm-18/bin/../include/c++/v1/__thread/thread.h:202:3 (test_bitcoin+0x44261e)\r\n  Previous read of size 8 at 0x721000012718 by main thread:\r\n    #0 strcmp <null> (test_bitcoin+0x161718) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #1 boost::test_tools::tt_detail::equal_impl(char const*, char const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/test_tools.ipp:463:30 (test_bitcoin+0x1fca6f) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #2 boost::test_tools::assertion_result boost::test_tools::tt_detail::equal_impl_frwd::call_impl<char const*, char [25]>(char const* const&, char const (&) [25], mpl_::bool_<false>) const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/tools/old/impl.hpp:130:16 (test_bitcoin+0xb2f88f) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #3 boost::test_tools::assertion_result boost::test_tools::tt_detail::equal_impl_frwd::operator()<char const*, char [25]>(char const* const&, char const (&) [25]) const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/tools/old/impl.hpp:145:16 (test_bitcoin+0xb2f88f)\r\n    #4 bool boost::test_tools::tt_detail::check_frwd<boost::test_tools::tt_detail::equal_impl_frwd, char const*, char [25]>(boost::test_tools::tt_detail::equal_impl_frwd, boost::unit_test::lazy_ostream const&, boost::unit_test::basic_cstring<char const>, unsigned long, boost::test_tools::tt_detail::tool_level, boost::test_tools::tt_detail::check_type, char const* const&, char const*, char const (&) [25], char const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/tools/old/impl.hpp:92:1 (test_bitcoin+0xb2f88f)\r\n    #5 threadpool_tests::threadpool_basic::test_method() src/test/threadpool_tests.cpp:117:13 (test_bitcoin+0xb2855b) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #6 threadpool_tests::threadpool_basic_invoker() src/test/threadpool_tests.cpp:11:1 (test_bitcoin+0xb26256) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #7 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:117:11 (test_bitcoin+0x31b9dd) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #8 boost::function0<void>::operator()() const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:763:14 (test_bitcoin+0x26f5f8) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #9 boost::detail::forward::operator()() /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1388:32 (test_bitcoin+0x26f5f8)\r\n    #10 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:137:18 (test_bitcoin+0x26f5f8)\r\n    #11 boost::function0<int>::operator()() const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:763:14 (test_bitcoin+0x1f49f3) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #12 int boost::detail::do_invoke<boost::shared_ptr<boost::detail::translator_holder_base>, boost::function<int ()>>(boost::shared_ptr<boost::detail::translator_holder_base> const&, boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:301:30 (test_bitcoin+0x1f49f3)\r\n    #13 boost::execution_monitor::catch_signals(boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:903:16 (test_bitcoin+0x1f49f3)\r\n    #14 boost::execution_monitor::execute(boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1301:16 (test_bitcoin+0x1f4d6a) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #15 boost::execution_monitor::vexecute(boost::function<void ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1397:5 (test_bitcoin+0x1f04d8) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #16 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_monitor.ipp:49:9 (test_bitcoin+0x1f04d8)\r\n    #17 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:815:44 (test_bitcoin+0x227215) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #18 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:784:58 (test_bitcoin+0x227aa1) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #19 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:784:58 (test_bitcoin+0x227aa1) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #20 boost::unit_test::framework::run(unsigned long, bool) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:1722:29 (test_bitcoin+0x1ef05f) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #21 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_main.ipp:250:9 (test_bitcoin+0x209e26) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #22 main /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_main.ipp:306:12 (test_bitcoin+0x20a753) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n  Mutex M0 (0x7fff25c67fe0) created at:\r\n    #0 pthread_mutex_trylock <null> (test_bitcoin+0x159aae) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #1 std::__1::mutex::try_lock() <null> (libc++.so.1+0x5f63c) (BuildId: b52c260d7d8ecb73699f2407c0a9b193fc4761fc)\r\n    #2 UniqueLock<AnnotatedMixin<std::__1::mutex>>::UniqueLock(AnnotatedMixin<std::__1::mutex>&, char const*, char const*, int, bool) src/./sync.h:182:13 (test_bitcoin+0x442c37) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #3 ThreadPool::WorkerThread() src/./util/threadpool.h:37:9 (test_bitcoin+0x442c37)\r\n    #4 ThreadPool::Start(int)::'lambda'()::operator()() const src/./util/threadpool.h:73:101 (test_bitcoin+0x442ae5) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #5 decltype(std::declval<ThreadPool::Start(int)::'lambda'()&>()()) std::__1::__invoke[abi:ne180100]<ThreadPool::Start(int)::'lambda'()&>(ThreadPool::Start(int)::'lambda'()&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:344:25 (test_bitcoin+0x442ae5)\r\n    #6 void std::__1::__invoke_void_return_wrapper<void, true>::__call[abi:ne180100]<ThreadPool::Start(int)::'lambda'()&>(ThreadPool::Start(int)::'lambda'()&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:419:5 (test_bitcoin+0x442ae5)\r\n    #7 std::__1::__function::__alloc_func<ThreadPool::Start(int)::'lambda'(), std::__1::allocator<ThreadPool::Start(int)::'lambda'()>, void ()>::operator()[abi:ne180100]() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:169:12 (test_bitcoin+0x442ae5)\r\n    #8 std::__1::__function::__func<ThreadPool::Start(int)::'lambda'(), std::__1::allocator<ThreadPool::Start(int)::'lambda'()>, void ()>::operator()() /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:311:10 (test_bitcoin+0x442ae5)\r\n    #9 std::__1::__function::__value_func<void ()>::operator()[abi:ne180100]() const /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:428:12 (test_bitcoin+0x1815b98) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #10 std::__1::function<void ()>::operator()() const /usr/lib/llvm-18/bin/../include/c++/v1/__functional/function.h:981:10 (test_bitcoin+0x1815b98)\r\n    #11 util::TraceThread(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>) src/util/thread.cpp:21:9 (test_bitcoin+0x1815b98)\r\n    #12 decltype(std::declval<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>)>()(std::declval<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>>(), std::declval<ThreadPool::Start(int)::'lambda'()>())) std::__1::__invoke[abi:ne180100]<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>(void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__type_traits/invoke.h:344:25 (test_bitcoin+0x44261e) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #13 void std::__1::__thread_execute[abi:ne180100]<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), 2ul, 3ul>(std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>&, std::__1::__tuple_indices<2ul, 3ul>) /usr/lib/llvm-18/bin/../include/c++/v1/__thread/thread.h:193:3 (test_bitcoin+0x44261e)\r\n    #14 void* std::__1::__thread_proxy[abi:ne180100]<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct>>, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>>(void*) /usr/lib/llvm-18/bin/../include/c++/v1/__thread/thread.h:202:3 (test_bitcoin+0x44261e)\r\n  Thread T13 'b-threadpool_wo' (tid=26954, running) created by main thread at:\r\n    #0 pthread_create <null> (test_bitcoin+0x157daf) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #1 std::__1::__libcpp_thread_create[abi:ne180100](unsigned long*, void* (*)(void*), void*) /usr/lib/llvm-18/bin/../include/c++/v1/__threading_support:317:10 (test_bitcoin+0x442473) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #2 std::__1::thread::thread<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), void>(void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__thread/thread.h:212:14 (test_bitcoin+0x442473)\r\n    #3 std::__1::thread* std::__1::construct_at[abi:ne180100]<std::__1::thread, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), std::__1::thread*>(std::__1::thread*, void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__memory/construct_at.h:41:46 (test_bitcoin+0x4421c5) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #4 std::__1::thread* std::__1::__construct_at[abi:ne180100]<std::__1::thread, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), std::__1::thread*>(std::__1::thread*, void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__memory/construct_at.h:49:10 (test_bitcoin+0x4421c5)\r\n    #5 void std::__1::allocator_traits<std::__1::allocator<std::__1::thread>>::construct[abi:ne180100]<std::__1::thread, void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'(), void, void>(std::__1::allocator<std::__1::thread>&, std::__1::thread*, void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/__memory/allocator_traits.h:305:5 (test_bitcoin+0x4421c5)\r\n    #6 std::__1::thread* std::__1::vector<std::__1::thread, std::__1::allocator<std::__1::thread>>::__emplace_back_slow_path<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>(void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/vector:1491:3 (test_bitcoin+0x4421c5)\r\n    #7 std::__1::thread& std::__1::vector<std::__1::thread, std::__1::allocator<std::__1::thread>>::emplace_back<void (*)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>, ThreadPool::Start(int)::'lambda'()>(void (*&&)(std::__1::basic_string_view<char, std::__1::char_traits<char>>, std::__1::function<void ()>), std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char>>&&, ThreadPool::Start(int)::'lambda'()&&) /usr/lib/llvm-18/bin/../include/c++/v1/vector:1511:13 (test_bitcoin+0x43efb4) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #8 ThreadPool::Start(int) src/./util/threadpool.h:73:23 (test_bitcoin+0x43efb4)\r\n    #9 threadpool_tests::threadpool_basic::test_method() src/test/threadpool_tests.cpp:109:20 (test_bitcoin+0xb283a6) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #10 threadpool_tests::threadpool_basic_invoker() src/test/threadpool_tests.cpp:11:1 (test_bitcoin+0xb26256) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #11 boost::detail::function::void_function_invoker0<void (*)(), void>::invoke(boost::detail::function::function_buffer&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:117:11 (test_bitcoin+0x31b9dd) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #12 boost::function0<void>::operator()() const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:763:14 (test_bitcoin+0x26f5f8) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #13 boost::detail::forward::operator()() /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1388:32 (test_bitcoin+0x26f5f8)\r\n    #14 boost::detail::function::function_obj_invoker0<boost::detail::forward, int>::invoke(boost::detail::function::function_buffer&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:137:18 (test_bitcoin+0x26f5f8)\r\n    #15 boost::function0<int>::operator()() const /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/function/function_template.hpp:763:14 (test_bitcoin+0x1f49f3) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #16 int boost::detail::do_invoke<boost::shared_ptr<boost::detail::translator_holder_base>, boost::function<int ()>>(boost::shared_ptr<boost::detail::translator_holder_base> const&, boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:301:30 (test_bitcoin+0x1f49f3)\r\n    #17 boost::execution_monitor::catch_signals(boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:903:16 (test_bitcoin+0x1f49f3)\r\n    #18 boost::execution_monitor::execute(boost::function<int ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1301:16 (test_bitcoin+0x1f4d6a) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #19 boost::execution_monitor::vexecute(boost::function<void ()> const&) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/execution_monitor.ipp:1397:5 (test_bitcoin+0x1f04d8) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #20 boost::unit_test::unit_test_monitor_t::execute_and_translate(boost::function<void ()> const&, unsigned long) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_monitor.ipp:49:9 (test_bitcoin+0x1f04d8)\r\n    #21 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:815:44 (test_bitcoin+0x227215) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #22 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:784:58 (test_bitcoin+0x227aa1) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #23 boost::unit_test::framework::state::execute_test_tree(unsigned long, unsigned long, boost::unit_test::framework::state::random_generator_helper const*) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:784:58 (test_bitcoin+0x227aa1) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #24 boost::unit_test::framework::run(unsigned long, bool) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/framework.ipp:1722:29 (test_bitcoin+0x1ef05f) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #25 boost::unit_test::unit_test_main(boost::unit_test::test_suite* (*)(int, char**), int, char**) /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_main.ipp:250:9 (test_bitcoin+0x209e26) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\n    #26 main /ci_container_base/depends/x86_64-pc-linux-gnu/include/boost/test/impl/unit_test_main.ipp:306:12 (test_bitcoin+0x20a753) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d)\r\nSUMMARY: ThreadSanitizer: data race (/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src/test/test_bitcoin+0x156ae3) (BuildId: 5ce48731414b473abd5838c79ce7029f5872bd2d) in free\r\n==================\r\nRunning tests: translation_tests from test/translation_tests.cpp\r\nmake[3]: *** [Makefile:22558: test/threadpool_tests.cpp.test] Error 1\r\nmake[3]: *** Waiting for unfinished jobs....\r\nmake[3]: Leaving directory '/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src'\r\nmake[2]: *** [Makefile:20520: check-am] Error 2\r\nmake[2]: Leaving directory '/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src'\r\nmake[1]: *** [Makefile:20185: check-recursive] Error 1\r\nmake[1]: Leaving directory '/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/src'\r\nmake: *** [Makefile:756: check-recursive] Error 1\r\nExit status: 2",
      "created_at" : "2024-04-05T07:59:13Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2039191008",
      "id" : 2039191008,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5855i5Xg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039191008/reactions"
      },
      "updated_at" : "2024-04-05T07:59:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039191008",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23011013574</sub>",
      "created_at" : "2024-04-05T08:37:46Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2039247719",
      "id" : 2039247719,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5855jHNn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039247719/reactions"
      },
      "updated_at" : "2024-04-05T08:37:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039247719",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Are you still working on this? If not, this could be moved to draft for as long as the tsan CI is failing.",
      "created_at" : "2024-04-17T17:19:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2061806007",
      "id" : 2061806007,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII58565Km3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061806007/reactions"
      },
      "updated_at" : "2024-04-17T17:19:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061806007",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-04-30T22:53:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/26966#issuecomment-2087667010",
      "id" : 2087667010,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
      "node_id" : "IC_kwDOABII5858b0VC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2087667010/reactions"
      },
      "updated_at" : "2024-04-30T22:53:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2087667010",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   }
]
