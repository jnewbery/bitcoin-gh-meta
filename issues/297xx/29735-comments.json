[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29735).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-03-26T14:41:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#issuecomment-2020621274",
      "id" : 2020621274,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29735",
      "node_id" : "IC_kwDOABII5854cDva",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020621274/reactions"
      },
      "updated_at" : "2024-03-26T14:41:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020621274",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1539410139"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539410139"
         }
      },
      "author_association" : "MEMBER",
      "body" : "is there an extra indent for this whole block? Also, might want to add some other things to this comment like\r\n- `-maxmempool` needs to be very small (i.e. 5) for this to work\r\n- if there are multiple nodes, note this doesn't run `sync_mempools`\r\n- assumes that `-minrelaytxfee` is 1sat/vB",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-26T14:51:14Z",
      "diff_hunk" : "@@ -496,6 +496,48 @@ def check_node_connections(*, node, num_in, num_out):\n     assert_equal(info[\"connections_in\"], num_in)\n     assert_equal(info[\"connections_out\"], num_out)\n \n+# Allows simpler testing of scenarios with minfee != minrelay\n+def fill_mempool(test_framework, node, miniwallet):\n+        \"\"\"Fill mempool until eviction.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1539410139",
      "id" : 1539410139,
      "line" : 504,
      "node_id" : "PRRC_kwDOABII585bwYjb",
      "original_commit_id" : "aaa5125f1c65724b89d464be7f6d962afa0171a1",
      "original_line" : 504,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 9,
      "pull_request_review_id" : 1960672199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539410139/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T11:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539410139",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540871530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540871530"
         }
      },
      "author_association" : "MEMBER",
      "body" : " IIUC util is for more low-level stuff, but don't have better ideas other than throwing it on test_framework.py. Maybe @maflcko or @theStack would have an opinion on where we should put this?",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T10:48:51Z",
      "diff_hunk" : "@@ -496,6 +496,48 @@ def check_node_connections(*, node, num_in, num_out):\n     assert_equal(info[\"connections_in\"], num_in)\n     assert_equal(info[\"connections_out\"], num_out)\n \n+# Allows simpler testing of scenarios with minfee != minrelay\n+def fill_mempool(test_framework, node, miniwallet):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540871530",
      "id" : 1540871530,
      "line" : 503,
      "node_id" : "PRRC_kwDOABII585b19Vq",
      "original_commit_id" : "aaa5125f1c65724b89d464be7f6d962afa0171a1",
      "original_line" : 503,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 8,
      "pull_request_review_id" : 1960672199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540871530/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T11:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540871530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540889727"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540889727"
         }
      },
      "author_association" : "MEMBER",
      "body" : "unrelated renames?",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T11:00:56Z",
      "diff_hunk" : "@@ -369,23 +375,58 @@ def test_maxfeerate_maxburn_submitpackage(self):\n         minrate_btc_kvb = min([chained_txn[\"fee\"] / chained_txn[\"tx\"].get_vsize() * 1000 for chained_txn in chained_txns])\n         chain_hex = [t[\"hex\"] for t in chained_txns]\n         pkg_result = node.submitpackage(chain_hex, maxfeerate=minrate_btc_kvb - Decimal(\"0.00000001\"))\n+\n+        # First tx failed in single transaction evaluation, so package message is generic\n+        assert_equal(pkg_result[\"package_msg\"], \"transaction failed\")\n         assert_equal(pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]][\"error\"], \"max feerate exceeded\")\n         assert_equal(pkg_result[\"tx-results\"][chained_txns[1][\"wtxid\"]][\"error\"], \"bad-txns-inputs-missingorspent\")\n         assert_equal(node.getrawmempool(), [])\n \n+        # Make chain of two transactions where parent doesn't make minfee threshold\n+        # but child is too high fee\n+        fill_mempool(self, node, self.wallet)\n+        while node.getrawmempool() != []:\n+            self.generate(node, 1)\n+\n+        minrelay = node.getmempoolinfo()[\"minrelaytxfee\"]\n+        parent = self.wallet.create_self_transfer(\n+            fee_rate=minrelay,\n+        )\n+\n+        child = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=parent[\"new_utxo\"],\n+        )\n+\n+        pkg_result = node.submitpackage([parent[\"hex\"], child[\"hex\"]], maxfeerate=DEFAULT_FEE - Decimal(\"0.00000001\"))\n+\n+        # Package-wide error reported for package evaluation rejection\n+        assert_equal(pkg_result[\"package_msg\"], \"max feerate exceeded\")\n+        assert \"mempool min fee not met\" in pkg_result[\"tx-results\"][parent[\"wtxid\"]][\"error\"]\n+        assert_equal(pkg_result[\"tx-results\"][child[\"wtxid\"]][\"error\"], \"max feerate exceeded\")\n+        assert_equal(node.getrawmempool(), [])\n+\n+        # Reset minfee\n+        self.restart_node(0)\n+\n         self.log.info(\"Submitpackage maxburnamount arg testing\")\n-        tx = tx_from_hex(chain_hex[1])\n+        chained_txns_burn = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chained_burn_hex = [t[\"hex\"] for t in chained_txns_burn]\n+\n+        tx = tx_from_hex(chained_burn_hex[1])\n         tx.vout[-1].scriptPubKey = b'a' * 10001 # scriptPubKey bigger than 10k IsUnspendable\n-        chain_hex = [chain_hex[0], tx.serialize().hex()]\n+        chained_burn_hex = [chained_burn_hex[0], tx.serialize().hex()]\n         # burn test is run before any package evaluation; nothing makes it in and we get broader exception\n-        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chain_hex, 0, chained_txns[1][\"new_utxo\"][\"value\"] - Decimal(\"0.00000001\"))\n+        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chained_burn_hex, 0, chained_txns_burn[1][\"new_utxo\"][\"value\"] - Decimal(\"0.00000001\"))\n         assert_equal(node.getrawmempool(), [])\n \n+        minrate_btc_kvb_burn = min([chained_txn_burn[\"fee\"] / chained_txn_burn[\"tx\"].get_vsize() * 1000 for chained_txn_burn in chained_txns_burn])\n+\n         # Relax the restrictions for both and send it; parent gets through as own subpackage\n-        pkg_result = node.submitpackage(chain_hex, maxfeerate=minrate_btc_kvb, maxburnamount=chained_txns[1][\"new_utxo\"][\"value\"])\n-        assert \"error\" not in pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]]\n+        pkg_result = node.submitpackage(chained_burn_hex, maxfeerate=minrate_btc_kvb_burn, maxburnamount=chained_txns_burn[1][\"new_utxo\"][\"value\"])\n+        assert \"error\" not in pkg_result[\"tx-results\"][chained_txns_burn[0][\"wtxid\"]]\n         assert_equal(pkg_result[\"tx-results\"][tx.getwtxid()][\"error\"], \"scriptpubkey\")\n-        assert_equal(node.getrawmempool(), [chained_txns[0][\"txid\"]])\n+        assert_equal(node.getrawmempool(), [chained_txns_burn[0][\"txid\"]])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540889727",
      "id" : 1540889727,
      "line" : 430,
      "node_id" : "PRRC_kwDOABII585b2Bx_",
      "original_commit_id" : "5ae4dce79d304457bb419512e2a478cf6dd08b43",
      "original_line" : 430,
      "original_position" : 81,
      "original_start_line" : 377,
      "path" : "test/functional/rpc_packages.py",
      "position" : 82,
      "pull_request_review_id" : 1960672199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540889727/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 377,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-03-27T11:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540889727",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540891352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540891352"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should this be \"transaction failed\" since it's an individual error?",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T11:02:12Z",
      "diff_hunk" : "@@ -1366,6 +1366,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n         // Individual modified feerate exceeded caller-defined max; abort\n         // N.B. this doesn't take into account CPFPs. Chunk-aware validation may be more robust.\n         if (args.m_client_maxfeerate && CFeeRate(ws.m_modified_fees, ws.m_vsize) > args.m_client_maxfeerate.value()) {\n+            // Need to set failure here both individually and at package level\n+            ws.m_state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"max feerate exceeded\", \"\");\n             package_state.Invalid(PackageValidationResult::PCKG_TX, \"max feerate exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1540891352",
      "id" : 1540891352,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b2CLY",
      "original_commit_id" : "5ae4dce79d304457bb419512e2a478cf6dd08b43",
      "original_line" : 1371,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1960672199,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540891352/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T11:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1540891352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541042929"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541042929"
         }
      },
      "author_association" : "MEMBER",
      "body" : "it has `mine_large_block` et al which seem quite similar imo. I'll move it if there's something obviously better?",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T12:46:58Z",
      "diff_hunk" : "@@ -496,6 +496,48 @@ def check_node_connections(*, node, num_in, num_out):\n     assert_equal(info[\"connections_in\"], num_in)\n     assert_equal(info[\"connections_out\"], num_out)\n \n+# Allows simpler testing of scenarios with minfee != minrelay\n+def fill_mempool(test_framework, node, miniwallet):",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541042929",
      "id" : 1541042929,
      "in_reply_to_id" : 1540871530,
      "line" : 503,
      "node_id" : "PRRC_kwDOABII585b2nLx",
      "original_commit_id" : "aaa5125f1c65724b89d464be7f6d962afa0171a1",
      "original_line" : 503,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 8,
      "pull_request_review_id" : 1963219672,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541042929/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T12:46:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541042929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541046523"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541046523"
         }
      },
      "author_association" : "MEMBER",
      "body" : "was confusing to me to re-use the names for two distinct transaction chains (yeah I wrote the original test, so what?)",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T12:49:37Z",
      "diff_hunk" : "@@ -369,23 +375,58 @@ def test_maxfeerate_maxburn_submitpackage(self):\n         minrate_btc_kvb = min([chained_txn[\"fee\"] / chained_txn[\"tx\"].get_vsize() * 1000 for chained_txn in chained_txns])\n         chain_hex = [t[\"hex\"] for t in chained_txns]\n         pkg_result = node.submitpackage(chain_hex, maxfeerate=minrate_btc_kvb - Decimal(\"0.00000001\"))\n+\n+        # First tx failed in single transaction evaluation, so package message is generic\n+        assert_equal(pkg_result[\"package_msg\"], \"transaction failed\")\n         assert_equal(pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]][\"error\"], \"max feerate exceeded\")\n         assert_equal(pkg_result[\"tx-results\"][chained_txns[1][\"wtxid\"]][\"error\"], \"bad-txns-inputs-missingorspent\")\n         assert_equal(node.getrawmempool(), [])\n \n+        # Make chain of two transactions where parent doesn't make minfee threshold\n+        # but child is too high fee\n+        fill_mempool(self, node, self.wallet)\n+        while node.getrawmempool() != []:\n+            self.generate(node, 1)\n+\n+        minrelay = node.getmempoolinfo()[\"minrelaytxfee\"]\n+        parent = self.wallet.create_self_transfer(\n+            fee_rate=minrelay,\n+        )\n+\n+        child = self.wallet.create_self_transfer(\n+            fee_rate=DEFAULT_FEE,\n+            utxo_to_spend=parent[\"new_utxo\"],\n+        )\n+\n+        pkg_result = node.submitpackage([parent[\"hex\"], child[\"hex\"]], maxfeerate=DEFAULT_FEE - Decimal(\"0.00000001\"))\n+\n+        # Package-wide error reported for package evaluation rejection\n+        assert_equal(pkg_result[\"package_msg\"], \"max feerate exceeded\")\n+        assert \"mempool min fee not met\" in pkg_result[\"tx-results\"][parent[\"wtxid\"]][\"error\"]\n+        assert_equal(pkg_result[\"tx-results\"][child[\"wtxid\"]][\"error\"], \"max feerate exceeded\")\n+        assert_equal(node.getrawmempool(), [])\n+\n+        # Reset minfee\n+        self.restart_node(0)\n+\n         self.log.info(\"Submitpackage maxburnamount arg testing\")\n-        tx = tx_from_hex(chain_hex[1])\n+        chained_txns_burn = self.wallet.create_self_transfer_chain(chain_length=2)\n+        chained_burn_hex = [t[\"hex\"] for t in chained_txns_burn]\n+\n+        tx = tx_from_hex(chained_burn_hex[1])\n         tx.vout[-1].scriptPubKey = b'a' * 10001 # scriptPubKey bigger than 10k IsUnspendable\n-        chain_hex = [chain_hex[0], tx.serialize().hex()]\n+        chained_burn_hex = [chained_burn_hex[0], tx.serialize().hex()]\n         # burn test is run before any package evaluation; nothing makes it in and we get broader exception\n-        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chain_hex, 0, chained_txns[1][\"new_utxo\"][\"value\"] - Decimal(\"0.00000001\"))\n+        assert_raises_rpc_error(-25, \"Unspendable output exceeds maximum configured by user\", node.submitpackage, chained_burn_hex, 0, chained_txns_burn[1][\"new_utxo\"][\"value\"] - Decimal(\"0.00000001\"))\n         assert_equal(node.getrawmempool(), [])\n \n+        minrate_btc_kvb_burn = min([chained_txn_burn[\"fee\"] / chained_txn_burn[\"tx\"].get_vsize() * 1000 for chained_txn_burn in chained_txns_burn])\n+\n         # Relax the restrictions for both and send it; parent gets through as own subpackage\n-        pkg_result = node.submitpackage(chain_hex, maxfeerate=minrate_btc_kvb, maxburnamount=chained_txns[1][\"new_utxo\"][\"value\"])\n-        assert \"error\" not in pkg_result[\"tx-results\"][chained_txns[0][\"wtxid\"]]\n+        pkg_result = node.submitpackage(chained_burn_hex, maxfeerate=minrate_btc_kvb_burn, maxburnamount=chained_txns_burn[1][\"new_utxo\"][\"value\"])\n+        assert \"error\" not in pkg_result[\"tx-results\"][chained_txns_burn[0][\"wtxid\"]]\n         assert_equal(pkg_result[\"tx-results\"][tx.getwtxid()][\"error\"], \"scriptpubkey\")\n-        assert_equal(node.getrawmempool(), [chained_txns[0][\"txid\"]])\n+        assert_equal(node.getrawmempool(), [chained_txns_burn[0][\"txid\"]])",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541046523",
      "id" : 1541046523,
      "in_reply_to_id" : 1540889727,
      "line" : 430,
      "node_id" : "PRRC_kwDOABII585b2oD7",
      "original_commit_id" : "5ae4dce79d304457bb419512e2a478cf6dd08b43",
      "original_line" : 430,
      "original_position" : 81,
      "original_start_line" : 377,
      "path" : "test/functional/rpc_packages.py",
      "position" : 82,
      "pull_request_review_id" : 1963225671,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541046523/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 377,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2024-03-27T12:49:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541046523",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541058199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058199"
         }
      },
      "author_association" : "MEMBER",
      "body" : "changed",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T12:55:57Z",
      "diff_hunk" : "@@ -1366,6 +1366,8 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptMultipleTransactions(const std::\n         // Individual modified feerate exceeded caller-defined max; abort\n         // N.B. this doesn't take into account CPFPs. Chunk-aware validation may be more robust.\n         if (args.m_client_maxfeerate && CFeeRate(ws.m_modified_fees, ws.m_vsize) > args.m_client_maxfeerate.value()) {\n+            // Need to set failure here both individually and at package level\n+            ws.m_state.Invalid(TxValidationResult::TX_MEMPOOL_POLICY, \"max feerate exceeded\", \"\");\n             package_state.Invalid(PackageValidationResult::PCKG_TX, \"max feerate exceeded\");",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541058199",
      "id" : 1541058199,
      "in_reply_to_id" : 1540891352,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585b2q6X",
      "original_commit_id" : "5ae4dce79d304457bb419512e2a478cf6dd08b43",
      "original_line" : 1371,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/validation.cpp",
      "position" : null,
      "pull_request_review_id" : 1963243559,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T12:55:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541058370"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058370"
         }
      },
      "author_association" : "MEMBER",
      "body" : "added some comments",
      "commit_id" : "4f8407cefa6ddb47b166b2c360d03778c0357a00",
      "created_at" : "2024-03-27T12:56:06Z",
      "diff_hunk" : "@@ -496,6 +496,48 @@ def check_node_connections(*, node, num_in, num_out):\n     assert_equal(info[\"connections_in\"], num_in)\n     assert_equal(info[\"connections_out\"], num_out)\n \n+# Allows simpler testing of scenarios with minfee != minrelay\n+def fill_mempool(test_framework, node, miniwallet):\n+        \"\"\"Fill mempool until eviction.\"\"\"",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29735#discussion_r1541058370",
      "id" : 1541058370,
      "in_reply_to_id" : 1539410139,
      "line" : 504,
      "node_id" : "PRRC_kwDOABII585b2q9C",
      "original_commit_id" : "aaa5125f1c65724b89d464be7f6d962afa0171a1",
      "original_line" : 504,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "test/functional/test_framework/util.py",
      "position" : 9,
      "pull_request_review_id" : 1963243860,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29735",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058370/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-27T12:56:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1541058370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   }
]
