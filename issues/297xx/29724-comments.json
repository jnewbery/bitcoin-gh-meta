[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29724).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-03-25T16:13:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2018377286",
      "id" : 2018377286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854Tf5G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018377286/reactions"
      },
      "updated_at" : "2024-03-25T16:13:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018377286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23064649168</sub>",
      "created_at" : "2024-03-25T18:04:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2018597226",
      "id" : 2018597226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854UVlq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018597226/reactions"
      },
      "updated_at" : "2024-03-25T18:04:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018597226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538848298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "836841e2683fa0ca3fd7837726d935e52be142bc seems a bit trivial :sweat_smile: ",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:14:40Z",
      "diff_hunk" : "@@ -1302,7 +1302,7 @@ util::Result<std::pair<std::vector<FeeFrac>, std::vector<FeeFrac>>> CTxMemPool::\n     // Step 1: build the old diagram.\n \n     // The above clusters are all trivially linearized;\n-    // they have a strict topology of 1 or two connected transactions.\n+    // they have a strict topology of one or two connected transactions.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538848298",
      "id" : 1538848298,
      "line" : 1305,
      "node_id" : "PRRC_kwDOABII585buPYq",
      "original_commit_id" : "836841e2683fa0ca3fd7837726d935e52be142bc",
      "original_line" : 1305,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 75,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538852116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b380a1df36a95c85310949aeb81d8c57f4d023c4: s/effects/affects",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:17:19Z",
      "diff_hunk" : "@@ -396,6 +396,14 @@ BOOST_FIXTURE_TEST_CASE(improves_feerate, TestChain100Setup)\n     // With one more satoshi it does\n     BOOST_CHECK(ImprovesFeerateDiagram(pool, {entry1}, {entry1, entry2}, tx1_fee + tx2_fee + 1, tx1_size + tx2_size) == std::nullopt);\n \n+    // With prioritisation of in-mempool conflicts, it effects the results of the comparison using the same args as just above",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538852116",
      "id" : 1538852116,
      "line" : 399,
      "node_id" : "PRRC_kwDOABII585buQUU",
      "original_commit_id" : "b380a1df36a95c85310949aeb81d8c57f4d023c4",
      "original_line" : 399,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 308,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538856182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could just make a copy of tx1 and change the input prevout? Can remove all the duplicate code.",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:19:26Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions\n+static inline std::pair<CTransactionRef, CTransactionRef> make_two_siblings(const CTransactionRef parent,\n+                                      const std::vector<CAmount>& output_values)\n+{\n+    assert(parent->vout.size() >= 2);\n+\n+    // First tx takes first parent output\n+    CMutableTransaction tx1 = CMutableTransaction();\n+    tx1.vin.resize(1);\n+    tx1.vout.resize(output_values.size());\n+\n+    tx1.vin[0].prevout.hash = parent->GetHash();\n+    tx1.vin[0].prevout.n = 0;\n+    // Add a witness so wtxid != txid\n+    CScriptWitness witness;\n+    witness.stack.emplace_back(10);\n+    tx1.vin[0].scriptWitness = witness;\n+\n+    for (size_t i = 0; i < output_values.size(); ++i) {\n+        tx1.vout[i].scriptPubKey = CScript() << OP_11 << OP_EQUAL;\n+        tx1.vout[i].nValue = output_values[i];\n+    }\n+\n+    // Second tx takes second parent output\n+    CMutableTransaction tx2 = CMutableTransaction();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538856182",
      "id" : 1538856182,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585buRT2",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 64,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538859925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n// Make two child transactions from parent (which must have at least 2 outputs).\r\n// Each tx will have the same outputs, using the amounts specified in output_values.\r\n```",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:21:04Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538859925",
      "id" : 1538859925,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII585buSOV",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 40,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538861778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Returns both, actually?",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:22:08Z",
      "diff_hunk" : "@@ -67,6 +108,21 @@ static CTransactionRef add_descendant_to_parents(const std::vector<CTransactionR\n     return child_tx;\n }\n \n+// Makes two children for a single parent\n+static std::pair<CTransactionRef, CTransactionRef> add_children_to_parent(const CTransactionRef parent, CTxMemPool& pool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main, pool.cs)\n+{\n+    AssertLockHeld(::cs_main);\n+    AssertLockHeld(pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    // Assumes this isn't already spent in mempool\n+    auto children_tx = make_two_siblings(/*parent=*/parent, /*output_values=*/{50 * CENT});\n+    pool.addUnchecked(entry.FromTx(children_tx.first));\n+    pool.addUnchecked(entry.FromTx(children_tx.second));\n+    // Return last created tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538861778",
      "id" : 1538861778,
      "line" : 122,
      "node_id" : "PRRC_kwDOABII585buSrS",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 122,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 82,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538868180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4f910a69448203fc51abd993bef27bf00768a1ec \"a straight\"?",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:26:03Z",
      "diff_hunk" : "@@ -178,5 +178,16 @@ FUZZ_TARGET(package_rbf, .init = initialize_package_rbf)\n \n     // If internals report error, wrapper should too\n     auto err_tuple{ImprovesFeerateDiagram(pool, direct_conflicts, all_conflicts, replacement_fees, replacement_vsize)};\n-    if (!calc_results.has_value()) assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    if (!calc_results.has_value()) {\n+         assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    } else {\n+        // Diagram check succeeded\n+        if (!err_tuple.has_value()) {\n+            // New diagram's final fee should always match or exceed old diagram's\n+            assert(calc_results->first.back().fee <= calc_results->second.back().fee);\n+        } else if (calc_results->first.back().fee > calc_results->second.back().fee) {\n+            // Or it failed, and if old diagram had higher fees, it should be a straight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538868180",
      "id" : 1538868180,
      "line" : 189,
      "node_id" : "PRRC_kwDOABII585buUPU",
      "original_commit_id" : "4f910a69448203fc51abd993bef27bf00768a1ec",
      "original_line" : 189,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/rbf.cpp",
      "position" : 149,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539012192"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539012192"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit (feel free to ignore): Member functions are already `inline`, so could drop the `inline` everywhere. See https://en.cppreference.com/w/cpp/language/inline \r\n\r\n> A function defined entirely inside a [class/struct/union definition](https://en.cppreference.com/w/cpp/language/classes), whether it's a member function or a non-member friend function, is implicitly an inline function ...",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T11:00:47Z",
      "diff_hunk" : "@@ -0,0 +1,160 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_FEEFRAC_H\n+#define BITCOIN_UTIL_FEEFRAC_H\n+\n+#include <stdint.h>\n+#include <compare>\n+#include <vector>\n+#include <span.h>\n+#include <util/check.h>\n+\n+/** Data structure storing a fee and size, ordered by increasing fee/size.\n+ *\n+ * The size of a FeeFrac cannot be zero unless the fee is also zero.\n+ *\n+ * FeeFracs have a total ordering, first by increasing feerate (ratio of fee over size), and then\n+ * by decreasing size. The empty FeeFrac (fee and size both 0) sorts last. So for example, the\n+ * following FeeFracs are in sorted order:\n+ *\n+ * - fee=0 size=1 (feerate 0)\n+ * - fee=1 size=2 (feerate 0.5)\n+ * - fee=2 size=3 (feerate 0.667...)\n+ * - fee=2 size=2 (feerate 1)\n+ * - fee=1 size=1 (feerate 1)\n+ * - fee=3 size=2 (feerate 1.5)\n+ * - fee=2 size=1 (feerate 2)\n+ * - fee=0 size=0 (undefined feerate)\n+ *\n+ * A FeeFrac is considered \"better\" if it sorts after another, by this ordering. All standard\n+ * comparison operators (<=>, ==, !=, >, <, >=, <=) respect this ordering.\n+ *\n+ * The FeeRateCompare, and >> and << operators only compare feerate and treat equal feerate but\n+ * different size as equivalent. The empty FeeFrac is neither lower or higher in feerate than any\n+ * other.\n+ */\n+struct FeeFrac\n+{\n+    /** Fallback version for Mul (see below).\n+     *\n+     * Separate to permit testing on platforms where it isn't actually needed.\n+     */\n+    static inline std::pair<int64_t, uint32_t> MulFallback(int64_t a, int32_t b) noexcept\n+    {\n+        // Otherwise, emulate 96-bit multiplication using two 64-bit multiplies.\n+        int64_t low = int64_t{static_cast<uint32_t>(a)} * b;\n+        int64_t high = (a >> 32) * b;\n+        return {high + (low >> 32), static_cast<uint32_t>(low)};\n+    }\n+\n+    // Compute a * b, returning an unspecified but totally ordered type.\n+#ifdef __SIZEOF_INT128__\n+    static inline __int128 Mul(int64_t a, int32_t b) noexcept\n+    {\n+        // If __int128 is available, use 128-bit wide multiply.\n+        return __int128{a} * b;\n+    }\n+#else\n+    static constexpr auto Mul = MulFallback;\n+#endif\n+\n+    int64_t fee;\n+    int32_t size;\n+\n+    /** Construct an IsEmpty() FeeFrac. */\n+    inline FeeFrac() noexcept : fee{0}, size{0} {}\n+\n+    /** Construct a FeeFrac with specified fee and size. */\n+    inline FeeFrac(int64_t f, int32_t s) noexcept : fee{f}, size{s} {}\n+\n+    inline FeeFrac(const FeeFrac&) noexcept = default;\n+    inline FeeFrac& operator=(const FeeFrac&) noexcept = default;\n+\n+    /** Check if this is empty (size and fee are 0). */\n+    bool inline IsEmpty() const noexcept {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539012192",
      "id" : 1539012192,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bu3Zg",
      "original_commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "original_line" : 76,
      "original_position" : 76,
      "original_start_line" : null,
      "path" : "src/util/feefrac.h",
      "position" : null,
      "pull_request_review_id" : 1960027369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539012192/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T11:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539012192",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539100329"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539100329"
         }
      },
      "author_association" : "MEMBER",
      "body" : "RFC: merge the two words into \"ffect\"",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:09:54Z",
      "diff_hunk" : "@@ -396,6 +396,14 @@ BOOST_FIXTURE_TEST_CASE(improves_feerate, TestChain100Setup)\n     // With one more satoshi it does\n     BOOST_CHECK(ImprovesFeerateDiagram(pool, {entry1}, {entry1, entry2}, tx1_fee + tx2_fee + 1, tx1_size + tx2_size) == std::nullopt);\n \n+    // With prioritisation of in-mempool conflicts, it effects the results of the comparison using the same args as just above",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539100329",
      "id" : 1539100329,
      "in_reply_to_id" : 1538852116,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvM6p",
      "original_commit_id" : "b380a1df36a95c85310949aeb81d8c57f4d023c4",
      "original_line" : 399,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1960171892,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539100329/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:09:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539100329",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121280"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121280"
         }
      },
      "author_association" : "MEMBER",
      "body" : ".... failure, fixed",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:41Z",
      "diff_hunk" : "@@ -178,5 +178,16 @@ FUZZ_TARGET(package_rbf, .init = initialize_package_rbf)\n \n     // If internals report error, wrapper should too\n     auto err_tuple{ImprovesFeerateDiagram(pool, direct_conflicts, all_conflicts, replacement_fees, replacement_vsize)};\n-    if (!calc_results.has_value()) assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    if (!calc_results.has_value()) {\n+         assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    } else {\n+        // Diagram check succeeded\n+        if (!err_tuple.has_value()) {\n+            // New diagram's final fee should always match or exceed old diagram's\n+            assert(calc_results->first.back().fee <= calc_results->second.back().fee);\n+        } else if (calc_results->first.back().fee > calc_results->second.back().fee) {\n+            // Or it failed, and if old diagram had higher fees, it should be a straight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121280",
      "id" : 1539121280,
      "in_reply_to_id" : 1538868180,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSCA",
      "original_commit_id" : "4f910a69448203fc51abd993bef27bf00768a1ec",
      "original_line" : 189,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203062,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121280/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121280",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121374"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121374"
         }
      },
      "author_association" : "MEMBER",
      "body" : "copy/paste, removed",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:44Z",
      "diff_hunk" : "@@ -67,6 +108,21 @@ static CTransactionRef add_descendant_to_parents(const std::vector<CTransactionR\n     return child_tx;\n }\n \n+// Makes two children for a single parent\n+static std::pair<CTransactionRef, CTransactionRef> add_children_to_parent(const CTransactionRef parent, CTxMemPool& pool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main, pool.cs)\n+{\n+    AssertLockHeld(::cs_main);\n+    AssertLockHeld(pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    // Assumes this isn't already spent in mempool\n+    auto children_tx = make_two_siblings(/*parent=*/parent, /*output_values=*/{50 * CENT});\n+    pool.addUnchecked(entry.FromTx(children_tx.first));\n+    pool.addUnchecked(entry.FromTx(children_tx.second));\n+    // Return last created tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121374",
      "id" : 1539121374,
      "in_reply_to_id" : 1538861778,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSDe",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 122,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203170,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121374/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121374",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121422"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121422"
         }
      },
      "author_association" : "MEMBER",
      "body" : "sure. taken",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:46Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121422",
      "id" : 1539121422,
      "in_reply_to_id" : 1538859925,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSEO",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 40,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203239,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121422/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:46Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121422",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121462"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121462"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:48Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions\n+static inline std::pair<CTransactionRef, CTransactionRef> make_two_siblings(const CTransactionRef parent,\n+                                      const std::vector<CAmount>& output_values)\n+{\n+    assert(parent->vout.size() >= 2);\n+\n+    // First tx takes first parent output\n+    CMutableTransaction tx1 = CMutableTransaction();\n+    tx1.vin.resize(1);\n+    tx1.vout.resize(output_values.size());\n+\n+    tx1.vin[0].prevout.hash = parent->GetHash();\n+    tx1.vin[0].prevout.n = 0;\n+    // Add a witness so wtxid != txid\n+    CScriptWitness witness;\n+    witness.stack.emplace_back(10);\n+    tx1.vin[0].scriptWitness = witness;\n+\n+    for (size_t i = 0; i < output_values.size(); ++i) {\n+        tx1.vout[i].scriptPubKey = CScript() << OP_11 << OP_EQUAL;\n+        tx1.vout[i].nValue = output_values[i];\n+    }\n+\n+    // Second tx takes second parent output\n+    CMutableTransaction tx2 = CMutableTransaction();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121462",
      "id" : 1539121462,
      "in_reply_to_id" : 1538856182,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSE2",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 64,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203313,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121462/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121543"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121543"
         }
      },
      "author_association" : "MEMBER",
      "body" : "done",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:50Z",
      "diff_hunk" : "@@ -396,6 +396,14 @@ BOOST_FIXTURE_TEST_CASE(improves_feerate, TestChain100Setup)\n     // With one more satoshi it does\n     BOOST_CHECK(ImprovesFeerateDiagram(pool, {entry1}, {entry1, entry2}, tx1_fee + tx2_fee + 1, tx1_size + tx2_size) == std::nullopt);\n \n+    // With prioritisation of in-mempool conflicts, it effects the results of the comparison using the same args as just above",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121543",
      "id" : 1539121543,
      "in_reply_to_id" : 1538852116,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSGH",
      "original_commit_id" : "b380a1df36a95c85310949aeb81d8c57f4d023c4",
      "original_line" : 399,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203382,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121543/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121591"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121591"
         }
      },
      "author_association" : "MEMBER",
      "body" : "removed :)",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T12:20:51Z",
      "diff_hunk" : "@@ -1302,7 +1302,7 @@ util::Result<std::pair<std::vector<FeeFrac>, std::vector<FeeFrac>>> CTxMemPool::\n     // Step 1: build the old diagram.\n \n     // The above clusters are all trivially linearized;\n-    // they have a strict topology of 1 or two connected transactions.\n+    // they have a strict topology of one or two connected transactions.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539121591",
      "id" : 1539121591,
      "in_reply_to_id" : 1538848298,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bvSG3",
      "original_commit_id" : "836841e2683fa0ca3fd7837726d935e52be142bc",
      "original_line" : 1305,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : null,
      "pull_request_review_id" : 1960203452,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121591/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T12:20:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539121591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "rebased on master, ready for more review",
      "created_at" : "2024-03-26T12:21:07Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2020284462",
      "id" : 2020284462,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854axgu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020284462/reactions"
      },
      "updated_at" : "2024-03-26T12:21:07Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020284462",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539343984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539343984"
         }
      },
      "author_association" : "MEMBER",
      "body" : "![image](https://github.com/bitcoin/bitcoin/assets/25183001/09b58c63-0944-4dfe-88e1-42e81ab97c7e)\r\n",
      "commit_id" : "de3af5f1449af533ba742377cb6fdd9e3854c2e3",
      "created_at" : "2024-03-26T14:18:21Z",
      "diff_hunk" : "@@ -178,5 +178,16 @@ FUZZ_TARGET(package_rbf, .init = initialize_package_rbf)\n \n     // If internals report error, wrapper should too\n     auto err_tuple{ImprovesFeerateDiagram(pool, direct_conflicts, all_conflicts, replacement_fees, replacement_vsize)};\n-    if (!calc_results.has_value()) assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    if (!calc_results.has_value()) {\n+         assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    } else {\n+        // Diagram check succeeded\n+        if (!err_tuple.has_value()) {\n+            // New diagram's final fee should always match or exceed old diagram's\n+            assert(calc_results->first.back().fee <= calc_results->second.back().fee);\n+        } else if (calc_results->first.back().fee > calc_results->second.back().fee) {\n+            // Or it failed, and if old diagram had higher fees, it should be a straight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1539343984",
      "id" : 1539343984,
      "in_reply_to_id" : 1538868180,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bwIZw",
      "original_commit_id" : "4f910a69448203fc51abd993bef27bf00768a1ec",
      "original_line" : 189,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/rbf.cpp",
      "position" : null,
      "pull_request_review_id" : 1960564224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539343984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T14:18:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1539343984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "```\r\nsrc/txmempool.cpp:1298:    // all_conflicts.  every such transaction will either be at its own feerate (followed \r\nsrc/txmempool.cpp:1299:    // by any descendant at its own feerate), or as a single chunk at the descendant's \r\n\r\n^^^\r\nTrailing whitespace\r\n```",
      "created_at" : "2024-03-26T14:21:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2020566703",
      "id" : 2020566703,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854b2av",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020566703/reactions"
      },
      "updated_at" : "2024-03-26T14:21:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2020566703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
