[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29724).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2024-03-25T16:13:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2018377286",
      "id" : 2018377286,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854Tf5G",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018377286/reactions"
      },
      "updated_at" : "2024-03-25T16:13:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018377286",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23064649168</sub>",
      "created_at" : "2024-03-25T18:04:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#issuecomment-2018597226",
      "id" : 2018597226,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29724",
      "node_id" : "IC_kwDOABII5854UVlq",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018597226/reactions"
      },
      "updated_at" : "2024-03-25T18:04:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018597226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538848298"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298"
         }
      },
      "author_association" : "MEMBER",
      "body" : "836841e2683fa0ca3fd7837726d935e52be142bc seems a bit trivial :sweat_smile: ",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:14:40Z",
      "diff_hunk" : "@@ -1302,7 +1302,7 @@ util::Result<std::pair<std::vector<FeeFrac>, std::vector<FeeFrac>>> CTxMemPool::\n     // Step 1: build the old diagram.\n \n     // The above clusters are all trivially linearized;\n-    // they have a strict topology of 1 or two connected transactions.\n+    // they have a strict topology of one or two connected transactions.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538848298",
      "id" : 1538848298,
      "line" : 1305,
      "node_id" : "PRRC_kwDOABII585buPYq",
      "original_commit_id" : "836841e2683fa0ca3fd7837726d935e52be142bc",
      "original_line" : 1305,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/txmempool.cpp",
      "position" : 75,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538848298",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538852116"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116"
         }
      },
      "author_association" : "MEMBER",
      "body" : "b380a1df36a95c85310949aeb81d8c57f4d023c4: s/effects/affects",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:17:19Z",
      "diff_hunk" : "@@ -396,6 +396,14 @@ BOOST_FIXTURE_TEST_CASE(improves_feerate, TestChain100Setup)\n     // With one more satoshi it does\n     BOOST_CHECK(ImprovesFeerateDiagram(pool, {entry1}, {entry1, entry2}, tx1_fee + tx2_fee + 1, tx1_size + tx2_size) == std::nullopt);\n \n+    // With prioritisation of in-mempool conflicts, it effects the results of the comparison using the same args as just above",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538852116",
      "id" : 1538852116,
      "line" : 399,
      "node_id" : "PRRC_kwDOABII585buQUU",
      "original_commit_id" : "b380a1df36a95c85310949aeb81d8c57f4d023c4",
      "original_line" : 399,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 308,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538852116",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538856182"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Could just make a copy of tx1 and change the input prevout? Can remove all the duplicate code.",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:19:26Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions\n+static inline std::pair<CTransactionRef, CTransactionRef> make_two_siblings(const CTransactionRef parent,\n+                                      const std::vector<CAmount>& output_values)\n+{\n+    assert(parent->vout.size() >= 2);\n+\n+    // First tx takes first parent output\n+    CMutableTransaction tx1 = CMutableTransaction();\n+    tx1.vin.resize(1);\n+    tx1.vout.resize(output_values.size());\n+\n+    tx1.vin[0].prevout.hash = parent->GetHash();\n+    tx1.vin[0].prevout.n = 0;\n+    // Add a witness so wtxid != txid\n+    CScriptWitness witness;\n+    witness.stack.emplace_back(10);\n+    tx1.vin[0].scriptWitness = witness;\n+\n+    for (size_t i = 0; i < output_values.size(); ++i) {\n+        tx1.vout[i].scriptPubKey = CScript() << OP_11 << OP_EQUAL;\n+        tx1.vout[i].nValue = output_values[i];\n+    }\n+\n+    // Second tx takes second parent output\n+    CMutableTransaction tx2 = CMutableTransaction();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538856182",
      "id" : 1538856182,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585buRT2",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 64,
      "original_position" : 28,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 29,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538856182",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538859925"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925"
         }
      },
      "author_association" : "MEMBER",
      "body" : "```suggestion\r\n// Make two child transactions from parent (which must have at least 2 outputs).\r\n// Each tx will have the same outputs, using the amounts specified in output_values.\r\n```",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:21:04Z",
      "diff_hunk" : "@@ -37,6 +37,47 @@ static inline CTransactionRef make_tx(const std::vector<CTransactionRef>& inputs\n     return MakeTransactionRef(tx);\n }\n \n+// Make two sibling transactions",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538859925",
      "id" : 1538859925,
      "line" : 40,
      "node_id" : "PRRC_kwDOABII585buSOV",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 40,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 5,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538859925",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538861778"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Returns both, actually?",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:22:08Z",
      "diff_hunk" : "@@ -67,6 +108,21 @@ static CTransactionRef add_descendant_to_parents(const std::vector<CTransactionR\n     return child_tx;\n }\n \n+// Makes two children for a single parent\n+static std::pair<CTransactionRef, CTransactionRef> add_children_to_parent(const CTransactionRef parent, CTxMemPool& pool)\n+    EXCLUSIVE_LOCKS_REQUIRED(::cs_main, pool.cs)\n+{\n+    AssertLockHeld(::cs_main);\n+    AssertLockHeld(pool.cs);\n+    TestMemPoolEntryHelper entry;\n+    // Assumes this isn't already spent in mempool\n+    auto children_tx = make_two_siblings(/*parent=*/parent, /*output_values=*/{50 * CENT});\n+    pool.addUnchecked(entry.FromTx(children_tx.first));\n+    pool.addUnchecked(entry.FromTx(children_tx.second));\n+    // Return last created tx",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538861778",
      "id" : 1538861778,
      "line" : 122,
      "node_id" : "PRRC_kwDOABII585buSrS",
      "original_commit_id" : "44ba5e9bea72397964a84cc1177afdb4f88e141f",
      "original_line" : 122,
      "original_position" : 63,
      "original_start_line" : null,
      "path" : "src/test/rbf_tests.cpp",
      "position" : 82,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538861778",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538868180"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180"
         }
      },
      "author_association" : "MEMBER",
      "body" : "4f910a69448203fc51abd993bef27bf00768a1ec \"a straight\"?",
      "commit_id" : "252af7bd6decf1b8cb26cb2711bc785aebf2f8cf",
      "created_at" : "2024-03-26T09:26:03Z",
      "diff_hunk" : "@@ -178,5 +178,16 @@ FUZZ_TARGET(package_rbf, .init = initialize_package_rbf)\n \n     // If internals report error, wrapper should too\n     auto err_tuple{ImprovesFeerateDiagram(pool, direct_conflicts, all_conflicts, replacement_fees, replacement_vsize)};\n-    if (!calc_results.has_value()) assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    if (!calc_results.has_value()) {\n+         assert(err_tuple.value().first == DiagramCheckError::UNCALCULABLE);\n+    } else {\n+        // Diagram check succeeded\n+        if (!err_tuple.has_value()) {\n+            // New diagram's final fee should always match or exceed old diagram's\n+            assert(calc_results->first.back().fee <= calc_results->second.back().fee);\n+        } else if (calc_results->first.back().fee > calc_results->second.back().fee) {\n+            // Or it failed, and if old diagram had higher fees, it should be a straight",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29724#discussion_r1538868180",
      "id" : 1538868180,
      "line" : 189,
      "node_id" : "PRRC_kwDOABII585buUPU",
      "original_commit_id" : "4f910a69448203fc51abd993bef27bf00768a1ec",
      "original_line" : 189,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/test/fuzz/rbf.cpp",
      "position" : 149,
      "pull_request_review_id" : 1959757669,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29724",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-26T09:27:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1538868180",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   }
]
