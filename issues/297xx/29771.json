{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Functional test framework unit tests are currently run prior to all other functional tests.\r\n\r\nThis PR enables execution of the test framework unit tests in parallel with the functional tests, rather than before the functional tests, saving runtime and more efficiently using available cores.\r\n\r\nThis is a follow up to  https://github.com/bitcoin/bitcoin/pull/29470#issuecomment-1962313977\r\n\r\n### New behavior:\r\n1) When running all tests, the framework unit tests are run in parallel with the other tests (unless explicitly skipped with `--exclude`).  This parallelization introduces marginal time savings when running all tests, depending on the machine used.  As an example, a 2-3% time savings (9 seconds) was observed on a machine using `--jobs=18` (with 18 available cores).\r\n2) When running specific functional tests, framework unit tests are now skipped by default.  Framework unit tests can be added by including `feature_framework_unit_tests.py` in the list of specific tests being executed.  The rationale for skipping by default is that if the tester is running specific functional tests, there is a conscious decision to focus testing, and choosing to run all tests (where unit tests are run by default) would be a next step.\r\n3) The `--skipunit` option is now removed since unit tests are parallelized (they no longer delay other tests).  Unit tests are treated equally as functional tests.\r\n\r\n### Implementation notes:\r\nSince `TextTestRunner` can be noisy (even with verbosity=0, and therefore trigger job failure through the presence of non-failure stderr output), the approach taken was to send output to stdout, and forward test result (as determined by `TestResult` returned).  This aligns with the previous check for unit test failure (`if not result.wasSuccessful():`).  \r\n\r\nThis approach was tested by inserting `self.assertEquals(True, False)` into test_framework/address.py and seeing specifics of the failure reported.\r\n\r\n```\r\n135/302 - feature_framework_unit_tests.py failed, Duration: 0 s\r\n\r\nstdout:\r\n.F\r\n======================================================================\r\nFAIL: test_bech32_decode (test_framework.address.TestFrameworkScript.test_bech32_decode)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/dev/myrepos/bitcoin/test/functional/test_framework/address.py\", line 228, in test_bech32_decode\r\n    self.assertEqual(True, False)\r\nAssertionError: True != False\r\n\r\n----------------------------------------------------------------------\r\nRan 2 tests in 0.003s\r\n\r\nFAILED (failures=1)\r\n\r\n\r\nstderr:\r\n```\r\n\r\nThere was an initial thought to parallelize the execution of the unit tests themselves (i.e. run the 12 unit test files in parallel), however, this is not anticipated to further reduce runtime meaningfully and is anticipated to add unnecessary complexity.\r\n",
   "closed_at" : "2024-04-26T20:06:50Z",
   "closed_by" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/3782274?v=4",
      "events_url" : "https://api.github.com/users/achow101/events{/privacy}",
      "followers_url" : "https://api.github.com/users/achow101/followers",
      "following_url" : "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url" : "https://api.github.com/users/achow101/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/achow101",
      "id" : 3782274,
      "login" : "achow101",
      "node_id" : "MDQ6VXNlcjM3ODIyNzQ=",
      "organizations_url" : "https://api.github.com/users/achow101/orgs",
      "received_events_url" : "https://api.github.com/users/achow101/received_events",
      "repos_url" : "https://api.github.com/users/achow101/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/achow101/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/achow101"
   },
   "comments" : 18,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771/comments",
   "created_at" : "2024-03-31T03:42:23Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/29771",
   "id" : 2216761550,
   "labels" : [
      {
         "color" : "d4c5f9",
         "default" : false,
         "description" : null,
         "id" : 62963516,
         "name" : "Tests",
         "node_id" : "MDU6TGFiZWw2Mjk2MzUxNg==",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585rPSay",
   "number" : 29771,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/29771.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29771",
      "merged_at" : "2024-04-26T20:06:49Z",
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/29771.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29771"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "closed",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771/timeline",
   "title" : "test: Run framework unit tests in parallel",
   "updated_at" : "2024-04-26T20:06:50Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29771",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
      "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
      "followers_url" : "https://api.github.com/users/tdb3/followers",
      "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
      "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/tdb3",
      "id" : 106488469,
      "login" : "tdb3",
      "node_id" : "U_kgDOBljilQ",
      "organizations_url" : "https://api.github.com/users/tdb3/orgs",
      "received_events_url" : "https://api.github.com/users/tdb3/received_events",
      "repos_url" : "https://api.github.com/users/tdb3/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/tdb3"
   }
}
