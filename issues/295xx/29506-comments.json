[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I don't understand this. A node sets `m_protect=true` for a a maximum of 4 outbound peers (`MAX_OUTBOUND_PEERS_TO_PROTECT_FROM_DISCONNECT`) that have announced headers to us that have at least the work of our tip. See [here](https://github.com/bitcoin/bitcoin/blob/ba907f96ad37c09c49c0e1532fad118fcb8dd4a8/src/net_processing.cpp#L2880-L2886) for the code on master.\r\nIt is also never set for inbound peers, so if an \"Adversary connects to Bitcoin\" it won't be protected by it.\r\n\r\nMoreover, even if it `m_protect` was set it only protects from being disconnected due to not keeping up with the best chain (`PeerManagerImpl::ConsiderEviction`). It doesn't protect against disconnections for other reasons.",
      "created_at" : "2024-02-28T18:58:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1969648412",
      "id" : 1969648412,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5851ZnMc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969648412/reactions"
      },
      "updated_at" : "2024-02-28T19:50:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969648412",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I understand what do you mean. I take back that it's caused by m_protect, but this bug behaves identically to m_protect =?= true and fDisconnect=?=true. Also in our tests it applies to both inbound and outbound peers, the bitcoin core peer stays connected, is pinging/ponging and never disconnects (but doesn't respond to any packets).",
      "created_at" : "2024-02-28T20:04:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1969776450",
      "id" : 1969776450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5851aGdC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969776450/reactions"
      },
      "updated_at" : "2024-02-28T20:20:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969776450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/121376577?v=4",
         "events_url" : "https://api.github.com/users/litecomb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/litecomb/followers",
         "following_url" : "https://api.github.com/users/litecomb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/litecomb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/litecomb",
         "id" : 121376577,
         "login" : "litecomb",
         "node_id" : "U_kgDOBzwPQQ",
         "organizations_url" : "https://api.github.com/users/litecomb/orgs",
         "received_events_url" : "https://api.github.com/users/litecomb/received_events",
         "repos_url" : "https://api.github.com/users/litecomb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/litecomb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/litecomb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/litecomb"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Also in our tests it applies to both inbound and outbound peers\r\n\r\nInbound eviction only happens when the node is full, replacing existing peers. There is a rather complicated algorithm for that protecting peers with respect to certain criteria to establish a good diversity of inbound peers, see `CConnman::AttemptToEvictConnection()`.\r\nBut when the node is not at capacity, no inbound peer gets disconnected, which is intentional.\r\n\r\nAutomatic outbound peers get disconnected if they fall behind our tip (`PeerManagerImpl::ConsiderEviction`).\r\nOf course, that requires you to have gotten a new tip from someone else in the meantime.\r\nManually chosen outbound peers (\"addnode\") are not disconnected this way.\r\n\r\nSee https://github.com/bitcoin-core/bitcoin-devwiki/wiki/P2P-Design-Philosophy for a more in-depth essay on that.",
      "created_at" : "2024-02-28T20:42:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1969884504",
      "id" : 1969884504,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5851ag1Y",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969884504/reactions"
      },
      "updated_at" : "2024-02-28T20:42:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969884504",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "author_association" : "NONE",
      "body" : ">  But when the node is not at capacity, no inbound peer gets disconnected, which is intentional.\r\n\r\nOkay, not a bug for inbound case. Still, the bad outbound case remains.\r\n\r\nEssay says:\r\n> so we won't stay connected to 9 peers for long, in theory\r\n\r\nMy tests show otherwise. You stay connected to an adversary (i.e. not Bitcoin Core) while not communicating new blocks or anything (except pings pongs) indefinitely. On Bitcoin Core - Bitcoin Core (the honest case) this bug doesn't manifest.\r\n\r\n",
      "created_at" : "2024-02-28T20:52:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1969897729",
      "id" : 1969897729,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5851akEB",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969897729/reactions"
      },
      "updated_at" : "2024-02-28T20:56:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1969897729",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/121376577?v=4",
         "events_url" : "https://api.github.com/users/litecomb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/litecomb/followers",
         "following_url" : "https://api.github.com/users/litecomb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/litecomb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/litecomb",
         "id" : 121376577,
         "login" : "litecomb",
         "node_id" : "U_kgDOBzwPQQ",
         "organizations_url" : "https://api.github.com/users/litecomb/orgs",
         "received_events_url" : "https://api.github.com/users/litecomb/received_events",
         "repos_url" : "https://api.github.com/users/litecomb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/litecomb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/litecomb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/litecomb"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> My tests show otherwise.\r\n\r\nCan you share your tests? Ideally as a python functional test with the P2P interface mock, or otherwise exact steps to reproduce?",
      "created_at" : "2024-02-29T08:38:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-1970659409",
      "id" : 1970659409,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5851deBR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1970659409/reactions"
      },
      "updated_at" : "2024-02-29T08:38:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1970659409",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I would love to, currently it's in golang.\r\nActually what bugs me the most that the remote bitcoins cease sending new block headers to me after a long time. But they keep pinging me.",
      "created_at" : "2024-03-22T01:29:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/issues/29506#issuecomment-2014152339",
      "id" : 2014152339,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29506",
      "node_id" : "IC_kwDOABII5854DYaT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2014152339/reactions"
      },
      "updated_at" : "2024-03-22T01:29:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2014152339",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/121376577?v=4",
         "events_url" : "https://api.github.com/users/litecomb/events{/privacy}",
         "followers_url" : "https://api.github.com/users/litecomb/followers",
         "following_url" : "https://api.github.com/users/litecomb/following{/other_user}",
         "gists_url" : "https://api.github.com/users/litecomb/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/litecomb",
         "id" : 121376577,
         "login" : "litecomb",
         "node_id" : "U_kgDOBzwPQQ",
         "organizations_url" : "https://api.github.com/users/litecomb/orgs",
         "received_events_url" : "https://api.github.com/users/litecomb/received_events",
         "repos_url" : "https://api.github.com/users/litecomb/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/litecomb/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/litecomb/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/litecomb"
      }
   }
]
