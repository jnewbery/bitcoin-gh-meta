[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29553).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1977099942), [Sjors](https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1978480989), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1980783607), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/29553#pullrequestreview-1919888870) |\n| Stale ACK | [alfonsoromanz](https://github.com/bitcoin/bitcoin/pull/29553#pullrequestreview-2033825476) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29681](https://github.com/bitcoin/bitcoin/pull/29681) (test: loading assumeutxo snapshot start states by BrandonOdiwuor)\n* [#29428](https://github.com/bitcoin/bitcoin/pull/29428) (test: Assumeutxo: snapshots with less work should not be loaded by hernanmarino)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-03-04T15:58:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1976911164",
      "id" : 1976911164,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII58511UU8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1976911164/reactions"
      },
      "updated_at" : "2024-06-06T09:00:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1976911164",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1511457747"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511457747"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "```suggestion\r\n        // still be created for the wrong height.\r\n```",
      "commit_id" : "a6ad525f48a0df0d9bcb304968acfb164180303c",
      "created_at" : "2024-03-04T16:40:35Z",
      "diff_hunk" : "@@ -2621,10 +2624,30 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};\n+        // In case there is any issue with a block being read from disc due to\n+        // pruning for example, we need to stop here, otherwise the dump would\n+        // still be greated for the wrong height.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1511457747",
      "id" : 1511457747,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585aFwPT",
      "original_commit_id" : "c2f62ebc44767bbc6795cb3036d4d28b5f21ffe8",
      "original_line" : 2636,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1914795143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511457747/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-04T18:21:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511457747",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1511469672"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511469672"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: could additionally check that the two dump file contents are equal, e.g.\r\n```diff\r\ndiff --git a/test/functional/feature_assumeutxo.py b/test/functional/feature_assumeutxo.py\r\nindex 71c3c2c096..a9ba96ae25 100755\r\n--- a/test/functional/feature_assumeutxo.py\r\n+++ b/test/functional/feature_assumeutxo.py\r\n@@ -39,6 +39,7 @@ from test_framework.test_framework import BitcoinTestFramework\r\n from test_framework.util import (\r\n     assert_equal,\r\n     assert_raises_rpc_error,\r\n+    sha256sum_file,\r\n )\r\n from test_framework.wallet import (\r\n     getnewdestination,\r\n@@ -216,6 +217,7 @@ class AssumeutxoTest(BitcoinTestFramework):\r\n         self.log.info(f\"Check that dumptxoutsetinfo works for past block heights\")\r\n         dump_output2 = n0.dumptxoutset('utxos2.dat', SNAPSHOT_BASE_HEIGHT)\r\n         check_dump_output(dump_output2)\r\n+        assert_equal(sha256sum_file(dump_output['path']), sha256sum_file(dump_output2['path']))\r\n \r\n         # Ensure n0 is back at the tip\r\n         assert_equal(n0.getblockchaininfo()[\"blocks\"], FINAL_HEIGHT)\r\n``` ",
      "commit_id" : "a6ad525f48a0df0d9bcb304968acfb164180303c",
      "created_at" : "2024-03-04T16:49:23Z",
      "diff_hunk" : "@@ -210,6 +213,13 @@ def run_test(self):\n \n         assert_equal(n0.getblockchaininfo()[\"blocks\"], FINAL_HEIGHT)\n \n+        self.log.info(f\"Check that dumptxoutsetinfo works for past block heights\")\n+        dump_output2 = n0.dumptxoutset('utxos2.dat', SNAPSHOT_BASE_HEIGHT)\n+        check_dump_output(dump_output2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1511469672",
      "id" : 1511469672,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585aFzJo",
      "original_commit_id" : "a480d9748b29c5467c038b3f73c0845f7ee27f70",
      "original_line" : 227,
      "original_position" : 25,
      "original_start_line" : 216,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 33,
      "pull_request_review_id" : 1914795143,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511469672/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 225,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-04T18:21:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511469672",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK\r\n\r\nNice idea. I think it makes sense to do the rollback (and roll forward after dump creation) directly in the RPC call, rather than relying on potentially fragile and poorly maintained shell scripts. One suggestion: on pruned nodes, the RPC should fail early if the block of the snapshot height is below the pruned block height, similar like what the script does:\r\nhttps://github.com/bitcoin/bitcoin/blob/98005b6a17907c4f7bdcf802ee96c274492f902a/contrib/devtools/utxo_snapshot.sh#L34-L37\r\n\r\nI'm neutral about removing `test_utxo_snapshots.sh`. This seems to be more meant like an interactive demo to get familiar with AssumeUTXO and as such could still make sense for some?",
      "created_at" : "2024-03-04T17:25:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1977099942",
      "id" : 1977099942,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII58512Cam",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1977099942/reactions"
      },
      "updated_at" : "2024-03-04T17:25:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1977099942",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Seems like this should freeze indexes, wallets, etc and hold a lock so nothing else happens during the process...?",
      "created_at" : "2024-03-04T19:14:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1977283372",
      "id" : 1977283372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII58512vMs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1977283372/reactions"
      },
      "updated_at" : "2024-03-04T19:14:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1977283372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1095675?v=4",
         "events_url" : "https://api.github.com/users/luke-jr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/luke-jr/followers",
         "following_url" : "https://api.github.com/users/luke-jr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/luke-jr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/luke-jr",
         "id" : 1095675,
         "login" : "luke-jr",
         "node_id" : "MDQ6VXNlcjEwOTU2NzU=",
         "organizations_url" : "https://api.github.com/users/luke-jr/orgs",
         "received_events_url" : "https://api.github.com/users/luke-jr/received_events",
         "repos_url" : "https://api.github.com/users/luke-jr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/luke-jr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/luke-jr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/luke-jr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK. But rather than relying on block invalidation, I would prefer to have a clean rollback. That would be useful as it's own RPC too: turn off network, call `rollback N/HASH`, turn on network and it will sync normally. See #29565.",
      "created_at" : "2024-03-05T10:51:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1978480989",
      "id" : 1978480989,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII58517Tld",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1978480989/reactions"
      },
      "updated_at" : "2024-03-05T10:51:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1978480989",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-03-06T12:40:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1980783607",
      "id" : 1980783607,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII5852EFv3",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1980783607/reactions"
      },
      "updated_at" : "2024-03-06T12:40:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1980783607",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-13T17:50:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-1995168775",
      "id" : 1995168775,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII585269wH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1995168775/reactions"
      },
      "updated_at" : "2024-03-13T17:50:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1995168775",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527253589"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253589"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "fixed",
      "commit_id" : "a6ad525f48a0df0d9bcb304968acfb164180303c",
      "created_at" : "2024-03-16T20:37:56Z",
      "diff_hunk" : "@@ -2621,10 +2624,30 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};\n+        // In case there is any issue with a block being read from disc due to\n+        // pruning for example, we need to stop here, otherwise the dump would\n+        // still be greated for the wrong height.",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527253589",
      "id" : 1527253589,
      "in_reply_to_id" : 1511457747,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585bCApV",
      "original_commit_id" : "c2f62ebc44767bbc6795cb3036d4d28b5f21ffe8",
      "original_line" : 2636,
      "original_position" : 23,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 1941317857,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253589/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-16T20:37:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253589",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527253605"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253605"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "added",
      "commit_id" : "a6ad525f48a0df0d9bcb304968acfb164180303c",
      "created_at" : "2024-03-16T20:38:01Z",
      "diff_hunk" : "@@ -210,6 +213,13 @@ def run_test(self):\n \n         assert_equal(n0.getblockchaininfo()[\"blocks\"], FINAL_HEIGHT)\n \n+        self.log.info(f\"Check that dumptxoutsetinfo works for past block heights\")\n+        dump_output2 = n0.dumptxoutset('utxos2.dat', SNAPSHOT_BASE_HEIGHT)\n+        check_dump_output(dump_output2)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527253605",
      "id" : 1527253605,
      "in_reply_to_id" : 1511469672,
      "line" : 227,
      "node_id" : "PRRC_kwDOABII585bCApl",
      "original_commit_id" : "a480d9748b29c5467c038b3f73c0845f7ee27f70",
      "original_line" : 227,
      "original_position" : 25,
      "original_start_line" : 216,
      "path" : "test/functional/feature_assumeutxo.py",
      "position" : 33,
      "pull_request_review_id" : 1941317864,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253605/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 225,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-16T20:38:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527253605",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks for all the comments! Rebased and addressed feedback.\r\n\r\n> One suggestion: on pruned nodes, the RPC should fail early if the block of the snapshot height is below the pruned block height\r\n\r\nAdded, good idea!\r\n\r\n> I'm neutral about removing test_utxo_snapshots.sh. This seems to be more meant like an interactive demo to get familiar with AssumeUTXO and as such could still make sense for some?\r\n\r\nYeah, I was kind of aiming at that when I wrote \"TBD if we need additional documentation.\". Since your comment I have been thinking about it a bit more but because that script requires the person that runs it to change the code and recompile bitcoin core I think its audience was always just a tiny group, particularly I think it was useful for reviewers of the concept and code in the early days. Going forward it should be more valuable if we instead document the code properly to make it easy to grasp for contributors (the same goes for the functional tests where we essentially go through similar steps as the script) and for users we should provide easy documentation that explains the usage of the feature properly but doesn't require changing the code.\r\n\r\nI have added another commit where I am splitting off a part of the previous design doc into a separate, usage-focused doc. Let me know what you think and if you have ideas for making the usage doc more complete.\r\n\r\n> Seems like this should freeze indexes, wallets, etc, and hold a lock so nothing else happens during the process...?\r\n\r\n> But rather than relying on block invalidation, I would prefer to have a clean rollback.\r\n\r\nI think these requests are essentially the same, or at least the ideal solution to both of these will look similar.\r\n\r\nFor now, I have only added that I am setting the network to inactive and I will now work on a draft for the clean rollback. But I am still pushing this here now because I think this is already an improvement as-is and the clean rollback may be a bigger change that could also be done as a follow-up, so I don't think review needs to be blocked here. I will report back on the rollback progress here soon.",
      "created_at" : "2024-03-16T20:57:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2002129556",
      "id" : 2002129556,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII5853VhKU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002129556/reactions"
      },
      "updated_at" : "2024-03-16T20:57:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2002129556",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527560566"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527560566"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This actually isn't a fully sufficient check because we could be missing the undo data. I am addressing this here: #29668",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-03-17T16:46:30Z",
      "diff_hunk" : "@@ -2646,10 +2649,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1527560566",
      "id" : 1527560566,
      "line" : 2671,
      "node_id" : "PRRC_kwDOABII585bDLl2",
      "original_commit_id" : "5da057c5330a49122873b9d5f5a44aea9bff1a8d",
      "original_line" : 2671,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 124,
      "pull_request_review_id" : 1941530208,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527560566/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-03-17T18:59:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1527560566",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > Seems like this should freeze indexes, wallets, etc, and hold a lock so nothing else happens during the process...?\r\n> \r\n> > But rather than relying on block invalidation, I would prefer to have a clean rollback.\r\n> \r\n> I think these requests are essentially the same, or at least the ideal solution to both of these will look similar.\r\n\r\nAnother approach, suggested by @maflcko in #29565 is to rewind the UTXO set inside of a cache. If that cache is kept isolated from the rest of the node, then indexes and wallets are not affected. It's also safe to abort the process, worst case just leaving a large temp file around.",
      "created_at" : "2024-03-18T12:56:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2003837404",
      "id" : 2003837404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII5853cCHc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2003837404/reactions"
      },
      "updated_at" : "2024-03-18T12:56:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2003837404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Another approach, suggested by @maflcko in #29565 is to rewind the UTXO set inside of a cache. If that cache is kept isolated from the rest of the node, then indexes and wallets are not affected. It's also safe to abort the process, worst case just leaving a large temp file around.\r\n\r\nYes, I have a similar approach in mind. I think that is the cleanest solution if it's feasible in terms of complexity.",
      "created_at" : "2024-03-18T13:00:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2003847400",
      "id" : 2003847400,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII5853cEjo",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2003847400/reactions"
      },
      "updated_at" : "2024-03-18T13:00:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2003847400",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-25T16:27:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2018407602",
      "id" : 2018407602,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII5854TnSy",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018407602/reactions"
      },
      "updated_at" : "2024-03-25T16:27:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2018407602",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-06-05T00:10:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2148607710",
      "id" : 2148607710,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII586AESbe",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2148607710/reactions"
      },
      "updated_at" : "2024-06-05T00:10:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2148607710",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Rebased\r\n\r\n> My impression is that this PR is good enough as is, unless there is a specific issue with invalidate/reconsider block that I am not aware of.\r\n\r\n> If the rollback functionality gets implemented after this PR is merged, it seems straightforward to change this code\r\n\r\nYes, either way, this PR should be an improvement. I am still planning to do the rollback in a cleaner way but if this PR is merged before that is ready, there should be no overhead resulting from that. It would become a refactoring follow-up that does not change the RPC interface again.",
      "created_at" : "2024-06-06T09:07:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#issuecomment-2151786093",
      "id" : 2151786093,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/29553",
      "node_id" : "IC_kwDOABII586AQaZt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2151786093/reactions"
      },
      "updated_at" : "2024-06-06T09:07:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2151786093",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629099295"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629099295"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Another issue could be that a sister block of `invalidate_index` was activated instead, if one exists? If so, could make sense to mention that as well.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-06T09:13:55Z",
      "diff_hunk" : "@@ -2646,10 +2657,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};\n+            if (first_block->nHeight > target_index->nHeight) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Could not roll back to requested height since necessary block data is already pruned.\");\n+            }\n+        }\n+\n+        // Suspend network activity for the duration of the process when we are\n+        // rolling back the chain to get a utxo set from a past height.\n+        connman.SetNetworkActive(false);\n+        if (connman.GetNetworkActive()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Network activity could not be suspended.\");\n+        }\n+\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};\n+\n+        // In case there is any issue with a block being read from disc we need",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629099295",
      "id" : 1629099295,
      "line" : 2688,
      "node_id" : "PRRC_kwDOABII585hGhUf",
      "original_commit_id" : "71b9fa96bfe1c936ecb10d3e5d1b95b7d24f9ea8",
      "original_line" : 2688,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 141,
      "pull_request_review_id" : 2101363203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629099295/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-06T09:15:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629099295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629101713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629101713"
         }
      },
      "author_association" : "MEMBER",
      "body" : "style nit for new code, here and elsewhere: Could make sense to use the chainman.GetMutex() alias for chainman locking, instead of the global cs_main?",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-06T09:15:29Z",
      "diff_hunk" : "@@ -2646,10 +2657,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629101713",
      "id" : 1629101713,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hGh6R",
      "original_commit_id" : "71b9fa96bfe1c936ecb10d3e5d1b95b7d24f9ea8",
      "original_line" : 2669,
      "original_position" : 121,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2101363203,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629101713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-06T09:15:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629101713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629758949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629758949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, interesting edge case! I extended the comment.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-06T15:30:34Z",
      "diff_hunk" : "@@ -2646,10 +2657,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};\n+            if (first_block->nHeight > target_index->nHeight) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Could not roll back to requested height since necessary block data is already pruned.\");\n+            }\n+        }\n+\n+        // Suspend network activity for the duration of the process when we are\n+        // rolling back the chain to get a utxo set from a past height.\n+        connman.SetNetworkActive(false);\n+        if (connman.GetNetworkActive()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Network activity could not be suspended.\");\n+        }\n+\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};\n+\n+        // In case there is any issue with a block being read from disc we need",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629758949",
      "id" : 1629758949,
      "in_reply_to_id" : 1629099295,
      "line" : 2688,
      "node_id" : "PRRC_kwDOABII585hJCXl",
      "original_commit_id" : "71b9fa96bfe1c936ecb10d3e5d1b95b7d24f9ea8",
      "original_line" : 2688,
      "original_position" : 140,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 141,
      "pull_request_review_id" : 2102318274,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629758949/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-06T15:30:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629758949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629759103"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629759103"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Done",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-06T15:30:40Z",
      "diff_hunk" : "@@ -2646,10 +2657,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1629759103",
      "id" : 1629759103,
      "in_reply_to_id" : 1629101713,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hJCZ_",
      "original_commit_id" : "71b9fa96bfe1c936ecb10d3e5d1b95b7d24f9ea8",
      "original_line" : 2669,
      "original_position" : 121,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : null,
      "pull_request_review_id" : 2102318499,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629759103/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-06T15:30:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629759103",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648974658"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648974658"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\nI don't think it's sufficient to call `connman.SetNetworkActive()` manually in this function, because the InvalidateBlock and ReconsiderBlock functions called here can both throw exceptions and leave the network disabled after this RPC call if there is an error. Would suggest making a NetworkDisable disable_network{connman}; RAII class that disables the network in its constructor and enables it in its destructor to improve the error handling.\r\n\r\nAlso, can there be a comment to say why this is suspending network activity? I'm not actually sure why that is needed, since presumably networking code should not download invalid blocks, so it's not clear what effect this has.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T13:34:20Z",
      "diff_hunk" : "@@ -2654,10 +2657,56 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(node.chainman->GetMutex());\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};\n+            if (first_block->nHeight > target_index->nHeight) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Could not roll back to requested height since necessary block data is already pruned.\");\n+            }\n+        }\n+\n+        // Suspend network activity for the duration of the process when we are\n+        // rolling back the chain to get a utxo set from a past height.\n+        connman.SetNetworkActive(false);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648974658",
      "id" : 1648974658,
      "line" : 2679,
      "node_id" : "PRRC_kwDOABII585iSVtC",
      "original_commit_id" : "2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364",
      "original_line" : 2679,
      "original_position" : 33,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 132,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648974658/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648974658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648975246"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648975246"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\ns/disc/disk/",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T13:34:51Z",
      "diff_hunk" : "@@ -2654,10 +2657,56 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(node.chainman->GetMutex());\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};\n+            if (first_block->nHeight > target_index->nHeight) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Could not roll back to requested height since necessary block data is already pruned.\");\n+            }\n+        }\n+\n+        // Suspend network activity for the duration of the process when we are\n+        // rolling back the chain to get a utxo set from a past height.\n+        connman.SetNetworkActive(false);\n+        if (connman.GetNetworkActive()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Network activity could not be suspended.\");\n+        }\n+\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};\n+\n+        // In case there is any issue with a block being read from disc we need",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648975246",
      "id" : 1648975246,
      "line" : 2688,
      "node_id" : "PRRC_kwDOABII585iSV2O",
      "original_commit_id" : "2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364",
      "original_line" : 2688,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 141,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648975246/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648975246",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648979413"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648979413"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\n> This actually isn't a fully sufficient check because we could be missing the undo data. I am addressing this here: #29668\r\n\r\nCan you say what the problem is in a code comment so it is clear what current behavior is? Comment can removed when the problem is fixed later.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T13:38:22Z",
      "diff_hunk" : "@@ -2646,10 +2649,53 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(::cs_main);\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1648979413",
      "id" : 1648979413,
      "in_reply_to_id" : 1527560566,
      "line" : 2671,
      "node_id" : "PRRC_kwDOABII585iSW3V",
      "original_commit_id" : "5da057c5330a49122873b9d5f5a44aea9bff1a8d",
      "original_line" : 2671,
      "original_position" : 25,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 124,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648979413/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1648979413",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649320665"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649320665"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Improve guide for usage of assumeutxo\" (6a5408dd7da4c31283cb4f632b3a7aa692a53ca3)\r\n\r\nMaybe say \"generate it yourself from another node\" to be clear you need a different node to generate it.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T18:47:03Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+# Assumeutxo Usage\n+\n+Assumeutxo is a feature that allows fast bootstrapping of a validating bitcoind\n+instance.\n+\n+For notes on the design of Assumeutxo, please refer to [the design doc](/doc/assumeutxo.md).\n+\n+## Loading a snapshot\n+\n+There is currently no canonical source for snapshots, but any downloaded snapshot\n+will be checked against a hash that's been hardcoded in source code. If there is\n+no source for the snapshot you need, you can generate it yourself using",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649320665",
      "id" : 1649320665,
      "line" : 12,
      "node_id" : "PRRC_kwDOABII585iTqLZ",
      "original_commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "original_line" : 12,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "doc/assumeutxo.md",
      "position" : 12,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649320665/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649320665",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649328350"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649328350"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"doc: Improve guide for usage of assumeutxo\" (6a5408dd7da4c31283cb4f632b3a7aa692a53ca3)\r\n\r\nIs it true that no pruning will take place between the snapshot and the tip? I haven't experimented but it looks like GetPruneRange will only return a minimum prune height for the snapshot chainstate, not the background chainstate.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T18:56:27Z",
      "diff_hunk" : "@@ -0,0 +1,65 @@\n+# Assumeutxo Usage\n+\n+Assumeutxo is a feature that allows fast bootstrapping of a validating bitcoind\n+instance.\n+\n+For notes on the design of Assumeutxo, please refer to [the design doc](/doc/assumeutxo.md).\n+\n+## Loading a snapshot\n+\n+There is currently no canonical source for snapshots, but any downloaded snapshot\n+will be checked against a hash that's been hardcoded in source code. If there is\n+no source for the snapshot you need, you can generate it yourself using\n+`dumptxoutset` (see [Generating a snapshot](#generating-a-snapshot)).\n+\n+Once you've obtained the snapshot, you can use the RPC command `loadtxoutset` to\n+load it.\n+\n+```\n+$ bitcoin-cli loadtxoutset /path/to/input\n+```\n+\n+After the snapshot has loaded, the syncing process of both the snapshot chain\n+and the background IBD chain can be monitored with the `getchainstates` RPC.\n+\n+### Pruning\n+\n+A pruned node can load a snapshot. To save space, it's possible to delete the\n+snapshot file as soon as `loadtxoutset` finishes.\n+\n+The minimum `-prune` setting is 550 MiB, but this functionality ignores that\n+minimum and uses at least 1100 MiB.\n+\n+As the background sync continues there will be temporarily two chainstate\n+directories, each multiple gigabytes in size (likely growing larger than the\n+downloaded snapshot).\n+\n+### Indexes\n+\n+Indexes work but don't take advantage of this feature. They always start building\n+from the genesis block. Once the background validation reaches the snapshot block,\n+indexes will continue to build all the way to the tip.\n+\n+For indexes that support pruning, note that no pruning will take place between\n+the snapshot and the tip, until the background sync has completed - after which",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649328350",
      "id" : 1649328350,
      "line" : 44,
      "node_id" : "PRRC_kwDOABII585iTsDe",
      "original_commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "original_line" : 44,
      "original_position" : 44,
      "original_start_line" : 43,
      "path" : "doc/assumeutxo.md",
      "position" : 44,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649328350/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 43,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649328350",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649333656"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649333656"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\nFor a followup, it might be convenient if height value defaulted to the last height value which could actually be loaded as a snapshot. It could also accept a \"latest\" string value in case the user does want to generate the latest snapshot.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T19:02:48Z",
      "diff_hunk" : "@@ -2615,6 +2615,9 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to a file.\",\n         {\n             {\"path\", RPCArg::Type::STR, RPCArg::Optional::NO, \"Path to the output file. If relative, will be prefixed by datadir.\"},\n+            {\"height\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"the current tip\"},",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649333656",
      "id" : 1649333656,
      "line" : 2618,
      "node_id" : "PRRC_kwDOABII585iTtWY",
      "original_commit_id" : "2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364",
      "original_line" : 2618,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 103,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649333656/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649333656",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649335464"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649335464"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\nIt seems racy to unlock cs_main before calling CreateUTXOSnapshot. Not sure if there is a way to implement this in a race-free way without looping though. Could be something to follow up on later.",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T19:05:07Z",
      "diff_hunk" : "@@ -2654,10 +2657,56 @@ static RPCHelpMan dumptxoutset()\n     }\n \n     NodeContext& node = EnsureAnyNodeContext(request.context);\n+    CConnman& connman = EnsureConnman(node);\n+\n+    const CBlockIndex* invalidate_index{nullptr};\n+    if (!request.params[1].isNull()) {\n+        const CBlockIndex* target_index = ParseHashOrHeight(request.params[1], *node.chainman);\n+\n+        // If the node is running in pruned mode we ensure all necessary block\n+        // data is available before starting to roll back.\n+        if (node.chainman->m_blockman.IsPruneMode()) {\n+            LOCK(node.chainman->GetMutex());\n+            const CBlockIndex* current_tip{node.chainman->ActiveChain().Tip()};\n+            const CBlockIndex* first_block{node.chainman->m_blockman.GetFirstStoredBlock(*current_tip)};\n+            if (first_block->nHeight > target_index->nHeight) {\n+                throw JSONRPCError(RPC_MISC_ERROR, \"Could not roll back to requested height since necessary block data is already pruned.\");\n+            }\n+        }\n+\n+        // Suspend network activity for the duration of the process when we are\n+        // rolling back the chain to get a utxo set from a past height.\n+        connman.SetNetworkActive(false);\n+        if (connman.GetNetworkActive()) {\n+            throw JSONRPCError(RPC_MISC_ERROR, \"Network activity could not be suspended.\");\n+        }\n+\n+        invalidate_index = WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Next(target_index));\n+        InvalidateBlock(*node.chainman, invalidate_index->GetBlockHash());\n+        const CBlockIndex* new_tip_index{WITH_LOCK(::cs_main, return node.chainman->ActiveChain().Tip())};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649335464",
      "id" : 1649335464,
      "line" : 2686,
      "node_id" : "PRRC_kwDOABII585iTtyo",
      "original_commit_id" : "2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364",
      "original_line" : 2686,
      "original_position" : 40,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 139,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649335464/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649335464",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649378681"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649378681"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"RPC: Add height parameter to dumptxoutset\" (https://github.com/bitcoin/bitcoin/commit/2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364)\r\n\r\nDocumentation here is really terse. For a folluwup , I think it would be nice to add some of the documentation from the usage guide to the RPC documentation so it is more accessible. ",
      "commit_id" : "6a5408dd7da4c31283cb4f632b3a7aa692a53ca3",
      "created_at" : "2024-06-21T20:00:10Z",
      "diff_hunk" : "@@ -2615,6 +2615,9 @@ static RPCHelpMan dumptxoutset()\n         \"Write the serialized UTXO set to a file.\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/29553#discussion_r1649378681",
      "id" : 1649378681,
      "line" : 2615,
      "node_id" : "PRRC_kwDOABII585iT4V5",
      "original_commit_id" : "2cdce8fd9c93099db7e86ff33a1da8fbf0aaf364",
      "original_line" : 2615,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/rpc/blockchain.cpp",
      "position" : 100,
      "pull_request_review_id" : 2132676568,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/29553",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649378681/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-21T20:03:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1649378681",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
