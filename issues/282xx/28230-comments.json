[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/28230#issuecomment-1667726750) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2023-08-07T11:14:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#issuecomment-1667663404",
      "id" : 1667663404,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28230",
      "node_id" : "IC_kwDOABII585jZoYs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667663404/reactions"
      },
      "updated_at" : "2023-08-07T12:02:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667663404",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2023-08-07T12:02:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#issuecomment-1667726750",
      "id" : 1667726750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28230",
      "node_id" : "IC_kwDOABII585jZ32e",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667726750/reactions"
      },
      "updated_at" : "2023-08-07T12:02:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1667726750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285806857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285806857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: would be helpful to specify what it throws, and perhaps use `@throws` to make it structured?",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T12:38:20Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285806857",
      "id" : 1285806857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mo9sJ",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 388,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565233492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285806857/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285806857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285831220"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285831220"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: as we're getting the parameter value, would `Arg` be a better name? Perhaps it's too similar to `RPCArg` though (which unfortunately would have been more appropriately named `RPCParam`, I think, but that's not relevant to this PR).",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T12:57:20Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can\n+     * not represent the default value.\n+     */\n+    template <typename R>\n+    R Param(size_t i) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285831220",
      "id" : 1285831220,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpDo0",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 392,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565233492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285831220/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:14:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285831220",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285838697"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285838697"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think we also want to set this to nullptr in the many cases where we throw early in this function?",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:02:01Z",
      "diff_hunk" : "@@ -631,9 +632,25 @@ UniValue RPCHelpMan::HandleRequest(const JSONRPCRequest& request) const\n                           PACKAGE_BUGREPORT)};\n         }\n     }\n+    m_req = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285838697",
      "id" : 1285838697,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpFdp",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 635,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : null,
      "pull_request_review_id" : 1565233492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285838697/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285838697",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285851447"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285851447"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not sure this is threadsafe with our `g_work_queue`. Will we not have race conditions here when multiple requests on the same `RPCHelpMan` are in the queue at the same time?",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:13:42Z",
      "diff_hunk" : "@@ -399,6 +406,7 @@ class RPCHelpMan\n     const std::vector<RPCArg> m_args;\n     const RPCResults m_results;\n     const RPCExamples m_examples;\n+    mutable const JSONRPCRequest* m_req{nullptr}; // A pointer to the request for the duration of HandleRequest()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285851447",
      "id" : 1285851447,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpIk3",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 409,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565233492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285851447/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:14:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285851447",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285862343"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285862343"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`RPCHelpMan` are constructed and allocated fresh for each RPC call.",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:22:59Z",
      "diff_hunk" : "@@ -399,6 +406,7 @@ class RPCHelpMan\n     const std::vector<RPCArg> m_args;\n     const RPCResults m_results;\n     const RPCExamples m_examples;\n+    mutable const JSONRPCRequest* m_req{nullptr}; // A pointer to the request for the duration of HandleRequest()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285862343",
      "id" : 1285862343,
      "in_reply_to_id" : 1285851447,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpLPH",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 409,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565323369,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285862343/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:23:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285862343",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285865972"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285865972"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Why? `throw` can only happen on internal bugs. Not sure if it makes sense to write additional code to cover unreachable code.\r\n\r\nAlso, how? This can be done in the destructor, but then the point of setting it is moot.",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:25:55Z",
      "diff_hunk" : "@@ -631,9 +632,25 @@ UniValue RPCHelpMan::HandleRequest(const JSONRPCRequest& request) const\n                           PACKAGE_BUGREPORT)};\n         }\n     }\n+    m_req = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285865972",
      "id" : 1285865972,
      "in_reply_to_id" : 1285838697,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpMH0",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 635,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : null,
      "pull_request_review_id" : 1565329017,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285865972/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:25:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285865972",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285870318"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285870318"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I am leaning toward removing the \"throws\". This only happens on internal bugs. For example if a dev writes `self.Param<int>(99999999)` (or switches `int` to `bool` by accident).\r\n\r\nIt is the requirement of the dev to pass the correct index and the tests will check it (if they call the RPC at least once).",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:29:20Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285870318",
      "id" : 1285870318,
      "in_reply_to_id" : 1285806857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpNLu",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 388,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565335806,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285870318/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:29:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285870318",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285892111"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285892111"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thx, done",
      "commit_id" : "fac01960f20598099dd5edf1731b518833759056",
      "created_at" : "2023-08-07T13:47:12Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can\n+     * not represent the default value.\n+     */\n+    template <typename R>\n+    R Param(size_t i) const;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285892111",
      "id" : 1285892111,
      "in_reply_to_id" : 1285831220,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpSgP",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 392,
      "original_position" : 10,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565370659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285892111/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T13:47:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285892111",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285912365"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285912365"
         }
      },
      "author_association" : "MEMBER",
      "body" : "The only check it does is, that if the default value is used, the return type must be able to represent it. (The other checks were already done before.\r\n\r\nHowever, I think it is an implementation detail of `RPCHelpMan` when to check for internal bugs. Developers should just avoid writing bugs in the first place. And if they do, they'll get a helpful error message (in the tests) and they shouldn't care where it is from.\r\n\r\nThus, I've removed this from the docs completely.",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T14:03:02Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1285912365",
      "id" : 1285912365,
      "in_reply_to_id" : 1285806857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MpXct",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 388,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565402763,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285912365/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T14:03:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1285912365",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/MarcoFalke/events{/privacy}",
         "followers_url" : "https://api.github.com/users/MarcoFalke/followers",
         "following_url" : "https://api.github.com/users/MarcoFalke/following{/other_user}",
         "gists_url" : "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/MarcoFalke",
         "id" : 6399679,
         "login" : "MarcoFalke",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/MarcoFalke/orgs",
         "received_events_url" : "https://api.github.com/users/MarcoFalke/received_events",
         "repos_url" : "https://api.github.com/users/MarcoFalke/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/MarcoFalke/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/MarcoFalke"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286133078"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286133078"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thanks, you're right. I always assumed they were instantiated along with `CRPCTable`, but as you say they're freshly created on every `CRPCTable::execute()` call because of [this line](https://github.com/bitcoin/bitcoin/blob/624333455a5745a7f184d0df531dc348d0ac48dd/src/rpc/server.h#L109d). Can be marked as resolved.",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T16:33:01Z",
      "diff_hunk" : "@@ -399,6 +406,7 @@ class RPCHelpMan\n     const std::vector<RPCArg> m_args;\n     const RPCResults m_results;\n     const RPCExamples m_examples;\n+    mutable const JSONRPCRequest* m_req{nullptr}; // A pointer to the request for the duration of HandleRequest()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286133078",
      "id" : 1286133078,
      "in_reply_to_id" : 1285851447,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MqNVW",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 409,
      "original_position" : 18,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565750058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286133078/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T18:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286133078",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286137440"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286137440"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I like how you changed this in your latest force push, can be marked as resolved",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T16:37:01Z",
      "diff_hunk" : "@@ -631,9 +632,25 @@ UniValue RPCHelpMan::HandleRequest(const JSONRPCRequest& request) const\n                           PACKAGE_BUGREPORT)};\n         }\n     }\n+    m_req = nullptr;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286137440",
      "id" : 1286137440,
      "in_reply_to_id" : 1285838697,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585MqOZg",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 635,
      "original_position" : 12,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : null,
      "pull_request_review_id" : 1565750058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286137440/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T18:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286137440",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286146628"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286146628"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: While correct, I think this could benefit from a useability hint, e.g.:\r\n\r\n```\r\n     * This function only works during m_fun(), i.e. it should only be used in RPC method implementations.",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T16:45:41Z",
      "diff_hunk" : "@@ -383,6 +383,12 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request argument or its default value.\n+     * This function only works during m_fun().",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286146628",
      "id" : 1286146628,
      "line" : 388,
      "node_id" : "PRRC_kwDOABII585MqQpE",
      "original_commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "original_line" : 388,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : 6,
      "pull_request_review_id" : 1565750058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286146628/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T18:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286146628",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286256642"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286256642"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This implementation only supports being called on parameters with a `RPCArg::Default` fallback. Do you envision this being extended to also support `RPCArg::DefaultHint` and `RPCArg::Optional::OMITTED` fallbacks, and if so, how?\r\n\r\nI think one way is with a `std::optional<int> RPCHelpMan::Arg<std::optional<int>>(size_t i) const` specialization. I tinkered around with it a bit and this is what I came up with:\r\n\r\n<details>\r\n<summary>git diff on fa6b2da57ef7ff125a493c7835cb15935255ff8c</summary>\r\n\r\n```diff\r\ndiff --git a/src/rpc/server.cpp b/src/rpc/server.cpp\r\nindex daf751111f..fd1d6c6a63 100644\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -180,8 +180,8 @@ static RPCHelpMan stop()\r\n     // Event loop will exit after current HTTP requests have been handled, so\r\n     // this reply will get back to the client.\r\n     StartShutdown();\r\n-    if (jsonRequest.params[0].isNum()) {\r\n-        UninterruptibleSleep(std::chrono::milliseconds{jsonRequest.params[0].getInt<int>()});\r\n+    if (const auto wait{self.Arg<std::optional<int>>(0)}) {\r\n+        UninterruptibleSleep(std::chrono::milliseconds{*wait});\r\n     }\r\n     return RESULT;\r\n },\r\ndiff --git a/src/rpc/util.cpp b/src/rpc/util.cpp\r\nindex 4e0bace96f..c1e626eeaa 100644\r\n--- a/src/rpc/util.cpp\r\n+++ b/src/rpc/util.cpp\r\n@@ -636,19 +636,37 @@ UniValue RPCHelpMan::HandleRequest(const JSONRPCRequest& request) const\r\n     return ret;\r\n }\r\n \r\n-static const UniValue& ArgOrDefault(const std::vector<RPCArg>& params, const JSONRPCRequest* req, size_t i)\r\n+static const std::optional<UniValue> ArgOrDefault(const std::vector<RPCArg>& params, const JSONRPCRequest* req, size_t i)\r\n {\r\n     CHECK_NONFATAL(i < params.size());\r\n     const UniValue& arg{CHECK_NONFATAL(req)->params[i]};\r\n     const RPCArg::Fallback& fallback{params.at(i).m_fallback};\r\n-    CHECK_NONFATAL(std::holds_alternative<RPCArg::Default>(fallback));\r\n-    return arg.isNull() ? std::get<RPCArg::Default>(fallback) : arg;\r\n+    const bool has_default{std::holds_alternative<RPCArg::Default>(fallback)};\r\n+\r\n+    if (arg.isNull()) {\r\n+        if (has_default) {\r\n+            return std::get<RPCArg::Default>(fallback);\r\n+        } else { \r\n+            return std::nullopt;\r\n+        }\r\n+    }\r\n+    return arg;\r\n }\r\n \r\n template <>\r\n int RPCHelpMan::Arg<int>(size_t i) const\r\n {\r\n-    return ArgOrDefault(m_args, m_req, i).getInt<int>();\r\n+    return CHECK_NONFATAL(ArgOrDefault(m_args, m_req, i)).value().getInt<int>();\r\n+}\r\n+\r\n+template <>\r\n+std::optional<int> RPCHelpMan::Arg<std::optional<int>>(size_t i) const\r\n+{\r\n+    if (const auto result{ArgOrDefault(m_args, m_req, i)}) {\r\n+        return result.value().getInt<int>();\r\n+    } else {\r\n+        return std::nullopt;\r\n+    }\r\n }\r\n \r\n bool RPCHelpMan::IsValidNumArgs(size_t num_args) const\r\n\r\n```\r\n</details>\r\n\r\nI like the limited scope of this PR to implement just `int` types, but perhaps it would be useful to extend it a bit and implement the helper for non-default parameters too? At the very least we get a sense of what we want the interface to look like?\r\n\r\nIf we don't extend it, perhaps the documentation for `template <typename R> R Arg(size_t i) const;` in `rpc/util.h` needs to be updated to reflect where it can safely be used?",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T18:29:50Z",
      "diff_hunk" : "@@ -634,6 +636,21 @@ UniValue RPCHelpMan::HandleRequest(const JSONRPCRequest& request) const\n     return ret;\n }\n \n+static const UniValue& ArgOrDefault(const std::vector<RPCArg>& params, const JSONRPCRequest* req, size_t i)\n+{\n+    CHECK_NONFATAL(i < params.size());\n+    const UniValue& arg{CHECK_NONFATAL(req)->params[i]};\n+    const RPCArg::Fallback& fallback{params.at(i).m_fallback};\n+    CHECK_NONFATAL(std::holds_alternative<RPCArg::Default>(fallback));\n+    return arg.isNull() ? std::get<RPCArg::Default>(fallback) : arg;\n+}\n+\n+template <>\n+int RPCHelpMan::Arg<int>(size_t i) const",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286256642",
      "id" : 1286256642,
      "line" : 649,
      "node_id" : "PRRC_kwDOABII585MqrgC",
      "original_commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "original_line" : 649,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/util.cpp",
      "position" : 24,
      "pull_request_review_id" : 1565750058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286256642/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T18:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286256642",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286262199"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286262199"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Makes sense, thanks for the explanation. Resolved.",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T18:35:57Z",
      "diff_hunk" : "@@ -383,6 +383,13 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples, RPCMethodImpl fun);\n \n     UniValue HandleRequest(const JSONRPCRequest& request) const;\n+    /**\n+     * Helper to get a request param or the default value.\n+     * Throws if the fallback has no default value, or if the return type can",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286262199",
      "id" : 1286262199,
      "in_reply_to_id" : 1285806857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585Mqs23",
      "original_commit_id" : "fa8cb8bfd96be1b016162405ff17c8b756843617",
      "original_line" : 388,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : null,
      "pull_request_review_id" : 1565750058,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286262199/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T18:37:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286262199",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/69010457?v=4",
         "events_url" : "https://api.github.com/users/stickies-v/events{/privacy}",
         "followers_url" : "https://api.github.com/users/stickies-v/followers",
         "following_url" : "https://api.github.com/users/stickies-v/following{/other_user}",
         "gists_url" : "https://api.github.com/users/stickies-v/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/stickies-v",
         "id" : 69010457,
         "login" : "stickies-v",
         "node_id" : "MDQ6VXNlcjY5MDEwNDU3",
         "organizations_url" : "https://api.github.com/users/stickies-v/orgs",
         "received_events_url" : "https://api.github.com/users/stickies-v/received_events",
         "repos_url" : "https://api.github.com/users/stickies-v/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/stickies-v/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/stickies-v/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/stickies-v"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286352893"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286352893"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: Add Arg() default helper\" (fa6b2da57ef7ff125a493c7835cb15935255ff8c)\r\n\r\nAny reason to not just drop const from `HandleRequest` instead of making this variable mutable? Keeping the const there seems a little misleading",
      "commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "created_at" : "2023-08-07T20:24:33Z",
      "diff_hunk" : "@@ -399,6 +405,7 @@ class RPCHelpMan\n     const std::vector<RPCArg> m_args;\n     const RPCResults m_results;\n     const RPCExamples m_examples;\n+    mutable const JSONRPCRequest* m_req{nullptr}; // A pointer to the request for the duration of m_fun()",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28230#discussion_r1286352893",
      "id" : 1286352893,
      "line" : 408,
      "node_id" : "PRRC_kwDOABII585MrC_9",
      "original_commit_id" : "fa6b2da57ef7ff125a493c7835cb15935255ff8c",
      "original_line" : 408,
      "original_position" : 17,
      "original_start_line" : null,
      "path" : "src/rpc/util.h",
      "position" : 17,
      "pull_request_review_id" : 1566099524,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28230",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286352893/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-07T20:24:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1286352893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   }
]
