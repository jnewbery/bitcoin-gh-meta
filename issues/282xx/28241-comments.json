[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28241).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29491](https://github.com/bitcoin/bitcoin/pull/29491) ([DO NOT MERGE] Schnorr batch verification for blocks by fjahr)\n* [#29483](https://github.com/bitcoin/bitcoin/pull/29483) (test, ci: add --v1transport option, add --v2transport  to a CI task by mzumsande)\n* [#29432](https://github.com/bitcoin/bitcoin/pull/29432) (Stratum v2 Template Provider (take 3) by Sjors)\n* [#28955](https://github.com/bitcoin/bitcoin/pull/28955) (index: block filters sync, reduce disk read operations by caching last header by furszy)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n* [#28122](https://github.com/bitcoin/bitcoin/pull/28122) (Silent Payments: Implement BIP352 by josibake)\n* [#27351](https://github.com/bitcoin/bitcoin/pull/27351) (wallet: add `seeds` argument to `importdescriptors` by apoelstra)\n* [#27260](https://github.com/bitcoin/bitcoin/pull/27260) (Enhanced error messages for invalid network prefix during address parsing. by russeree)\n* [#24539](https://github.com/bitcoin/bitcoin/pull/24539) (Add a \"tx output spender\" index by sstone)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2023-08-09T09:13:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670962513",
      "id" : 1670962513,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmN1R",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670962513/reactions"
      },
      "updated_at" : "2024-03-01T11:43:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670962513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'd like to keep this based on #28122 but that requires some refactoring there. See https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1670943979.",
      "created_at" : "2023-08-09T09:15:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670965334",
      "id" : 1670965334,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmOhW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670965334/reactions"
      },
      "updated_at" : "2023-08-09T09:15:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670965334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> I'd like to keep this based on #28122 but that requires some refactoring there. See [#28122 (comment)](https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1670943979).\r\n\r\nyou can also rebase on https://github.com/bitcoin/bitcoin/pull/27827 , which has everything, or just the receiving PR. Might be easier then to reason about which functions belong in which PRs if we can see it all together. I think the functions you need are introduced in the receiving PR (#28202)",
      "created_at" : "2023-08-09T09:39:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1670999533",
      "id" : 1670999533,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jmW3t",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670999533/reactions"
      },
      "updated_at" : "2023-08-09T09:39:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1670999533",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I'll take a stab at rebasing on the bigger thing. It makes sense to do that and then unrebase / debase(?) it later.",
      "created_at" : "2023-08-09T11:40:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1671166932",
      "id" : 1671166932,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jm_vU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671166932/reactions"
      },
      "updated_at" : "2023-08-09T11:40:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671166932",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I ended up \"borrowing\" some code from the followup PRs, without having to rebase on them.\r\n\r\nThis code compiles and the index doesn't crash. That's about the extend of it though :-) For now.",
      "created_at" : "2023-08-09T14:57:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1671573912",
      "id" : 1671573912,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585jojGY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671573912/reactions"
      },
      "updated_at" : "2023-08-09T14:57:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1671573912",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Hi, I have a little question about the motivation for making this index in Core. Afaiu, an implementation of electrum server (or any light client backend) could construct this index as easily, and I think it would be better separation of concerns to let them take responsibility for this instead of Core. Or maybe it's necessary for the consistency check you're mentioning? I'm not sure of what it is.",
      "created_at" : "2023-09-04T12:23:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1705177519",
      "id" : 1705177519,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585lovGv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705177519/reactions"
      },
      "updated_at" : "2023-09-04T12:23:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705177519",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/11726747?v=4",
         "events_url" : "https://api.github.com/users/Sosthene00/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sosthene00/followers",
         "following_url" : "https://api.github.com/users/Sosthene00/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sosthene00/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sosthene00",
         "id" : 11726747,
         "login" : "Sosthene00",
         "node_id" : "MDQ6VXNlcjExNzI2NzQ3",
         "organizations_url" : "https://api.github.com/users/Sosthene00/orgs",
         "received_events_url" : "https://api.github.com/users/Sosthene00/received_events",
         "repos_url" : "https://api.github.com/users/Sosthene00/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sosthene00/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sosthene00/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sosthene00"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sosthene00 I find it useful to have this index for developing and reviewing the silent payment implementation. But as you say, it may not be worth merging eventually. I'm not sure about that yet.\r\n\r\nThere's also the possibility of building something like this on top of the Kernel, when that project is a bit further along.",
      "created_at" : "2023-09-04T14:39:54Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1705381372",
      "id" : 1705381372,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585lpg38",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705381372/reactions"
      },
      "updated_at" : "2023-09-04T14:40:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1705381372",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-07T16:04:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1710417733",
      "id" : 1710417733,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585l8udF",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710417733/reactions"
      },
      "updated_at" : "2023-09-07T16:04:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710417733",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased to use `GetSilentPaymentsTweakDataFromTxInputs`. Otherwise still WIP.",
      "created_at" : "2023-09-19T14:49:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1725798395",
      "id" : 1725798395,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m3Zf7",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1725798395/reactions"
      },
      "updated_at" : "2023-09-19T14:49:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1725798395",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Pushed a simple RPC method to get the tweaked public key for a given transaction. I'd like to sanity check it against some other implementation.\r\n\r\nSignet: [dacb55db5c506a34771bf8ac3664e2510c17e80ada81347300fb4223f2d6c545](https://mempool.space/signet/tx/dacb55db5c506a34771bf8ac3664e2510c17e80ada81347300fb4223f2d6c545)\r\n\r\n`getsilentpaymenttxdata` result: `03fc95cfeac43e9179c002d32a042626e5a2b289a8d7a4a0c88fbf81d570cef987`\r\n\r\n\r\n",
      "created_at" : "2023-09-19T16:20:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1726028248",
      "id" : 1726028248,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m4RnY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726028248/reactions"
      },
      "updated_at" : "2023-09-19T16:20:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726028248",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2023-09-19T18:10:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1726248570",
      "id" : 1726248570,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m5HZ6",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726248570/reactions"
      },
      "updated_at" : "2023-09-19T18:10:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1726248570",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331775156"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think this logic doesn't match the BIP, as it currently implements \"all outputs have to be taproot outputs\" rather than \"at least _one_ output has to be a taproot output\"? Could use `std::none_of` to achieve the latter (https://en.cppreference.com/w/cpp/algorithm/all_any_none_of).\r\n\r\nSomething like\r\n```\r\n    if (std::none_of(tx.vout.begin(), tx.vout.end(), [](const TxOut& txout) {\r\n            std::vector<std::vector<unsigned char>> solutions;\r\n            return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\r\n        }) {\r\n        return false;\r\n    }\r\n```\r\n(untested)",
      "commit_id" : "8b63994eccf981e0d2cd907ed41b1633842d0a3f",
      "created_at" : "2023-09-20T15:03:39Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331775156",
      "id" : 1331775156,
      "line" : 64,
      "node_id" : "PRRC_kwDOABII585PYUa0",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 64,
      "pull_request_review_id" : 1635872510,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 57,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T15:03:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331775156",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331881346"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@josibake it sounds like this should be another helper function. The index shouldn't be too far in the weeds of the BIP rules.\r\n\r\nHowever, I'll look into fixing this.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:09:49Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331881346",
      "id" : 1331881346,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYuWC",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636035765,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:09:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331881346",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@fjahr since you've been working on indexes, do you have any feedback on indexer best practices I should follow? ",
      "created_at" : "2023-09-20T16:13:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1728050950",
      "id" : 1728050950,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585m__cG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728050950/reactions"
      },
      "updated_at" : "2023-09-20T16:13:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1728050950",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331900870"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Should be fixed now.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:26:14Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331900870",
      "id" : 1331900870,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PYzHG",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636065708,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:26:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331900870",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331905745"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745"
         }
      },
      "author_association" : "MEMBER",
      "body" : "It might be nice if the indexer base class can skip ahead to a minimum height, as it takes a bunch of time to go through all the blocks.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T16:30:17Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        for (auto& vout : tx->vout) {\n+            if (std::none_of(tx->vout.begin(), tx->vout.end(), [vout](const CTxOut& txout) {\n+                std::vector<std::vector<unsigned char>> solutions;\n+                return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\n+            })) {\n+                continue;\n+            }\n+        }\n+\n+        // -1 as blockundo does not have coinbase tx\n+        CTxUndo undoTX{block_undo.vtxundo.at(i - 1)};\n+        std::map<COutPoint, Coin> coins;\n+\n+        for (uint32_t j = 0; j < tx->vin.size(); j++) {\n+            coins[tx->vin.at(j).prevout] = undoTX.vprevout.at(j);\n+        }\n+\n+        const auto tweak_data = wallet::GetSilentPaymentsTweakDataFromTxInputs(tx->vin, coins);\n+\n+        if (!tweak_data) continue;\n+\n+        const uint256 outpoint_hash = tweak_data->first;\n+        CPubKey tweaked_pub_key_sum = tweak_data->second;\n+        if (!tweaked_pub_key_sum.TweakAdd(outpoint_hash.begin())) {\n+            // TODO: Is this bad??\n+            continue;\n+        }\n+        assert(tweaked_pub_key_sum.IsFullyValid());\n+        tweaked_pub_key_sums.emplace_back(tweaked_pub_key_sum);\n+    }\n+\n+    // TODO: so this can never fail?\n+    return true;\n+\n+\n+}\n+\n+bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n+{\n+    // Exclude genesis block transaction because outputs are not spendable.\n+    if (block.height == 0) return true;\n+\n+    assert(block.data);\n+\n+    Consensus::Params consensus = Params().GetConsensus();\n+\n+    if (block.height < consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331905745",
      "id" : 1331905745,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585PY0TR",
      "original_commit_id" : "91fd02f4474c1cfae2aaa5064866e9766dbd7379",
      "original_line" : 103,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 103,
      "pull_request_review_id" : 1636074083,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-20T16:30:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331905745",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331983796"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Oops, pushing new fix.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-20T17:42:45Z",
      "diff_hunk" : "@@ -0,0 +1,135 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::vector<std::pair<uint256, CPubKey>>& items)\n+{\n+    CDBBatch batch(*this);\n+    for (const auto& tuple : items) {\n+        batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tuple.first), tuple.second);\n+    }\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+// TODO: it's more efficient to do this per block\n+bool SilentPaymentIndex::GetSilentPaymentKey(const CTransactionRef& tx, const CBlockIndex& blockindex, CPubKey& tweakedPubKeySum)\n+{\n+    if (tx->IsCoinBase()) {\n+        return false;\n+    }\n+\n+    for (auto& vout : tx->vout) {\n+        std::vector<std::vector<unsigned char>> solutions;\n+        TxoutType whichType = Solver(vout.scriptPubKey, solutions);\n+\n+        if (whichType != TxoutType::WITNESS_V1_TAPROOT) {\n+            return false;\n+        }\n+    }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1331983796",
      "id" : 1331983796,
      "in_reply_to_id" : 1331775156,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585PZHW0",
      "original_commit_id" : "0235ff2891ec9573d2bdc67d0a08ba47040fd173",
      "original_line" : 64,
      "original_position" : 64,
      "original_start_line" : 57,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1636196767,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-20T17:42:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1331983796",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The index (as generated by 46b32b63d57a62466a2b2181e28bab477dc8de95) is 54GB on mainnet and took about 2 hours to generate (of which much time was wasted looping through pre-taproot blocks). Something like #26966 could make it even faster.\r\n\r\nI'd like to compare the results in this mainnet index to another implementation, if someone can point me to one.",
      "created_at" : "2023-09-21T09:42:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1729224452",
      "id" : 1729224452,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nEd8E",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729224452/reactions"
      },
      "updated_at" : "2023-09-21T09:43:49Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1729224452",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@setavenger you mentioned using a light client in the tracking issue. Does that have an index or some other way to compare to this PR?",
      "created_at" : "2023-09-28T08:34:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1738712806",
      "id" : 1738712806,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585noqbm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738712806/reactions"
      },
      "updated_at" : "2023-09-28T08:34:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738712806",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @setavenger you mentioned using a light client in the tracking issue. Does that have an index or some other way to compare to this PR?\r\n\r\nHmm I don't think it matches exactly what you are doing here. My backend was built as a \"light client\" itself and with the assumption that it would only index forward looking from a certain activation point. It does create an index but it's not running a full node which means there's a lot of networking happening to services that offer prevout information per transacton. I would be surprised if it would take less than two hours to index the entire chain. Plus I would probably get rate limited before even being able to index the entire chain.\r\n\r\nThat being said I was thinking of upgrading my backend to using a fullnode I could give an update then.",
      "created_at" : "2023-09-28T11:15:02Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1738949322",
      "id" : 1738949322,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585npkLK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738949322/reactions"
      },
      "updated_at" : "2023-09-28T11:15:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1738949322",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I see. Even a few spot checks against what this index produces would be useful though.",
      "created_at" : "2023-09-28T13:33:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1739195463",
      "id" : 1739195463,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nqgRH",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739195463/reactions"
      },
      "updated_at" : "2023-09-28T13:33:28Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739195463",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Yeah, we could do that perhaps for selected blocks. I just have to get the handling of P2PKH inputs in order, then I should be able to index any block from the chain.",
      "created_at" : "2023-09-28T15:15:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1739502295",
      "id" : 1739502295,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nrrLX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739502295/reactions"
      },
      "updated_at" : "2023-09-28T15:15:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1739502295",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340496572"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "`silentpaymentindex`?",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-28T17:54:18Z",
      "diff_hunk" : "@@ -905,6 +917,8 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n     if (args.GetIntArg(\"-prune\", 0)) {\n         if (args.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n+        if (args.GetBoolArg(\"-silentpaymentindex\", DEFAULT_SILENT_PAYMENT_INDEX))\n+            return InitError(_(\"Prune mode is incompatible with -txospenderindex.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340496572",
      "id" : 1340496572,
      "line" : 921,
      "node_id" : "PRRC_kwDOABII585P5lq8",
      "original_commit_id" : "432b7a235a2972b5c0064ab9eca44606760aa9b8",
      "original_line" : 921,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 45,
      "pull_request_review_id" : 1649426783,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T19:54:16Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340496572",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340671534"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yeah, we don't have the possibility to skip blocks yet, so I think we would need to add it as a feature on base index, I have started drafting it here, though it's not functional yet: https://github.com/fjahr/bitcoin/commit/cd7bf1249765a011210653c393b3a0fdb7106d55\r\n\r\nBut I also guess 2h doesn't sound extremely bad, we might want more than one silentpaymentindex to motivate something like this.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-28T21:09:42Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        for (auto& vout : tx->vout) {\n+            if (std::none_of(tx->vout.begin(), tx->vout.end(), [vout](const CTxOut& txout) {\n+                std::vector<std::vector<unsigned char>> solutions;\n+                return Solver(vout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\n+            })) {\n+                continue;\n+            }\n+        }\n+\n+        // -1 as blockundo does not have coinbase tx\n+        CTxUndo undoTX{block_undo.vtxundo.at(i - 1)};\n+        std::map<COutPoint, Coin> coins;\n+\n+        for (uint32_t j = 0; j < tx->vin.size(); j++) {\n+            coins[tx->vin.at(j).prevout] = undoTX.vprevout.at(j);\n+        }\n+\n+        const auto tweak_data = wallet::GetSilentPaymentsTweakDataFromTxInputs(tx->vin, coins);\n+\n+        if (!tweak_data) continue;\n+\n+        const uint256 outpoint_hash = tweak_data->first;\n+        CPubKey tweaked_pub_key_sum = tweak_data->second;\n+        if (!tweaked_pub_key_sum.TweakAdd(outpoint_hash.begin())) {\n+            // TODO: Is this bad??\n+            continue;\n+        }\n+        assert(tweaked_pub_key_sum.IsFullyValid());\n+        tweaked_pub_key_sums.emplace_back(tweaked_pub_key_sum);\n+    }\n+\n+    // TODO: so this can never fail?\n+    return true;\n+\n+\n+}\n+\n+bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n+{\n+    // Exclude genesis block transaction because outputs are not spendable.\n+    if (block.height == 0) return true;\n+\n+    assert(block.data);\n+\n+    Consensus::Params consensus = Params().GetConsensus();\n+\n+    if (block.height < consensus.vDeployments[Consensus::DEPLOYMENT_TAPROOT].min_activation_height) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1340671534",
      "id" : 1340671534,
      "in_reply_to_id" : 1331905745,
      "line" : 103,
      "node_id" : "PRRC_kwDOABII585P6QYu",
      "original_commit_id" : "91fd02f4474c1cfae2aaa5064866e9766dbd7379",
      "original_line" : 103,
      "original_position" : 105,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 103,
      "pull_request_review_id" : 1649715687,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-28T21:09:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1340671534",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1341036797"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I should probably get rid of this error, since the entry for each block is independent, pruning shouldn't be a problem.",
      "commit_id" : "83e1755276f58be540253805e2889f77920da589",
      "created_at" : "2023-09-29T07:54:56Z",
      "diff_hunk" : "@@ -905,6 +917,8 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n     if (args.GetIntArg(\"-prune\", 0)) {\n         if (args.GetBoolArg(\"-txindex\", DEFAULT_TXINDEX))\n             return InitError(_(\"Prune mode is incompatible with -txindex.\"));\n+        if (args.GetBoolArg(\"-silentpaymentindex\", DEFAULT_SILENT_PAYMENT_INDEX))\n+            return InitError(_(\"Prune mode is incompatible with -txospenderindex.\"));",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1341036797",
      "id" : 1341036797,
      "in_reply_to_id" : 1340496572,
      "line" : 921,
      "node_id" : "PRRC_kwDOABII585P7pj9",
      "original_commit_id" : "432b7a235a2972b5c0064ab9eca44606760aa9b8",
      "original_line" : 921,
      "original_position" : 45,
      "original_start_line" : null,
      "path" : "src/init.cpp",
      "position" : 45,
      "pull_request_review_id" : 1650257409,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-29T07:54:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1341036797",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Silent Payments is built with versioning in mind. They're not types like with BIP157 filters, but rather ways to support transactions that have inputs with new script patterns.\r\n\r\nUnless there's no more soft forks, it's quite likely to actually need these new versions. E.g. any new taproot version will need a new silent payment version in order to be able to spend from it.\r\n\r\nThat said, I have not thought at all on how to handle such versioning. Although the `-silentpaymentindex` takes a version number, the index itself doesn't have versioning. I'll have to study the BIP more closely to figure out how versioning works.\r\n\r\nThe most simple solution is to just redesign and rebuild the index by the time that's needed. But if basic versioning can be supported with little code complexity and storage overhead, I would prefer that.\r\n\r\nAdded a note to the PR description to address this. \r\n\r\n> I currently have to set -silentpaymentindex=0 explicitly if I don't want to activate it in this branch\r\n\r\nWill look into that along with the above. The index should be off by default. I probably want the user to set the maximum supported silent paymnets version. That way they won't automatically upgrade later (which might involve increased storage requirements). But since the first version is `0` that's an ambiguous argument. Adding a `v` prefix would be an easy solution:\r\n\r\n* `-silentpaymentindex=0`: index is off (default)\r\n* `-silentpaymentindex=v0`: index version 0\r\n\r\nIn the future, either:\r\n* `-silentpaymentindex=v1`: index version 0 and 1; or\r\n* `-silentpaymentindex=v1`: index _only_ version 1 (makes no sense if the v1 index is a superset of v0, so I have to read up on this)\r\n\r\n> it will need reorg robustness\r\n\r\nThe index is stored and queried by block hash. Each entry is independent (nothing cumulative). So I think it's fine to keep reorged blocks around. But there should be a test to make sure the new block is added.",
      "created_at" : "2023-09-29T08:03:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1740477714",
      "id" : 1740477714,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nvZUS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740477714/reactions"
      },
      "updated_at" : "2023-09-29T08:03:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740477714",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I posted a short wish list of helper functions on the base PR, to make the index a bit less aware of low level protocol details: https://github.com/bitcoin/bitcoin/pull/28122#issuecomment-1738728491",
      "created_at" : "2023-09-29T08:07:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1740482543",
      "id" : 1740482543,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nvafv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740482543/reactions"
      },
      "updated_at" : "2023-09-29T08:07:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1740482543",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "I am still confused why we need to let users decide which version of the index they want to run. What is the motivation to let users run an older version of the index explicitly even though they have a newer version available in their node and the newer version isn't missing anything? I don't see a good reason for it aside from maybe storage space. So then I think the index should be either on or off and it will be updated with every softfork to accommodate for the new types once the softfork activates. That way there is also no reindex needed if users upgrade their nodes in time. We could do explicit versioning in this scenario if it helps to simplify things I am not sure it's even needed.\r\n\r\nAnd if the storage argument is really something that matters, then I don't see why we wouldn't treat it just like blockfilterstypes. It seems much simpler to have separate indexes for each of these new softforks/silentpayment versions rather than deal with all the compatibility stuff inside a single index. That would also make sense in light of the storage argument: If I am just starting to use silent payments with segwit v5 then I don't care about the silent payments that were maybe done before on older segwit versions and I could save a lot of space if I can just run `-siltentpaymentindex=5` or so.\r\n\r\nEDIT: Is it an issue with the second suggests path that senders can theoretically send to any version after taproot and the receiver can not control it? In that case I guess the first path makes even more sense because then there is really no reason for receivers to run with an older version of the index.",
      "created_at" : "2023-09-29T15:16:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1741055405",
      "id" : 1741055405,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nxmWt",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741055405/reactions"
      },
      "updated_at" : "2023-09-29T15:31:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741055405",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> What is the motivation to let users run an older version of the index explicitly even though they have a newer version available in their node and the newer version isn't missing anything? I don't see a good reason for it aside from maybe storage space.\r\n\r\nStorage space would be the reason. Though in general I expect new soft forks to have low transaction counts and therefore not much extra storage. So maybe that's not a big deal.\r\n\r\nThe other question is how to serve older clients. That might involve keeping one version entry per block and then joining them as needed. But that doesn't require versioning at the `-silentpaymentindex` level.",
      "created_at" : "2023-09-29T16:36:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1741188015",
      "id" : 1741188015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585nyGuv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741188015/reactions"
      },
      "updated_at" : "2023-09-29T16:36:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1741188015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased and added a simple functional test, which includes a (hopefully) deterministic tweak. ",
      "created_at" : "2023-12-11T11:48:15Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1849912410",
      "id" : 1849912410,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585uQ2xa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1849912410/reactions"
      },
      "updated_at" : "2023-12-11T11:48:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1849912410",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-01-26T13:13:22Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1912049718",
      "id" : 1912049718,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585x95A2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912049718/reactions"
      },
      "updated_at" : "2024-01-26T13:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912049718",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@Sjors I've made some on #28122 to reflect the changes in the BIP + a few naming cleanups on the functions. Should be good to go for a rebase here, if you're still working on this.",
      "created_at" : "2024-01-26T15:04:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1912215341",
      "id" : 1912215341,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585x-hct",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912215341/reactions"
      },
      "updated_at" : "2024-01-26T15:04:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1912215341",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Will do soon(tm)",
      "created_at" : "2024-01-29T09:39:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1914312450",
      "id" : 1914312450,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yGhcC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 1,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914312450/reactions"
      },
      "updated_at" : "2024-01-29T09:39:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1914312450",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I was tinkering around with this and had a few thoughts:\r\n\r\n* Being able to specify a `start_height` sounds like something that would be generally useful for all indexes, not just this one. I've been toying with the idea of what it would take to have a \"pruned\" txindex and I would need to be able to start from a specific height for that. @fjahr I took the branch you started and got it working with a little tinkering here: https://github.com/josibake/bitcoin/tree/add-start-height-to-base-index . With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n* I wanted to see how difficult it would be to make this as a new `BlockFilterType`, and it was way easier than I thought it would be. The blockfilterindex code is really well designed! I copied the SP logic from this PR and got a hacked together working branch here: https://github.com/josibake/bitcoin/tree/implement-bip352-blockfilterindex (this syncs on my laptop in < 1 hr on mainnet and ends up being around 1.5gb on disk)\r\n\r\nWith the `blockfilterindex`, all we would need to do is propose a new filter type BIP and everything Just Works (TM) for light clients that support BIP157. I don't see any easy way to \"prune\" this index to only have data for the UTXO set.. but I also don't see a way to easily do that with a general index like we have in this PR either. I'm also less convinced this matters (for right now), and more worried we might be prematurely optimizing at this stage.\r\n\r\n@Sjors brought up some good points about versioning, but I can see that working with a block filter index in that we would just propose a new filter type for new version types (fine, so long as we don't frequently update silent payments versions), or if we do find ourselves needing to frequently update the version we just build versioning into the encoded filter e.g. return data for all versions and let the clients figure it out, or split up the encoded filter into sections with version bytes? \r\n\r\nCurious what you guys think on how to proceed, @Sjors @fjahr. In my mind, it makes more sense to go with a custom index if we have a clean way to support pruning to the UTXO set, and we'd also need to think about how to make this index available to light clients. If instead we go the blockfilterindex route, we get all the infrastructure for supporting light clients for free (and fast wallet rescans), but probably more difficult to build in custom logic like SP versions and UTXO pruning, since the blockfilterindexes are somewhat rigid in how they are built.",
      "created_at" : "2024-01-31T19:24:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1919780358",
      "id" : 1919780358,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585ybYYG",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919780358/reactions"
      },
      "updated_at" : "2024-01-31T19:24:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1919780358",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n\r\nIf you're feeling momentum, best just open a new PR. I'll then close this one. I can always take back the baton and reopen. ",
      "created_at" : "2024-02-01T13:26:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921321547",
      "id" : 1921321547,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhQpL",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921321547/reactions"
      },
      "updated_at" : "2024-02-01T13:26:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921321547",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> > With a little more work this could probably be it's own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n> \r\n> If you're feeling momentum, best just open a new PR. I'll then close this one. I can always take back the baton and reopen.\r\n\r\nI was referring to opening a PR just for adding `start_height` to the indexes (the work that @fjahr had started), but I'm also happy to open a blockfilterindex PR! Although, curious if you had any thoughts regarding the rest of my comment re: pruning to the UTXO set and versioning?\r\n",
      "created_at" : "2024-02-01T13:50:21Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921373748",
      "id" : 1921373748,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhdY0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921373748/reactions"
      },
      "updated_at" : "2024-02-01T13:50:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921373748",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@josibake I'll get back to you on those later.",
      "created_at" : "2024-02-01T14:20:37Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1921448658",
      "id" : 1921448658,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585yhvrS",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921448658/reactions"
      },
      "updated_at" : "2024-02-01T14:20:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1921448658",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased.\r\n\r\nI agree adding `start_height` could be useful. I grabbed the commits and set start height to the taproot activation height. Will leave it up to someone else to make it a PR.\r\n\r\nLooks like I'm using it incorrectly though:\r\n\r\n```\r\n2024-02-12T12:17:04Z silentpaymentindex thread start\r\n2024-02-12T12:17:04Z Syncing silentpaymentindex with block chain from height 0\r\n2024-02-12T12:17:04Z ERROR: Commit: Failed to commit latest silentpaymentindex state\r\n2024-02-12T12:17:04Z ERROR: UndoReadFromDisk: no undo data available\r\n2024-02-12T12:17:04Z *** ThreadSync: Failed to write block 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f to index database\r\n2024-02-12T12:17:04Z Error: A fatal internal error occurred, see debug.log for details\r\nError: A fatal internal error occurred, see debug.log for details\r\n```\r\n\r\nThe compiler is also warning about the block filter index:\r\n\r\n```\r\nIn file included from init.cpp:30:\r\n./index/blockfilterindex.h:32:15: warning: non-static data member 'm_start_height' of 'BlockFilterIndex' shadows member inherited from type 'BaseIndex' [-Wshadow-field]\r\n    const int m_start_height;\r\n              ^\r\n./index/base.h:110:15: note: declared here\r\n    const int m_start_height{0};\r\n              ^\r\n1 warning generated.\r\n```\r\n\r\n> If instead we go the blockfilterindex route, we get all the infrastructure for supporting light clients for free (and fast wallet rescans), but probably more difficult to build in custom logic like SP versions and UTXO pruning, since the blockfilterindexes are somewhat rigid in how they are built.\r\n\r\nNot sure about this either.\r\n",
      "created_at" : "2024-02-12T12:19:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1938574388",
      "id" : 1938574388,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585zjEw0",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938574388/reactions"
      },
      "updated_at" : "2024-02-12T12:19:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938574388",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Interesting, your first error seems related to `UndoData`, which start height shouldn't affect?\r\n\r\n> The compiler is also warning about the block filter index:\r\n\r\nAh, this is a shadowing error, I can fix that. I think I'll go ahead and open a `start_height` index PR since this seems generally useful and I'll fix the error there. @fjahr adding you as co-author unless you have any objections?",
      "created_at" : "2024-02-12T12:24:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1938581651",
      "id" : 1938581651,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585zjGiT",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938581651/reactions"
      },
      "updated_at" : "2024-02-12T12:24:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938581651",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "It's indeed a strange error. I nuked the existing silent payment index before running, so not sure what's going on here.\r\n\r\n(I'll take another look once you open the `start_height` PR)",
      "created_at" : "2024-02-12T12:35:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1938598929",
      "id" : 1938598929,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII585zjKwR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938598929/reactions"
      },
      "updated_at" : "2024-02-12T13:55:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1938598929",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Being able to specify a start_height sounds like something that would be generally useful for all indexes, not just this one. I've been toying with the idea of what it would take to have a \"pruned\" txindex and I would need to be able to start from a specific height for that. @fjahr I took the branch you started and got it working with a little tinkering here: https://github.com/josibake/bitcoin/tree/add-start-height-to-base-index . With a little more work this could probably be its own PR. Feel free to grab this branch, or I can open a PR if you're busy with other stuff!\r\n\r\nHm, I don't think it's clear that it's generally useful. Not starting from the genesis block doesn't work for `coinstatsindex` because it's accumulating values from genesis on. I also don't think it works for the current `blockfilterindex` because the headers build a hashchain similar to block headers. `txindex` would work in theory but I think we would need to check everywhere where it's used to ensure error handling is consistent for this use case, because that would then mean just because a tx isn't in the index doesn't mean it doesn't exist which is probably implied right now.\r\n\r\nEach of these could be fixed if we had a way to get the starting point but I think it would be pretty intrusive also for `coinstatsindex` and `blockfilterindex` to handle not having values for certain blocks due to a specific start height.\r\n\r\nIn terms of usefulness for a next blockfilter type, I don't think it's a strong argument right now because nobody is proposing a new blockfilter type and if somebody proposes it, it's also possible that it might be interesting to have it from genesis. And then there are also conceptual questions: If we have a new filter type for a new type of script that is introduced in the future it makes sense to not have a filter but maybe we still want to have a header chain with empty filters up to the block where it starts to get interesting (for security reasons)?\r\n\r\nI would rather keep this scoped to silent payment index for now because there is a clear use case and I don't see any pitfalls like with the other indices. It can be a separate PR but I would suggest calling it a precursor to this PR.",
      "created_at" : "2024-02-17T20:58:49Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1950323631",
      "id" : 1950323631,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5850P5Ov",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950323631/reactions"
      },
      "updated_at" : "2024-02-18T00:38:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950323631",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493405713"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493405713"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why hardcode this value here when we can get it from chain params?",
      "commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "created_at" : "2024-02-17T21:11:37Z",
      "diff_hunk" : "@@ -16,6 +16,7 @@\n #include <hash.h>\n \n constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+const int TAPROOT_MAINNET_ACTIVATION_HEIGHT{709632};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493405713",
      "id" : 1493405713,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII585ZA5AR",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 19,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 13,
      "pull_request_review_id" : 1887029235,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493405713/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-17T21:11:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493405713",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493429857"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493429857"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Removing this is causing an error on all non-mainnet chains now because m_start_height is 0 by default, which is the genesis block and it needs to be skipped because it's unspendable and has no undo data.",
      "commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "created_at" : "2024-02-17T21:58:58Z",
      "diff_hunk" : "@@ -93,17 +95,11 @@ bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs,\n \n bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n-    // Exclude genesis block transaction because outputs are not spendable.\n-    if (block.height == 0) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493429857",
      "id" : 1493429857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZA-5h",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 97,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 42,
      "pull_request_review_id" : 1887035555,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493429857/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-17T21:58:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493429857",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493494203"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493494203"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "This isn't the right place to pass the `start_height`, this is actually setting the obfuscate option of the DB that is constructed here.",
      "commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "created_at" : "2024-02-18T00:23:53Z",
      "diff_hunk" : "@@ -28,8 +29,9 @@ class SilentPaymentIndex::DB : public BaseIndex::DB\n     bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n };\n \n+// TODO: check if we're on mainnet, otherwise start_height=0\n SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n-    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe, /*start_height=*/TAPROOT_MAINNET_ACTIVATION_HEIGHT)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493494203",
      "id" : 1493494203,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585ZBOm7",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 24,
      "pull_request_review_id" : 1887051050,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493494203/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-18T00:23:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493494203",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493495599"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493495599"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The `start height` goes into the `BaseIndex` constructor on line 45 below:\r\n\r\n```\r\nSilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\r\n    : BaseIndex(std::move(chain), \"silentpaymentindex\", /*start_height=*/TAPROOT_MAINNET_ACTIVATION_HEIGHT), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\r\n{}\r\n```",
      "commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "created_at" : "2024-02-18T00:27:35Z",
      "diff_hunk" : "@@ -28,8 +29,9 @@ class SilentPaymentIndex::DB : public BaseIndex::DB\n     bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n };\n \n+// TODO: check if we're on mainnet, otherwise start_height=0\n SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n-    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe, /*start_height=*/TAPROOT_MAINNET_ACTIVATION_HEIGHT)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1493495599",
      "id" : 1493495599,
      "in_reply_to_id" : 1493494203,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585ZBO8v",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 24,
      "pull_request_review_id" : 1887051295,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493495599/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-18T00:35:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1493495599",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "For me, the `silentpaymentindex` now synced fine from the Taproot start height when I applied the suggestion fixes and removed the `blockfilterindex` commit.",
      "created_at" : "2024-02-18T00:31:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1950636630",
      "id" : 1950636630,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5850RFpW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950636630/reactions"
      },
      "updated_at" : "2024-02-18T00:36:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1950636630",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494191408"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494191408"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Because I want to drop that in #26201. Though perhaps Silent Payments itself is a reason to keep it. But we could still demote it to a regular constant rather than consensus.",
      "commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "created_at" : "2024-02-19T08:45:49Z",
      "diff_hunk" : "@@ -16,6 +16,7 @@\n #include <hash.h>\n \n constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+const int TAPROOT_MAINNET_ACTIVATION_HEIGHT{709632};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494191408",
      "id" : 1494191408,
      "in_reply_to_id" : 1493405713,
      "line" : 19,
      "node_id" : "PRRC_kwDOABII585ZD40w",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 19,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 13,
      "pull_request_review_id" : 1887852035,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494191408/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T08:46:20Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494191408",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494213677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494213677"
         }
      },
      "author_association" : "MEMBER",
      "body" : "(though I think the specific reason here was because I was in a hurry)",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-02-19T09:02:11Z",
      "diff_hunk" : "@@ -16,6 +16,7 @@\n #include <hash.h>\n \n constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+const int TAPROOT_MAINNET_ACTIVATION_HEIGHT{709632};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494213677",
      "id" : 1494213677,
      "in_reply_to_id" : 1493405713,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585ZD-Qt",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 24,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 24,
      "pull_request_review_id" : 1887887077,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494213677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T09:02:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494213677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494217939"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494217939"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Brought it back.",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-02-19T09:05:34Z",
      "diff_hunk" : "@@ -93,17 +95,11 @@ bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs,\n \n bool SilentPaymentIndex::CustomAppend(const interfaces::BlockInfo& block)\n {\n-    // Exclude genesis block transaction because outputs are not spendable.\n-    if (block.height == 0) return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494217939",
      "id" : 1494217939,
      "in_reply_to_id" : 1493429857,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZD_TT",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 97,
      "original_position" : 42,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1887893992,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494217939/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T09:05:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494217939",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494226737"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494226737"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-02-19T09:12:20Z",
      "diff_hunk" : "@@ -28,8 +29,9 @@ class SilentPaymentIndex::DB : public BaseIndex::DB\n     bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n };\n \n+// TODO: check if we're on mainnet, otherwise start_height=0\n SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n-    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe, /*start_height=*/TAPROOT_MAINNET_ACTIVATION_HEIGHT)",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494226737",
      "id" : 1494226737,
      "in_reply_to_id" : 1493494203,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585ZEBcx",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 34,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : null,
      "pull_request_review_id" : 1887908292,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494226737/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T09:12:21Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494226737",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Applied @fjahr's patches and running the indexer again...\r\n\r\nAs of block 831,110 the index is 1.7 GB (down from 54 GB https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1729224452)",
      "created_at" : "2024-02-19T09:12:58Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1952006804",
      "id" : 1952006804,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5850WUKU",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 1,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1952006804/reactions"
      },
      "updated_at" : "2024-02-19T10:27:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1952006804",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494466102"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494466102"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Ok, I see. If the taproot activation height is removed we might decide not to use that specific height at all but rather one that is around the time the BIP was proposed or even to some time around now? The specifics of the approach have been changed a lot and so even if someone already has experimented with it in the last few months the current iteration likely won't work for them to be able to spend their funds, no @josibake ? Had we discussed adding the start height as a parameter? That may be another option, though raising the complexity quite a bit...",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-02-19T12:20:53Z",
      "diff_hunk" : "@@ -16,6 +16,7 @@\n #include <hash.h>\n \n constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+const int TAPROOT_MAINNET_ACTIVATION_HEIGHT{709632};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1494466102",
      "id" : 1494466102,
      "in_reply_to_id" : 1493405713,
      "line" : 24,
      "node_id" : "PRRC_kwDOABII585ZE742",
      "original_commit_id" : "ce0e59e4bcdec4a70787e221bfe89d7ad7a1d12c",
      "original_line" : 24,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 24,
      "pull_request_review_id" : 1888284913,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494466102/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-02-19T12:27:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1494466102",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1322187?v=4",
         "events_url" : "https://api.github.com/users/fjahr/events{/privacy}",
         "followers_url" : "https://api.github.com/users/fjahr/followers",
         "following_url" : "https://api.github.com/users/fjahr/following{/other_user}",
         "gists_url" : "https://api.github.com/users/fjahr/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/fjahr",
         "id" : 1322187,
         "login" : "fjahr",
         "node_id" : "MDQ6VXNlcjEzMjIxODc=",
         "organizations_url" : "https://api.github.com/users/fjahr/orgs",
         "received_events_url" : "https://api.github.com/users/fjahr/received_events",
         "repos_url" : "https://api.github.com/users/fjahr/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/fjahr/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/fjahr"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@josibake I'm trying to rebase, but I'm not sure how to change the following:\r\n\r\n```cpp\r\nconst auto tweak_data = wallet::GetSilentPaymentTweakDataFromTxInputs(tx->vin, coins);\r\n\r\n    if (!tweak_data) continue;\r\n\r\n    const uint256 outpoint_hash = tweak_data->first;\r\n    CPubKey tweaked_pub_key_sum = tweak_data->second;\r\n    if (!tweaked_pub_key_sum.TweakAdd(outpoint_hash.begin())) {\r\n```\r\n\r\nIt looks like `GetSilentPaymentTweakDataFromTxInputs` is only used by test code. Am I still supposed to use it, or is there a new approach?",
      "created_at" : "2024-02-20T08:51:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1953738549",
      "id" : 1953738549,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5850c681",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953738549/reactions"
      },
      "updated_at" : "2024-02-20T08:51:31Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953738549",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> Am I still supposed to use it\r\n\r\nYep, still the correct function. The return value has changed, and we've removed the `pubkey.TweakAdd` method in favor of a dedicated routine in `module/silentpayments`. I need to expose the routine for pubkey tweaking in `src/bip352.h` and then you should be good.",
      "created_at" : "2024-02-20T10:15:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1953888046",
      "id" : 1953888046,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5850dfcu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953888046/reactions"
      },
      "updated_at" : "2024-02-20T10:15:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1953888046",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7444140?v=4",
         "events_url" : "https://api.github.com/users/josibake/events{/privacy}",
         "followers_url" : "https://api.github.com/users/josibake/followers",
         "following_url" : "https://api.github.com/users/josibake/following{/other_user}",
         "gists_url" : "https://api.github.com/users/josibake/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/josibake",
         "id" : 7444140,
         "login" : "josibake",
         "node_id" : "MDQ6VXNlcjc0NDQxNDA=",
         "organizations_url" : "https://api.github.com/users/josibake/orgs",
         "received_events_url" : "https://api.github.com/users/josibake/received_events",
         "repos_url" : "https://api.github.com/users/josibake/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/josibake/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/josibake/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/josibake"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1511956337"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511956337"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Considering that we only want to check if one of the outputs is P2TR, using Solver in this situation seems to be a potentially expensive tool (it does the matching for all standard output types and returns data that we never need). Thinking of e.g. txs that have dozens or hundreds of bare multisig outputs, this could be much slower. I'd suggest to use a simple fast-test here instead, e.g.:\r\n```suggestion\r\n            const CScript& spk = txout.scriptPubKey;\r\n            return spk.size() == 34 && spk[0] == OP_1 && spk[1] == 0x20;\r\n```\r\n(could introduce this as `CScript` method `IsPayToTaproot`, very similar to the already existing [`IsPayToWitnessScriptHash`](https://github.com/bitcoin/bitcoin/blob/98005b6a17907c4f7bdcf802ee96c274492f902a/src/script/script.cpp#L216-L222))",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-03-04T23:59:53Z",
      "diff_hunk" : "@@ -0,0 +1,132 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        if (std::none_of(tx->vout.begin(), tx->vout.end(), [](const CTxOut& txout) {\n+            std::vector<std::vector<unsigned char>> solutions;\n+            return Solver(txout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1511956337",
      "id" : 1511956337,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585aHp9x",
      "original_commit_id" : "16cf1d4d49e4e7d911b3de958fb215ec3b7a46cb",
      "original_line" : 61,
      "original_position" : 61,
      "original_start_line" : 60,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 67,
      "pull_request_review_id" : 1915594768,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511956337/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-05T00:11:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1511956337",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1512361897"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512361897"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Would be nice to have this as a helper method, as imo it's too low level for an indexer.",
      "commit_id" : "6f576639ad0672be25ba1b956e37f35daeea2824",
      "created_at" : "2024-03-05T08:42:13Z",
      "diff_hunk" : "@@ -0,0 +1,132 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: move GetSilentPaymentsTweakDataFromTxInputs out of wallet?\n+#include <wallet/silentpayments.h>\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\"), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        if (std::none_of(tx->vout.begin(), tx->vout.end(), [](const CTxOut& txout) {\n+            std::vector<std::vector<unsigned char>> solutions;\n+            return Solver(txout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1512361897",
      "id" : 1512361897,
      "in_reply_to_id" : 1511956337,
      "line" : 67,
      "node_id" : "PRRC_kwDOABII585aJM-p",
      "original_commit_id" : "16cf1d4d49e4e7d911b3de958fb215ec3b7a46cb",
      "original_line" : 61,
      "original_position" : 61,
      "original_start_line" : 60,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 67,
      "pull_request_review_id" : 1916251906,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512361897/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 66,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-03-05T08:42:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1512361897",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@Sjors I finally came around to upgrade my implementation for the tweak data. I have indexed a couple hundred blocks now which we could compare if that's still relevant for this PR.",
      "created_at" : "2024-03-05T22:12:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1979724552",
      "id" : 1979724552,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852ADMI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1979724552/reactions"
      },
      "updated_at" : "2024-03-05T22:12:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1979724552",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@setavenger yes that would be useful! However, I'm waiting (?) for @josibake to give me some helper methods so I can update this PR. Otherwise I don't think things wil match.",
      "created_at" : "2024-03-07T10:53:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1983254935",
      "id" : 1983254935,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852NhGX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983254935/reactions"
      },
      "updated_at" : "2024-03-07T10:53:19Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1983254935",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, in that case you can just ping me when your ready to compare.",
      "created_at" : "2024-03-07T21:39:43Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1984547557",
      "id" : 1984547557,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852Scrl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984547557/reactions"
      },
      "updated_at" : "2024-03-08T14:07:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1984547557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@Sjors I was looking through your implementation of the index, I'm curious if there's a segment dedicated to [transaction cut-through](https://github.com/josibake/bips/blob/silent-payments-bip/bip-0352.mediawiki#transaction-cut-through). I couldn't spot anything. My implementation does remove obsolete tweaks as suggested in the Appendix. I guess that would be something we'd have to keep in mind when comparing the indices.",
      "created_at" : "2024-03-08T14:07:23Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1985759856",
      "id" : 1985759856,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852XEpw",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1985759856/reactions"
      },
      "updated_at" : "2024-03-08T14:07:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1985759856",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I have not looked a transaction cut-through. This would heavily depend on how we (later on) serve the index over p2p. If we use a message pattern like BIP157, we could perhaps decide to restrict the query ranges that are allowed. E.g. only modulo 1000 blocks would be a valid start and stop. Then we can use that fact to cut-through the index itself. (and serve the last <1000 blocks without cut-through)\r\n\r\nWe should avoid calculating this at request time, as that would probably require too much CPU use.",
      "created_at" : "2024-03-08T18:23:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1986192088",
      "id" : 1986192088,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852YuLY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986192088/reactions"
      },
      "updated_at" : "2024-03-08T18:24:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986192088",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "I'm not quite sure I'm understanding why one would keep the obsolete tweaks (even for the last <1000 blocks). I do agree that the overhead would be too much if computed at request time. In my implementation I throw out the obsolete tweaks during indexing. That way it's easy to serve the smallest possible array of tweaks to a light client for every block.",
      "created_at" : "2024-03-09T15:20:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1986884015",
      "id" : 1986884015,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852bXGv",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986884015/reactions"
      },
      "updated_at" : "2024-03-09T15:20:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1986884015",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> I throw out the obsolete tweaks during indexing\r\n\r\nThat might work, we'd have to keep an eye on how much extra disk I/O that is compared to only doing it every 1000 blocks. \r\n\r\nLooking at this again, doesn't cut-through remove transaction history? So then you'd need to keep two indexes, one for regular use and the other for a wallet that needs to rescan. Or is there another solution for that?",
      "created_at" : "2024-03-11T09:41:53Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1987992694",
      "id" : 1987992694,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852flx2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987992694/reactions"
      },
      "updated_at" : "2024-03-11T09:41:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987992694",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > I throw out the obsolete tweaks during indexing\r\n> \r\n> That might work, we'd have to keep an eye on how much extra disk I/O that is compared to only doing it every 1000 blocks.\r\n\r\nI can't really comment on the I/O implications, I haven't looked too much at those yet. Especially because I'm not running my implementation on the node itself.\r\n\r\n> Looking at this again, doesn't cut-through remove transaction history? So then you'd need to keep two indexes, one for regular use and the other for a wallet that needs to rescan. Or is there another solution for that?\r\n\r\nThe way I understood cut-through, is that once all taproot UTXOs for a given transaction are spent, the tweak for their transaction is removed from the index. This does mean that if a light client rescans, it will not find its own spent transactions. I remember there being a discussion some time ago, and I believe it was seen as a reasonable trade-off to not find ones own transaction history in favor of saving a lot on bandwidth and computation (maybe @josibake can chime in here). But yes, as far as I know, one would have to keep a full index in parallel or set a flag on spent tweaks in some way.\r\n\r\nAs a note to that. I have tested a bit with a mobile wallet and it's already very time consuming to do a full scan (and that was just signet). From what I've seen cutting out unnecessary tweaks where possible is very desirable for weaker devices.\r\n",
      "created_at" : "2024-03-11T10:09:17Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988044568",
      "id" : 1988044568,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852fycY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988044568/reactions"
      },
      "updated_at" : "2024-03-11T10:09:17Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988044568",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> The way I understood cut-through, is that once all taproot UTXOs for a given transaction are spent, the tweak for their transaction is removed from the index. This does mean that if a light client rescans, it will not find its own spent transactions. I remember there being a discussion some time ago, and I believe it was seen as a reasonable trade-off to not find ones own transaction history in favor of saving a lot on bandwidth and computation (maybe @josibake can chime in here). But yes, as far as I know, one would have to keep a full index in parallel or set a flag on spent tweaks in some way.\r\n\r\nIt should also be noted that some wallets may want to continue tracking the scriptpubkeys that were used for earlier transactions, in case users screw up and accidentally send to the same on-chain address twice. That is not part of the silent payments protocol, but it could occur if users are trying to re-send to an address that they see on a block explorer.\r\n\r\nSo if wallets want to track these scriptpubkeys, they would also need to be able to discover them even after they are spent.\r\n\r\nThen again, you could argue that this is a niche wallet recovery scenario, and if users want to do this, they shouldn't use a light wallet.",
      "created_at" : "2024-03-11T11:43:42Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988250383",
      "id" : 1988250383,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852gksP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988250383/reactions"
      },
      "updated_at" : "2024-03-11T11:43:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988250383",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/131168104?v=4",
         "events_url" : "https://api.github.com/users/cygnet3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/cygnet3/followers",
         "following_url" : "https://api.github.com/users/cygnet3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/cygnet3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/cygnet3",
         "id" : 131168104,
         "login" : "cygnet3",
         "node_id" : "U_kgDOB9F3aA",
         "organizations_url" : "https://api.github.com/users/cygnet3/orgs",
         "received_events_url" : "https://api.github.com/users/cygnet3/received_events",
         "repos_url" : "https://api.github.com/users/cygnet3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/cygnet3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/cygnet3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/cygnet3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> and if users want to do this, they shouldn't use a light wallet.\r\n\r\nIt's the recipient that uses a light wallet. They can't control mistakes by the sender.\r\n\r\nHowever this issue is not related to the index. The index just returns tweaks, the wallet then needs to generate the scriptpubkeys to monitor. For that it would use BIP158 \"neutrino\" filters. The wallet should never remove a _used_ address from such a filter. That means the filter will grow, but I don't think that becomes a practical issue (high false positive rate, more blocks to download) unless you receive tens of thousands of transactions - at which point you may want to switch wallets.\r\n\r\n(the spec should probably say something about this, if it doesn't already)",
      "created_at" : "2024-03-11T11:55:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988269657",
      "id" : 1988269657,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852gpZZ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988269657/reactions"
      },
      "updated_at" : "2024-03-11T11:55:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988269657",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : " > However this issue is not related to the index. The index just returns tweaks, the wallet then needs to generate the scriptpubkeys to monitor. For that it would use BIP158 \"neutrino\" filters. The wallet should never remove a _used_ address from such a filter. That means the filter will grow, but I don't think that becomes a practical issue (high false positive rate, more blocks to download) unless you receive tens of thousands of transactions - at which point you may want to switch wallets.\r\n> \r\n\r\nI guess it does become relevant if a tweak index implements cut-through. A light client that is completely restored from seed and has to do a complete rescan would be unable to find UTXOs that were re-sent to an address. The new tweak for that tx would not match the scriptPubKey, the old tweak would be gone and the scriptpubkey would go unnoticed because those would not be available in a recovery from seed.\r\n\r\nI agree that this case should be considered in the specification. Or at least a discussion for light clients would be good in order to think about these kinds of trade-offs and pitfalls. Has there been a discussion in this direction already?\r\n",
      "created_at" : "2024-03-11T12:38:35Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988346866",
      "id" : 1988346866,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852g8Py",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988346866/reactions"
      },
      "updated_at" : "2024-03-11T12:38:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988346866",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-03-11T14:39:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988599893",
      "id" : 1988599893,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852h6BV",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988599893/reactions"
      },
      "updated_at" : "2024-03-11T14:39:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988599893",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I think that for early development it makes most sense to have two indexes: one without cut-through (this PR) and one with cut-through (maybe a followup?).\r\n\r\nFor the purpose of testing equality, is it straight-forward for you to build an index without cut-through?\r\n\r\nThe recovery use case is less common, so in the long run it would be fine if e.g. most nodes run the cut-through index and only a few run the full one.\r\n\r\n",
      "created_at" : "2024-03-11T15:46:10Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988758480",
      "id" : 1988758480,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852igvQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988758480/reactions"
      },
      "updated_at" : "2024-03-11T15:46:10Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988758480",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> I think that for early development it makes most sense to have two indexes: one without cut-through (this PR) and one with cut-through (maybe a followup?).\r\n>\r\nAgreed. I could do both as well. The extra work should be minimal.\r\n\r\n> For the purpose of testing equality, is it straight-forward for you to build an index without cut-through?\r\n> \r\nI think it should be quite straight-forward. My implementation might even benefit from having the two options available. Just to be sure and we get the same results, you are only collecting the actual 33byte tweaks per block/blockhash, correct?\r\n",
      "created_at" : "2024-03-11T16:50:04Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1988938472",
      "id" : 1988938472,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852jMro",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988938472/reactions"
      },
      "updated_at" : "2024-03-11T16:50:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988938472",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> you are only collecting the actual 33byte tweaks per block/blockhash, correct\r\n\r\nWhat else would you have in mind?",
      "created_at" : "2024-03-11T17:20:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1989009934",
      "id" : 1989009934,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852jeIO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989009934/reactions"
      },
      "updated_at" : "2024-03-11T17:20:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989009934",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> > you are only collecting the actual 33byte tweaks per block/blockhash, correct\r\n> \r\n> What else would you have in mind?\r\n>\r\nI'm not sure, was just thinking, because I'm collecting a bit of periphery for the tweaks (e.g. txids, and more) but I guess that's not really relevant here. \r\nThinking ahead though, how exactly would you want to compare the tweaks, sorted and hashed I presume? I have a feeling it will be easier to store the data already sorted instead of having to do that afterwards.",
      "created_at" : "2024-03-11T18:51:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1989202908",
      "id" : 1989202908,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852kNPc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989202908/reactions"
      },
      "updated_at" : "2024-03-11T18:51:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989202908",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "I haven't studied this PR in a while (and my memory is terrible), but I believe we store one entry per block. The entry is an array with one element for transaction, which is either empty or a tweak. The RPC similarly asks for a block hash and returns an array where each element is either empty or a tweak.",
      "created_at" : "2024-03-11T18:55:25Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1989209985",
      "id" : 1989209985,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852kO-B",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989209985/reactions"
      },
      "updated_at" : "2024-03-11T18:55:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989209985",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "In that case we could maybe just compare a hash of all tweaks per block, with the tweaks sorted lexicographically.",
      "created_at" : "2024-03-11T19:31:50Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1989274432",
      "id" : 1989274432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852ketA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989274432/reactions"
      },
      "updated_at" : "2024-03-11T19:31:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989274432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@setavenger it's much easier to debug if we just compare all tweaks individually.",
      "created_at" : "2024-03-12T08:39:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1991046311",
      "id" : 1991046311,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852rPSn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991046311/reactions"
      },
      "updated_at" : "2024-03-12T08:39:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991046311",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "> @setavenger it's much easier to debug if we just compare all tweaks individually.\r\n\r\nIn that case it could help having the corresponding txid for a tweak, what do you think? Or are you able to accurately track a tweak in a different way?",
      "created_at" : "2024-03-12T09:31:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1991159921",
      "id" : 1991159921,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852rrBx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991159921/reactions"
      },
      "updated_at" : "2024-03-12T09:31:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991159921",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The RPC returns an array for each block with one entry per transaction. The entry is empty if there is no tweak. So the ordering is based on the order of transactions in a block.",
      "created_at" : "2024-03-12T10:12:41Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1991262187",
      "id" : 1991262187,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852sD_r",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991262187/reactions"
      },
      "updated_at" : "2024-03-12T10:12:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1991262187",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "Ok, then I'll make sure my full index follows the same pattern.",
      "created_at" : "2024-03-12T16:12:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1992029420",
      "id" : 1992029420,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5852u_Ts",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992029420/reactions"
      },
      "updated_at" : "2024-03-12T16:12:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1992029420",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "NONE",
      "body" : "@Sjors I was able to run the full index but due to performance issues I couldn't keep the tweaks in order. I jotted down a couple notes regarding the tweak index, light client implementation etc. [here](https://github.com/setavenger/BIP0352-light-client-specification). This might be interesting for other implementations as well. I also published the index and some peripheral data there.\r\n\r\nA couple key stats:\r\n- index ranges from 709632 -> 834636\r\n- my full index is **1.7 GB** (https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1952006804) so we are in the same ballpark. I believe I'm using the same method to store the index data\r\n- cut-through leads to a reduction of roughly ~40% in the number of total tweaks\r\n\r\n",
      "created_at" : "2024-03-14T11:47:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-1997264125",
      "id" : 1997264125,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII5853C9T9",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1997264125/reactions"
      },
      "updated_at" : "2024-03-17T19:03:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1997264125",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Rebased. It no longer has a wallet dependency, which is nice.\r\n\r\n> The RPC returns an array for each block with one entry per transaction. The entry is empty if there is no tweak. So the ordering is based on the order of transactions in a block.\r\n\r\nThe middle part here is wrong: when a transaction doesn't have a tweak it's simply skipped, there's no empty element. I could change that, but I don't think it's necessary for anything.\r\n\r\nHere's the tweaks I get on a recent signet block:\r\n\r\n<details>\r\n<summary>getsilentpaymentblockdata 0000007dd632616a4ca25072cd4160bf3a4df1ecfd99a3e06aefe054bc8f6ff9</summary>\r\n\r\n```json\r\n{\r\n  \"tweaks\": [\r\n    \"03dde7131aedd4ffb7f0c8190253c61d5c268d2d9bf495b3e8f70161c4a88748b1\",\r\n    \"02d69b26c5e219c13ba258600ce2d88adb604cf9e3dbec9a4cba3d79072fc35aec\",\r\n    \"03cf8f34abd0f4cc6e2804b2cf8afd564846433f135af3678c9d7bd03eacf12edc\",\r\n    \"025a08ce8e8d85765f91ad10af65755cf3c60dd770b3d72384786134765d69820b\",\r\n    \"02e3f1656ec39e4240fffa6f36ff2eb57f20e7f819340cf44317690990ddc98544\",\r\n    \"03e674eb283627a44cf4aab3ba50651d1093e732f94baaca2d74c96ccaa48ca8b2\",\r\n    \"026c0973324533bf2b9d60d6ff8ad133493ee8828462a476ab0c2df171bbd0c2b1\",\r\n    \"02199bca98e3da7687680d01ecfd9075db1e45d2a00a2a4c4981663a99e3b2ff10\",\r\n    \"03ef64b3387938515ac203493cebc5c21a62415e7bc987542fda269add11854713\",\r\n    \"0263e6534d7e3968d14dbb4d5710b7077902963e6f6b4138b4d7f1f611465132dd\",\r\n    \"02688fd83b707668c040d348dd64fed5a5000448bb00d57aafe5ee9b11f0447ffe\",\r\n    \"039d07d18475ae86ac8ac3c87fcf31bc4c254524fff840822b76eb1613e84db499\",\r\n    \"0202f81b34ba6a4898dd5095f3e9b9a7ed8fb88401834fab61b63a6bdc436887bb\",\r\n    \"02c0d7686d33428e67e0fbda243dfca566d6d5905b0ad08cf1d0d35fd084ea7773\",\r\n    \"03e3da7b3d62397a6b98fdd07590a0c846b13d5bfe314a8a077f3cd77f5c40a84b\",\r\n    \"03d7d59345bb9ec837014e52c4c9ef5fee1e3b33de5772e3fd20e186de977dc192\",\r\n    \"023a6cc21ae1fa66091d96629170b57cba644b10f192df85f879278f0d02fc3923\",\r\n    \"0370c79353f62462295b2493a0eadfa01204a64a03660731e937cc256cea041f49\",\r\n    \"02df8f5e4b7ef17de157523fd32c5cc48711f3b036dc3973b82c7c8fae24f96563\",\r\n    \"0200797c52d48f366ee4551428e353e3df3a9456bd957c534f7db11704ae35f0f3\",\r\n    \"036f6617e4e8e8336c3011611127fcf8bb59467af09ce03081b82b45bd522f7e88\",\r\n    \"03e8fb68156fc78a70c3895b1529625cfc8a8c93a7977701a6aca9051bf1215348\",\r\n    \"02664b42446ba19da313adc6a8319942edec22956d1ffe0d0f3753e26a94bcc06c\",\r\n    \"036eedc78d6eecbe2def9133b8ae233e72b511b55e98a6b045586e19412a1e718e\",\r\n    \"02f391d95a701cf916bd8902ce30bebf4b3517f32bc0adaf28ea7daaefa223a921\",\r\n    \"0229fcfc868dae34eb8cd6bf9401a5c5d6304e51e50c288a8923591e97bdcc0733\",\r\n    \"02dffebc4193b1e7a103abdc61d13af33a04330dc0d27eb9de5db6e2f3fa73cd8e\",\r\n    \"03d83568533fe290f056abb888594c53157233ff9cadda9b09704bbbc5474f8c54\",\r\n    \"033e1155156b29b10b3faef395bbc107df30a53d6d2e1945ad0e7f19fcbd7df133\",\r\n    \"021c51d6dbb9c5c3db635175d25967c09d6b8c94ba352d55655ead1a3ba5bad34d\",\r\n    \"02bad2eee846e43b1c3c0f0ada5ab2eb51b5b55f6445a627749d366a702323ae22\",\r\n    \"02df04c0be57db13589c2472abd61e3001ce2769ac839a32c3f76d0f66a5e10408\",\r\n    \"02665859519d38fe4e226839679c355b2ff2c2cf3c72c08e9fa35889dd66c9274e\",\r\n    \"02962c2eb048f47dda56a4c839199f2d1e567435fee68268372f6e4c01f8b7a86a\",\r\n    \"022184a3ce6d63dbce433bfca44a8596d7ed035b42afa3a1e9782396838cfa01de\",\r\n    \"03fd1043acf8a35297c204df2612d03843979cac685c5ac7ce53683fe554cb6879\",\r\n    \"02cb1a084af2690fd06cac6da519ed100a5c44c8af27ade9d2c7b37e900af3a948\",\r\n    \"03585571e85609eb1378ce53c517650c32635ee68685ce6ca62b98662ca7d97f1b\",\r\n    \"03d24b172c6a3be7b7bb0946c75703532a80adea7d94c9b605979efb9c6d3ef823\",\r\n    \"034b46840cbf6500d7a82d1bd397dbed098aa230fa1915e1b28921db967fe2334a\",\r\n    \"029d9176ea61a1c45d8560ce897f9f0b46d408096d46b2dcedad9c039824e1ad49\",\r\n    \"039419755c7f70a486e3a7470976f7a70cb77ba26620869501027484135ef6c48e\",\r\n    \"02f590d701a5559feb5d672d69f92789d3cd13304408b36f9686f44abe4256086d\",\r\n    \"02cd8c3a992fab9883ec88666d4c2232f2a3007c685393be23e7aa9fc58c3216e8\",\r\n    \"0388c4a9e53407470834ccfde64bb76345aa9bdf84c32da0b74b3ba8e390652ce0\",\r\n    \"0361aedc2bda5fd14ec038425980c69253624c733c4d99992eeb569bd1aa58c85d\",\r\n    \"0280473683c77bd3185585252125b8a9669741095e033eae1462d9f35e4667da27\",\r\n    \"03d387b416d93f0bb785e8ba31cb3053a587fa28be11ae44b5b065697e40417bef\",\r\n    \"03c45748c66ff5e76f27a9ccd17c1305c599266e36751fb8c44e1b1d6de1c947d0\",\r\n    \"02290446b0263057ac9fba6a277c4244a482b2238ba2c415b181975977cdd33281\",\r\n    \"02bdfd35682562719cb4a26428dbd9a38ec19cc659e280f33b565c4cc06f1f4224\",\r\n    \"026ffad185910b1e5e2e74320e5649a5ccec25807b20626d140a09ef87e8492f38\",\r\n    \"0328521c4b2363a64fd5679efd71fad2c7d857c34ae41b46c0230a0f9220e6b3f7\",\r\n    \"03a3dc0aff3941e2d7c7d3a69ca5ba2afc35fa28df2a17f3e7d35d19411dfddc55\",\r\n    \"0262b5193d4fb7470a065f1444979ca18c0b4ed6a8d730c852a4c6650c30850594\",\r\n    \"025c3c5602bb5d50c8fa1d287b9c6698b28f3c1697183377c3654985a931108cf1\",\r\n    \"03d3574d15a6b9a069cde1c570c93ee6d94eeacc63f1426434385b1319afaadaa8\",\r\n    \"020d1efc22d6aff6f49a02e2894cee64a6d03bbd804a89e0809eaf0a44f657b97b\",\r\n    \"02035b7e10e5062f1ff7ac98a5ad26ceb8854de45197fe429d61eb86d6db04f749\",\r\n    \"029bd0d8a9f3db6ed4e47a5b100b45e0373a988c5710d63fedfff68809c9c9ba30\",\r\n    \"02f221e959bbb5fed1f6a8cc55bec48bf1f0c398170954d2181cd0c3fb7080265e\",\r\n    \"025d70330b90e4da34e893bab4de988620393be736fe74d5a97fe7f296eb240299\",\r\n    \"02445cd8e53dc46e4c7dc04d9778376a153d57f27884efba7f7f034cad85544194\",\r\n    \"02fd9ede367839371a15ccb3933ba5717bca9b38e759bbf2952061d3a32bf254db\",\r\n    \"03a3fa126a9af15bc0354a6c87a453d42c77472f3bfd8d76d599e2ad4f1187f437\",\r\n    \"030c822f92dad97ef49af0383f492f1f79c9e7bb522f363e1de4b231fa36ee26d6\",\r\n    \"03cfa37488e3ec657cbaaa3be8802af238a1c827c9bbf61045aa45dbf4d00a2055\",\r\n    \"0356532eebb2bc3b764ee2a34d9ff4a1797b843ce1eb194fca7f3c6a1a60b26111\",\r\n    \"02d6e21027cec1e5eb4dac6b4be44f0601398886acd1a8ea3aa99d99bfef52d4d8\",\r\n    \"03bff341819a679295fc159c6d78d535f6d26e79ed28b6045979828449d3d81404\",\r\n    \"039f7ea2f399a9fdc4c9a5fdd99bd41285e829eb320088c18e565bff5bf7f490f2\",\r\n    \"02f977a4159d25d9c0197c614a653ef549a94088a12f49dd71c4fa32877287d65e\",\r\n    \"0398a9d825c49626dea0f4371863519b86e75f4c951aac87cb1f8c621ba23cfd38\",\r\n    \"028278c78676e88f13dfa7efe5351eb3951125313a0b7a6c18274a65e0b0f734b7\",\r\n    \"033ff8f7f4afeb45730a4ba47145b1d3f628179cae5d7c185cfad9971a82c1a08d\",\r\n    \"031405054061d9fb120a785e0dbbdb3bbf5353e99254e11a5e9ece6eca77393d88\",\r\n    \"034e27e90802aab13af0340246eec9a30337e50da8a59067371dd2362efbbc3ec2\",\r\n    \"032e19d8915d22d537ebe4c7ba5532a54ad68fbea0b9bcc7431892b0816abd91d7\",\r\n    \"03ade6ae261ba9e9f4bfb8e02f6b26e7d23b9d06e9f1423681c9117c034892187f\",\r\n    \"029dc032b8faabf9b3c7c54c83ca3c7f5f7be0a72b4f01e6b7c9de4796fd0af702\",\r\n    \"0302062e06ff2d1fc971c885d610c3c192053600e71ff04aedd79fd9b8462483a4\",\r\n    \"036d39837fa8f15fbd1f42a3041ffed5ddc18f5569cb4ab7de2acf338fba10badc\",\r\n    \"030997ee943e289f82e0b2a3cabfa5695e54c834886d336cb395dfce4222f24891\",\r\n    \"03c262abff0b89b764854e0ece12761bb728d4ec4d654535d1d0da5eb30733ca1e\",\r\n    \"02b80cc210cb9301d5b538262cc022d553b1eaf9f5324f1e77644960020ce8d47a\",\r\n    \"035abc895c2a93a0cff15b05f7700e8b966adc902a14f9c04d303d98e435a2e038\",\r\n    \"021e2831164d40726addfd1dbce18a45823a729ecb5de448173f2de7a972b3c699\",\r\n    \"030e9e9e650b663b45bc19bc919bbad47b27ee7517956fd3af91a5060ef18940c6\",\r\n    \"0383e6f14e9ce6fee2703dca908109222ac314ef55e10cd40225965e7834ef9ae3\",\r\n    \"02d3e54b107d61f41f7e075b42ea1f3cda346a9533b513d0ba7ae414340f6bbd2b\",\r\n    \"024b56519418825efce7e8461f1b89dea87512702fc1e7f20594410db2ab44e4b0\",\r\n    \"027ad45dfe13d32e6245d6ff5490388153be629c6ee54bb5b71803985465844aa5\",\r\n    \"027f9a01694a7db47a75e43900dd65a7864c3b221b723f3c26c072369a8a3e2bb7\",\r\n    \"028d3b965a00e51246f38f97a18d43ef72c6f514681efb2b8db41f675f0b39e6a4\",\r\n    \"02ea5eea75dc7fdcc09a09d18f4d2bad9b10143c74372731dc00ac4719271e3b9e\",\r\n    \"03ee4480f1457043cd79cd5e253ac44f2fe1b52fa6d7c327b9ff835ce543c3abf6\",\r\n    \"02bb886ae36426b0f7e0ef14aaba151a0f700652e3e21b7f57e74ff32536158d6f\",\r\n    \"022117a2ce70f9db5c4ac264f31fe344d1ba0a794c2bade8e9bc291dff2529845a\",\r\n    \"02e7ca97bfbeac1fbdef85e2610defddd6786f4eb58475e5ff0df095d2f4453ea6\",\r\n    \"0285f650d4fec806e6560926b5b164de6b129b79b489d6790cb3da42d325322783\",\r\n    \"03b21ff0d3fcefa6435a093c6932a1aac9cebb5118bc69865855d95ea293da829d\",\r\n    \"039d7c959a684a92117e8da302c3141a99ac942aea3cd2a99762ec00eaceeef8e7\",\r\n    \"0348759e66fc521108075043681fa0be4f5906ccaa18e4111a9bbea0f8aaf86159\",\r\n    \"03978a366bf1b745d1f9e6c7df10566439ee010542461356ac9f0833a3bf74851e\",\r\n    \"028e633daca005532b44df046bfded6a5e69eb06badcb609f990b9d2e3b0793c5a\",\r\n    \"0308708b9e27944d9de82ed9cfeac51681455f4f1584869c2cdb73ba1e0f71d0b1\",\r\n    \"02c7f36661ce2bb478ddbdeb927a56cff5628c4ab17280ddd8b0791c39067838f7\",\r\n    \"023b6de613085e662bdc681de94092704e6c114bcb08c628ac066b2ad8f34b186a\",\r\n    \"0322033f1a4dbedf951eec5454f9f18cedca7ff3c7823fca1203ebfb91a6b7cc06\",\r\n    \"02ebb434e8f8aba732b05023dcc5c13c04556febed25a5a6c5d7719c42da783b76\",\r\n    \"035a6bf473764fbc64767b27866e1ee82380247c197568ae52203266037049cc64\",\r\n    \"028a7e4a4684a3b264b5e339b5a7376ec5e0e2beaab7223bc926c6bd401f0f8a33\",\r\n    \"03bd2a3e364a767f89507392cf60f5bb7baf65df8c576dc745dce29449dbe69e7d\",\r\n    \"02100bf00d138aa9b0186a2bdc04b86f617b7db1c43ce4c6d98a6a73873909bdcf\",\r\n    \"025f663962346b24920d2046ebf6c7a6c59d62b6641b2d5f529a278463a01681e2\",\r\n    \"02cdee816b652c733ae7118760cddf5d6c224b4ddc2a60a94f9b63969f65fc8905\",\r\n    \"03e0111bfca7188a4ff597c2ab9762d40150e2d5eaa4d7b6ee0619c244f00f6e1d\",\r\n    \"03a362c507df74497a9a4c4ec1b96157c641067877448a961a2fd12fc12a57dc9f\",\r\n    \"0300f11a977e52d4b2df2f340dbb48939af569f80abcfb721d80bcaad241478dd8\",\r\n    \"0338941aca63e2e24a8ff823b9b82346c7d3b25e98a71f33c1f5aa2f44cc9456df\",\r\n    \"021bf9c708e836e05470ddaf418961e840b5bb1d5392e6cf7259cc0072a2ba8e33\",\r\n    \"039c3cd95ef1c859c27ed8c8ef0b74d362288eab068d7ed8aad38851a657dbc473\",\r\n    \"0373793ecc68a94acda07708dadf2082318f5c2586fabbacad7dadad55c87cf513\",\r\n    \"02e7436b58aab20271f0b5d5865921bfb4534b63c904034be995dfebe383184f1a\",\r\n    \"0287828b42211f00491b8c34c129e069e780c2e928800433b4753b2c82628818e1\",\r\n    \"0234400b2e0dfb8d0121c66315f210de41d989dcb8374f0649120e5206b9120d8c\",\r\n    \"02414187a6e41625c111411c3557c7c4cf79a77b7c2c90be290cb30468e21f04ad\",\r\n    \"0361aca306f5d7c3584d4554aae89fecc76886d09c87ca4ffaeb1ddcf1995f3ccd\",\r\n    \"0223d4a2975c7edc6d4ef9d0115ffc2ca301de8abc33b4e8f16c5ff6dcba68aba7\",\r\n    \"028ff059b5ead51d75905778d70505a9577c55f0dd13ba16b31c312952f794abca\",\r\n    \"03c8b14ebe61fa7f776919e4e1443558d8d453bc306728781d400f17d12d1d645e\",\r\n    \"02c4cfe62d07450117db533e8f781ccecc61fff6b3cdf4d7fd635407d0ea6104d0\",\r\n    \"025f303c19c542f50a535be71323403816950d535033b2bc7c2bbd468b95011eb9\",\r\n    \"02a2910f75512fc66310f6af63c36b5d70f9bec3b4a9502ef8021b8d0aca83a29a\",\r\n    \"02df7e5ef91d223bee7e4705e5fdd6767d259e5ee0b9b577add84c8485e59dc59f\",\r\n    \"02509825a12b1638e051903bb7bddd2e4e190595b73cc0330e6e510e2866b8d50d\",\r\n    \"0355135adc7b4cef16bbb6800bf993bf36538e823ea4f03a31e40c360e2bce52c1\",\r\n    \"03f5156fb6f04624941ba8621e889d440ff6861ad231a0979ee66f9df7c51f2dcf\",\r\n    \"0378996dd85f0c7cc2a804cc009b1b0f854df84a81510e1bd4019df0251c03c0d1\",\r\n    \"0277e0904ec2c6402843f5d6babc1f173436543ec89d1dfde7d0c104a6cd1c5273\",\r\n    \"021f10375da54be801d51be2233b1fcbd52340d08dc706a1b3e753033568767324\",\r\n    \"0262aecedfeaf0df822e019c124fd95e606ff775aa30f9a3e125a87b01b0f30eff\",\r\n    \"02d0bbb0aa14dc4f3ba2043de749ea1d63c105de0577b37f71ec9658f8a0e949c0\",\r\n    \"0325c11eaa27cb529a3392064cfb49ac1f999b5c8ff7f14917abcdad67be86ba60\",\r\n    \"02aabf4e66a7f218206975818264b946eadd3e4ff57ae41f49a4262e1b848945b6\",\r\n    \"03d2a22045b2026977059b2ec0b803d722592671e800a30c2ba47fe9c3f3705560\",\r\n    \"031f8ca3109d282190b1bd2610890a2ff13ca55710bc5596cc6ce27745f8c050ea\",\r\n    \"03288e9994b079988eb369083b3f5b4a6c31dcb90c2904d212c7d80fdbd4298b94\",\r\n    \"02aae19e60d90b9b9829b60dd851bc4c63c916a93d71f3cd709180862eab6de09f\",\r\n    \"02884c700c60d91413bdf1c8d901b876ec6b601cb13c08567e642881a7751fb6dd\",\r\n    \"02ba16b1174391da8e69038a99571afcd37821208cb1d0ca4bb8bfff4d38bac70a\",\r\n    \"032ee3d3257472b05e5b5898244db2770419be4a4fa6e0969bf5783d682ba3bb7a\",\r\n    \"022e9c923b710601c0a9e4b2f7c347c4c98daed810329722c760cfabfa3a16c79a\",\r\n    \"03f734f312f6be23104ceb723d65e157caa09506693be5e85fc590299f09461169\",\r\n    \"03312306b90116a7c6329f63a0bfda88ff75d3a707972cc1e0dfe4807189e05634\",\r\n    \"03987a966332397cc8e53afb797965a0add8745f8b3c1ee7a302b709be177b5e53\",\r\n    \"030532bd3bc68e4a433f5a2f328c0923dea81d1922a4c50cdbcfe4b98a2b7bd7de\",\r\n    \"027698978b34610a4479172849d5ee811928698572489b7f9732e4942ae3451189\",\r\n    \"0257332a323b92a04b4dea3449953bcaa0b27571fc20265a14476f64d0b5af2b9c\",\r\n    \"0354107b26fcbe2cdb69e92b454d19d3485d1d06005b3d819790504847c0e79813\",\r\n    \"036d9953598ed569e4030739bd61ef8b811c4fcd6c18377266653a2c1a46be24d0\",\r\n    \"02f66f188aa800651d8e11a8efaf3ff14606196ad26a4dbf5d020911a513186c41\",\r\n    \"023d47e6088ce2984f92752d1f3c796ff6a2d3c37419d2f0c199756bb9ecd7e02c\",\r\n    \"0384acb414a8fb2e61896018b26b0e25a73f304011bc5b6062a3e36bfb0e538cb9\",\r\n    \"02630235c2b85eb8dde983382ef0d57ae113efc555e5d5ff8dffea0ad23a4d686e\"\r\n  ]\r\n}\r\n\r\n```\r\n<details>",
      "created_at" : "2024-04-17T08:43:28Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-2060724432",
      "id" : 2060724432,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII58561CjQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2060724432/reactions"
      },
      "updated_at" : "2024-04-17T08:44:00Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2060724432",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1568462751"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568462751"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@josibake can you make `GetSilentPaymentTweakDataFromTxInputs` return a `CPub` (or `uint256`) rather than this low level secp thing?",
      "commit_id" : "3b52e4d2e6bc7f0e2b24eeed6478a719d54ac910",
      "created_at" : "2024-04-17T08:46:26Z",
      "diff_hunk" : "@@ -0,0 +1,134 @@\n+#include <index/silentpaymentindex.h>\n+\n+#include <bip352.h>\n+#include <chainparams.h>\n+#include <coins.h>\n+#include <common/args.h>\n+#include <index/disktxpos.h>\n+#include <node/blockstorage.h>\n+#include <pubkey.h>\n+#include <primitives/transaction.h>\n+// TODO: get rid of this\n+#include <secp256k1.h>\n+\n+#include <undo.h>\n+#include <validation.h>\n+\n+#include <dbwrapper.h>\n+#include <hash.h>\n+\n+constexpr uint8_t DB_SILENT_PAYMENT_INDEX{'s'};\n+/* Save space on mainnet by starting the index at Taproot activation.\n+ * Copying the height here assuming DEPLOYMENT_TAPROOT will be dropped:\n+ * https://github.com/bitcoin/bitcoin/pull/26201/\n+ * Only apply this storage optimization on mainnet.\n+ */\n+const int TAPROOT_MAINNET_ACTIVATION_HEIGHT{709632};\n+\n+std::unique_ptr<SilentPaymentIndex> g_silent_payment_index;\n+\n+/** Access to the silent payment index database (indexes/silentpaymentindex/) */\n+class SilentPaymentIndex::DB : public BaseIndex::DB\n+{\n+public:\n+    explicit DB(size_t n_cache_size, bool f_memory = false, bool f_wipe = false);\n+\n+    bool WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks);\n+};\n+\n+SilentPaymentIndex::DB::DB(size_t n_cache_size, bool f_memory, bool f_wipe) :\n+    BaseIndex::DB(gArgs.GetDataDirNet() / \"indexes\" / \"silentpaymentindex\", n_cache_size, f_memory, f_wipe)\n+{}\n+\n+bool SilentPaymentIndex::DB::WriteSilentPayments(const std::pair<uint256, std::vector<CPubKey>>& tweaks)\n+{\n+    CDBBatch batch(*this);\n+    batch.Write(std::make_pair(DB_SILENT_PAYMENT_INDEX, tweaks.first), tweaks.second);\n+    return WriteBatch(batch);\n+}\n+\n+SilentPaymentIndex::SilentPaymentIndex(std::unique_ptr<interfaces::Chain> chain, size_t n_cache_size, bool f_memory, bool f_wipe)\n+    : BaseIndex(std::move(chain), \"silentpaymentindex\", /*start_height=*/Params().IsTestChain() ? 0 : TAPROOT_MAINNET_ACTIVATION_HEIGHT), m_db(std::make_unique<SilentPaymentIndex::DB>(n_cache_size, f_memory, f_wipe))\n+{}\n+\n+SilentPaymentIndex::~SilentPaymentIndex() {}\n+\n+bool SilentPaymentIndex::GetSilentPaymentKeys(std::vector<CTransactionRef> txs, CBlockUndo& block_undo, std::vector<CPubKey>& tweaked_pub_key_sums)\n+{\n+    assert(txs.size() - 1 == block_undo.vtxundo.size());\n+\n+    for (uint32_t i=0; i < txs.size(); i++) {\n+        auto& tx = txs.at(i);\n+\n+        if (tx->IsCoinBase()) {\n+            continue;\n+        }\n+\n+        if (std::none_of(tx->vout.begin(), tx->vout.end(), [](const CTxOut& txout) {\n+            std::vector<std::vector<unsigned char>> solutions;\n+            return Solver(txout.scriptPubKey, solutions) == TxoutType::WITNESS_V1_TAPROOT;\n+        })) {\n+            continue;\n+        }\n+\n+        // -1 as blockundo does not have coinbase tx\n+        CTxUndo undoTX{block_undo.vtxundo.at(i - 1)};\n+        std::map<COutPoint, Coin> coins;\n+\n+        for (uint32_t j = 0; j < tx->vin.size(); j++) {\n+            coins[tx->vin.at(j).prevout] = undoTX.vprevout.at(j);\n+        }\n+\n+        std::optional<BIP352::PubTweakData> tweak_data = BIP352::GetSilentPaymentTweakDataFromTxInputs(tx->vin, coins, /*combined=*/true);\n+\n+        if (!tweak_data) continue;\n+\n+        // TODO: friends don't make friends do low level libsecp stuff on return values...",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#discussion_r1568462751",
      "id" : 1568462751,
      "line" : 86,
      "node_id" : "PRRC_kwDOABII585dfNef",
      "original_commit_id" : "4b4e99b1dafb139b6f004aa47cb5a59019f49971",
      "original_line" : 86,
      "original_position" : 86,
      "original_start_line" : null,
      "path" : "src/index/silentpaymentindex.cpp",
      "position" : 86,
      "pull_request_review_id" : 2005416700,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28241",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568462751/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-04-17T08:46:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1568462751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "NONE",
      "body" : " > Here's the tweaks I get on a recent signet block:\r\n> \r\nDo you have a mainnet block before height 834761 indexed, then we could compare. I don't have signet data available.\r\n\r\n",
      "created_at" : "2024-04-17T14:20:01Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28241#issuecomment-2061378522",
      "id" : 2061378522,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28241",
      "node_id" : "IC_kwDOABII58563iPa",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061378522/reactions"
      },
      "updated_at" : "2024-04-17T14:20:01Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2061378522",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/34041358?v=4",
         "events_url" : "https://api.github.com/users/setavenger/events{/privacy}",
         "followers_url" : "https://api.github.com/users/setavenger/followers",
         "following_url" : "https://api.github.com/users/setavenger/following{/other_user}",
         "gists_url" : "https://api.github.com/users/setavenger/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/setavenger",
         "id" : 34041358,
         "login" : "setavenger",
         "node_id" : "MDQ6VXNlcjM0MDQxMzU4",
         "organizations_url" : "https://api.github.com/users/setavenger/orgs",
         "received_events_url" : "https://api.github.com/users/setavenger/received_events",
         "repos_url" : "https://api.github.com/users/setavenger/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/setavenger/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/setavenger/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/setavenger"
      }
   }
]
