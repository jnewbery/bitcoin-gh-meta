[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "created_at" : "2023-08-09T20:46:24Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#issuecomment-1672125136",
      "id" : 1672125136,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28248",
      "node_id" : "IC_kwDOABII585jqprQ",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1672125136/reactions"
      },
      "updated_at" : "2023-08-09T20:46:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1672125136",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The title \"p2p: outbound network diversity improvements\" makes it sound like you are improving on the logic for making outbound connections but really you are refactoring and adding additional logging. Would you mind making the title more accurate?\r\n\r\n> Please see the commit messages for details.\r\n\r\nThe PR description is added to the merge commit, so in my opinion it makes sense to have at least a summary of what the PR does in the description.\r\n\r\nFrom our [docs](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#creating-the-pull-request):\r\n```\r\nThe body of the pull request should contain sufficient description of what the patch does, and even more importantly, why, with \r\njustification and reasoning. You should include references to any discussions (for example, other issues or mailing list\r\ndiscussions).\r\n```",
      "created_at" : "2023-08-10T10:03:44Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#issuecomment-1672930044",
      "id" : 1672930044,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28248",
      "node_id" : "IC_kwDOABII585jtuL8",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1672930044/reactions"
      },
      "updated_at" : "2023-08-10T10:03:44Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1672930044",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8077169?v=4",
         "events_url" : "https://api.github.com/users/dergoegge/events{/privacy}",
         "followers_url" : "https://api.github.com/users/dergoegge/followers",
         "following_url" : "https://api.github.com/users/dergoegge/following{/other_user}",
         "gists_url" : "https://api.github.com/users/dergoegge/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/dergoegge",
         "id" : 8077169,
         "login" : "dergoegge",
         "node_id" : "MDQ6VXNlcjgwNzcxNjk=",
         "organizations_url" : "https://api.github.com/users/dergoegge/orgs",
         "received_events_url" : "https://api.github.com/users/dergoegge/received_events",
         "repos_url" : "https://api.github.com/users/dergoegge/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/dergoegge/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/dergoegge/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/dergoegge"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "@dergoegge updated",
      "created_at" : "2023-08-10T21:52:33Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#issuecomment-1673966621",
      "id" : 1673966621,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28248",
      "node_id" : "IC_kwDOABII585jxrQd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1673966621/reactions"
      },
      "updated_at" : "2023-08-10T21:52:33Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1673966621",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "This mostly seems like pointless refactoring (changing a `switch` to an `||` of two functions that themselves have switches). Doesn't seem worth the review effort to me.",
      "created_at" : "2023-08-11T05:51:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#issuecomment-1674241624",
      "id" : 1674241624,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/28248",
      "node_id" : "IC_kwDOABII585jyuZY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1674241624/reactions"
      },
      "updated_at" : "2023-08-11T05:51:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1674241624",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/127186?v=4",
         "events_url" : "https://api.github.com/users/ajtowns/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ajtowns/followers",
         "following_url" : "https://api.github.com/users/ajtowns/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ajtowns/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ajtowns",
         "id" : 127186,
         "login" : "ajtowns",
         "node_id" : "MDQ6VXNlcjEyNzE4Ng==",
         "organizations_url" : "https://api.github.com/users/ajtowns/orgs",
         "received_events_url" : "https://api.github.com/users/ajtowns/received_events",
         "repos_url" : "https://api.github.com/users/ajtowns/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ajtowns/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ajtowns"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1293481061"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1293481061"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good catch with this deficiency!\r\n\r\nIf `m_added_nodes` is changed to `std::unordered_set`, then this can be a simple `m_added_nodes.count() > 0` and `CConnman::AddNode()` and `CConnman::RemoveAddedNode()` could be simplified (and made faster since they are now `O(number of added nodes)` and will become `O(1)`, I guess performance is irrelevant in practice because of the small number of elements).\r\n\r\nMaybe this is worth a separate PR since it is distinct from other commits (one commit to change it to `std::unordered_set` and one to add this check).",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-14T13:46:05Z",
      "diff_hunk" : "@@ -1928,6 +1921,25 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n             }\n \n+            // Do not make automatic outbound connections to addnode peers, to\n+            // avoid using our limited outbound slots for them and to ensure\n+            // addnode connections benefit from their intended protections.\n+            {\n+                const auto str_addr{addr.ToStringAddr()};\n+                const auto str_addr_port{addr.ToStringAddrPort()};\n+\n+                LOCK(m_added_nodes_mutex);\n+                if (m_added_nodes.size() < 16 // bound the query to a reasonable limit\n+                    && std::any_of(m_added_nodes.cbegin(), m_added_nodes.cend(), [&](const auto& a) { return a == str_addr || a == str_addr_port; })) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1293481061",
      "id" : 1293481061,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NGPRl",
      "original_commit_id" : "4b9774dd49359cc0a807f1dc57b96d182330a4a1",
      "original_line" : 1933,
      "original_position" : 121,
      "original_start_line" : 1924,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1576881142,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1293481061/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-14T13:58:38Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1293481061",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1294891951"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294891951"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good idea, simpler and faster. Done (thanks!)",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-15T17:13:01Z",
      "diff_hunk" : "@@ -1928,6 +1921,25 @@ void CConnman::ThreadOpenConnections(const std::vector<std::string> connect)\n                 continue;\n             }\n \n+            // Do not make automatic outbound connections to addnode peers, to\n+            // avoid using our limited outbound slots for them and to ensure\n+            // addnode connections benefit from their intended protections.\n+            {\n+                const auto str_addr{addr.ToStringAddr()};\n+                const auto str_addr_port{addr.ToStringAddrPort()};\n+\n+                LOCK(m_added_nodes_mutex);\n+                if (m_added_nodes.size() < 16 // bound the query to a reasonable limit\n+                    && std::any_of(m_added_nodes.cbegin(), m_added_nodes.cend(), [&](const auto& a) { return a == str_addr || a == str_addr_port; })) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1294891951",
      "id" : 1294891951,
      "in_reply_to_id" : 1293481061,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NLnuv",
      "original_commit_id" : "4b9774dd49359cc0a807f1dc57b96d182330a4a1",
      "original_line" : 1933,
      "original_position" : 121,
      "original_start_line" : 1924,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1579039581,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294891951/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-15T17:13:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294891951",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296069949"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296069949"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Before this it would compare just the address and after this change it would compare the address and the port. I think that is undesirable because for inbound connections we see the peer as e.g. `1.2.3.4:somerandomport` and when we try to connect to `1.2.3.4:8333` we should assume we are already connected to that peer.",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T15:15:07Z",
      "diff_hunk" : "@@ -408,7 +397,8 @@ CNode* CConnman::FindNode(const CService& addr)\n \n bool CConnman::AlreadyConnectedToAddress(const CAddress& addr)\n {\n-    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringAddrPort());\n+    const CService service{MaybeFlipIPv6toCJDNS(addr)};\n+    return FindNode(service) || FindNode(service.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296069949",
      "id" : 1296069949,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NQHU9",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 401,
      "original_position" : 33,
      "original_start_line" : 398,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1580868907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296069949/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-16T15:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296069949",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296074743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296074743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "The existent code in `master` seems to be comparing the ports. Is there another bug that an inbound connection from `1.2.3.4` would not be considered as \"we are connected to `1.2.3.4:8333`\"?",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T15:18:50Z",
      "diff_hunk" : "@@ -1995,7 +2004,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n     }\n \n     for (const std::string& strAddNode : lAddresses) {\n-        CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n+        CService service{MaybeFlipIPv6toCJDNS(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296074743",
      "id" : 1296074743,
      "line" : 2794,
      "node_id" : "PRRC_kwDOABII585NQIf3",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2794,
      "original_position" : 158,
      "original_start_line" : 1998,
      "path" : "src/net.cpp",
      "position" : 231,
      "pull_request_review_id" : 1580868907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296074743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2753,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-08-16T15:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296074743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296106505"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296106505"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Or this:\r\n\r\n```cpp\r\nreturn m_added_nodes.insert(strNode).second;\r\n```",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T15:43:05Z",
      "diff_hunk" : "@@ -2621,24 +2630,15 @@ std::vector<CAddress> CConnman::GetAddresses(CNode& requestor, size_t max_addres\n bool CConnman::AddNode(const std::string& strNode)\n {\n     LOCK(m_added_nodes_mutex);\n-    for (const std::string& it : m_added_nodes) {\n-        if (strNode == it) return false;\n-    }\n-\n-    m_added_nodes.push_back(strNode);\n+    if (m_added_nodes.count(strNode)) return false;\n+    m_added_nodes.insert(strNode);\n     return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296106505",
      "id" : 1296106505,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NQQQJ",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2635,
      "original_position" : 173,
      "original_start_line" : 2633,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1580868907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296106505/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-16T15:58:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296106505",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296121513"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296121513"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Why not use `LogPrintLevel(BCLog::NET, BCLog::Level::Debug`?",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T15:55:15Z",
      "diff_hunk" : "@@ -437,6 +427,14 @@ static CAddress GetBindAddress(const Sock& sock)\n     return addr_bind;\n }\n \n+static void LogAlreadyConnected(CNode* pnode, ConnectionType conn_type)\n+{\n+    LogPrintfCategory(BCLog::NET, \"Failed to open new %s connection, already connected to peer=%d, net=%s%s (%s)\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296121513",
      "id" : 1296121513,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NQT6p",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 432,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1580868907,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296121513/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-16T15:58:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296121513",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296393528"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296393528"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Thank you, done.",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T20:28:46Z",
      "diff_hunk" : "@@ -2621,24 +2630,15 @@ std::vector<CAddress> CConnman::GetAddresses(CNode& requestor, size_t max_addres\n bool CConnman::AddNode(const std::string& strNode)\n {\n     LOCK(m_added_nodes_mutex);\n-    for (const std::string& it : m_added_nodes) {\n-        if (strNode == it) return false;\n-    }\n-\n-    m_added_nodes.push_back(strNode);\n+    if (m_added_nodes.count(strNode)) return false;\n+    m_added_nodes.insert(strNode);\n     return true;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296393528",
      "id" : 1296393528,
      "in_reply_to_id" : 1296106505,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NRWU4",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2635,
      "original_position" : 173,
      "original_start_line" : 2633,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1581366261,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296393528/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-08-16T20:47:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296393528",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296405960"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296405960"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I didn't change the level from the current `LogPrintf` since 236618061a445d2cb11e722cfac5fdae5be26abb in 2017. Since this shouldn't normally occur, unconditionally logging seems helpful (the `net` category is currently much too busy to leave on and see this happen unless you proactively grep for it -- finishing the logging severity level upgrade should solve that. I personally test this branch with the added logging changed to unconditional).",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T20:41:00Z",
      "diff_hunk" : "@@ -437,6 +427,14 @@ static CAddress GetBindAddress(const Sock& sock)\n     return addr_bind;\n }\n \n+static void LogAlreadyConnected(CNode* pnode, ConnectionType conn_type)\n+{\n+    LogPrintfCategory(BCLog::NET, \"Failed to open new %s connection, already connected to peer=%d, net=%s%s (%s)\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296405960",
      "id" : 1296405960,
      "in_reply_to_id" : 1296121513,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585NRZXI",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 432,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1581383931,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296405960/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-08-16T20:48:50Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296405960",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296427115"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296427115"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Yes, I think that is currently an issue as well.\r\n",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-16T21:03:15Z",
      "diff_hunk" : "@@ -1995,7 +2004,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n     }\n \n     for (const std::string& strAddNode : lAddresses) {\n-        CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n+        CService service{MaybeFlipIPv6toCJDNS(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296427115",
      "id" : 1296427115,
      "in_reply_to_id" : 1296074743,
      "line" : 2794,
      "node_id" : "PRRC_kwDOABII585NRehr",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2794,
      "original_position" : 158,
      "original_start_line" : 1998,
      "path" : "src/net.cpp",
      "position" : 231,
      "pull_request_review_id" : 1581416432,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296427115/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2753,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T22:04:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296427115",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296810743"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296810743"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I mean, if we already have an inbound connection from `1.2.3.4` (ie we are connected to `1.2.3.4:somerandomport`) and this code checks whether we are connected to `1.2.3.4:8333` it would wrongly assume that we are not and would open an outbound connection to that address.",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-08-17T07:43:27Z",
      "diff_hunk" : "@@ -1995,7 +2004,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n     }\n \n     for (const std::string& strAddNode : lAddresses) {\n-        CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n+        CService service{MaybeFlipIPv6toCJDNS(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1296810743",
      "id" : 1296810743,
      "in_reply_to_id" : 1296074743,
      "line" : 2794,
      "node_id" : "PRRC_kwDOABII585NS8L3",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2794,
      "original_position" : 158,
      "original_start_line" : 1998,
      "path" : "src/net.cpp",
      "position" : 231,
      "pull_request_review_id" : 1581989659,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296810743/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2753,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-08-17T07:43:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296810743",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/266751?v=4",
         "events_url" : "https://api.github.com/users/vasild/events{/privacy}",
         "followers_url" : "https://api.github.com/users/vasild/followers",
         "following_url" : "https://api.github.com/users/vasild/following{/other_user}",
         "gists_url" : "https://api.github.com/users/vasild/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/vasild",
         "id" : 266751,
         "login" : "vasild",
         "node_id" : "MDQ6VXNlcjI2Njc1MQ==",
         "organizations_url" : "https://api.github.com/users/vasild/orgs",
         "received_events_url" : "https://api.github.com/users/vasild/received_events",
         "repos_url" : "https://api.github.com/users/vasild/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/vasild/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/vasild/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/vasild"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569401"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569401"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Good call. I've reproduced that bug and am looking at a fix.",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-01T21:57:12Z",
      "diff_hunk" : "@@ -1995,7 +2004,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n     }\n \n     for (const std::string& strAddNode : lAddresses) {\n-        CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n+        CService service{MaybeFlipIPv6toCJDNS(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569401",
      "id" : 1313569401,
      "in_reply_to_id" : 1296074743,
      "line" : 2794,
      "node_id" : "PRRC_kwDOABII585OS3p5",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2794,
      "original_position" : 158,
      "original_start_line" : 1998,
      "path" : "src/net.cpp",
      "position" : 231,
      "pull_request_review_id" : 1607704196,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569401/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2753,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T21:57:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569401",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569449"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569449"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Changed `FindNode(service)` to `FindNode(static_cast<CNetAddr>(service))`.",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-01T21:57:15Z",
      "diff_hunk" : "@@ -408,7 +397,8 @@ CNode* CConnman::FindNode(const CService& addr)\n \n bool CConnman::AlreadyConnectedToAddress(const CAddress& addr)\n {\n-    return FindNode(static_cast<CNetAddr>(addr)) || FindNode(addr.ToStringAddrPort());\n+    const CService service{MaybeFlipIPv6toCJDNS(addr)};\n+    return FindNode(service) || FindNode(service.ToStringAddrPort());",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569449",
      "id" : 1313569449,
      "in_reply_to_id" : 1296069949,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OS3qp",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 401,
      "original_position" : 33,
      "original_start_line" : 398,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1607704224,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569449/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2023-09-01T21:57:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569449",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569577"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569577"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "On second thought, taking your suggestion (with warning level) as the goal is to migrate to severity level logging. Thanks!",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-01T21:57:25Z",
      "diff_hunk" : "@@ -437,6 +427,14 @@ static CAddress GetBindAddress(const Sock& sock)\n     return addr_bind;\n }\n \n+static void LogAlreadyConnected(CNode* pnode, ConnectionType conn_type)\n+{\n+    LogPrintfCategory(BCLog::NET, \"Failed to open new %s connection, already connected to peer=%d, net=%s%s (%s)\\n\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1313569577",
      "id" : 1313569577,
      "in_reply_to_id" : 1296121513,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585OS3sp",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 432,
      "original_position" : 43,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : null,
      "pull_request_review_id" : 1607704324,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569577/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-01T21:57:25Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1313569577",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1316687977"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1316687977"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Updated with a fix, along with several additional issues found and possibly fixed now while looking into this (thanks!)",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-06T03:56:40Z",
      "diff_hunk" : "@@ -1995,7 +2004,7 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n     }\n \n     for (const std::string& strAddNode : lAddresses) {\n-        CService service(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)));\n+        CService service{MaybeFlipIPv6toCJDNS(LookupNumeric(strAddNode, Params().GetDefaultPort(strAddNode)))};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1316687977",
      "id" : 1316687977,
      "in_reply_to_id" : 1296074743,
      "line" : 2794,
      "node_id" : "PRRC_kwDOABII585OexBp",
      "original_commit_id" : "a411cb5a170098c99e7c64f508153613f5e377da",
      "original_line" : 2794,
      "original_position" : 158,
      "original_start_line" : 1998,
      "path" : "src/net.cpp",
      "position" : 231,
      "pull_request_review_id" : 1612367872,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1316687977/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 2753,
      "start_side" : "LEFT",
      "subject_type" : "line",
      "updated_at" : "2023-09-06T03:56:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1316687977",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/2415484?v=4",
         "events_url" : "https://api.github.com/users/jonatack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/jonatack/followers",
         "following_url" : "https://api.github.com/users/jonatack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/jonatack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/jonatack",
         "id" : 2415484,
         "login" : "jonatack",
         "node_id" : "MDQ6VXNlcjI0MTU0ODQ=",
         "organizations_url" : "https://api.github.com/users/jonatack/orgs",
         "received_events_url" : "https://api.github.com/users/jonatack/received_events",
         "repos_url" : "https://api.github.com/users/jonatack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/jonatack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/jonatack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1323598562"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323598562"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Could this lead to disambiguities? Say if you want to addnode different localhost peers with different ports (but the same IP 127.0.0.1), would `getaddednode()` now say you are connected to all of them, even when you are only connected to 1 in reality? ",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-12T21:28:33Z",
      "diff_hunk" : "@@ -2734,13 +2734,13 @@ std::vector<AddedNodeInfo> CConnman::GetAddedNodeInfo() const\n \n \n     // Build a map of all already connected addresses (by IP:port and by name) to inbound/outbound and resolved CService\n-    std::map<CService, bool> mapConnected;\n+    std::map<CNetAddr, bool> mapConnected;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1323598562",
      "id" : 1323598562,
      "line" : 2778,
      "node_id" : "PRRC_kwDOABII585O5ILi",
      "original_commit_id" : "54804cba858b614462b21e20dac088b2e7740e11",
      "original_line" : 2737,
      "original_position" : 5,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 215,
      "pull_request_review_id" : 1623186191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323598562/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T22:13:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323598562",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1323646824"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323646824"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Similar question here: Could this make some local network setups no longer viable? Probably no one should mainnet for those if it's just for testing, but possibly some setups with multiple nodes sharing the same IP exist?",
      "commit_id" : "a4887e4d7db8d247d118155360d435c34cb0adb9",
      "created_at" : "2023-09-12T22:05:39Z",
      "diff_hunk" : "@@ -1814,6 +1814,16 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\n     }\n \n     const bool inbound_onion = std::find(m_onion_binds.begin(), m_onion_binds.end(), addr_bind) != m_onion_binds.end();\n+\n+    // Don't accept inbound connections from peers already connected to us.\n+    // Skip this check for Tor, as their inbound/outbound addresses differ.\n+    if (!inbound_onion) {\n+        if (auto pnode = AlreadyConnectedToAddress(addr)) {",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/28248#discussion_r1323646824",
      "id" : 1323646824,
      "line" : 1824,
      "node_id" : "PRRC_kwDOABII585O5T9o",
      "original_commit_id" : "b97cfd18da8ad4e29319b8e3c84c3388cd75ff60",
      "original_line" : 1821,
      "original_position" : 8,
      "original_start_line" : null,
      "path" : "src/net.cpp",
      "position" : 106,
      "pull_request_review_id" : 1623186191,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/28248",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323646824/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2023-09-12T22:22:35Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323646824",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48763452?v=4",
         "events_url" : "https://api.github.com/users/mzumsande/events{/privacy}",
         "followers_url" : "https://api.github.com/users/mzumsande/followers",
         "following_url" : "https://api.github.com/users/mzumsande/following{/other_user}",
         "gists_url" : "https://api.github.com/users/mzumsande/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/mzumsande",
         "id" : 48763452,
         "login" : "mzumsande",
         "node_id" : "MDQ6VXNlcjQ4NzYzNDUy",
         "organizations_url" : "https://api.github.com/users/mzumsande/orgs",
         "received_events_url" : "https://api.github.com/users/mzumsande/received_events",
         "repos_url" : "https://api.github.com/users/mzumsande/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/mzumsande/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/mzumsande/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/mzumsande"
      }
   }
]
