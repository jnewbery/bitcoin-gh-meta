[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30272).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/30272#pullrequestreview-2126011000) |\n| Concept ACK | [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/30272#pullrequestreview-2116107521), [theStack](https://github.com/bitcoin/bitcoin/pull/30272#issuecomment-2176371825) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30239](https://github.com/bitcoin/bitcoin/pull/30239) (Ephemeral Anchors, take 2 by instagibbs)\n* [#30079](https://github.com/bitcoin/bitcoin/pull/30079) (Fee Estimation: Ignore all transactions that are CPFP'd by ismaelsadeeq)\n* [#28676](https://github.com/bitcoin/bitcoin/pull/28676) ([WIP] Cluster mempool implementation by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-06-12T14:00:51Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#issuecomment-2163088578",
      "id" : 2163088578,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30272",
      "node_id" : "IC_kwDOABII586A7hzC",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2163088578/reactions"
      },
      "updated_at" : "2024-06-18T18:09:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2163088578",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-06-17T21:14:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#issuecomment-2174435827",
      "id" : 2174435827,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30272",
      "node_id" : "IC_kwDOABII586Bm0Hz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2174435827/reactions"
      },
      "updated_at" : "2024-06-17T21:14:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2174435827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK ð ",
      "created_at" : "2024-06-18T15:21:57Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#issuecomment-2176371825",
      "id" : 2176371825,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30272",
      "node_id" : "IC_kwDOABII586BuMxx",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2176371825/reactions"
      },
      "updated_at" : "2024-06-18T15:21:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2176371825",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/91535?v=4",
         "events_url" : "https://api.github.com/users/theStack/events{/privacy}",
         "followers_url" : "https://api.github.com/users/theStack/followers",
         "following_url" : "https://api.github.com/users/theStack/following{/other_user}",
         "gists_url" : "https://api.github.com/users/theStack/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/theStack",
         "id" : 91535,
         "login" : "theStack",
         "node_id" : "MDQ6VXNlcjkxNTM1",
         "organizations_url" : "https://api.github.com/users/theStack/orgs",
         "received_events_url" : "https://api.github.com/users/theStack/received_events",
         "repos_url" : "https://api.github.com/users/theStack/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/theStack/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/theStack/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/theStack"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1644761817"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644761817"
         }
      },
      "author_association" : "MEMBER",
      "body" : "could directly link the BIP here: https://github.com/bitcoin/bips/blob/master/bip-0431.mediawiki",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-18T16:33:51Z",
      "diff_hunk" : "@@ -0,0 +1,10 @@\n+Mempool Policy Changes\n+----------------------\n+\n+- Transactions with version number set to 3 are now treated as standard on all networks (#29496),\n+  subject to Opt-in Topologically Restricted Until Confirmation (TRUC) Transactions policy as\n+  described in BIP 431.  The policy includes limits on spending unconfirmed outputs (#28948), eviction",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1644761817",
      "id" : 1644761817,
      "line" : 6,
      "node_id" : "PRRC_kwDOABII585iCRLZ",
      "original_commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "original_line" : 6,
      "original_position" : 6,
      "original_start_line" : null,
      "path" : "doc/release-notes-29496.md",
      "position" : 6,
      "pull_request_review_id" : 2126011000,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644761817/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-18T16:36:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1644761817",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "cc @murchandamus @ismaelsadeeq since you suggested the doc changes",
      "created_at" : "2024-06-19T08:58:55Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#issuecomment-2178143370",
      "id" : 2178143370,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30272",
      "node_id" : "IC_kwDOABII586B09SK",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178143370/reactions"
      },
      "updated_at" : "2024-06-19T08:58:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2178143370",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646688833"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646688833"
         }
      },
      "author_association" : "MEMBER",
      "body" : "nit: the v3 mentions in debug strings should be explicitly stated as version=3 for clarity.\r\nhere and other places\r\n```suggestion\r\n            return std::make_pair(strprintf(\"version=3 child tx %s (wtxid=%s) is too big: %u > %u virtual bytes\",\r\n```",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-19T21:07:06Z",
      "diff_hunk" : "@@ -203,7 +203,7 @@ std::optional<std::pair<std::string, CTransactionRef>> SingleV3Checks(const CTra\n \n     // Remaining checks only pertain to transactions with unconfirmed ancestors.\n     if (mempool_ancestors.size() > 0) {\n-        // If this transaction spends V3 parents, it cannot be too large.\n+        // If this transaction spends TRUC parents, it cannot be too large.\n         if (vsize > V3_CHILD_MAX_VSIZE) {\n             return std::make_pair(strprintf(\"v3 child tx %s (wtxid=%s) is too big: %u > %u virtual bytes\",",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646688833",
      "id" : 1646688833,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII585iJnpB",
      "original_commit_id" : "f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06",
      "original_line" : 208,
      "original_position" : 52,
      "original_start_line" : null,
      "path" : "src/policy/truc_policy.cpp",
      "position" : 150,
      "pull_request_review_id" : 2129042349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646688833/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T21:37:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646688833",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646693859"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646693859"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06\r\nHere are a couple of places that were not replaced\r\n```diff\r\ndiff --git a/src/policy/truc_policy.h b/src/policy/truc_policy.h\r\nindex d1e65806cc0..37a445bcc14 100644\r\n--- a/src/policy/truc_policy.h\r\n+++ b/src/policy/truc_policy.h\r\n@@ -23,18 +23,18 @@ static constexpr decltype(CTransaction::version) TRUC_VERSION{3};\r\n // of 2 and ancestor set size of 2.\r\n /** Maximum number of transactions including an unconfirmed tx and its descendants. */\r\n static constexpr unsigned int TRUC_DESCENDANT_LIMIT{2};\r\n-/** Maximum number of transactions including a V3 tx and all its mempool ancestors. */\r\n+/** Maximum number of transactions including a TRUC tx and all its mempool ancestors. */\r\n static constexpr unsigned int TRUC_ANCESTOR_LIMIT{2};\r\n \r\n-/** Maximum sigop-adjusted virtual size of all v3 transactions. */\r\n+/** Maximum sigop-adjusted virtual size of all TRUC transactions. */\r\n static constexpr int64_t TRUC_MAX_VSIZE{10000};\r\n-/** Maximum sigop-adjusted virtual size of a tx which spends from an unconfirmed v3 \r\ntransaction. */\r\n+/** Maximum sigop-adjusted virtual size of a tx which spends from an unconfirmed TRU\r\nC transaction. */\r\n static constexpr int64_t TRUC_CHILD_MAX_VSIZE{1000};\r\n // These limits are within the default ancestor/descendant limits.\r\n static_assert(TRUC_MAX_VSIZE + TRUC_CHILD_MAX_VSIZE <= DEFAULT_ANCESTOR_SIZE_LIMIT_K\r\nVB * 1000);\r\n static_assert(TRUC_MAX_VSIZE + TRUC_CHILD_MAX_VSIZE <= DEFAULT_DESCENDANT_SIZE_LIMIT\r\n_KVB * 1000);\r\n \r\n-/** Must be called for every transaction, even if not v3. Not strictly necessary for\r\n transactions\r\n+/** Must be called for every transaction, even if not TRUC. Not strictly necessary f\r\nor transactions\r\n  * accepted through AcceptMultipleTransactions.\r\n  *\r\n  * Checks the following rules:\r\ndiff --git a/src/test/fuzz/package_eval.cpp b/src/test/fuzz/package_eval.cpp\r\nindex ecacfed58ed..71f72847dd4 100644\r\n--- a/src/test/fuzz/package_eval.cpp\r\n+++ b/src/test/fuzz/package_eval.cpp\r\n@@ -225,7 +225,7 @@ FUZZ_TARGET(tx_package_eval, .init = initialize_tx_pool)\r\n                     tx_mut.vin.emplace_back();\r\n                 }\r\n \r\n-                // Make a p2pk output to make sigops adjusted vsize to violate v3, p\r\notentially, which is never spent\r\n+                // Make a p2pk output to make sigops adjusted vsize to violate TRUC,\r\n potentially, which is never spent\r\n                 if (last_tx && amount_in > 1000 && fuzzed_data_provider.ConsumeBool(\r\n)) {\r\n                     tx_mut.vout.emplace_back(1000, CScript() << std::vector<unsigned\r\n char>(33, 0x02) << OP_CHECKSIG);\r\n                     // Don't add any other outputs.\r\ndiff --git a/src/test/util/txmempool.cpp b/src/test/util/txmempool.cpp\r\nindex 1153df4ade7..37cd0de5d2a 100644\r\n--- a/src/test/util/txmempool.cpp\r\n+++ b/src/test/util/txmempool.cpp\r\n@@ -150,7 +150,7 @@ void CheckMempoolV3Invariants(const CTxMemPool& tx_pool)\r\n             // Check that special maximum virtual size is respected\r\n             Assert(entry.GetTxSize() <= TRUC_MAX_VSIZE);\r\n \r\n-            // Check that special v3 ancestor/descendant limits and rules are always\r\n respected\r\n+            // Check that special TRUC ancestor/descendant limits and rules are alwa\r\nys respected\r\n             Assert(entry.GetCountWithDescendants() <= TRUC_DESCENDANT_LIMIT);\r\n             Assert(entry.GetCountWithAncestors() <= TRUC_ANCESTOR_LIMIT);\r\n             Assert(entry.GetSizeWithDescendants() <= TRUC_MAX_VSIZE + TRUC_CHILD_MAX\r\n_VSIZE);\r\n@@ -159,12 +159,12 @@ void CheckMempoolV3Invariants(const CTxMemPool& tx_pool)\r\n             // If this transaction has at least 1 ancestor, it's a \"child\" and has r\r\nestricted weight.\r\n             if (entry.GetCountWithAncestors() > 1) {\r\n                 Assert(entry.GetTxSize() <= TRUC_CHILD_MAX_VSIZE);\r\n-                // All v3 transactions must only have v3 unconfirmed parents.\r\n+                // All TRUC transactions must only have TRUC unconfirmed parents.\r\n                 const auto& parents = entry.GetMemPoolParentsConst();\r\n                 Assert(parents.begin()->get().GetSharedTx()->version == TRUC_VERSION\r\n);\r\n             }\r\n         } else if (entry.GetCountWithAncestors() > 1) {\r\n-            // All non-v3 transactions must only have non-v3 unconfirmed parents.\r\n+            // All non-TRUC transactions must only have non-TRUC unconfirmed parents\r\n.\r\n             for (const auto& parent : entry.GetMemPoolParentsConst()) {\r\n                 Assert(parent.get().GetSharedTx()->version != TRUC_VERSION);\r\n             }\r\ndiff --git a/src/test/util/txmempool.h b/src/test/util/txmempool.h\r\nindex 9986cabf7e9..57027cc0e62 100644\r\n--- a/src/test/util/txmempool.h\r\n+++ b/src/test/util/txmempool.h\r\n@@ -47,12 +47,12 @@ std::optional<std::string>  CheckPackageMempoolAcceptResult(const\r\n Package& txns,\r\n                                                             bool expect_valid,\r\n                                                             const CTxMemPool* mempoo\r\nl);\r\n \r\n-/** For every transaction in tx_pool, check v3 invariants:\r\n- * - a v3 tx's ancestor count must be within V3_ANCESTOR_LIMIT\r\n- * - a v3 tx's descendant count must be within V3_DESCENDANT_LIMIT\r\n- * - if a v3 tx has ancestors, its sigop-adjusted vsize must be within V3_CHILD_MA\r\nX_VSIZE\r\n- * - any non-v3 tx must only have non-v3 parents\r\n- * - any v3 tx must only have v3 parents\r\n+/** For every transaction in tx_pool, check TRUC invariants:\r\n+ * - a TRUC tx's ancestor count must be within V3_ANCESTOR_LIMIT\r\n+ * - a TRUC tx's descendant count must be within V3_DESCENDANT_LIMIT\r\n+ * - if a TRUC tx has ancestors, its sigop-adjusted vsize must be within V3_CHILD_\r\nMAX_VSIZE\r\n+ * - any non-TRUC tx must only have non-TRUC parents\r\n+ * - any TRUC tx must only have TRUC parents\r\n  *   */\r\n void CheckMempoolV3Invariants(const CTxMemPool& tx_pool);\r\n \r\n```",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-19T21:16:02Z",
      "diff_hunk" : "@@ -15,11 +15,12 @@\n #include <set>",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646693859",
      "id" : 1646693859,
      "line" : 15,
      "node_id" : "PRRC_kwDOABII585iJo3j",
      "original_commit_id" : "f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06",
      "original_line" : 15,
      "original_position" : 1,
      "original_start_line" : null,
      "path" : "src/policy/truc_policy.h",
      "position" : 15,
      "pull_request_review_id" : 2129042349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646693859/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T21:37:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646693859",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646698050"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646698050"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06\r\n\r\nThis left out v3 mentions in the unit tests, maybe just leave out just the variable names as you stated from PR description.",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-19T21:24:43Z",
      "diff_hunk" : "@@ -15,11 +15,12 @@\n #include <set>\n #include <string>\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646698050",
      "id" : 1646698050,
      "line" : 17,
      "node_id" : "PRRC_kwDOABII585iJp5C",
      "original_commit_id" : "f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06",
      "original_line" : 17,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/policy/truc_policy.h",
      "position" : 17,
      "pull_request_review_id" : 2129042349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646698050/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T21:37:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646698050",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646699035"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646699035"
         }
      },
      "author_association" : "MEMBER",
      "body" : "In 8994c2b4e307cf63ed717b68cf5b8adb47f53cd1\r\nAdd `CheckMempoolV3Invariants` also?",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-19T21:26:33Z",
      "diff_hunk" : "@@ -14,7 +14,7 @@\n #include <numeric>\n #include <vector>\n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646699035",
      "id" : 1646699035,
      "line" : 16,
      "node_id" : "PRRC_kwDOABII585iJqIb",
      "original_commit_id" : "8994c2b4e307cf63ed717b68cf5b8adb47f53cd1",
      "original_line" : 16,
      "original_position" : 3,
      "original_start_line" : null,
      "path" : "src/policy/truc_policy.cpp",
      "position" : 12,
      "pull_request_review_id" : 2129042349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646699035/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T21:38:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646699035",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646705728"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646705728"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Maybe update `test/functional/wallet_create_tx.py` test.\r\n\r\nsee https://github.com/bitcoin/bitcoin/commit/d3fa531e67c0af77f52e754ad47a8396f2cab4c4, if it makes sense feel free to cherry-pick",
      "commit_id" : "a6821a0a4e1cf2aba679962289f4beeefd3d539a",
      "created_at" : "2024-06-19T21:37:04Z",
      "diff_hunk" : "@@ -644,4 +644,4 @@ def run_test(self):\n \n ",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30272#discussion_r1646705728",
      "id" : 1646705728,
      "line" : 645,
      "node_id" : "PRRC_kwDOABII585iJrxA",
      "original_commit_id" : "f5b26e5b9be41cdab6e75aa0a3fbbb765a96ed06",
      "original_line" : 645,
      "original_position" : 307,
      "original_start_line" : null,
      "path" : "test/functional/mempool_accept_v3.py",
      "position" : 340,
      "pull_request_review_id" : 2129042349,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30272",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646705728/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-19T21:37:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646705728",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   }
]
