[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30237).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/30237#pullrequestreview-2102010028), [glozow](https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2154575591) |\n| Stale ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/30237#pullrequestreview-2122540242) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n",
      "created_at" : "2024-06-06T11:17:31Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2152083948",
      "id" : 2152083948,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586ARjHs",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2152083948/reactions"
      },
      "updated_at" : "2024-06-18T22:09:59Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2152083948",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/25888431395</sub>",
      "created_at" : "2024-06-06T12:08:36Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2152248477",
      "id" : 2152248477,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586ASLSd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2152248477/reactions"
      },
      "updated_at" : "2024-06-06T12:08:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2152248477",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1629573202"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629573202"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think another useful case is a transaction that's *also* in your mempool",
      "commit_id" : "4c99301220ab44e98d0d0e1cc8d774d96a25b7aa",
      "created_at" : "2024-06-06T13:40:49Z",
      "diff_hunk" : "@@ -302,6 +303,51 @@ BOOST_AUTO_TEST_CASE(EmptyBlockRoundTripTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ReceiveWithExtraTransactions) {\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    TestMemPoolEntryHelper entry;\n+    const CBlock block(BuildBlockTestCase());\n+    std::vector<CTransactionRef> extra_txn;\n+    extra_txn.resize(10);\n+\n+    CMutableTransaction mtx = BuildTransactionTestCase();\n+    mtx.vin[0].prevout.hash = Txid::FromUint256(InsecureRand256());\n+    mtx.vin[0].prevout.n = 0;\n+    const CTransactionRef non_block_tx = MakeTransactionRef(std::move(mtx));\n+\n+    LOCK2(cs_main, pool.cs);\n+    pool.addUnchecked(entry.FromTx(block.vtx[2]));\n+    BOOST_CHECK_EQUAL(pool.get(block.vtx[2]->GetHash()).use_count(), SHARED_TX_OFFSET + 0);\n+    // Ensure the non_block_tx is actually not in the block\n+    for (const auto &block_tx : block.vtx) {\n+        BOOST_CHECK_NE(block_tx->GetHash(), non_block_tx->GetHash());\n+    }\n+    // Ensure block.vtx[1] is not in pool\n+    BOOST_CHECK_EQUAL(pool.get(block.vtx[1]->GetHash()), nullptr);\n+\n+    {\n+        const CBlockHeaderAndShortTxIDs cmpctblock{block};\n+        PartiallyDownloadedBlock partial_block(&pool);\n+        PartiallyDownloadedBlock partial_block_with_extra(&pool);\n+\n+        BOOST_CHECK(partial_block.InitData(cmpctblock, extra_txn) == READ_STATUS_OK);\n+        BOOST_CHECK( partial_block.IsTxAvailable(0));\n+        BOOST_CHECK(!partial_block.IsTxAvailable(1));\n+        BOOST_CHECK( partial_block.IsTxAvailable(2));\n+\n+        // Add an unrelated tx to extra_txn:\n+        extra_txn[0] = non_block_tx;\n+        // and a tx from the block that's not in the mempool:\n+        extra_txn[1] = block.vtx[1];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1629573202",
      "id" : 1629573202,
      "line" : 341,
      "node_id" : "PRRC_kwDOABII585hIVBS",
      "original_commit_id" : "4c99301220ab44e98d0d0e1cc8d774d96a25b7aa",
      "original_line" : 341,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/blockencodings_tests.cpp",
      "position" : 73,
      "pull_request_review_id" : 2102010028,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629573202/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-06T13:40:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629573202",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/5767891?v=4",
         "events_url" : "https://api.github.com/users/instagibbs/events{/privacy}",
         "followers_url" : "https://api.github.com/users/instagibbs/followers",
         "following_url" : "https://api.github.com/users/instagibbs/following{/other_user}",
         "gists_url" : "https://api.github.com/users/instagibbs/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/instagibbs",
         "id" : 5767891,
         "login" : "instagibbs",
         "node_id" : "MDQ6VXNlcjU3Njc4OTE=",
         "organizations_url" : "https://api.github.com/users/instagibbs/orgs",
         "received_events_url" : "https://api.github.com/users/instagibbs/received_events",
         "repos_url" : "https://api.github.com/users/instagibbs/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/instagibbs/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/instagibbs"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1629620484"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629620484"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "L325 has `pool.addUnchecked(entry.FromTx(block.vtx[2]));` which adds a tx from the block to the mempool, giving `.IsTxAvailable(2)` (`.IsTxAvailable(0)` should always be true as that's the coinbase [which is in the compact block header](https://github.com/bitcoin/bitcoin/blob/1040a1fc807ed984020eeaa6e90b5bf070b61b05/src/blockencodings.cpp#L25), IIUC).\r\n\r\n`SimpleRoundTripTest` and a couple others in here also already covered the add to mempool case.",
      "commit_id" : "bba77a2b540a22f95204db3bc3bf6c723fcca47c",
      "created_at" : "2024-06-06T14:05:00Z",
      "diff_hunk" : "@@ -302,6 +303,51 @@ BOOST_AUTO_TEST_CASE(EmptyBlockRoundTripTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ReceiveWithExtraTransactions) {\n+    CTxMemPool& pool = *Assert(m_node.mempool);\n+    TestMemPoolEntryHelper entry;\n+    const CBlock block(BuildBlockTestCase());\n+    std::vector<CTransactionRef> extra_txn;\n+    extra_txn.resize(10);\n+\n+    CMutableTransaction mtx = BuildTransactionTestCase();\n+    mtx.vin[0].prevout.hash = Txid::FromUint256(InsecureRand256());\n+    mtx.vin[0].prevout.n = 0;\n+    const CTransactionRef non_block_tx = MakeTransactionRef(std::move(mtx));\n+\n+    LOCK2(cs_main, pool.cs);\n+    pool.addUnchecked(entry.FromTx(block.vtx[2]));\n+    BOOST_CHECK_EQUAL(pool.get(block.vtx[2]->GetHash()).use_count(), SHARED_TX_OFFSET + 0);\n+    // Ensure the non_block_tx is actually not in the block\n+    for (const auto &block_tx : block.vtx) {\n+        BOOST_CHECK_NE(block_tx->GetHash(), non_block_tx->GetHash());\n+    }\n+    // Ensure block.vtx[1] is not in pool\n+    BOOST_CHECK_EQUAL(pool.get(block.vtx[1]->GetHash()), nullptr);\n+\n+    {\n+        const CBlockHeaderAndShortTxIDs cmpctblock{block};\n+        PartiallyDownloadedBlock partial_block(&pool);\n+        PartiallyDownloadedBlock partial_block_with_extra(&pool);\n+\n+        BOOST_CHECK(partial_block.InitData(cmpctblock, extra_txn) == READ_STATUS_OK);\n+        BOOST_CHECK( partial_block.IsTxAvailable(0));\n+        BOOST_CHECK(!partial_block.IsTxAvailable(1));\n+        BOOST_CHECK( partial_block.IsTxAvailable(2));\n+\n+        // Add an unrelated tx to extra_txn:\n+        extra_txn[0] = non_block_tx;\n+        // and a tx from the block that's not in the mempool:\n+        extra_txn[1] = block.vtx[1];",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1629620484",
      "id" : 1629620484,
      "in_reply_to_id" : 1629573202,
      "line" : 347,
      "node_id" : "PRRC_kwDOABII585hIgkE",
      "original_commit_id" : "4c99301220ab44e98d0d0e1cc8d774d96a25b7aa",
      "original_line" : 341,
      "original_position" : 73,
      "original_start_line" : null,
      "path" : "src/test/blockencodings_tests.cpp",
      "position" : 218,
      "pull_request_review_id" : 2102087579,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629620484/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-18T22:11:52Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1629620484",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : " > Not sure if that is worth addressing since it's so rare but perhaps simply adding a comment that the test might fail every 2^48 runs is good?\r\n\r\nI think it's worth avoiding, I don't really like the notion of flaky tests maybe failing for a random reason, even if it is very improbable. I'd guess short-ID collisions would also affect some of the other existing tests in here so there's additional benefit in them not being flaky too.",
      "created_at" : "2024-06-07T07:51:48Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2154290717",
      "id" : 2154290717,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586AZ94d",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154290717/reactions"
      },
      "updated_at" : "2024-06-07T07:51:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154290717",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Concept ACK\r\n\r\n> > Not sure if that is worth addressing since it's so rare but perhaps simply adding a comment that the test might fail every 2^48 runs is good?\r\n> \r\n> I think it's worth avoiding, I don't really like the notion of flaky tests maybe failing for a random reason, even if it is very improbable. I'd guess short-ID collisions would also affect some of the other existing tests in here so there's additional benefit in them not being flaky too.\r\n\r\nNot sure exactly how flaky it is and don't want to blow this out of proportion. Comment sounds good to save a future debugger from headache. If we might hit it, you can knock it down closer to 0 by running it e.g. 5 times and asserting that it doesn't fail every time, like in coinselector_tests:\r\nhttps://github.com/bitcoin/bitcoin/blob/4a020ca443ba370bf41583962d16aa8551876f53/src/wallet/test/coinselector_tests.cpp#L752-L777",
      "created_at" : "2024-06-07T10:42:27Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2154575591",
      "id" : 2154575591,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586AbDbn",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154575591/reactions"
      },
      "updated_at" : "2024-06-07T10:42:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154575591",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Would it be difficult to make the test deterministic?",
      "created_at" : "2024-06-07T13:24:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2154833376",
      "id" : 2154833376,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586AcCXg",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154833376/reactions"
      },
      "updated_at" : "2024-06-07T13:24:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154833376",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> Would it be difficult to make the test deterministic?\r\n\r\nYes, the straightforward way would be to replace the `InsecureRand256()` with fixed hashes that don't result in transaction short IDs that collide. Less-straightforward but maybe better would be to keep using random hashes but check for a short ID collision and try again with a different random hash until the collision is gone -- or start with one random hash and change it in a way that guarantees the short ID (siphash) will be different, but I'm not sure if siphash is easily 'attackable' in that sense.",
      "created_at" : "2024-06-12T08:54:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2162468751",
      "id" : 2162468751,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586A5KeP",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2162468751/reactions"
      },
      "updated_at" : "2024-06-12T08:54:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2162468751",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> `InsecureRand256`\r\n\r\nI'd say longer them those global non-deterministic functions should go away anyway. Not something you need to do here, but if you want you can create a commit to accept a FastRandomContext reference as param to `BuildBlockTestCase`, then in each unit test, create a local FastRandomContext and bind it to a lambda named `BuildBlockTestCase`. ",
      "created_at" : "2024-06-12T09:01:06Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2162486216",
      "id" : 2162486216,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586A5OvI",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 2,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 2,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2162486216/reactions"
      },
      "updated_at" : "2024-06-12T09:01:06Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2162486216",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6399679?v=4",
         "events_url" : "https://api.github.com/users/maflcko/events{/privacy}",
         "followers_url" : "https://api.github.com/users/maflcko/followers",
         "following_url" : "https://api.github.com/users/maflcko/following{/other_user}",
         "gists_url" : "https://api.github.com/users/maflcko/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/maflcko",
         "id" : 6399679,
         "login" : "maflcko",
         "node_id" : "MDQ6VXNlcjYzOTk2Nzk=",
         "organizations_url" : "https://api.github.com/users/maflcko/orgs",
         "received_events_url" : "https://api.github.com/users/maflcko/received_events",
         "repos_url" : "https://api.github.com/users/maflcko/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/maflcko/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/maflcko/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/maflcko"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Pushed 09b90c6 which makes the tests deterministic by using predictable 'random' numbers. I've jsut picked them, there's nothing particularly special about their values.\r\n\r\nUsing this to reproduce the issue @dergoegge pointed out:\r\n\r\n```patch\r\ndiff --git a/src/blockencodings.cpp b/src/blockencodings.cpp\r\nindex 695e8d806a..64d635a97a 100644\r\n--- a/src/blockencodings.cpp\r\n+++ b/src/blockencodings.cpp\r\n@@ -44,7 +44,8 @@ void CBlockHeaderAndShortTxIDs::FillShortTxIDSelector() const {\r\n\r\n uint64_t CBlockHeaderAndShortTxIDs::GetShortID(const Wtxid& wtxid) const {\r\n     static_assert(SHORTTXIDS_LENGTH == 6, \"shorttxids calculation assumes 6-byte shorttxids\");\r\n-    return SipHashUint256(shorttxidk0, shorttxidk1, wtxid) & 0xffffffffffffL;\r\n+    // return SipHashUint256(shorttxidk0, shorttxidk1, wtxid) & 0xffffffffffffL;\r\n+    return SipHashUint256(shorttxidk0, shorttxidk1, wtxid) & 0x0f;\r\n }\r\n\r\n\r\n\r\n```\r\n\r\nand then running\r\n\r\n```shell\r\nset -e;\r\nn=0;\r\nwhile (( n++ < 5000 )); do\r\n    src/test/test_bitcoin --run_test=blockencodings_tests;\r\ndone\r\n```\r\n\r\nthe failures were either `READ_STATUS_FAILED` from `InitData`, or `IsTxAvailable(...) == false` when we were expecting `true`.\r\n\r\nOn the above-patched 09b90c6, I've not seen any failures with `0x0f` short IDs and ~10k re-runs of all the blockencodings tests.\r\n\r\n * Use a new `FastRandomContext` with a fixed seed in each test, to ensure 'random' uint256s used as fake prevouts are deterministic, so in-turn test txids and short IDs are deterministic and don't collide causing very rare but flaky test failures.\r\n * Add new test-only/internal initializer for `CBlockHeaderAndShortTxIDs` that takes a specified nonce to further ensure determinism and avoid rare but undesireable short ID collisions.\r\n   In a test context this nonce is set to a fixed known-good value. Normally it is random, as previously.",
      "created_at" : "2024-06-12T21:36:20Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2163943260",
      "id" : 2163943260,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586A-ydc",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2163943260/reactions"
      },
      "updated_at" : "2024-06-12T21:55:26Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2163943260",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1642694693"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642694693"
         }
      },
      "author_association" : "MEMBER",
      "body" : "What about always requiring a `FastRandomContext` and getting a `rand64()` for the nonce that way? peerman would pass in its own `m_rng. Making the rng a param feels preferable to adding a test-only version of the ctor.",
      "commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "created_at" : "2024-06-17T11:53:54Z",
      "diff_hunk" : "@@ -109,6 +109,9 @@ class CBlockHeaderAndShortTxIDs {\n     // Dummy for deserialization\n     CBlockHeaderAndShortTxIDs() {}\n \n+    // Unsafe init with fixed nonce for testing/internal-use only\n+    CBlockHeaderAndShortTxIDs(const CBlock& block, const uint64_t nonce);\n+\n     CBlockHeaderAndShortTxIDs(const CBlock& block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1642694693",
      "id" : 1642694693,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585h6Ygl",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 115,
      "original_position" : 7,
      "original_start_line" : 112,
      "path" : "src/blockencodings.h",
      "position" : 7,
      "pull_request_review_id" : 2122703071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642694693/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 112,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-17T11:58:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642694693",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1642697581"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642697581"
         }
      },
      "author_association" : "MEMBER",
      "body" : "really not a fan of these magic numbers, would prefer `rand_ctx.rand64()`",
      "commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "created_at" : "2024-06-17T11:56:33Z",
      "diff_hunk" : "@@ -282,7 +286,7 @@ BOOST_AUTO_TEST_CASE(EmptyBlockRoundTripTest)\n \n     // Test simple header round-trip with only coinbase\n     {\n-        CBlockHeaderAndShortTxIDs shortIDs{block};\n+        CBlockHeaderAndShortTxIDs shortIDs{block, 1341};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1642697581",
      "id" : 1642697581,
      "line" : 289,
      "node_id" : "PRRC_kwDOABII585h6ZNt",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 289,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/test/blockencodings_tests.cpp",
      "position" : 94,
      "pull_request_review_id" : 2122703071,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642697581/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-17T11:58:22Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642697581",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/25183001?v=4",
         "events_url" : "https://api.github.com/users/glozow/events{/privacy}",
         "followers_url" : "https://api.github.com/users/glozow/followers",
         "following_url" : "https://api.github.com/users/glozow/following{/other_user}",
         "gists_url" : "https://api.github.com/users/glozow/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/glozow",
         "id" : 25183001,
         "login" : "glozow",
         "node_id" : "MDQ6VXNlcjI1MTgzMDAx",
         "organizations_url" : "https://api.github.com/users/glozow/orgs",
         "received_events_url" : "https://api.github.com/users/glozow/received_events",
         "repos_url" : "https://api.github.com/users/glozow/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/glozow/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/glozow/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/glozow"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1643388352"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388352"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I think that should be OK, assuming it doesn't happen to hit a case where there's a short-ID collision",
      "commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "created_at" : "2024-06-17T20:19:47Z",
      "diff_hunk" : "@@ -282,7 +286,7 @@ BOOST_AUTO_TEST_CASE(EmptyBlockRoundTripTest)\n \n     // Test simple header round-trip with only coinbase\n     {\n-        CBlockHeaderAndShortTxIDs shortIDs{block};\n+        CBlockHeaderAndShortTxIDs shortIDs{block, 1341};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1643388352",
      "id" : 1643388352,
      "in_reply_to_id" : 1642697581,
      "line" : 289,
      "node_id" : "PRRC_kwDOABII585h9B3A",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 289,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/test/blockencodings_tests.cpp",
      "position" : 94,
      "pull_request_review_id" : 2123833492,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388352/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-17T20:19:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388352",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1643388594"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388594"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Sure, seems sensible to me",
      "commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "created_at" : "2024-06-17T20:20:02Z",
      "diff_hunk" : "@@ -109,6 +109,9 @@ class CBlockHeaderAndShortTxIDs {\n     // Dummy for deserialization\n     CBlockHeaderAndShortTxIDs() {}\n \n+    // Unsafe init with fixed nonce for testing/internal-use only\n+    CBlockHeaderAndShortTxIDs(const CBlock& block, const uint64_t nonce);\n+\n     CBlockHeaderAndShortTxIDs(const CBlock& block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1643388594",
      "id" : 1643388594,
      "in_reply_to_id" : 1642694693,
      "line" : 115,
      "node_id" : "PRRC_kwDOABII585h9B6y",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 115,
      "original_position" : 7,
      "original_start_line" : 112,
      "path" : "src/blockencodings.h",
      "position" : 7,
      "pull_request_review_id" : 2123833924,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388594/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 112,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-17T20:20:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1643388594",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1645152984"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645152984"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed in bba77a2",
      "commit_id" : "bba77a2b540a22f95204db3bc3bf6c723fcca47c",
      "created_at" : "2024-06-18T22:10:15Z",
      "diff_hunk" : "@@ -282,7 +286,7 @@ BOOST_AUTO_TEST_CASE(EmptyBlockRoundTripTest)\n \n     // Test simple header round-trip with only coinbase\n     {\n-        CBlockHeaderAndShortTxIDs shortIDs{block};\n+        CBlockHeaderAndShortTxIDs shortIDs{block, 1341};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1645152984",
      "id" : 1645152984,
      "in_reply_to_id" : 1642697581,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iDwrY",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 289,
      "original_position" : 94,
      "original_start_line" : null,
      "path" : "src/test/blockencodings_tests.cpp",
      "position" : null,
      "pull_request_review_id" : 2126640019,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645152984/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-18T22:15:42Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645152984",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1645153389"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645153389"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Addressed in bba77a2 -- though I've kept it as passing in a `uint64_t nonce`, as then it doesn't \"impose\" how you got the nonce; in peerman, `m_rng` has locks guarding it, so using `GetRand<uint64_t>()` is easier (and claims to be threadsafe), plus this matches the previous behaviour where the `CBlockHeaderAndShortTxIDs` constructor would just call `GetRand` itself, rather than switching to a `FastRandomContext`",
      "commit_id" : "bba77a2b540a22f95204db3bc3bf6c723fcca47c",
      "created_at" : "2024-06-18T22:10:50Z",
      "diff_hunk" : "@@ -109,6 +109,9 @@ class CBlockHeaderAndShortTxIDs {\n     // Dummy for deserialization\n     CBlockHeaderAndShortTxIDs() {}\n \n+    // Unsafe init with fixed nonce for testing/internal-use only\n+    CBlockHeaderAndShortTxIDs(const CBlock& block, const uint64_t nonce);\n+\n     CBlockHeaderAndShortTxIDs(const CBlock& block);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1645153389",
      "id" : 1645153389,
      "in_reply_to_id" : 1642694693,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585iDwxt",
      "original_commit_id" : "09b90c69bc17ce43dce3881a208d9066a729c67d",
      "original_line" : 115,
      "original_position" : 7,
      "original_start_line" : 112,
      "path" : "src/blockencodings.h",
      "position" : null,
      "pull_request_review_id" : 2126640550,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645153389/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-19T12:25:03Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1645153389",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--85328a0da195eb286784d51f73fa0af9-->\n\nð§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/26393192395</sub>",
      "created_at" : "2024-06-18T22:15:05Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#issuecomment-2177173654",
      "id" : 2177173654,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30237",
      "node_id" : "IC_kwDOABII586BxQiW",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2177173654/reactions"
      },
      "updated_at" : "2024-06-18T22:15:05Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2177173654",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1646108157"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646108157"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "I'm not familiar with the fuzz tests so I hope this change isn't stupid/wrong?",
      "commit_id" : "bba77a2b540a22f95204db3bc3bf6c723fcca47c",
      "created_at" : "2024-06-19T12:28:53Z",
      "diff_hunk" : "@@ -50,7 +51,8 @@ FUZZ_TARGET(partially_downloaded_block, .init = initialize_pdb)\n         return;\n     }\n \n-    CBlockHeaderAndShortTxIDs cmpctblock{*block};\n+    FastRandomContext fast_random_context{ConsumeUInt256(fuzzed_data_provider)};\n+    CBlockHeaderAndShortTxIDs cmpctblock{*block, fast_random_context.rand64()};",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30237#discussion_r1646108157",
      "id" : 1646108157,
      "line" : 55,
      "node_id" : "PRRC_kwDOABII585iHZ39",
      "original_commit_id" : "bba77a2b540a22f95204db3bc3bf6c723fcca47c",
      "original_line" : 55,
      "original_position" : 14,
      "original_start_line" : 54,
      "path" : "src/test/fuzz/partially_downloaded_block.cpp",
      "position" : 14,
      "pull_request_review_id" : 2128144308,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30237",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646108157/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 54,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-19T12:28:53Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1646108157",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/1328814?v=4",
         "events_url" : "https://api.github.com/users/AngusP/events{/privacy}",
         "followers_url" : "https://api.github.com/users/AngusP/followers",
         "following_url" : "https://api.github.com/users/AngusP/following{/other_user}",
         "gists_url" : "https://api.github.com/users/AngusP/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/AngusP",
         "id" : 1328814,
         "login" : "AngusP",
         "node_id" : "MDQ6VXNlcjEzMjg4MTQ=",
         "organizations_url" : "https://api.github.com/users/AngusP/orgs",
         "received_events_url" : "https://api.github.com/users/AngusP/received_events",
         "repos_url" : "https://api.github.com/users/AngusP/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/AngusP/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/AngusP/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/AngusP"
      }
   }
]
