[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30212).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/30212#pullrequestreview-2094224853), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/30212#pullrequestreview-2103261626) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n* [#29015](https://github.com/bitcoin/bitcoin/pull/29015) (kernel: Streamline util library by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-05-31T14:03:59Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#issuecomment-2142266947",
      "id" : 2142266947,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30212",
      "node_id" : "IC_kwDOABII585_sGZD",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2142266947/reactions"
      },
      "updated_at" : "2024-06-12T22:43:54Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2142266947",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "This addresses #19363 's concern:\r\n\r\n> If a transaction is already in the block chain, and all of its outputs are spent, the BroadcastTransaction() fails to detect the correct transaction status. It returns TransactionError::MISSING_INPUTS instead of TransactionError::ALREADY_IN_CHAIN.\r\n\r\n...by now returning `TransactionError::INPUTS_MISSING_OR_SPENT`. The [translation](https://github.com/bitcoin/bitcoin/blob/62f7f59ff495fbcbfc10c25e97bb0dc032647abf/src/util/error.cpp#L19) for this error message already indicated this error may mean the inputs were missing or spent.",
      "created_at" : "2024-05-31T14:07:45Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#issuecomment-2142284206",
      "id" : 2142284206,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30212",
      "node_id" : "IC_kwDOABII585_sKmu",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2142284206/reactions"
      },
      "updated_at" : "2024-05-31T14:07:45Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2142284206",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1630291371"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630291371"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Nice, I think we should also rename the one in `TxValidationResult` enum.\r\n\r\ng/`TX_MISSING_INPUTS`/`TX_MISSING_INPUT_OR_SPENT`/g\r\nand update comments appropriately.",
      "commit_id" : "aa422bcb898b7e3aa8dca912d92016bd22cf243d",
      "created_at" : "2024-06-06T21:40:23Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ static TransactionError HandleATMPError(const TxValidationState& state, std::str\n     err_string_out = state.ToString();\n     if (state.IsInvalid()) {\n         if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n-            return TransactionError::MISSING_INPUTS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1630291371",
      "id" : 1630291371,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII585hLEWr",
      "original_commit_id" : "e9d2fd31c353e6e392d43df028685b0d1caf042d",
      "original_line" : 25,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : 4,
      "pull_request_review_id" : 2103261626,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630291371/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-07T08:48:04Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630291371",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1636456867"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1636456867"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I did consider this, but it felt much less exposed to the user, only via `testmempoolaccept` AFAIK:\r\n\r\n```cpp\r\n    result_inner.pushKV(\"reject-reason\", \"missing-inputs\");\r\n```\r\n\r\nTherefore as an \"internal error\", `TX_MISSING_INPUTS` (for any reason) it felt more accurate to me to leave as is? Very happy to be persuaded away from this viewpoint though :)",
      "commit_id" : "aa422bcb898b7e3aa8dca912d92016bd22cf243d",
      "created_at" : "2024-06-12T13:22:23Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ static TransactionError HandleATMPError(const TxValidationState& state, std::str\n     err_string_out = state.ToString();\n     if (state.IsInvalid()) {\n         if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n-            return TransactionError::MISSING_INPUTS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1636456867",
      "id" : 1636456867,
      "in_reply_to_id" : 1630291371,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII585hilmj",
      "original_commit_id" : "e9d2fd31c353e6e392d43df028685b0d1caf042d",
      "original_line" : 25,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : 4,
      "pull_request_review_id" : 2113010733,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1636456867/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-12T13:22:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1636456867",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/6606587?v=4",
         "events_url" : "https://api.github.com/users/willcl-ark/events{/privacy}",
         "followers_url" : "https://api.github.com/users/willcl-ark/followers",
         "following_url" : "https://api.github.com/users/willcl-ark/following{/other_user}",
         "gists_url" : "https://api.github.com/users/willcl-ark/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/willcl-ark",
         "id" : 6606587,
         "login" : "willcl-ark",
         "node_id" : "MDQ6VXNlcjY2MDY1ODc=",
         "organizations_url" : "https://api.github.com/users/willcl-ark/orgs",
         "received_events_url" : "https://api.github.com/users/willcl-ark/received_events",
         "repos_url" : "https://api.github.com/users/willcl-ark/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/willcl-ark/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/willcl-ark/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/willcl-ark"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-06-12T22:26:11Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#issuecomment-2164000886",
      "id" : 2164000886,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30212",
      "node_id" : "IC_kwDOABII586A_Ah2",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2164000886/reactions"
      },
      "updated_at" : "2024-06-12T22:26:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2164000886",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1638282582"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1638282582"
         }
      },
      "author_association" : "MEMBER",
      "body" : "> Therefore as an \"internal error\", TX_MISSING_INPUTS (for any reason) it felt more accurate to me to leave as is?\r\n\r\nI was reviewing this based on the PR rationale in the OP. You stated that \"a transaction's inputs are missing from the UTXO set, which could also be due to all inputs having already been spent (MISSING_INPUTS -> INPUTS_MISSING_OR_SPENT).\" That's why I suggested that `TxValidationResult` one  should be changed just for uniformity. But Internally, you're right `TX_MISSING_INPUTS` inferred or spent.\r\n\r\nMaybe just update the `testmempoolaccept` reject reason since it's user-facing?\r\n\r\nBut if you agree, you may have to update some functional tests that use it and maybe a release note since users heavily use the RPC.\r\n\r\nThis is a non blocking comment.\r\n\r\nThis PR is an improvement and will close the [issue](https://github.com/bitcoin/bitcoin/issues/19363)",
      "commit_id" : "aa422bcb898b7e3aa8dca912d92016bd22cf243d",
      "created_at" : "2024-06-13T14:05:29Z",
      "diff_hunk" : "@@ -22,7 +22,7 @@ static TransactionError HandleATMPError(const TxValidationState& state, std::str\n     err_string_out = state.ToString();\n     if (state.IsInvalid()) {\n         if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n-            return TransactionError::MISSING_INPUTS;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30212#discussion_r1638282582",
      "id" : 1638282582,
      "in_reply_to_id" : 1630291371,
      "line" : 25,
      "node_id" : "PRRC_kwDOABII585hpjVW",
      "original_commit_id" : "e9d2fd31c353e6e392d43df028685b0d1caf042d",
      "original_line" : 25,
      "original_position" : 4,
      "original_start_line" : null,
      "path" : "src/node/transaction.cpp",
      "position" : 4,
      "pull_request_review_id" : 2115911139,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30212",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1638282582/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-13T14:05:30Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1638282582",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/48946461?v=4",
         "events_url" : "https://api.github.com/users/ismaelsadeeq/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ismaelsadeeq/followers",
         "following_url" : "https://api.github.com/users/ismaelsadeeq/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ismaelsadeeq/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ismaelsadeeq",
         "id" : 48946461,
         "login" : "ismaelsadeeq",
         "node_id" : "MDQ6VXNlcjQ4OTQ2NDYx",
         "organizations_url" : "https://api.github.com/users/ismaelsadeeq/orgs",
         "received_events_url" : "https://api.github.com/users/ismaelsadeeq/received_events",
         "repos_url" : "https://api.github.com/users/ismaelsadeeq/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ismaelsadeeq/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ismaelsadeeq/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ismaelsadeeq"
      }
   }
]
