{
   "active_lock_reason" : null,
   "assignee" : null,
   "assignees" : [],
   "author_association" : "CONTRIBUTOR",
   "body" : "Right now, we have no way to quantify the \"degradation\" of an ASMap over time in the context of Bitcoin's P2P network in a meaningful way. However, such data would be useful for:\r\n1. Making sure the minimum shelf life of ASMaps is compatible with the release cycle (we wouldn't want to start shipping ASMaps with releases before making sure ASMaps typically do not become obsolete before the time of the next release)\r\n2. Node operators eager to keep their ASMaps up-to-date between releases.\r\n\r\nWhile `asmap-tool.py` has a `diff` command to perform a prefix-based comparison of two ASMaps, it is hard to reason about whether an old ASMap still is \"good enough\" or should be replaced with a newer one based on a prefix-based diff such as the following:\r\n\r\n```shell\r\n$ ./asmap-tool.py diff 1704463200_asmap.dat 1710770400_asmap.dat\r\n[...]\r\n# 2c0f:fc98::/32 was AS37282\r\n# 2c0f:fcb8::/32 was AS37323\r\n2c0f:ff18::/32 AS37044 # was unassigned\r\n2c0f:ff98::/32 AS37113 # was unassigned\r\n2c0f:ffa0::/32 AS37273 # was unassigned\r\n# 76082350 (2^26.18) IPv4 addresses changed; 834271985742505274886878979424260 (2^109.36) IPv6 addresses changed\r\n```\r\n\r\nOne option for a more Bitcoin-centric ASMap comparison comprises comparing ASNs for the addresses of Bitcoin nodes and reporting on the number/share of addresses of nodes with disagreeing ASNs. By applying this approach to a node's set of known peers, a node operator can estimate how many of the node's peers are mapped to out-of-date AS when using the currently deployed and an up-to-date ASMap as input.\r\n\r\nThis PR adds this functionality to `asmap-tool.py` by introducing a `diff_addrs` subcommand. In addition to two ASMaps, the subcommand reads addresses from a (`getnodeaddresses`-compatible) file, and computes statistics for those addresses:\r\n\r\n```bash\r\n$ ./asmap-tool.py diff_addrs 1704463200_asmap.dat 1710770400_asmap.dat <(bitcoin-cli getnodeaddresses 0)\r\n275 address(es) reassigned from unassigned to AS51167\r\n84 address(es) reassigned from AS198949 to AS15557\r\n66 address(es) reassigned from AS45758 to AS45629\r\n33 address(es) reassigned from AS174 to AS212238\r\n[...]\r\n1 address(es) reassigned from unassigned to AS399619\r\nSummary: 919 (1.67%) of 54,901 addresses were reassigned.\r\n```\r\n\r\nWhen the `-s / --show-addresses` flag is used, addresses subject to reassignment are included in the output.",
   "closed_at" : null,
   "closed_by" : null,
   "comments" : 1,
   "comments_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246/comments",
   "created_at" : "2024-06-07T12:59:52Z",
   "draft" : false,
   "events_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246/events",
   "html_url" : "https://github.com/bitcoin/bitcoin/pull/30246",
   "id" : 2340398601,
   "labels" : [
      {
         "color" : "ffffee",
         "default" : false,
         "description" : null,
         "id" : 231994551,
         "name" : "Scripts and tools",
         "node_id" : "MDU6TGFiZWwyMzE5OTQ1NTE=",
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools"
      }
   ],
   "labels_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246/labels{/name}",
   "locked" : false,
   "milestone" : null,
   "node_id" : "PR_kwDOABII585xy6w1",
   "number" : 30246,
   "performed_via_github_app" : null,
   "pull_request" : {
      "diff_url" : "https://github.com/bitcoin/bitcoin/pull/30246.diff",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30246",
      "merged_at" : null,
      "patch_url" : "https://github.com/bitcoin/bitcoin/pull/30246.patch",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30246"
   },
   "reactions" : {
      "+1" : 0,
      "-1" : 0,
      "confused" : 0,
      "eyes" : 0,
      "heart" : 0,
      "hooray" : 0,
      "laugh" : 0,
      "rocket" : 0,
      "total_count" : 0,
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246/reactions"
   },
   "repository_url" : "https://api.github.com/repos/bitcoin/bitcoin",
   "state" : "open",
   "state_reason" : null,
   "timeline_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246/timeline",
   "title" : "contrib: asmap-tool - Compare ASMaps with respect to specific addresses",
   "updated_at" : "2024-06-07T12:59:57Z",
   "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30246",
   "user" : {
      "avatar_url" : "https://avatars.githubusercontent.com/u/72414353?v=4",
      "events_url" : "https://api.github.com/users/virtu/events{/privacy}",
      "followers_url" : "https://api.github.com/users/virtu/followers",
      "following_url" : "https://api.github.com/users/virtu/following{/other_user}",
      "gists_url" : "https://api.github.com/users/virtu/gists{/gist_id}",
      "gravatar_id" : "",
      "html_url" : "https://github.com/virtu",
      "id" : 72414353,
      "login" : "virtu",
      "node_id" : "MDQ6VXNlcjcyNDE0MzUz",
      "organizations_url" : "https://api.github.com/users/virtu/orgs",
      "received_events_url" : "https://api.github.com/users/virtu/received_events",
      "repos_url" : "https://api.github.com/users/virtu/repos",
      "site_admin" : false,
      "starred_url" : "https://api.github.com/users/virtu/starred{/owner}{/repo}",
      "subscriptions_url" : "https://api.github.com/users/virtu/subscriptions",
      "type" : "User",
      "url" : "https://api.github.com/users/virtu"
   }
}
