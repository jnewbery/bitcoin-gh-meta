[
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30200).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2140862734), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/30200#pullrequestreview-2116792265) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/30200#pullrequestreview-2116692613), [tdb3](https://github.com/bitcoin/bitcoin/pull/30200#pullrequestreview-2120845152) |\n\nIf your review is incorrectly listed, please react with ð to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28843](https://github.com/bitcoin/bitcoin/pull/28843) ([refactor] Remove BlockAssembler m_mempool member by TheCharlatan)\n* [#10102](https://github.com/bitcoin/bitcoin/pull/10102) (Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "created_at" : "2024-05-30T12:34:34Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2139458980",
      "id" : 2139458980,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII585_hY2k",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2139458980/reactions"
      },
      "updated_at" : "2024-06-17T10:18:09Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2139458980",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The first commit is all the boilerplate plus a single method `isTestChain()` that's used by the `getblocktemplate` RPC.",
      "created_at" : "2024-05-30T12:35:03Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2139459750",
      "id" : 2139459750,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII585_hZCm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2139459750/reactions"
      },
      "updated_at" : "2024-05-30T12:35:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2139459750",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Let me know if I should expand the interface to cover more of `rpc/mining.cpp` or stick to this for now.",
      "created_at" : "2024-05-30T16:34:12Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2140187315",
      "id" : 2140187315,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII585_kKqz",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2140187315/reactions"
      },
      "updated_at" : "2024-05-30T16:34:12Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2140187315",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621067334"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621067334"
         }
      },
      "author_association" : "MEMBER",
      "body" : "f04cf9f75054573c204245f7bb1e6813cce1fed8: I guess I should change the `BlockAssembler` constructor",
      "commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "created_at" : "2024-05-30T16:36:58Z",
      "diff_hunk" : "@@ -854,6 +856,13 @@ class MinerImpl : public Miner\n         return TestBlockValidity(state, chainman().GetParams(), chainman().ActiveChainstate(), block, chainman().ActiveChain().Tip(), /*fCheckPOW=*/false, check_merkle_root);\n     }\n \n+    std::unique_ptr<CBlockTemplate> createNewBlock(const CScript& scriptPubKeyIn) override\n+    {\n+        LOCK(::cs_main);\n+        // TODO pass mempool sanely\n+        return BlockAssembler{chainman().ActiveChainstate(), &*(context()->mempool)}.CreateNewBlock(scriptPubKeyIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621067334",
      "id" : 1621067334,
      "line" : 873,
      "node_id" : "PRRC_kwDOABII585gn4ZG",
      "original_commit_id" : "f04cf9f75054573c204245f7bb1e6813cce1fed8",
      "original_line" : 863,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 75,
      "pull_request_review_id" : 2088822400,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621067334/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T16:36:58Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621067334",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621071328"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621071328"
         }
      },
      "author_association" : "MEMBER",
      "body" : "@ryanofsky I'm not sure what the design philophy is behind `Ensure` and `EnsureAny`. The other methods here return more low level objects.\r\n\r\nPerhaps related to what you said in https://github.com/bitcoin/bitcoin/pull/29346#issuecomment-2110376536:\r\n\r\n> I think of \"Context\" as being a passive container for state instead of an object you would call methods on. The top level interfaces like `interfaces::Chain` `interface::Node` `interfaces::Wallet` are actually stateless themselves, and only point to state stored in other places. (The idea is to let interface instances be created and destroyed freely, since with multiprocess support new processes can connect and create interface pointers that get destroyed on disconnection, and the state of the node shouldn't be affected too much from connections and disconnections. Anyway, the mining interface could follow this pattern.)",
      "commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "created_at" : "2024-05-30T16:40:43Z",
      "diff_hunk" : "@@ -31,6 +34,7 @@ ChainstateManager& EnsureAnyChainman(const std::any& context);\n CBlockPolicyEstimator& EnsureFeeEstimator(const node::NodeContext& node);\n CBlockPolicyEstimator& EnsureAnyFeeEstimator(const std::any& context);\n CConnman& EnsureConnman(const node::NodeContext& node);\n+interfaces::Miner& EnsureMiner(const node::NodeContext& node);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621071328",
      "id" : 1621071328,
      "line" : 37,
      "node_id" : "PRRC_kwDOABII585gn5Xg",
      "original_commit_id" : "b30a8aca5191186f56eb1e9bd8f1a1d899a07039",
      "original_line" : 37,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/server_util.h",
      "position" : 14,
      "pull_request_review_id" : 2088829216,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621071328/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-05-30T16:41:23Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1621071328",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "Concept ACK",
      "created_at" : "2024-05-30T21:05:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2140862734",
      "id" : 2140862734,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII585_mvkO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2140862734/reactions"
      },
      "updated_at" : "2024-05-30T21:05:18Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2140862734",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/8421793?v=4",
         "events_url" : "https://api.github.com/users/TheCharlatan/events{/privacy}",
         "followers_url" : "https://api.github.com/users/TheCharlatan/followers",
         "following_url" : "https://api.github.com/users/TheCharlatan/following{/other_user}",
         "gists_url" : "https://api.github.com/users/TheCharlatan/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/TheCharlatan",
         "id" : 8421793,
         "login" : "TheCharlatan",
         "node_id" : "MDQ6VXNlcjg0MjE3OTM=",
         "organizations_url" : "https://api.github.com/users/TheCharlatan/orgs",
         "received_events_url" : "https://api.github.com/users/TheCharlatan/received_events",
         "repos_url" : "https://api.github.com/users/TheCharlatan/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/TheCharlatan/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/TheCharlatan/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/TheCharlatan"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626320289"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626320289"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621071328\r\n\r\nIn commit \"Introduce Miner interface\" (b30a8aca5191186f56eb1e9bd8f1a1d899a07039)\r\n\r\n> @ryanofsky I'm not sure what the design philophy is behind `Ensure` and `EnsureAny`. The other methods here return more low level objects.\r\n\r\nThis looks good to me. Ensure functions are just supposed to make it possible to access node/wallet state from RPCs in a type-safe way. There are similar functions for the wallet in src/wallet/rpc/util.h.\r\n\r\nIt is true that existing RPC methods just call node and wallet functions directly, instead of going through interface classes like the GUI does, because there hasn't been a need for preventing RPC methods from accessing node or wallet internals.\r\n\r\nBut it would be nice if we could prevent Stratum code from accessing node internals, so having a mining interface seems useful, and having the mining RPCs use the interface is a nice way to test it and make sure it is full-featured.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T16:43:01Z",
      "diff_hunk" : "@@ -31,6 +34,7 @@ ChainstateManager& EnsureAnyChainman(const std::any& context);\n CBlockPolicyEstimator& EnsureFeeEstimator(const node::NodeContext& node);\n CBlockPolicyEstimator& EnsureAnyFeeEstimator(const std::any& context);\n CConnman& EnsureConnman(const node::NodeContext& node);\n+interfaces::Miner& EnsureMiner(const node::NodeContext& node);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626320289",
      "id" : 1626320289,
      "in_reply_to_id" : 1621071328,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g762h",
      "original_commit_id" : "b30a8aca5191186f56eb1e9bd8f1a1d899a07039",
      "original_line" : 37,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/rpc/server_util.h",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626320289/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626320289",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626328774"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626328774"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: getblocktemplate getTip() via Miner interface\" (d5b354ed93266d76ab9e2dd2af9c9b611583a1ee)\r\n\r\nIt looks like all the other `Miner` parameters and return values are serializable except this CBlockIndex pointer. \r\n\r\nThis is fine for this PR, but if you wanted to support stratum code running in another process and calling this, you could change this return value to a struct containing whatever information the miner needs to know about the tip (block hash, previous block hash, block time, etc), instead returning of this pointer to a tree of blocks, which can't easily be used from another process.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T16:50:24Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INTERFACES_MINER_H\n+#define BITCOIN_INTERFACES_MINER_H\n+\n+namespace node {\n+struct CBlockTemplate;\n+struct NodeContext;\n+} // namespace node\n+\n+class CBlockIndex;\n+class BlockValidationState;\n+class CBlockIndex;\n+\n+namespace interfaces {\n+\n+//! Interface giving clients (RPC, Stratum v2 Template Provider in the future)\n+//! ability to create block templates.\n+\n+class Miner\n+{\n+public:\n+    virtual ~Miner() {}\n+\n+    /** If this chain is exclusively used for testing */\n+    virtual bool isTestChain() = 0;\n+\n+    //! Returns the index entry for the tip of this chain, or nullptr if none.\n+    virtual CBlockIndex* getTip() = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626328774",
      "id" : 1626328774,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g787G",
      "original_commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/interfaces/miner.h",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626328774/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626328774",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626346904"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626346904"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"Introduce Miner interface\" (b30a8aca5191186f56eb1e9bd8f1a1d899a07039)\r\n\r\nNot important, but could consider renaming this class.\r\n\r\n- interfaces::Node is an interface used by the gui to control the node\r\n- interfaces::Wallet is an interface used by the gui to control the node\r\n- interface::Chain is an interface used by the wallet and indexes to sync with the chain\r\n\r\ninterfaces::Miner sounds like an interface that would be used to control a miner, which is not really what this is. Maybe interfaces::Mining or interfaces::MiningService would be better.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T17:05:24Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INTERFACES_MINER_H\n+#define BITCOIN_INTERFACES_MINER_H\n+\n+namespace node {\n+struct CBlockTemplate;\n+struct NodeContext;\n+} // namespace node\n+\n+class CBlockIndex;\n+class BlockValidationState;\n+class CBlockIndex;\n+\n+namespace interfaces {\n+\n+//! Interface giving clients (RPC, Stratum v2 Template Provider in the future)\n+//! ability to create block templates.\n+\n+class Miner",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626346904",
      "id" : 1626346904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g8BWY",
      "original_commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/interfaces/miner.h",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626346904/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626346904",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626351637"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626351637"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: call TestBlockValidity via miner interface\" (d880aa0ebe374394b2f8c061ebc7d428f899b59b)\r\n\r\nMaybe unintended whitespace change here",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T17:09:37Z",
      "diff_hunk" : "@@ -694,6 +696,7 @@ static RPCHelpMan getblocktemplate()\n                 throw JSONRPCError(RPC_DESERIALIZATION_ERROR, \"Block decode failed\");\n \n             uint256 hash = block.GetHash();\n+",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626351637",
      "id" : 1626351637,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g8CgV",
      "original_commit_id" : "d880aa0ebe374394b2f8c061ebc7d428f899b59b",
      "original_line" : 699,
      "original_position" : 29,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626351637/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626351637",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626371955"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626371955"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: getblocktemplate getTip() via Miner interface\" (d5b354ed93266d76ab9e2dd2af9c9b611583a1ee)\r\n\r\nWould suggest introducing a `CBlockIndex* tip{miner.getTip()};` variable, using it where possible, and updating it as needed instead of calling `miner.getTip()` repeatedly in this function.\r\n\r\nIt seems like the reason it is ok to make multiple getTip() calls is that cs_main is locked for most of this function. But more ideally, this function would not be locking cs_main directly, only calling interface methods which lock cs_main internally. Using a tip variable in this code, instead of just assuming tip cannot change, would get closer to this state.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T17:24:56Z",
      "diff_hunk" : "@@ -761,7 +759,7 @@ static RPCHelpMan getblocktemplate()\n         else\n         {\n             // NOTE: Spec does not specify behaviour for non-string longpollid, but this makes testing easier\n-            hashWatchedChain = active_chain.Tip()->GetBlockHash();\n+            hashWatchedChain = miner.getTip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626371955",
      "id" : 1626371955,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g8Hdz",
      "original_commit_id" : "d5b354ed93266d76ab9e2dd2af9c9b611583a1ee",
      "original_line" : 762,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626371955/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626371955",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626379012"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626379012"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "re: https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1621067334\r\n\r\n> I guess I should change the `BlockAssembler` constructor\r\n\r\nIn commit \"rpc: call CreateNewBlock via miner interface\" (f04cf9f75054573c204245f7bb1e6813cce1fed8)\r\n\r\nI don't actually understand the TODO here. The way the mempool is passed seems ok. You could do mempool.get() instead of &*mempool, but both should be equivalent.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-04T17:30:34Z",
      "diff_hunk" : "@@ -854,6 +856,13 @@ class MinerImpl : public Miner\n         return TestBlockValidity(state, chainman().GetParams(), chainman().ActiveChainstate(), block, chainman().ActiveChain().Tip(), /*fCheckPOW=*/false, check_merkle_root);\n     }\n \n+    std::unique_ptr<CBlockTemplate> createNewBlock(const CScript& scriptPubKeyIn) override\n+    {\n+        LOCK(::cs_main);\n+        // TODO pass mempool sanely\n+        return BlockAssembler{chainman().ActiveChainstate(), &*(context()->mempool)}.CreateNewBlock(scriptPubKeyIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1626379012",
      "id" : 1626379012,
      "in_reply_to_id" : 1621067334,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585g8JME",
      "original_commit_id" : "f04cf9f75054573c204245f7bb1e6813cce1fed8",
      "original_line" : 863,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 2096918003,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626379012/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-04T17:41:24Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626379012",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967421"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967421"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I'm now setting `uint256 tip{miner.getTipHash()};` at the top. For long polls it's updated after the wait. See d1be135e568605539fa3932da6e7c5032816825b.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-07T09:56:37Z",
      "diff_hunk" : "@@ -761,7 +759,7 @@ static RPCHelpMan getblocktemplate()\n         else\n         {\n             // NOTE: Spec does not specify behaviour for non-string longpollid, but this makes testing easier\n-            hashWatchedChain = active_chain.Tip()->GetBlockHash();\n+            hashWatchedChain = miner.getTip()->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967421",
      "id" : 1630967421,
      "in_reply_to_id" : 1626371955,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hNpZ9",
      "original_commit_id" : "d5b354ed93266d76ab9e2dd2af9c9b611583a1ee",
      "original_line" : 762,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 2104138088,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967421/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-07T09:56:37Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967421",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967487"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967487"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Renamed to `Mining`",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-07T09:56:40Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INTERFACES_MINER_H\n+#define BITCOIN_INTERFACES_MINER_H\n+\n+namespace node {\n+struct CBlockTemplate;\n+struct NodeContext;\n+} // namespace node\n+\n+class CBlockIndex;\n+class BlockValidationState;\n+class CBlockIndex;\n+\n+namespace interfaces {\n+\n+//! Interface giving clients (RPC, Stratum v2 Template Provider in the future)\n+//! ability to create block templates.\n+\n+class Miner",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967487",
      "id" : 1630967487,
      "in_reply_to_id" : 1626346904,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hNpa_",
      "original_commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "original_line" : 22,
      "original_position" : 22,
      "original_start_line" : null,
      "path" : "src/interfaces/miner.h",
      "position" : null,
      "pull_request_review_id" : 2104138185,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967487/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-07T09:56:40Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967487",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967663"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967663"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I replaced `getTip()` with `getTipHash()`. `Sv2TemplateProvider` doesn't need it, so for now I use it in a few places in `rpc/mining.cpp`, but then fall back to `chainman.m_blockman.LookupBlockIndex(miner.getTipHash())` where we need more info.\r\n\r\nA future refactor could move more of `getblocktemplate` implementation details out of the RPC.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-07T09:56:48Z",
      "diff_hunk" : "@@ -0,0 +1,66 @@\n+// Copyright (c) 2024 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_INTERFACES_MINER_H\n+#define BITCOIN_INTERFACES_MINER_H\n+\n+namespace node {\n+struct CBlockTemplate;\n+struct NodeContext;\n+} // namespace node\n+\n+class CBlockIndex;\n+class BlockValidationState;\n+class CBlockIndex;\n+\n+namespace interfaces {\n+\n+//! Interface giving clients (RPC, Stratum v2 Template Provider in the future)\n+//! ability to create block templates.\n+\n+class Miner\n+{\n+public:\n+    virtual ~Miner() {}\n+\n+    /** If this chain is exclusively used for testing */\n+    virtual bool isTestChain() = 0;\n+\n+    //! Returns the index entry for the tip of this chain, or nullptr if none.\n+    virtual CBlockIndex* getTip() = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967663",
      "id" : 1630967663,
      "in_reply_to_id" : 1626328774,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hNpdv",
      "original_commit_id" : "87ba70a2731951a16432ca2d8d55c62bad87dd41",
      "original_line" : 31,
      "original_position" : 31,
      "original_start_line" : null,
      "path" : "src/interfaces/miner.h",
      "position" : null,
      "pull_request_review_id" : 2104138482,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967663/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-07T09:56:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967663",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967783"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967783"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Thanks, replaced it with `get()`.",
      "commit_id" : "d1be135e568605539fa3932da6e7c5032816825b",
      "created_at" : "2024-06-07T09:56:55Z",
      "diff_hunk" : "@@ -854,6 +856,13 @@ class MinerImpl : public Miner\n         return TestBlockValidity(state, chainman().GetParams(), chainman().ActiveChainstate(), block, chainman().ActiveChain().Tip(), /*fCheckPOW=*/false, check_merkle_root);\n     }\n \n+    std::unique_ptr<CBlockTemplate> createNewBlock(const CScript& scriptPubKeyIn) override\n+    {\n+        LOCK(::cs_main);\n+        // TODO pass mempool sanely\n+        return BlockAssembler{chainman().ActiveChainstate(), &*(context()->mempool)}.CreateNewBlock(scriptPubKeyIn);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1630967783",
      "id" : 1630967783,
      "in_reply_to_id" : 1621067334,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hNpfn",
      "original_commit_id" : "f04cf9f75054573c204245f7bb1e6813cce1fed8",
      "original_line" : 863,
      "original_position" : 24,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 2104138685,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967783/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-07T09:56:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1630967783",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky thanks for the review! I rebased and changed a few things to address comments, see inline.\r\n\r\nI'll cherry-pick this into #29432 to see if we need anything more.\r\n\r\n---\r\n\r\nSwitched back to draft.\r\n\r\nI need to add `IsInitialBlockDownload`, which was the last thing `Sv2TemplateProvider` still needs `ChainstateManager& m_chainman;` for.\r\n\r\nI also need to be able to pass `BlockAssembler::Options` into `createNewBlock` (in a serialisable way).\r\n\r\nForgot to rename `miner` on `NodeContext`, and `makeMiner` to `makeMining` in `init.h`. \r\n\r\nAdditionally the template provider needs to wait, to see if there's a new tip, with `g_best_block_cv.wait_until`. How would I go about moving that into this interface?",
      "created_at" : "2024-06-07T09:57:00Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2154504861",
      "id" : 2154504861,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586AayKd",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154504861/reactions"
      },
      "updated_at" : "2024-06-07T10:54:27Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154504861",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "All the above should be fixed now, except for `g_best_block_cv.wait_until` (but that's not blocking).\r\n\r\nThe biggest change is in 914c26bbd4d7e87af4e0d0edf9af69ae76668b7e. It now makes the `options` argument mandatory for `BlockAssembler` constructor, dropping implicit handling of `ArgsManager`. The caller i.e. the `Mining` interface implementation now handles this.\r\n\r\nIn Stratum v2 the pool communicates how many extra bytes it needs for its own outputs (payouts, extra commitments, etc). This needs to be subtracted from what the user set as -blockmaxweight. To achieve that the caller would have to pass in an options object, and not forget to also process `-blockmintxfee` - a mistake I made in #29432.",
      "created_at" : "2024-06-07T13:57:56Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2154903353",
      "id" : 2154903353,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586AcTc5",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154903353/reactions"
      },
      "updated_at" : "2024-06-07T13:57:56Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154903353",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "You can see the interface in action in https://github.com/bitcoin/bitcoin/pull/29432/commits/5078e51f4ad3c6bd01580d583274dd5faaf01c70, with one additional argument added to `createNewBlock ` in https://github.com/bitcoin/bitcoin/pull/29432/commits/41ac95ea547eef8c79eb8d2e995df8241f53c030\r\n\r\n--- \r\n\r\nOops, 914c26bbd4d7e87af4e0d0edf9af69ae76668b7e broke some tests, e.g. `test/functional/rpc_generate.py` ...",
      "created_at" : "2024-06-07T14:20:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2154948888",
      "id" : 2154948888,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586AcekY",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154948888/reactions"
      },
      "updated_at" : "2024-06-07T15:16:57Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2154948888",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "The `generateblock` RPC relies on not passing the mempool to `BlockAssembler`, in order to allow manual transaction selection. So I added `bool use_mempool = true` to `createNewBlock`.",
      "created_at" : "2024-06-07T15:04:18Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2155027685",
      "id" : 2155027685,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586Acxzl",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2155027685/reactions"
      },
      "updated_at" : "2024-06-07T15:05:11Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2155027685",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633296276"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633296276"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: call TestBlockValidity via miner interface\" (8589e6c44726d6b5760095d72c37934e4be3315c)\r\n\r\nWhy is the `testBlockValidity` check being moved before the block.hashPrevBlock != tip check? The previous ordering seemed more straightforward and consistent with \"TestBlockValidity only supports blocks built on the current Tip\" comment",
      "commit_id" : "febd3d1c3d41cf6083baf990fb2a3a69cade364a",
      "created_at" : "2024-06-10T13:54:43Z",
      "diff_hunk" : "@@ -703,12 +706,14 @@ static RPCHelpMan getblocktemplate()\n                 return \"duplicate-inconclusive\";\n             }\n \n+            BlockValidationState state;\n+            miner.testBlockValidity(state, block, /*check_merkle_root=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633296276",
      "id" : 1633296276,
      "line" : 708,
      "node_id" : "PRRC_kwDOABII585hWh-U",
      "original_commit_id" : "8589e6c44726d6b5760095d72c37934e4be3315c",
      "original_line" : 710,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 138,
      "pull_request_review_id" : 2107880187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633296276/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T14:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633296276",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633297880"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633297880"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: getblocktemplate getTip() via Miner interface\" (9c226c5c3818ef157fc50a5f6ecc534a612ac1d0)\r\n\r\nCommit message could be updated since this now called getTipHash",
      "commit_id" : "febd3d1c3d41cf6083baf990fb2a3a69cade364a",
      "created_at" : "2024-06-10T13:55:39Z",
      "diff_hunk" : "@@ -25,6 +26,9 @@ class Mining\n     /** If this chain is exclusively used for testing */\n     virtual bool isTestChain() = 0;\n \n+    //! Returns the hash for the tip of this chain, 0 if none\n+    virtual uint256 getTipHash() = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633297880",
      "id" : 1633297880,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585hWiXY",
      "original_commit_id" : "9c226c5c3818ef157fc50a5f6ecc534a612ac1d0",
      "original_line" : 30,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/interfaces/mining.h",
      "position" : 34,
      "pull_request_review_id" : 2107880187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633297880/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T14:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633297880",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633318785"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633318785"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: call CreateNewBlock via miner interface\" (f375fb9a0dff7ccead80626f4aee853db7799e6f)\r\n\r\nIt might be good to keep this ApplyArgsManOptions function for more consistency with other options parsing code. The node/interfaces.cpp createNewBlock function could call ApplyArgsManOptions instead of parsing options itself. The current approach also seems ok though if you prefer it.",
      "commit_id" : "febd3d1c3d41cf6083baf990fb2a3a69cade364a",
      "created_at" : "2024-06-10T14:08:15Z",
      "diff_hunk" : "@@ -203,9 +202,6 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\n void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);\n-\n-/** Apply -blockmintxfee and -blockmaxweight options from ArgsManager to BlockAssembler options. */\n-void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633318785",
      "id" : 1633318785,
      "line" : 208,
      "node_id" : "PRRC_kwDOABII585hWneB",
      "original_commit_id" : "f375fb9a0dff7ccead80626f4aee853db7799e6f",
      "original_line" : 208,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/node/miner.h",
      "position" : 14,
      "pull_request_review_id" : 2107880187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633318785/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T14:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633318785",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633363110"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633363110"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "In commit \"rpc: call CreateNewBlock via miner interface\" (f375fb9a0dff7ccead80626f4aee853db7799e6f)\r\n\r\nI'm not clear how this implementation lines up with the commit description which says \"the pool communicates how many extra bytes it needs for its own outputs (payouts, extra commitments, etc). This needs to be substracted from what the user set as -blockmaxweight.\"\r\n\r\nIs the commit description just saying that this implementation is not complete and it will need to be extended in the future? Would be helpful to clarify.",
      "commit_id" : "febd3d1c3d41cf6083baf990fb2a3a69cade364a",
      "created_at" : "2024-06-10T14:34:50Z",
      "diff_hunk" : "@@ -856,6 +859,20 @@ class MinerImpl : public Mining\n         return TestBlockValidity(state, chainman().GetParams(), chainman().ActiveChainstate(), block, chainman().ActiveChain().Tip(), /*fCheckPOW=*/false, check_merkle_root);\n     }\n \n+    std::unique_ptr<CBlockTemplate> createNewBlock(const CScript& scriptPubKeyIn, bool use_mempool) override\n+    {\n+        BlockAssembler::Options options;\n+\n+        // Block resource limits\n+        options.nBlockMaxWeight = gArgs.GetIntArg(\"-blockmaxweight\", options.nBlockMaxWeight);\n+        if (const auto blockmintxfee{gArgs.GetArg(\"-blockmintxfee\")}) {\n+            if (const auto parsed{ParseMoney(*blockmintxfee)}) options.blockMinFeeRate = CFeeRate{*parsed};\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633363110",
      "id" : 1633363110,
      "line" : 885,
      "node_id" : "PRRC_kwDOABII585hWySm",
      "original_commit_id" : "f375fb9a0dff7ccead80626f4aee853db7799e6f",
      "original_line" : 870,
      "original_position" : 36,
      "original_start_line" : 867,
      "path" : "src/node/interfaces.cpp",
      "position" : 94,
      "pull_request_review_id" : 2107880187,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633363110/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 882,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-10T14:45:02Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633363110",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633391557"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633391557"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Yes, this is a reference to the future change in sv2. I reworded it in 6b7c8c3e27ae529306d18019e7bd94b4ae5b9a21.",
      "commit_id" : "4f9c3369a453f7e5f0c12179dd629ee8fc042379",
      "created_at" : "2024-06-10T14:52:05Z",
      "diff_hunk" : "@@ -856,6 +859,20 @@ class MinerImpl : public Mining\n         return TestBlockValidity(state, chainman().GetParams(), chainman().ActiveChainstate(), block, chainman().ActiveChain().Tip(), /*fCheckPOW=*/false, check_merkle_root);\n     }\n \n+    std::unique_ptr<CBlockTemplate> createNewBlock(const CScript& scriptPubKeyIn, bool use_mempool) override\n+    {\n+        BlockAssembler::Options options;\n+\n+        // Block resource limits\n+        options.nBlockMaxWeight = gArgs.GetIntArg(\"-blockmaxweight\", options.nBlockMaxWeight);\n+        if (const auto blockmintxfee{gArgs.GetArg(\"-blockmintxfee\")}) {\n+            if (const auto parsed{ParseMoney(*blockmintxfee)}) options.blockMinFeeRate = CFeeRate{*parsed};\n+        }",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633391557",
      "id" : 1633391557,
      "in_reply_to_id" : 1633363110,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hW5PF",
      "original_commit_id" : "f375fb9a0dff7ccead80626f4aee853db7799e6f",
      "original_line" : 870,
      "original_position" : 36,
      "original_start_line" : 867,
      "path" : "src/node/interfaces.cpp",
      "position" : null,
      "pull_request_review_id" : 2108037087,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633391557/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-10T16:01:13Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633391557",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492530"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492530"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I split f375fb9a0dff7ccead80626f4aee853db7799e6f in two parts:\r\n\r\n1. 6d6ddcb759465c7375ff772faa960cf92805468a simply adds and uses the interface\r\n2. 6b7c8c3e27ae529306d18019e7bd94b4ae5b9a21 drops the `BlockAssembler` constructor without `options` argument\r\n\r\nI changed this second commit to keep `ApplyArgsManOptions`.",
      "commit_id" : "4f9c3369a453f7e5f0c12179dd629ee8fc042379",
      "created_at" : "2024-06-10T16:00:46Z",
      "diff_hunk" : "@@ -203,9 +202,6 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n \n /** Update an old GenerateCoinbaseCommitment from CreateNewBlock after the block txs have changed */\n void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);\n-\n-/** Apply -blockmintxfee and -blockmaxweight options from ArgsManager to BlockAssembler options. */\n-void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492530",
      "id" : 1633492530,
      "in_reply_to_id" : 1633318785,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hXR4y",
      "original_commit_id" : "f375fb9a0dff7ccead80626f4aee853db7799e6f",
      "original_line" : 208,
      "original_position" : 14,
      "original_start_line" : null,
      "path" : "src/node/miner.h",
      "position" : null,
      "pull_request_review_id" : 2108202167,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492530/reactions"
      },
      "side" : "LEFT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T16:00:47Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492530",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492626"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492626"
         }
      },
      "author_association" : "MEMBER",
      "body" : "Done",
      "commit_id" : "4f9c3369a453f7e5f0c12179dd629ee8fc042379",
      "created_at" : "2024-06-10T16:00:51Z",
      "diff_hunk" : "@@ -25,6 +26,9 @@ class Mining\n     /** If this chain is exclusively used for testing */\n     virtual bool isTestChain() = 0;\n \n+    //! Returns the hash for the tip of this chain, 0 if none\n+    virtual uint256 getTipHash() = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492626",
      "id" : 1633492626,
      "in_reply_to_id" : 1633297880,
      "line" : 34,
      "node_id" : "PRRC_kwDOABII585hXR6S",
      "original_commit_id" : "9c226c5c3818ef157fc50a5f6ecc534a612ac1d0",
      "original_line" : 34,
      "original_position" : 13,
      "original_start_line" : null,
      "path" : "src/interfaces/mining.h",
      "position" : 34,
      "pull_request_review_id" : 2108202322,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492626/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T16:00:51Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492626",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492703"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492703"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I think that was by accident. Moved it back in 609c9ca052d90d029435e24ec3331ef145c11fcf.",
      "commit_id" : "4f9c3369a453f7e5f0c12179dd629ee8fc042379",
      "created_at" : "2024-06-10T16:00:55Z",
      "diff_hunk" : "@@ -703,12 +706,14 @@ static RPCHelpMan getblocktemplate()\n                 return \"duplicate-inconclusive\";\n             }\n \n+            BlockValidationState state;\n+            miner.testBlockValidity(state, block, /*check_merkle_root=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1633492703",
      "id" : 1633492703,
      "in_reply_to_id" : 1633296276,
      "line" : null,
      "node_id" : "PRRC_kwDOABII585hXR7f",
      "original_commit_id" : "8589e6c44726d6b5760095d72c37934e4be3315c",
      "original_line" : 710,
      "original_position" : 38,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : null,
      "pull_request_review_id" : 2108202457,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492703/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-10T16:01:41Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1633492703",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "@ryanofsky do you have any thoughts on this (for this PR or a followup)?\r\n\r\n> Additionally the template provider needs to wait, to see if there's a new tip, with g_best_block_cv.wait_until. How would I go about moving that into this interface?\r\n\r\n",
      "created_at" : "2024-06-11T08:14:14Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2160080256",
      "id" : 2160080256,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586AwDWA",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2160080256/reactions"
      },
      "updated_at" : "2024-06-11T08:14:14Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2160080256",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "> > Additionally the template provider needs to wait, to see if there's a new tip, with g_best_block_cv.wait_until. How would I go about moving that into this interface?\r\n\r\nMaybe the simplest way to do it would be to have a waitTipChanged() method that just blocks waiting for a new tip, and would be interrupted when the node shuts down or the mining interface is destroyed. If needed, the waiting interface could have more features and accept a timeout or return an object with wait() and cancel() methods.\r\n\r\nAnother alternative would be to provide a callback interface instead of a waiting interface like interfaces::Node:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/0fbb8043ce0d6a931d5ce4bc877b6b596976a908/src/interfaces/node.h#L256-L259",
      "created_at" : "2024-06-11T13:25:39Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2160764070",
      "id" : 2160764070,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586AyqSm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2160764070/reactions"
      },
      "updated_at" : "2024-06-11T13:25:39Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2160764070",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/7133040?v=4",
         "events_url" : "https://api.github.com/users/ryanofsky/events{/privacy}",
         "followers_url" : "https://api.github.com/users/ryanofsky/followers",
         "following_url" : "https://api.github.com/users/ryanofsky/following{/other_user}",
         "gists_url" : "https://api.github.com/users/ryanofsky/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/ryanofsky",
         "id" : 7133040,
         "login" : "ryanofsky",
         "node_id" : "MDQ6VXNlcjcxMzMwNDA=",
         "organizations_url" : "https://api.github.com/users/ryanofsky/orgs",
         "received_events_url" : "https://api.github.com/users/ryanofsky/received_events",
         "repos_url" : "https://api.github.com/users/ryanofsky/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/ryanofsky/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/ryanofsky"
      }
   },
   {
      "author_association" : "CONTRIBUTOR",
      "body" : "<!--cf906140f33d8803c4a75a2196329ecb-->\nð This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "created_at" : "2024-06-12T22:26:29Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2164001166",
      "id" : 2164001166,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586A_AmO",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2164001166/reactions"
      },
      "updated_at" : "2024-06-12T22:26:29Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2164001166",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/39886733?v=4",
         "events_url" : "https://api.github.com/users/DrahtBot/events{/privacy}",
         "followers_url" : "https://api.github.com/users/DrahtBot/followers",
         "following_url" : "https://api.github.com/users/DrahtBot/following{/other_user}",
         "gists_url" : "https://api.github.com/users/DrahtBot/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/DrahtBot",
         "id" : 39886733,
         "login" : "DrahtBot",
         "node_id" : "MDQ6VXNlcjM5ODg2NzMz",
         "organizations_url" : "https://api.github.com/users/DrahtBot/orgs",
         "received_events_url" : "https://api.github.com/users/DrahtBot/received_events",
         "repos_url" : "https://api.github.com/users/DrahtBot/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/DrahtBot/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/DrahtBot"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Thanks for the review, and for the suggestions. I might add that later to this PR or as a followup.\r\n\r\nTrivial rebase after #29015.",
      "created_at" : "2024-06-13T14:49:32Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2165900439",
      "id" : 2165900439,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586BGQSX",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 1,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 1,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2165900439/reactions"
      },
      "updated_at" : "2024-06-13T14:49:32Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2165900439",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641433677"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641433677"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:  Since this is an interface, to maximize clarity it might be good to add Doxygen-ey style `@param` and `@returns` statements in the function comment, similar to `processNewBlock()`.\r\nSame for `createNewBlock()`.\r\n\r\nAlso, would it make sense to provide a default value for `check_merkle_root` (e.g. default true)?  Or do we want users of the interface to explicitly state whether or not they want merkle root checking performed?",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-15T19:59:22Z",
      "diff_hunk" : "@@ -22,6 +25,13 @@ class Mining\n     /** If this chain is exclusively used for testing */\n     virtual bool isTestChain() = 0;\n \n+    /**\n+     * Check a block is completely valid from start to finish.\n+     * Only works on top of our current best block.\n+     * Does not check proof-of-work.\n+     * */\n+    virtual bool testBlockValidity(BlockValidationState& state, const CBlock& block, bool check_merkle_root) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641433677",
      "id" : 1641433677,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII585h1kpN",
      "original_commit_id" : "2833c3ccf6ea0b43c296b5dd4f8e3107697590ff",
      "original_line" : 33,
      "original_position" : 19,
      "original_start_line" : 28,
      "path" : "src/interfaces/mining.h",
      "position" : 57,
      "pull_request_review_id" : 2120845152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641433677/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-15T21:19:34Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641433677",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641438112"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641438112"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit: If a default value for `check_merkle_root` is added to `testBlockValidity()`, this call could be updated as well.",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-15T20:17:22Z",
      "diff_hunk" : "@@ -706,10 +708,11 @@ static RPCHelpMan getblocktemplate()\n \n             CBlockIndex* const pindexPrev = active_chain.Tip();\n             // TestBlockValidity only supports blocks built on the current Tip\n-            if (block.hashPrevBlock != pindexPrev->GetBlockHash())\n+            if (block.hashPrevBlock != pindexPrev->GetBlockHash()) {\n                 return \"inconclusive-not-best-prevblk\";\n+            }\n             BlockValidationState state;\n-            TestBlockValidity(state, chainman.GetParams(), active_chainstate, block, pindexPrev, false, true);\n+            miner.testBlockValidity(state, block, /*check_merkle_root=*/true);",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641438112",
      "id" : 1641438112,
      "line" : 713,
      "node_id" : "PRRC_kwDOABII585h1lug",
      "original_commit_id" : "2833c3ccf6ea0b43c296b5dd4f8e3107697590ff",
      "original_line" : 715,
      "original_position" : 35,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 144,
      "pull_request_review_id" : 2120845152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641438112/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-15T21:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641438112",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641440653"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641440653"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "Although extraordinarily improbable, is the value of 0 reserved as an invalid hash (maybe I'm forgetting something)? If not, maybe it's worth updating this function to return something like `std::optional<uint256>` instead?",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-15T20:29:39Z",
      "diff_hunk" : "@@ -844,6 +844,14 @@ class MinerImpl : public Mining\n         return chainman().GetParams().IsTestChain();\n     }\n \n+    uint256 getTipHash() override\n+    {\n+        LOCK(::cs_main);\n+        CBlockIndex* tip{chainman().ActiveChain().Tip()};\n+        if (!tip) return uint256{0};\n+        return tip->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641440653",
      "id" : 1641440653,
      "line" : 859,
      "node_id" : "PRRC_kwDOABII585h1mWN",
      "original_commit_id" : "a78bc3ac4f600e656bf839aad9989c8bce51ae71",
      "original_line" : 852,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 59,
      "pull_request_review_id" : 2120845152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641440653/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-15T21:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641440653",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641492827"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641492827"
         }
      },
      "author_association" : "CONTRIBUTOR",
      "body" : "nit:  this comment (and the one on 811) still mention `CreateNewBlock` rather than the new `createNewBlock`.  Feel free to ignore unless touching this file for something else.",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-15T20:54:42Z",
      "diff_hunk" : "@@ -816,9 +815,10 @@ static RPCHelpMan getblocktemplate()\n \n         // Create new block\n         CScript scriptDummy = CScript() << OP_TRUE;\n-        pblocktemplate = BlockAssembler{active_chainstate, &mempool}.CreateNewBlock(scriptDummy);\n-        if (!pblocktemplate)\n+        pblocktemplate = miner.createNewBlock(scriptDummy);\n+        if (!pblocktemplate) {\n             throw JSONRPCError(RPC_OUT_OF_MEMORY, \"Out of memory\");\n+        }\n \n         // Need to update only after we know CreateNewBlock succeeded",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1641492827",
      "id" : 1641492827,
      "line" : 825,
      "node_id" : "PRRC_kwDOABII585h1zFb",
      "original_commit_id" : "9c7402bba8a6320bbe095e4b585c33a99f02315f",
      "original_line" : 823,
      "original_position" : 70,
      "original_start_line" : null,
      "path" : "src/rpc/mining.cpp",
      "position" : 225,
      "pull_request_review_id" : 2120845152,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641492827/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-15T21:18:15Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1641492827",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/106488469?v=4",
         "events_url" : "https://api.github.com/users/tdb3/events{/privacy}",
         "followers_url" : "https://api.github.com/users/tdb3/followers",
         "following_url" : "https://api.github.com/users/tdb3/following{/other_user}",
         "gists_url" : "https://api.github.com/users/tdb3/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/tdb3",
         "id" : 106488469,
         "login" : "tdb3",
         "node_id" : "U_kgDOBljilQ",
         "organizations_url" : "https://api.github.com/users/tdb3/orgs",
         "received_events_url" : "https://api.github.com/users/tdb3/received_events",
         "repos_url" : "https://api.github.com/users/tdb3/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/tdb3/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/tdb3/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/tdb3"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "> any other good ways you'd like to see these changes exercised `getblocktemplate()` is a pretty crucial RPC\r\n\r\nYou could test #27433 on top of the changes here. Or try solo CPU mining on a custom signet, e.g. using [pooler/cpuminer](https://github.com/pooler/cpuminer) and then:\r\n\r\n```sh\r\n./minerd -u bitcoin -p bitcoin -o http://127.0.0.1:38332 --coinbase-addr $ADDRESS --no-stratum --algo=sha256d\r\n```\r\n\r\nThe latter requires `signetchallenge=51` and a patch setting `#define GBT_RULES \"[\\\"segwit\\\", \\\"signet\\\"]\"`.\r\n\r\n> update the description\r\n\r\nDone\r\n\r\n---\r\n\r\nPushed an update to add Doxygen comments for functions that take at least one parameter. Also renamed `scriptPubKeyIn` to `script_pub_key`.\r\n\r\nI changed 38315fc9439ec18f3cb21e2c87c1c590dba78ee2 to have `getTipHash()` return an optional. Now that there's only two calls to it, it's not too tedious to (sanity) check for a missing tip.\r\n\r\n\r\nReview [hint](https://github.com/bitcoin/bitcoin/blob/master/doc/productivity.md#diff-the-diffs-with-git-range-diff):\r\n\r\n```sh\r\nPREV=5666af2 N=9 && git range-diff `git merge-base --all HEAD $PREV`...$PREV HEAD~$N...HEAD\r\n```",
      "created_at" : "2024-06-17T08:41:16Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2172702822",
      "id" : 2172702822,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586BgNBm",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2172702822/reactions"
      },
      "updated_at" : "2024-06-17T10:20:36Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2172702822",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1642458226"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642458226"
         }
      },
      "author_association" : "MEMBER",
      "body" : "`GetBlockHash()`, which was called directly before this commit, has an `assert` that `tip` must exist. So `return uint256{0};` should never happen. An optional does seem more robust though, will look into it.",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-17T09:00:48Z",
      "diff_hunk" : "@@ -844,6 +844,14 @@ class MinerImpl : public Mining\n         return chainman().GetParams().IsTestChain();\n     }\n \n+    uint256 getTipHash() override\n+    {\n+        LOCK(::cs_main);\n+        CBlockIndex* tip{chainman().ActiveChain().Tip()};\n+        if (!tip) return uint256{0};\n+        return tip->GetBlockHash();",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1642458226",
      "id" : 1642458226,
      "in_reply_to_id" : 1641440653,
      "line" : 859,
      "node_id" : "PRRC_kwDOABII585h5exy",
      "original_commit_id" : "a78bc3ac4f600e656bf839aad9989c8bce51ae71",
      "original_line" : 852,
      "original_position" : 9,
      "original_start_line" : null,
      "path" : "src/node/interfaces.cpp",
      "position" : 59,
      "pull_request_review_id" : 2122321591,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642458226/reactions"
      },
      "side" : "RIGHT",
      "start_line" : null,
      "start_side" : null,
      "subject_type" : "line",
      "updated_at" : "2024-06-17T09:00:48Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642458226",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "_links" : {
         "html" : {
            "href" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1642459287"
         },
         "pull_request" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200"
         },
         "self" : {
            "href" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642459287"
         }
      },
      "author_association" : "MEMBER",
      "body" : "I added a default `true` to mimic `TestBlockValidity` in `validation.h`.",
      "commit_id" : "5666af2c6e4924bf8e358ab5121c88d14cb085df",
      "created_at" : "2024-06-17T09:01:43Z",
      "diff_hunk" : "@@ -22,6 +25,13 @@ class Mining\n     /** If this chain is exclusively used for testing */\n     virtual bool isTestChain() = 0;\n \n+    /**\n+     * Check a block is completely valid from start to finish.\n+     * Only works on top of our current best block.\n+     * Does not check proof-of-work.\n+     * */\n+    virtual bool testBlockValidity(BlockValidationState& state, const CBlock& block, bool check_merkle_root) = 0;",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#discussion_r1642459287",
      "id" : 1642459287,
      "in_reply_to_id" : 1641433677,
      "line" : 57,
      "node_id" : "PRRC_kwDOABII585h5fCX",
      "original_commit_id" : "2833c3ccf6ea0b43c296b5dd4f8e3107697590ff",
      "original_line" : 33,
      "original_position" : 19,
      "original_start_line" : 28,
      "path" : "src/interfaces/mining.h",
      "position" : 57,
      "pull_request_review_id" : 2122323356,
      "pull_request_url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/30200",
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642459287/reactions"
      },
      "side" : "RIGHT",
      "start_line" : 52,
      "start_side" : "RIGHT",
      "subject_type" : "line",
      "updated_at" : "2024-06-17T09:01:43Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1642459287",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   },
   {
      "author_association" : "MEMBER",
      "body" : "Oops, `'TestBlockValidity failed: bad-txns-inputs-missingorspent'` in `rpc_generate.py`.",
      "created_at" : "2024-06-17T11:45:19Z",
      "html_url" : "https://github.com/bitcoin/bitcoin/pull/30200#issuecomment-2173170961",
      "id" : 2173170961,
      "issue_url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/30200",
      "node_id" : "IC_kwDOABII586Bh_UR",
      "performed_via_github_app" : null,
      "reactions" : {
         "+1" : 0,
         "-1" : 0,
         "confused" : 0,
         "eyes" : 0,
         "heart" : 0,
         "hooray" : 0,
         "laugh" : 0,
         "rocket" : 0,
         "total_count" : 0,
         "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2173170961/reactions"
      },
      "updated_at" : "2024-06-17T11:45:55Z",
      "url" : "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2173170961",
      "user" : {
         "avatar_url" : "https://avatars.githubusercontent.com/u/10217?v=4",
         "events_url" : "https://api.github.com/users/Sjors/events{/privacy}",
         "followers_url" : "https://api.github.com/users/Sjors/followers",
         "following_url" : "https://api.github.com/users/Sjors/following{/other_user}",
         "gists_url" : "https://api.github.com/users/Sjors/gists{/gist_id}",
         "gravatar_id" : "",
         "html_url" : "https://github.com/Sjors",
         "id" : 10217,
         "login" : "Sjors",
         "node_id" : "MDQ6VXNlcjEwMjE3",
         "organizations_url" : "https://api.github.com/users/Sjors/orgs",
         "received_events_url" : "https://api.github.com/users/Sjors/received_events",
         "repos_url" : "https://api.github.com/users/Sjors/repos",
         "site_admin" : false,
         "starred_url" : "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
         "subscriptions_url" : "https://api.github.com/users/Sjors/subscriptions",
         "type" : "User",
         "url" : "https://api.github.com/users/Sjors"
      }
   }
]
